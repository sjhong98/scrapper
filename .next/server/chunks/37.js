exports.id=37,exports.ids=[37],exports.modules={1605:($,ee)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.addAdminServicesToServer=ee.registerAdminService=void 0;let et=[];function registerAdminService($,ee){et.push({getServiceDefinition:$,getHandlers:ee})}function addAdminServicesToServer($){for(let{getServiceDefinition:ee,getHandlers:er}of et)$.addService(ee(),er())}ee.registerAdminService=registerAdminService,ee.addAdminServicesToServer=addAdminServicesToServer},77257:($,ee)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.BackoffTimeout=void 0;let et=1e3,er=1.6,en=12e4,ei=.2;function uniformRandom($,ee){return Math.random()*(ee-$)+$}let BackoffTimeout=class BackoffTimeout{constructor($,ee){this.callback=$,this.initialDelay=et,this.multiplier=er,this.maxDelay=en,this.jitter=ei,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,ee&&(ee.initialDelay&&(this.initialDelay=ee.initialDelay),ee.multiplier&&(this.multiplier=ee.multiplier),ee.jitter&&(this.jitter=ee.jitter),ee.maxDelay&&(this.maxDelay=ee.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer($){var ee,et;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},$),this.hasRef||null===(et=(ee=this.timerId).unref)||void 0===et||et.call(ee)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let $=Math.min(this.nextDelay*this.multiplier,this.maxDelay),ee=$*this.jitter;this.nextDelay=$+uniformRandom(-ee,ee)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let $=new Date,ee=this.startTime;ee.setMilliseconds(ee.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),$<ee?this.runTimer(ee.getTime()-$.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var $,ee;this.hasRef=!0,null===(ee=($=this.timerId).ref)||void 0===ee||ee.call($)}unref(){var $,ee;this.hasRef=!1,null===(ee=($=this.timerId).unref)||void 0===ee||ee.call($)}getEndTime(){return this.endTime}};ee.BackoffTimeout=BackoffTimeout},68612:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.CallCredentials=void 0;let er=et(32908);function isCurrentOauth2Client($){return"getRequestHeaders"in $&&"function"==typeof $.getRequestHeaders}let CallCredentials=class CallCredentials{static createFromMetadataGenerator($){return new SingleCallCredentials($)}static createFromGoogleCredential($){return CallCredentials.createFromMetadataGenerator((ee,et)=>{let en;(en=isCurrentOauth2Client($)?$.getRequestHeaders(ee.service_url):new Promise((et,er)=>{$.getRequestMetadata(ee.service_url,($,ee)=>{if($){er($);return}if(!ee){er(Error("Headers not set by metadata plugin"));return}et(ee)})})).then($=>{let ee=new er.Metadata;for(let et of Object.keys($))ee.add(et,$[et]);et(null,ee)},$=>{et($)})})}static createEmpty(){return new EmptyCallCredentials}};ee.CallCredentials=CallCredentials;let ComposedCallCredentials=class ComposedCallCredentials extends CallCredentials{constructor($){super(),this.creds=$}async generateMetadata($){let ee=new er.Metadata,et=await Promise.all(this.creds.map(ee=>ee.generateMetadata($)));for(let $ of et)ee.merge($);return ee}compose($){return new ComposedCallCredentials(this.creds.concat([$]))}_equals($){return this===$||$ instanceof ComposedCallCredentials&&this.creds.every((ee,et)=>ee._equals($.creds[et]))}};let SingleCallCredentials=class SingleCallCredentials extends CallCredentials{constructor($){super(),this.metadataGenerator=$}generateMetadata($){return new Promise((ee,et)=>{this.metadataGenerator($,($,er)=>{void 0!==er?ee(er):et($)})})}compose($){return new ComposedCallCredentials([this,$])}_equals($){return this===$||$ instanceof SingleCallCredentials&&this.metadataGenerator===$.metadataGenerator}};let EmptyCallCredentials=class EmptyCallCredentials extends CallCredentials{generateMetadata($){return Promise.resolve(new er.Metadata)}compose($){return $}_equals($){return $ instanceof EmptyCallCredentials}}},88577:($,ee)=>{"use strict";function isInterceptingListener($){return void 0!==$.onReceiveMetadata&&1===$.onReceiveMetadata.length}Object.defineProperty(ee,"__esModule",{value:!0}),ee.InterceptingListenerImpl=ee.isInterceptingListener=void 0,ee.isInterceptingListener=isInterceptingListener;let InterceptingListenerImpl=class InterceptingListenerImpl{constructor($,ee){this.listener=$,this.nextListener=ee,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata($){this.processingMetadata=!0,this.listener.onReceiveMetadata($,$=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata($),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage($){this.processingMessage=!0,this.listener.onReceiveMessage($,$=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=$,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage($),this.processPendingStatus())})}onReceiveStatus($){this.listener.onReceiveStatus($,$=>{this.processingMetadata||this.processingMessage?this.pendingStatus=$:this.nextListener.onReceiveStatus($)})}};ee.InterceptingListenerImpl=InterceptingListenerImpl},60060:($,ee)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.getNextCallNumber=void 0;let et=0;function getNextCallNumber(){return et++}ee.getNextCallNumber=getNextCallNumber},12953:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.ClientDuplexStreamImpl=ee.ClientWritableStreamImpl=ee.ClientReadableStreamImpl=ee.ClientUnaryCallImpl=ee.callErrorFromStatus=void 0;let er=et(82361),en=et(12781),ei=et(69238);function callErrorFromStatus($,ee){let et=`${$.code} ${ei.Status[$.code]}: ${$.details}`,er=Error(et),en=`${er.stack}
for call at
${ee}`;return Object.assign(Error(et),$,{stack:en})}ee.callErrorFromStatus=callErrorFromStatus;let ClientUnaryCallImpl=class ClientUnaryCallImpl extends er.EventEmitter{constructor(){super()}cancel(){var $;null===($=this.call)||void 0===$||$.cancelWithStatus(ei.Status.CANCELLED,"Cancelled on client")}getPeer(){var $,ee;return null!==(ee=null===($=this.call)||void 0===$?void 0:$.getPeer())&&void 0!==ee?ee:"unknown"}};ee.ClientUnaryCallImpl=ClientUnaryCallImpl;let ClientReadableStreamImpl=class ClientReadableStreamImpl extends en.Readable{constructor($){super({objectMode:!0}),this.deserialize=$}cancel(){var $;null===($=this.call)||void 0===$||$.cancelWithStatus(ei.Status.CANCELLED,"Cancelled on client")}getPeer(){var $,ee;return null!==(ee=null===($=this.call)||void 0===$?void 0:$.getPeer())&&void 0!==ee?ee:"unknown"}_read($){var ee;null===(ee=this.call)||void 0===ee||ee.startRead()}};ee.ClientReadableStreamImpl=ClientReadableStreamImpl;let ClientWritableStreamImpl=class ClientWritableStreamImpl extends en.Writable{constructor($){super({objectMode:!0}),this.serialize=$}cancel(){var $;null===($=this.call)||void 0===$||$.cancelWithStatus(ei.Status.CANCELLED,"Cancelled on client")}getPeer(){var $,ee;return null!==(ee=null===($=this.call)||void 0===$?void 0:$.getPeer())&&void 0!==ee?ee:"unknown"}_write($,ee,et){var er;let en={callback:et},ei=Number(ee);Number.isNaN(ei)||(en.flags=ei),null===(er=this.call)||void 0===er||er.sendMessageWithContext(en,$)}_final($){var ee;null===(ee=this.call)||void 0===ee||ee.halfClose(),$()}};ee.ClientWritableStreamImpl=ClientWritableStreamImpl;let ClientDuplexStreamImpl=class ClientDuplexStreamImpl extends en.Duplex{constructor($,ee){super({objectMode:!0}),this.serialize=$,this.deserialize=ee}cancel(){var $;null===($=this.call)||void 0===$||$.cancelWithStatus(ei.Status.CANCELLED,"Cancelled on client")}getPeer(){var $,ee;return null!==(ee=null===($=this.call)||void 0===$?void 0:$.getPeer())&&void 0!==ee?ee:"unknown"}_read($){var ee;null===(ee=this.call)||void 0===ee||ee.startRead()}_write($,ee,et){var er;let en={callback:et},ei=Number(ee);Number.isNaN(ei)||(en.flags=ei),null===(er=this.call)||void 0===er||er.sendMessageWithContext(en,$)}_final($){var ee;null===(ee=this.call)||void 0===ee||ee.halfClose(),$()}};ee.ClientDuplexStreamImpl=ClientDuplexStreamImpl},77021:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.ChannelCredentials=void 0;let er=et(24404),en=et(68612),ei=et(66801);function verifyIsBufferOrNull($,ee){if($&&!($ instanceof Buffer))throw TypeError(`${ee}, if provided, must be a Buffer.`)}let ChannelCredentials=class ChannelCredentials{constructor($){this.callCredentials=$||en.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl($,ee,et,en){var es;if(verifyIsBufferOrNull($,"Root certificate"),verifyIsBufferOrNull(ee,"Private key"),verifyIsBufferOrNull(et,"Certificate chain"),ee&&!et)throw Error("Private key must be given with accompanying certificate chain");if(!ee&&et)throw Error("Certificate chain must be given with accompanying private key");let eo=(0,er.createSecureContext)({ca:null!==(es=null!=$?$:(0,ei.getDefaultRootsData)())&&void 0!==es?es:void 0,key:null!=ee?ee:void 0,cert:null!=et?et:void 0,ciphers:ei.CIPHER_SUITES});return new SecureChannelCredentialsImpl(eo,null!=en?en:{})}static createFromSecureContext($,ee){return new SecureChannelCredentialsImpl($,null!=ee?ee:{})}static createInsecure(){return new InsecureChannelCredentialsImpl}};ee.ChannelCredentials=ChannelCredentials;let InsecureChannelCredentialsImpl=class InsecureChannelCredentialsImpl extends ChannelCredentials{constructor($){super($)}compose($){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals($){return $ instanceof InsecureChannelCredentialsImpl}};let SecureChannelCredentialsImpl=class SecureChannelCredentialsImpl extends ChannelCredentials{constructor($,ee){super(),this.secureContext=$,this.verifyOptions=ee,this.connectionOptions={secureContext:$},(null==ee?void 0:ee.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=ee.checkServerIdentity)}compose($){let ee=this.callCredentials.compose($);return new ComposedChannelCredentialsImpl(this,ee)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals($){return this===$||$ instanceof SecureChannelCredentialsImpl&&this.secureContext===$.secureContext&&this.verifyOptions.checkServerIdentity===$.verifyOptions.checkServerIdentity}};let ComposedChannelCredentialsImpl=class ComposedChannelCredentialsImpl extends ChannelCredentials{constructor($,ee){super(ee),this.channelCredentials=$}compose($){let ee=this.callCredentials.compose($);return new ComposedChannelCredentialsImpl(this.channelCredentials,ee)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals($){return this===$||$ instanceof ComposedChannelCredentialsImpl&&this.channelCredentials._equals($.channelCredentials)&&this.callCredentials._equals($.callCredentials)}}},70332:($,ee)=>{"use strict";function channelOptionsEqual($,ee){let et=Object.keys($).sort(),er=Object.keys(ee).sort();if(et.length!==er.length)return!1;for(let en=0;en<et.length;en+=1)if(et[en]!==er[en]||$[et[en]]!==ee[er[en]])return!1;return!0}Object.defineProperty(ee,"__esModule",{value:!0}),ee.channelOptionsEqual=ee.recognizedOptions=void 0,ee.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},ee.channelOptionsEqual=channelOptionsEqual},49914:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.ChannelImplementation=void 0;let er=et(77021),en=et(35233);let ChannelImplementation=class ChannelImplementation{constructor($,ee,et){if("string"!=typeof $)throw TypeError("Channel target must be a string");if(!(ee instanceof er.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(et&&"object"!=typeof et)throw TypeError("Channel options must be an object");this.internalChannel=new en.InternalChannel($,ee,et)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState($){return this.internalChannel.getConnectivityState($)}watchConnectivityState($,ee,et){this.internalChannel.watchConnectivityState($,ee,et)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall($,ee,et,er,en){if("string"!=typeof $)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof ee||ee instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall($,ee,et,er,en)}};ee.ChannelImplementation=ChannelImplementation},83316:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.setup=ee.getChannelzServiceDefinition=ee.getChannelzHandlers=ee.unregisterChannelzRef=ee.registerChannelzSocket=ee.registerChannelzServer=ee.registerChannelzSubchannel=ee.registerChannelzChannel=ee.ChannelzCallTracker=ee.ChannelzChildrenTracker=ee.ChannelzTrace=void 0;let er=et(41808),en=et(91360),ei=et(69238),es=et(72782),eo=et(1605),eu=et(47697);function channelRefToMessage($){return{channel_id:$.id,name:$.name}}function subchannelRefToMessage($){return{subchannel_id:$.id,name:$.name}}function serverRefToMessage($){return{server_id:$.id}}function socketRefToMessage($){return{socket_id:$.id,name:$.name}}let eh=32;let ChannelzTrace=class ChannelzTrace{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace($,ee,et){let er=new Date;this.events.push({description:ee,severity:$,timestamp:er,childChannel:(null==et?void 0:et.kind)==="channel"?et:void 0,childSubchannel:(null==et?void 0:et.kind)==="subchannel"?et:void 0}),this.events.length>=2*eh&&(this.events=this.events.slice(eh)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:dateToProtoTimestamp(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map($=>({description:$.description,severity:$.severity,timestamp:dateToProtoTimestamp($.timestamp),channel_ref:$.childChannel?channelRefToMessage($.childChannel):null,subchannel_ref:$.childSubchannel?subchannelRefToMessage($.childSubchannel):null}))}}};ee.ChannelzTrace=ChannelzTrace;let ChannelzChildrenTracker=class ChannelzChildrenTracker{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild($){var ee,et,er;switch($.kind){case"channel":{let et=null!==(ee=this.channelChildren.get($.id))&&void 0!==ee?ee:{ref:$,count:0};et.count+=1,this.channelChildren.set($.id,et);break}case"subchannel":{let ee=null!==(et=this.subchannelChildren.get($.id))&&void 0!==et?et:{ref:$,count:0};ee.count+=1,this.subchannelChildren.set($.id,ee);break}case"socket":{let ee=null!==(er=this.socketChildren.get($.id))&&void 0!==er?er:{ref:$,count:0};ee.count+=1,this.socketChildren.set($.id,ee)}}}unrefChild($){switch($.kind){case"channel":{let ee=this.channelChildren.get($.id);void 0!==ee&&(ee.count-=1,0===ee.count?this.channelChildren.delete($.id):this.channelChildren.set($.id,ee));break}case"subchannel":{let ee=this.subchannelChildren.get($.id);void 0!==ee&&(ee.count-=1,0===ee.count?this.subchannelChildren.delete($.id):this.subchannelChildren.set($.id,ee));break}case"socket":{let ee=this.socketChildren.get($.id);void 0!==ee&&(ee.count-=1,0===ee.count?this.socketChildren.delete($.id):this.socketChildren.set($.id,ee))}}}getChildLists(){let $=[];for(let{ref:ee}of this.channelChildren.values())$.push(ee);let ee=[];for(let{ref:$}of this.subchannelChildren.values())ee.push($);let et=[];for(let{ref:$}of this.socketChildren.values())et.push($);return{channels:$,subchannels:ee,sockets:et}}};ee.ChannelzChildrenTracker=ChannelzChildrenTracker;let ChannelzCallTracker=class ChannelzCallTracker{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};ee.ChannelzCallTracker=ChannelzCallTracker;let ep=1;function getNextId(){return ep++}let ef=[],em=[],eg=[],ey=[];function registerChannelzChannel($,ee,et){let er=getNextId(),en={id:er,name:$,kind:"channel"};return et&&(ef[er]={ref:en,getInfo:ee}),en}function registerChannelzSubchannel($,ee,et){let er=getNextId(),en={id:er,name:$,kind:"subchannel"};return et&&(em[er]={ref:en,getInfo:ee}),en}function registerChannelzServer($,ee){let et=getNextId(),er={id:et,kind:"server"};return ee&&(eg[et]={ref:er,getInfo:$}),er}function registerChannelzSocket($,ee,et){let er=getNextId(),en={id:er,name:$,kind:"socket"};return et&&(ey[er]={ref:en,getInfo:ee}),en}function unregisterChannelzRef($){switch($.kind){case"channel":delete ef[$.id];return;case"subchannel":delete em[$.id];return;case"server":delete eg[$.id];return;case"socket":delete ey[$.id];return}}function parseIPv6Section($){let ee=Number.parseInt($,16);return[ee/256|0,ee%256]}function parseIPv6Chunk($){if(""===$)return[];let ee=$.split(":").map($=>parseIPv6Section($)),et=[];return et.concat(...ee)}function ipAddressStringToBuffer($){if((0,er.isIPv4)($))return Buffer.from(Uint8Array.from($.split(".").map($=>Number.parseInt($))));if(!(0,er.isIPv6)($))return null;{let ee,et;let er=$.indexOf("::");-1===er?(ee=$,et=""):(ee=$.substring(0,er),et=$.substring(er+2));let en=Buffer.from(parseIPv6Chunk(ee)),ei=Buffer.from(parseIPv6Chunk(et)),es=Buffer.alloc(16-en.length-ei.length,0);return Buffer.concat([en,es,ei])}}function connectivityStateToMessage($){switch($){case en.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case en.ConnectivityState.IDLE:return{state:"IDLE"};case en.ConnectivityState.READY:return{state:"READY"};case en.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case en.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function dateToProtoTimestamp($){if(!$)return null;let ee=$.getTime();return{seconds:ee/1e3|0,nanos:ee%1e3*1e6}}function getChannelMessage($){let ee=$.getInfo();return{ref:channelRefToMessage($.ref),data:{target:ee.target,state:connectivityStateToMessage(ee.state),calls_started:ee.callTracker.callsStarted,calls_succeeded:ee.callTracker.callsSucceeded,calls_failed:ee.callTracker.callsFailed,last_call_started_timestamp:dateToProtoTimestamp(ee.callTracker.lastCallStartedTimestamp),trace:ee.trace.getTraceMessage()},channel_ref:ee.children.channels.map($=>channelRefToMessage($)),subchannel_ref:ee.children.subchannels.map($=>subchannelRefToMessage($))}}function GetChannel($,ee){let et=Number.parseInt($.request.channel_id),er=ef[et];if(void 0===er){ee({code:ei.Status.NOT_FOUND,details:"No channel data found for id "+et});return}ee(null,{channel:getChannelMessage(er)})}function GetTopChannels($,ee){let et=Number.parseInt($.request.max_results),er=[],en=Number.parseInt($.request.start_channel_id);for(;en<ef.length;en++){let $=ef[en];if(void 0!==$&&(er.push(getChannelMessage($)),er.length>=et))break}ee(null,{channel:er,end:en>=eg.length})}function getServerMessage($){let ee=$.getInfo();return{ref:serverRefToMessage($.ref),data:{calls_started:ee.callTracker.callsStarted,calls_succeeded:ee.callTracker.callsSucceeded,calls_failed:ee.callTracker.callsFailed,last_call_started_timestamp:dateToProtoTimestamp(ee.callTracker.lastCallStartedTimestamp),trace:ee.trace.getTraceMessage()},listen_socket:ee.listenerChildren.sockets.map($=>socketRefToMessage($))}}function GetServer($,ee){let et=Number.parseInt($.request.server_id),er=eg[et];if(void 0===er){ee({code:ei.Status.NOT_FOUND,details:"No server data found for id "+et});return}ee(null,{server:getServerMessage(er)})}function GetServers($,ee){let et=Number.parseInt($.request.max_results),er=[],en=Number.parseInt($.request.start_server_id);for(;en<eg.length;en++){let $=eg[en];if(void 0!==$&&(er.push(getServerMessage($)),er.length>=et))break}ee(null,{server:er,end:en>=eg.length})}function GetSubchannel($,ee){let et=Number.parseInt($.request.subchannel_id),er=em[et];if(void 0===er){ee({code:ei.Status.NOT_FOUND,details:"No subchannel data found for id "+et});return}let en=er.getInfo(),es={ref:subchannelRefToMessage(er.ref),data:{target:en.target,state:connectivityStateToMessage(en.state),calls_started:en.callTracker.callsStarted,calls_succeeded:en.callTracker.callsSucceeded,calls_failed:en.callTracker.callsFailed,last_call_started_timestamp:dateToProtoTimestamp(en.callTracker.lastCallStartedTimestamp),trace:en.trace.getTraceMessage()},socket_ref:en.children.sockets.map($=>socketRefToMessage($))};ee(null,{subchannel:es})}function subchannelAddressToAddressMessage($){var ee;return(0,es.isTcpSubchannelAddress)($)?{address:"tcpip_address",tcpip_address:{ip_address:null!==(ee=ipAddressStringToBuffer($.host))&&void 0!==ee?ee:void 0,port:$.port}}:{address:"uds_address",uds_address:{filename:$.path}}}function GetSocket($,ee){var et,er,en,es,eo;let eu=Number.parseInt($.request.socket_id),eh=ey[eu];if(void 0===eh){ee({code:ei.Status.NOT_FOUND,details:"No socket data found for id "+eu});return}let ep=eh.getInfo(),ef=ep.security?{model:"tls",tls:{cipher_suite:ep.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!==(et=ep.security.cipherSuiteStandardName)&&void 0!==et?et:void 0,other_name:null!==(er=ep.security.cipherSuiteOtherName)&&void 0!==er?er:void 0,local_certificate:null!==(en=ep.security.localCertificate)&&void 0!==en?en:void 0,remote_certificate:null!==(es=ep.security.remoteCertificate)&&void 0!==es?es:void 0}}:null,em={ref:socketRefToMessage(eh.ref),local:ep.localAddress?subchannelAddressToAddressMessage(ep.localAddress):null,remote:ep.remoteAddress?subchannelAddressToAddressMessage(ep.remoteAddress):null,remote_name:null!==(eo=ep.remoteName)&&void 0!==eo?eo:void 0,security:ef,data:{keep_alives_sent:ep.keepAlivesSent,streams_started:ep.streamsStarted,streams_succeeded:ep.streamsSucceeded,streams_failed:ep.streamsFailed,last_local_stream_created_timestamp:dateToProtoTimestamp(ep.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:dateToProtoTimestamp(ep.lastRemoteStreamCreatedTimestamp),messages_received:ep.messagesReceived,messages_sent:ep.messagesSent,last_message_received_timestamp:dateToProtoTimestamp(ep.lastMessageReceivedTimestamp),last_message_sent_timestamp:dateToProtoTimestamp(ep.lastMessageSentTimestamp),local_flow_control_window:ep.localFlowControlWindow?{value:ep.localFlowControlWindow}:null,remote_flow_control_window:ep.remoteFlowControlWindow?{value:ep.remoteFlowControlWindow}:null}};ee(null,{socket:em})}function GetServerSockets($,ee){let et=Number.parseInt($.request.server_id),er=eg[et];if(void 0===er){ee({code:ei.Status.NOT_FOUND,details:"No server data found for id "+et});return}let en=Number.parseInt($.request.start_socket_id),es=Number.parseInt($.request.max_results),eo=er.getInfo(),eu=eo.sessionChildren.sockets.sort(($,ee)=>$.id-ee.id),eh=[],ep=0;for(;ep<eu.length&&(!(eu[ep].id>=en)||(eh.push(socketRefToMessage(eu[ep])),!(eh.length>=es)));ep++);ee(null,{socket_ref:eh,end:ep>=eu.length})}function getChannelzHandlers(){return{GetChannel,GetTopChannels,GetServer,GetServers,GetSubchannel,GetSocket,GetServerSockets}}ee.registerChannelzChannel=registerChannelzChannel,ee.registerChannelzSubchannel=registerChannelzSubchannel,ee.registerChannelzServer=registerChannelzServer,ee.registerChannelzSocket=registerChannelzSocket,ee.unregisterChannelzRef=unregisterChannelzRef,ee.getChannelzHandlers=getChannelzHandlers;let ev=null;function getChannelzServiceDefinition(){if(ev)return ev;let $=et(18196).J_,ee=$("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]}),er=(0,eu.loadPackageDefinition)(ee);return ev=er.grpc.channelz.v1.Channelz.service}function setup(){(0,eo.registerAdminService)(getChannelzServiceDefinition,getChannelzHandlers)}ee.getChannelzServiceDefinition=getChannelzServiceDefinition,ee.setup=setup},72158:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.getInterceptingCall=ee.InterceptingCall=ee.RequesterBuilder=ee.ListenerBuilder=ee.InterceptorConfigurationError=void 0;let er=et(32908),en=et(88577),ei=et(69238),es=et(9006);let InterceptorConfigurationError=class InterceptorConfigurationError extends Error{constructor($){super($),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,InterceptorConfigurationError)}};ee.InterceptorConfigurationError=InterceptorConfigurationError;let ListenerBuilder=class ListenerBuilder{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata($){return this.metadata=$,this}withOnReceiveMessage($){return this.message=$,this}withOnReceiveStatus($){return this.status=$,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};ee.ListenerBuilder=ListenerBuilder;let RequesterBuilder=class RequesterBuilder{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart($){return this.start=$,this}withSendMessage($){return this.message=$,this}withHalfClose($){return this.halfClose=$,this}withCancel($){return this.cancel=$,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};ee.RequesterBuilder=RequesterBuilder;let eo={onReceiveMetadata:($,ee)=>{ee($)},onReceiveMessage:($,ee)=>{ee($)},onReceiveStatus:($,ee)=>{ee($)}},eu={start:($,ee,et)=>{et($,ee)},sendMessage:($,ee)=>{ee($)},halfClose:$=>{$()},cancel:$=>{$()}};let InterceptingCall=class InterceptingCall{constructor($,ee){var et,er,en,ei;this.nextCall=$,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,ee?this.requester={start:null!==(et=ee.start)&&void 0!==et?et:eu.start,sendMessage:null!==(er=ee.sendMessage)&&void 0!==er?er:eu.sendMessage,halfClose:null!==(en=ee.halfClose)&&void 0!==en?en:eu.halfClose,cancel:null!==(ei=ee.cancel)&&void 0!==ei?ei:eu.cancel}:this.requester=eu}cancelWithStatus($,ee){this.requester.cancel(()=>{this.nextCall.cancelWithStatus($,ee)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start($,ee){var et,er,ei,es,eu,eh;let ep={onReceiveMetadata:null!==(er=null===(et=null==ee?void 0:ee.onReceiveMetadata)||void 0===et?void 0:et.bind(ee))&&void 0!==er?er:$=>{},onReceiveMessage:null!==(es=null===(ei=null==ee?void 0:ee.onReceiveMessage)||void 0===ei?void 0:ei.bind(ee))&&void 0!==es?es:$=>{},onReceiveStatus:null!==(eh=null===(eu=null==ee?void 0:ee.onReceiveStatus)||void 0===eu?void 0:eu.bind(ee))&&void 0!==eh?eh:$=>{}};this.processingMetadata=!0,this.requester.start($,ep,($,ee)=>{var et,er,ei;let es;if(this.processingMetadata=!1,(0,en.isInterceptingListener)(ee))es=ee;else{let $={onReceiveMetadata:null!==(et=ee.onReceiveMetadata)&&void 0!==et?et:eo.onReceiveMetadata,onReceiveMessage:null!==(er=ee.onReceiveMessage)&&void 0!==er?er:eo.onReceiveMessage,onReceiveStatus:null!==(ei=ee.onReceiveStatus)&&void 0!==ei?ei:eo.onReceiveStatus};es=new en.InterceptingListenerImpl($,ep)}this.nextCall.start($,es),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext($,ee){this.processingMessage=!0,this.requester.sendMessage(ee,et=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=$,this.pendingMessage=ee):(this.nextCall.sendMessageWithContext($,et),this.processPendingHalfClose())})}sendMessage($){this.sendMessageWithContext({},$)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};function getCall($,ee,et){var er,en;let ei=null!==(er=et.deadline)&&void 0!==er?er:1/0,es=et.host,eo=null!==(en=et.parent)&&void 0!==en?en:null,eu=et.propagate_flags,eh=et.credentials,ep=$.createCall(ee,ei,es,eo,eu);return eh&&ep.setCredentials(eh),ep}ee.InterceptingCall=InterceptingCall;let BaseInterceptingCall=class BaseInterceptingCall{constructor($,ee){this.call=$,this.methodDefinition=ee}cancelWithStatus($,ee){this.call.cancelWithStatus($,ee)}getPeer(){return this.call.getPeer()}sendMessageWithContext($,ee){let et;try{et=this.methodDefinition.requestSerialize(ee)}catch($){this.call.cancelWithStatus(ei.Status.INTERNAL,`Request message serialization failure: ${(0,es.getErrorMessage)($)}`);return}this.call.sendMessageWithContext($,et)}sendMessage($){this.sendMessageWithContext({},$)}start($,ee){let et=null;this.call.start($,{onReceiveMetadata:$=>{var et;null===(et=null==ee?void 0:ee.onReceiveMetadata)||void 0===et||et.call(ee,$)},onReceiveMessage:$=>{var en;let eo;try{eo=this.methodDefinition.responseDeserialize($)}catch($){et={code:ei.Status.INTERNAL,details:`Response message parsing error: ${(0,es.getErrorMessage)($)}`,metadata:new er.Metadata},this.call.cancelWithStatus(et.code,et.details);return}null===(en=null==ee?void 0:ee.onReceiveMessage)||void 0===en||en.call(ee,eo)},onReceiveStatus:$=>{var er,en;et?null===(er=null==ee?void 0:ee.onReceiveStatus)||void 0===er||er.call(ee,et):null===(en=null==ee?void 0:ee.onReceiveStatus)||void 0===en||en.call(ee,$)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}};let BaseUnaryInterceptingCall=class BaseUnaryInterceptingCall extends BaseInterceptingCall{constructor($,ee){super($,ee)}start($,ee){var et,er;let en=!1,ei={onReceiveMetadata:null!==(er=null===(et=null==ee?void 0:ee.onReceiveMetadata)||void 0===et?void 0:et.bind(ee))&&void 0!==er?er:$=>{},onReceiveMessage:$=>{var et;en=!0,null===(et=null==ee?void 0:ee.onReceiveMessage)||void 0===et||et.call(ee,$)},onReceiveStatus:$=>{var et,er;en||null===(et=null==ee?void 0:ee.onReceiveMessage)||void 0===et||et.call(ee,null),null===(er=null==ee?void 0:ee.onReceiveStatus)||void 0===er||er.call(ee,$)}};super.start($,ei),this.call.startRead()}};let BaseStreamingInterceptingCall=class BaseStreamingInterceptingCall extends BaseInterceptingCall{};function getBottomInterceptingCall($,ee,et){let er=getCall($,et.path,ee);return et.responseStream?new BaseStreamingInterceptingCall(er,et):new BaseUnaryInterceptingCall(er,et)}function getInterceptingCall($,ee,et,er){if($.clientInterceptors.length>0&&$.clientInterceptorProviders.length>0)throw new InterceptorConfigurationError("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if($.callInterceptors.length>0&&$.callInterceptorProviders.length>0)throw new InterceptorConfigurationError("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let en=[];en=$.callInterceptors.length>0||$.callInterceptorProviders.length>0?[].concat($.callInterceptors,$.callInterceptorProviders.map($=>$(ee))).filter($=>$):[].concat($.clientInterceptors,$.clientInterceptorProviders.map($=>$(ee))).filter($=>$);let ei=Object.assign({},et,{method_definition:ee}),es=en.reduceRight(($,ee)=>et=>ee(et,$),$=>getBottomInterceptingCall(er,$,ee));return es(ei)}ee.getInterceptingCall=getInterceptingCall},47307:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.Client=void 0;let er=et(12953),en=et(49914),ei=et(91360),es=et(69238),eo=et(32908),eu=et(72158),eh=Symbol(),ep=Symbol(),ef=Symbol(),em=Symbol();function isFunction($){return"function"==typeof $}function getErrorStackString($){return $.stack.split("\n").slice(1).join("\n")}let Client=class Client{constructor($,ee,et={}){var er,ei;if(et=Object.assign({},et),this[ep]=null!==(er=et.interceptors)&&void 0!==er?er:[],delete et.interceptors,this[ef]=null!==(ei=et.interceptor_providers)&&void 0!==ei?ei:[],delete et.interceptor_providers,this[ep].length>0&&this[ef].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[em]=et.callInvocationTransformer,delete et.callInvocationTransformer,et.channelOverride)this[eh]=et.channelOverride;else if(et.channelFactoryOverride){let er=et.channelFactoryOverride;delete et.channelFactoryOverride,this[eh]=er($,ee,et)}else this[eh]=new en.ChannelImplementation($,ee,et)}close(){this[eh].close()}getChannel(){return this[eh]}waitForReady($,ee){let checkState=et=>{let er;if(et){ee(Error("Failed to connect before the deadline"));return}try{er=this[eh].getConnectivityState(!0)}catch($){ee(Error("The channel has been closed"));return}if(er===ei.ConnectivityState.READY)ee();else try{this[eh].watchConnectivityState(er,$,checkState)}catch($){ee(Error("The channel has been closed"))}};setImmediate(checkState)}checkOptionalUnaryResponseArguments($,ee,et){if(isFunction($))return{metadata:new eo.Metadata,options:{},callback:$};if(isFunction(ee))return $ instanceof eo.Metadata?{metadata:$,options:{},callback:ee}:{metadata:new eo.Metadata,options:$,callback:ee};if(!($ instanceof eo.Metadata&&ee instanceof Object&&isFunction(et)))throw Error("Incorrect arguments passed");return{metadata:$,options:ee,callback:et}}makeUnaryRequest($,ee,et,en,ei,eo,eg){var ey,ev;let eS=this.checkOptionalUnaryResponseArguments(ei,eo,eg),eC={path:$,requestStream:!1,responseStream:!1,requestSerialize:ee,responseDeserialize:et},eT={argument:en,metadata:eS.metadata,call:new er.ClientUnaryCallImpl,channel:this[eh],methodDefinition:eC,callOptions:eS.options,callback:eS.callback};this[em]&&(eT=this[em](eT));let eE=eT.call,ew={clientInterceptors:this[ep],clientInterceptorProviders:this[ef],callInterceptors:null!==(ey=eT.callOptions.interceptors)&&void 0!==ey?ey:[],callInterceptorProviders:null!==(ev=eT.callOptions.interceptor_providers)&&void 0!==ev?ev:[]},eD=(0,eu.getInterceptingCall)(ew,eT.methodDefinition,eT.callOptions,eT.channel);eE.call=eD;let eI=null,eR=!1,e_=Error();return eD.start(eT.metadata,{onReceiveMetadata:$=>{eE.emit("metadata",$)},onReceiveMessage($){null!==eI&&eD.cancelWithStatus(es.Status.INTERNAL,"Too many responses received"),eI=$},onReceiveStatus($){if(!eR){if(eR=!0,$.code===es.Status.OK){if(null===eI){let ee=getErrorStackString(e_);eT.callback((0,er.callErrorFromStatus)({code:es.Status.INTERNAL,details:"No message received",metadata:$.metadata},ee))}else eT.callback(null,eI)}else{let ee=getErrorStackString(e_);eT.callback((0,er.callErrorFromStatus)($,ee))}e_=null,eE.emit("status",$)}}}),eD.sendMessage(en),eD.halfClose(),eE}makeClientStreamRequest($,ee,et,en,ei,eo){var eg,ey;let ev=this.checkOptionalUnaryResponseArguments(en,ei,eo),eS={path:$,requestStream:!0,responseStream:!1,requestSerialize:ee,responseDeserialize:et},eC={metadata:ev.metadata,call:new er.ClientWritableStreamImpl(ee),channel:this[eh],methodDefinition:eS,callOptions:ev.options,callback:ev.callback};this[em]&&(eC=this[em](eC));let eT=eC.call,eE={clientInterceptors:this[ep],clientInterceptorProviders:this[ef],callInterceptors:null!==(eg=eC.callOptions.interceptors)&&void 0!==eg?eg:[],callInterceptorProviders:null!==(ey=eC.callOptions.interceptor_providers)&&void 0!==ey?ey:[]},ew=(0,eu.getInterceptingCall)(eE,eC.methodDefinition,eC.callOptions,eC.channel);eT.call=ew;let eD=null,eI=!1,eR=Error();return ew.start(eC.metadata,{onReceiveMetadata:$=>{eT.emit("metadata",$)},onReceiveMessage($){null!==eD&&ew.cancelWithStatus(es.Status.INTERNAL,"Too many responses received"),eD=$},onReceiveStatus($){if(!eI){if(eI=!0,$.code===es.Status.OK){if(null===eD){let ee=getErrorStackString(eR);eC.callback((0,er.callErrorFromStatus)({code:es.Status.INTERNAL,details:"No message received",metadata:$.metadata},ee))}else eC.callback(null,eD)}else{let ee=getErrorStackString(eR);eC.callback((0,er.callErrorFromStatus)($,ee))}eR=null,eT.emit("status",$)}}}),eT}checkMetadataAndOptions($,ee){let et,er;return $ instanceof eo.Metadata?(et=$,er=ee||{}):(er=$||{},et=new eo.Metadata),{metadata:et,options:er}}makeServerStreamRequest($,ee,et,en,ei,eo){var eg,ey;let ev=this.checkMetadataAndOptions(ei,eo),eS={path:$,requestStream:!1,responseStream:!0,requestSerialize:ee,responseDeserialize:et},eC={argument:en,metadata:ev.metadata,call:new er.ClientReadableStreamImpl(et),channel:this[eh],methodDefinition:eS,callOptions:ev.options};this[em]&&(eC=this[em](eC));let eT=eC.call,eE={clientInterceptors:this[ep],clientInterceptorProviders:this[ef],callInterceptors:null!==(eg=eC.callOptions.interceptors)&&void 0!==eg?eg:[],callInterceptorProviders:null!==(ey=eC.callOptions.interceptor_providers)&&void 0!==ey?ey:[]},ew=(0,eu.getInterceptingCall)(eE,eC.methodDefinition,eC.callOptions,eC.channel);eT.call=ew;let eD=!1,eI=Error();return ew.start(eC.metadata,{onReceiveMetadata($){eT.emit("metadata",$)},onReceiveMessage($){eT.push($)},onReceiveStatus($){if(!eD){if(eD=!0,eT.push(null),$.code!==es.Status.OK){let ee=getErrorStackString(eI);eT.emit("error",(0,er.callErrorFromStatus)($,ee))}eI=null,eT.emit("status",$)}}}),ew.sendMessage(en),ew.halfClose(),eT}makeBidiStreamRequest($,ee,et,en,ei){var eo,eg;let ey=this.checkMetadataAndOptions(en,ei),ev={path:$,requestStream:!0,responseStream:!0,requestSerialize:ee,responseDeserialize:et},eS={metadata:ey.metadata,call:new er.ClientDuplexStreamImpl(ee,et),channel:this[eh],methodDefinition:ev,callOptions:ey.options};this[em]&&(eS=this[em](eS));let eC=eS.call,eT={clientInterceptors:this[ep],clientInterceptorProviders:this[ef],callInterceptors:null!==(eo=eS.callOptions.interceptors)&&void 0!==eo?eo:[],callInterceptorProviders:null!==(eg=eS.callOptions.interceptor_providers)&&void 0!==eg?eg:[]},eE=(0,eu.getInterceptingCall)(eT,eS.methodDefinition,eS.callOptions,eS.channel);eC.call=eE;let ew=!1,eD=Error();return eE.start(eS.metadata,{onReceiveMetadata($){eC.emit("metadata",$)},onReceiveMessage($){eC.push($)},onReceiveStatus($){if(!ew){if(ew=!0,eC.push(null),$.code!==es.Status.OK){let ee=getErrorStackString(eD);eC.emit("error",(0,er.callErrorFromStatus)($,ee))}eD=null,eC.emit("status",$)}}}),eC}};ee.Client=Client},56702:($,ee)=>{"use strict";var et;Object.defineProperty(ee,"__esModule",{value:!0}),ee.CompressionAlgorithms=void 0,function($){$[$.identity=0]="identity",$[$.deflate=1]="deflate",$[$.gzip=2]="gzip"}(et||(ee.CompressionAlgorithms=et={}))},69718:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.CompressionFilterFactory=ee.CompressionFilter=void 0;let er=et(59796),en=et(56702),ei=et(69238),es=et(81818),eo=et(68200),isCompressionAlgorithmKey=$=>"number"==typeof $&&"string"==typeof en.CompressionAlgorithms[$];let CompressionHandler=class CompressionHandler{async writeMessage($,ee){let et=$;ee&&(et=await this.compressMessage(et));let er=Buffer.allocUnsafe(et.length+5);return er.writeUInt8(ee?1:0,0),er.writeUInt32BE(et.length,1),et.copy(er,5),er}async readMessage($){let ee=1===$.readUInt8(0),et=$.slice(5);return ee&&(et=await this.decompressMessage(et)),et}};let IdentityHandler=class IdentityHandler extends CompressionHandler{async compressMessage($){return $}async writeMessage($,ee){let et=Buffer.allocUnsafe($.length+5);return et.writeUInt8(0,0),et.writeUInt32BE($.length,1),$.copy(et,5),et}decompressMessage($){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}};let DeflateHandler=class DeflateHandler extends CompressionHandler{compressMessage($){return new Promise((ee,et)=>{er.deflate($,($,er)=>{$?et($):ee(er)})})}decompressMessage($){return new Promise((ee,et)=>{er.inflate($,($,er)=>{$?et($):ee(er)})})}};let GzipHandler=class GzipHandler extends CompressionHandler{compressMessage($){return new Promise((ee,et)=>{er.gzip($,($,er)=>{$?et($):ee(er)})})}decompressMessage($){return new Promise((ee,et)=>{er.unzip($,($,er)=>{$?et($):ee(er)})})}};let UnknownHandler=class UnknownHandler extends CompressionHandler{constructor($){super(),this.compressionName=$}compressMessage($){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage($){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}};function getCompressionHandler($){switch($){case"identity":return new IdentityHandler;case"deflate":return new DeflateHandler;case"gzip":return new GzipHandler;default:return new UnknownHandler($)}}let CompressionFilter=class CompressionFilter extends es.BaseFilter{constructor($,ee){var et;super(),this.sharedFilterConfig=ee,this.sendCompression=new IdentityHandler,this.receiveCompression=new IdentityHandler,this.currentCompressionAlgorithm="identity";let er=$["grpc.default_compression_algorithm"];if(void 0!==er){if(isCompressionAlgorithmKey(er)){let $=en.CompressionAlgorithms[er],ei=null===(et=ee.serverSupportedEncodingHeader)||void 0===et?void 0:et.split(",");(!ei||ei.includes($))&&(this.currentCompressionAlgorithm=$,this.sendCompression=getCompressionHandler(this.currentCompressionAlgorithm))}else eo.log(ei.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${er}`)}}async sendMetadata($){let ee=await $;return ee.set("grpc-accept-encoding","identity,deflate,gzip"),ee.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?ee.remove("grpc-encoding"):ee.set("grpc-encoding",this.currentCompressionAlgorithm),ee}receiveMetadata($){let ee=$.get("grpc-encoding");if(ee.length>0){let $=ee[0];"string"==typeof $&&(this.receiveCompression=getCompressionHandler($))}$.remove("grpc-encoding");let et=$.get("grpc-accept-encoding")[0];if(et){this.sharedFilterConfig.serverSupportedEncodingHeader=et;let $=et.split(",");$.includes(this.currentCompressionAlgorithm)||(this.sendCompression=new IdentityHandler,this.currentCompressionAlgorithm="identity")}return $.remove("grpc-accept-encoding"),$}async sendMessage($){var ee;let et;let er=await $;return et=!(this.sendCompression instanceof IdentityHandler)&&((null!==(ee=er.flags)&&void 0!==ee?ee:0)&2)==0,{message:await this.sendCompression.writeMessage(er.message,et),flags:er.flags}}async receiveMessage($){return this.receiveCompression.readMessage(await $)}};ee.CompressionFilter=CompressionFilter;let CompressionFilterFactory=class CompressionFilterFactory{constructor($,ee){this.options=ee,this.sharedFilterConfig={}}createFilter(){return new CompressionFilter(this.options,this.sharedFilterConfig)}};ee.CompressionFilterFactory=CompressionFilterFactory},91360:($,ee)=>{"use strict";var et;Object.defineProperty(ee,"__esModule",{value:!0}),ee.ConnectivityState=void 0,function($){$[$.IDLE=0]="IDLE",$[$.CONNECTING=1]="CONNECTING",$[$.READY=2]="READY",$[$.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",$[$.SHUTDOWN=4]="SHUTDOWN"}(et||(ee.ConnectivityState=et={}))},69238:($,ee)=>{"use strict";var et,er,en;Object.defineProperty(ee,"__esModule",{value:!0}),ee.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=ee.DEFAULT_MAX_SEND_MESSAGE_LENGTH=ee.Propagate=ee.LogVerbosity=ee.Status=void 0,function($){$[$.OK=0]="OK",$[$.CANCELLED=1]="CANCELLED",$[$.UNKNOWN=2]="UNKNOWN",$[$.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",$[$.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",$[$.NOT_FOUND=5]="NOT_FOUND",$[$.ALREADY_EXISTS=6]="ALREADY_EXISTS",$[$.PERMISSION_DENIED=7]="PERMISSION_DENIED",$[$.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",$[$.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",$[$.ABORTED=10]="ABORTED",$[$.OUT_OF_RANGE=11]="OUT_OF_RANGE",$[$.UNIMPLEMENTED=12]="UNIMPLEMENTED",$[$.INTERNAL=13]="INTERNAL",$[$.UNAVAILABLE=14]="UNAVAILABLE",$[$.DATA_LOSS=15]="DATA_LOSS",$[$.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(et||(ee.Status=et={})),function($){$[$.DEBUG=0]="DEBUG",$[$.INFO=1]="INFO",$[$.ERROR=2]="ERROR",$[$.NONE=3]="NONE"}(er||(ee.LogVerbosity=er={})),function($){$[$.DEADLINE=1]="DEADLINE",$[$.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",$[$.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",$[$.CANCELLATION=8]="CANCELLATION",$[$.DEFAULTS=65535]="DEFAULTS"}(en||(ee.Propagate=en={})),ee.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,ee.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},6614:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.restrictControlPlaneStatusCode=void 0;let er=et(69238),en=[er.Status.OK,er.Status.INVALID_ARGUMENT,er.Status.NOT_FOUND,er.Status.ALREADY_EXISTS,er.Status.FAILED_PRECONDITION,er.Status.ABORTED,er.Status.OUT_OF_RANGE,er.Status.DATA_LOSS];function restrictControlPlaneStatusCode($,ee){return en.includes($)?{code:er.Status.INTERNAL,details:`Invalid status from control plane: ${$} ${er.Status[$]} ${ee}`}:{code:$,details:ee}}ee.restrictControlPlaneStatusCode=restrictControlPlaneStatusCode},50823:($,ee)=>{"use strict";function minDeadline(...$){let ee=1/0;for(let et of $){let $=et instanceof Date?et.getTime():et;$<ee&&(ee=$)}return ee}Object.defineProperty(ee,"__esModule",{value:!0}),ee.deadlineToString=ee.getRelativeTimeout=ee.getDeadlineTimeoutString=ee.minDeadline=void 0,ee.minDeadline=minDeadline;let et=[["m",1],["S",1e3],["M",6e4],["H",36e5]];function getDeadlineTimeoutString($){let ee=new Date().getTime();$ instanceof Date&&($=$.getTime());let er=Math.max($-ee,0);for(let[$,ee]of et){let et=er/ee;if(et<1e8)return String(Math.ceil(et))+$}throw Error("Deadline is too far in the future")}ee.getDeadlineTimeoutString=getDeadlineTimeoutString;let er=2147483647;function getRelativeTimeout($){let ee=$ instanceof Date?$.getTime():$,et=new Date().getTime(),en=ee-et;return en<0?0:en>er?1/0:en}function deadlineToString($){if($ instanceof Date)return $.toISOString();{let ee=new Date($);return Number.isNaN(ee.getTime())?""+$:ee.toISOString()}}ee.getRelativeTimeout=getRelativeTimeout,ee.deadlineToString=deadlineToString},89589:($,ee)=>{"use strict";function msToDuration($){return{seconds:$/1e3|0,nanos:$%1e3*1e6|0}}function durationToMs($){return 1e3*$.seconds+$.nanos/1e6|0}function isDuration($){return"number"==typeof $.seconds&&"number"==typeof $.nanos}Object.defineProperty(ee,"__esModule",{value:!0}),ee.isDuration=ee.durationToMs=ee.msToDuration=void 0,ee.msToDuration=msToDuration,ee.durationToMs=durationToMs,ee.isDuration=isDuration},9006:($,ee)=>{"use strict";function getErrorMessage($){return $ instanceof Error?$.message:String($)}function getErrorCode($){return"object"==typeof $&&null!==$&&"code"in $&&"number"==typeof $.code?$.code:null}Object.defineProperty(ee,"__esModule",{value:!0}),ee.getErrorCode=ee.getErrorMessage=void 0,ee.getErrorMessage=getErrorMessage,ee.getErrorCode=getErrorCode},86868:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.OutlierDetectionLoadBalancingConfig=ee.BaseSubchannelWrapper=ee.registerAdminService=ee.FilterStackFactory=ee.BaseFilter=ee.PickResultType=ee.QueuePicker=ee.UnavailablePicker=ee.ChildLoadBalancerHandler=ee.subchannelAddressToString=ee.validateLoadBalancingConfig=ee.getFirstUsableConfig=ee.registerLoadBalancerType=ee.createChildChannelControlHelper=ee.BackoffTimeout=ee.durationToMs=ee.uriToString=ee.createResolver=ee.registerResolver=ee.log=ee.trace=void 0;var er=et(68200);Object.defineProperty(ee,"trace",{enumerable:!0,get:function(){return er.trace}}),Object.defineProperty(ee,"log",{enumerable:!0,get:function(){return er.log}});var en=et(14755);Object.defineProperty(ee,"registerResolver",{enumerable:!0,get:function(){return en.registerResolver}}),Object.defineProperty(ee,"createResolver",{enumerable:!0,get:function(){return en.createResolver}});var ei=et(14717);Object.defineProperty(ee,"uriToString",{enumerable:!0,get:function(){return ei.uriToString}});var es=et(89589);Object.defineProperty(ee,"durationToMs",{enumerable:!0,get:function(){return es.durationToMs}});var eo=et(77257);Object.defineProperty(ee,"BackoffTimeout",{enumerable:!0,get:function(){return eo.BackoffTimeout}});var eu=et(77203);Object.defineProperty(ee,"createChildChannelControlHelper",{enumerable:!0,get:function(){return eu.createChildChannelControlHelper}}),Object.defineProperty(ee,"registerLoadBalancerType",{enumerable:!0,get:function(){return eu.registerLoadBalancerType}}),Object.defineProperty(ee,"getFirstUsableConfig",{enumerable:!0,get:function(){return eu.getFirstUsableConfig}}),Object.defineProperty(ee,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return eu.validateLoadBalancingConfig}});var eh=et(72782);Object.defineProperty(ee,"subchannelAddressToString",{enumerable:!0,get:function(){return eh.subchannelAddressToString}});var ep=et(38390);Object.defineProperty(ee,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return ep.ChildLoadBalancerHandler}});var ef=et(32939);Object.defineProperty(ee,"UnavailablePicker",{enumerable:!0,get:function(){return ef.UnavailablePicker}}),Object.defineProperty(ee,"QueuePicker",{enumerable:!0,get:function(){return ef.QueuePicker}}),Object.defineProperty(ee,"PickResultType",{enumerable:!0,get:function(){return ef.PickResultType}});var em=et(81818);Object.defineProperty(ee,"BaseFilter",{enumerable:!0,get:function(){return em.BaseFilter}});var eg=et(4213);Object.defineProperty(ee,"FilterStackFactory",{enumerable:!0,get:function(){return eg.FilterStackFactory}});var ey=et(1605);Object.defineProperty(ee,"registerAdminService",{enumerable:!0,get:function(){return ey.registerAdminService}});var ev=et(69609);Object.defineProperty(ee,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return ev.BaseSubchannelWrapper}});var eS=et(35683);Object.defineProperty(ee,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return eS.OutlierDetectionLoadBalancingConfig}})},4213:($,ee)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.FilterStackFactory=ee.FilterStack=void 0;let FilterStack=class FilterStack{constructor($){this.filters=$}sendMetadata($){let ee=$;for(let $=0;$<this.filters.length;$++)ee=this.filters[$].sendMetadata(ee);return ee}receiveMetadata($){let ee=$;for(let $=this.filters.length-1;$>=0;$--)ee=this.filters[$].receiveMetadata(ee);return ee}sendMessage($){let ee=$;for(let $=0;$<this.filters.length;$++)ee=this.filters[$].sendMessage(ee);return ee}receiveMessage($){let ee=$;for(let $=this.filters.length-1;$>=0;$--)ee=this.filters[$].receiveMessage(ee);return ee}receiveTrailers($){let ee=$;for(let $=this.filters.length-1;$>=0;$--)ee=this.filters[$].receiveTrailers(ee);return ee}push($){this.filters.unshift(...$)}getFilters(){return this.filters}};ee.FilterStack=FilterStack;let FilterStackFactory=class FilterStackFactory{constructor($){this.factories=$}push($){this.factories.unshift(...$)}clone(){return new FilterStackFactory([...this.factories])}createFilter(){return new FilterStack(this.factories.map($=>$.createFilter()))}};ee.FilterStackFactory=FilterStackFactory},81818:($,ee)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.BaseFilter=void 0;let BaseFilter=class BaseFilter{async sendMetadata($){return $}receiveMetadata($){return $}async sendMessage($){return $}async receiveMessage($){return $}receiveTrailers($){return $}};ee.BaseFilter=BaseFilter},18304:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.getProxiedConnection=ee.mapProxyName=void 0;let er=et(68200),en=et(69238),ei=et(14755),es=et(13685),eo=et(24404),eu=et(68200),eh=et(72782),ep=et(14717),ef=et(57310),em="proxy";function trace($){eu.trace(en.LogVerbosity.DEBUG,em,$)}function getProxyInfo(){let $,ee="",et="";if(process.env.grpc_proxy)et="grpc_proxy",ee=process.env.grpc_proxy;else if(process.env.https_proxy)et="https_proxy",ee=process.env.https_proxy;else{if(!process.env.http_proxy)return{};et="http_proxy",ee=process.env.http_proxy}try{$=new ef.URL(ee)}catch($){return(0,er.log)(en.LogVerbosity.ERROR,`cannot parse value of "${et}" env var`),{}}if("http:"!==$.protocol)return(0,er.log)(en.LogVerbosity.ERROR,`"${$.protocol}" scheme not supported in proxy URI`),{};let ei=null;$.username&&($.password?((0,er.log)(en.LogVerbosity.INFO,"userinfo found in proxy URI"),ei=`${$.username}:${$.password}`):ei=$.username);let es=$.hostname,eo=$.port;""===eo&&(eo="80");let eu={address:`${es}:${eo}`};return ei&&(eu.creds=ei),trace("Proxy server "+eu.address+" set by environment variable "+et),eu}function getNoProxyHostList(){let $=process.env.no_grpc_proxy,ee="no_grpc_proxy";return($||($=process.env.no_proxy,ee="no_proxy"),$)?(trace("No proxy server list set by environment variable "+ee),$.split(",")):[]}function mapProxyName($,ee){var et;let er={target:$,extraOptions:{}};if((null!==(et=ee["grpc.enable_http_proxy"])&&void 0!==et?et:1)===0||"unix"===$.scheme)return er;let en=getProxyInfo();if(!en.address)return er;let ei=(0,ep.splitHostPort)($.path);if(!ei)return er;let es=ei.host;for(let ee of getNoProxyHostList())if(ee===es)return trace("Not using proxy for target in no_proxy list: "+(0,ep.uriToString)($)),er;let eo={"grpc.http_connect_target":(0,ep.uriToString)($)};return en.creds&&(eo["grpc.http_connect_creds"]=en.creds),{target:{scheme:"dns",path:en.address},extraOptions:eo}}function getProxiedConnection($,ee,et){if(!("grpc.http_connect_target"in ee))return Promise.resolve({});let eu=ee["grpc.http_connect_target"],ef=(0,ep.parseUri)(eu);if(null===ef)return Promise.resolve({});let em={method:"CONNECT",path:ef.path},eg={Host:ef.path};(0,eh.isTcpSubchannelAddress)($)?(em.host=$.host,em.port=$.port):em.socketPath=$.path,"grpc.http_connect_creds"in ee&&(eg["Proxy-Authorization"]="Basic "+Buffer.from(ee["grpc.http_connect_creds"]).toString("base64")),em.headers=eg;let ey=(0,eh.subchannelAddressToString)($);return trace("Using proxy "+ey+" to connect to "+em.path),new Promise(($,ee)=>{let eu=es.request(em);eu.once("connect",(es,eh,eg)=>{var ev;if(eu.removeAllListeners(),eh.removeAllListeners(),200===es.statusCode){if(trace("Successfully connected to "+em.path+" through proxy "+ey),"secureContext"in et){let er=(0,ei.getDefaultAuthority)(ef),en=(0,ep.splitHostPort)(er),es=null!==(ev=null==en?void 0:en.host)&&void 0!==ev?ev:er,eu=eo.connect(Object.assign({host:es,servername:es,socket:eh},et),()=>{trace("Successfully established a TLS connection to "+em.path+" through proxy "+ey),$({socket:eu,realTarget:ef})});eu.on("error",$=>{trace("Failed to establish a TLS connection to "+em.path+" through proxy "+ey+" with error "+$.message),ee()})}else trace("Successfully established a plaintext connection to "+em.path+" through proxy "+ey),$({socket:eh,realTarget:ef})}else(0,er.log)(en.LogVerbosity.ERROR,"Failed to connect to "+em.path+" through proxy "+ey+" with status "+es.statusCode),ee()}),eu.once("error",$=>{eu.removeAllListeners(),(0,er.log)(en.LogVerbosity.ERROR,"Failed to connect to proxy "+ey+" with error "+$.message),ee()}),eu.end()})}ee.mapProxyName=mapProxyName,ee.getProxiedConnection=getProxiedConnection},16063:($,ee,et)=>{"use strict";eS={value:!0},eS=eS=eS=eS=eS=eS=eS=eS=eS=eS=eS=eS=eS=eS=eS=eS=eS=eS=eS=eS=eS=eS=eS=ee.Rz=eS=eS=eS=eS=eS=eS=ee.SF=ee.K9=void 0;let er=et(68612);eS={enumerable:!0,get:function(){return er.CallCredentials}};let en=et(49914);eS={enumerable:!0,get:function(){return en.ChannelImplementation}};let ei=et(56702);eS={enumerable:!0,get:function(){return ei.CompressionAlgorithms}};let es=et(91360);eS={enumerable:!0,get:function(){return es.ConnectivityState}};let eo=et(77021);eS={enumerable:!0,get:function(){return eo.ChannelCredentials}};let eu=et(47307);eS={enumerable:!0,get:function(){return eu.Client}};let eh=et(69238);eS={enumerable:!0,get:function(){return eh.LogVerbosity}},eS={enumerable:!0,get:function(){return eh.Status}},eS={enumerable:!0,get:function(){return eh.Propagate}};let ep=et(68200),ef=et(47697);Object.defineProperty(ee,"Rz",{enumerable:!0,get:function(){return ef.loadPackageDefinition}}),eS={enumerable:!0,get:function(){return ef.makeClientConstructor}},eS={enumerable:!0,get:function(){return ef.makeClientConstructor}};let em=et(32908);Object.defineProperty(ee,"SF",{enumerable:!0,get:function(){return em.Metadata}});let eg=et(92903);eS={enumerable:!0,get:function(){return eg.Server}};let ey=et(62501);eS={enumerable:!0,get:function(){return ey.ServerCredentials}};let ev=et(9929);eS={enumerable:!0,get:function(){return ev.StatusBuilder}},ee.K9={combineChannelCredentials:($,...ee)=>ee.reduce(($,ee)=>$.compose(ee),$),combineCallCredentials:($,...ee)=>ee.reduce(($,ee)=>$.compose(ee),$),createInsecure:eo.ChannelCredentials.createInsecure,createSsl:eo.ChannelCredentials.createSsl,createFromSecureContext:eo.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:er.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:er.CallCredentials.createFromGoogleCredential,createEmpty:er.CallCredentials.createEmpty};let closeClient=$=>$.close();eS=closeClient;let waitForClientReady=($,ee,et)=>$.waitForReady(ee,et);eS=waitForClientReady;let loadObject=($,ee)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};eS=loadObject;let load=($,ee,et)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};eS=load;let setLogger=$=>{ep.setLogger($)};eS=setLogger;let setLogVerbosity=$=>{ep.setLoggerVerbosity($)};eS=setLogVerbosity;let getClientChannel=$=>eu.Client.prototype.getChannel.call($);eS=getClientChannel;var eS,eC=et(72158);eS={enumerable:!0,get:function(){return eC.ListenerBuilder}},eS={enumerable:!0,get:function(){return eC.RequesterBuilder}},eS={enumerable:!0,get:function(){return eC.InterceptingCall}},eS={enumerable:!0,get:function(){return eC.InterceptorConfigurationError}};var eT=et(83316);eS={enumerable:!0,get:function(){return eT.getChannelzServiceDefinition}},eS={enumerable:!0,get:function(){return eT.getChannelzHandlers}};var eE=et(1605);eS={enumerable:!0,get:function(){return eE.addAdminServicesToServer}};let ew=et(86868);eS=ew;let eD=et(84988),eI=et(50864),eR=et(96633),e_=et(72190),eP=et(19580),eA=et(35683),ex=et(83316),eO=et(81513).i8;(()=>{ep.trace(eh.LogVerbosity.DEBUG,"index","Loading @grpc/grpc-js version "+eO),eD.setup(),eI.setup(),eR.setup(),e_.setup(),eP.setup(),eA.setup(),ex.setup()})()},35233:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.InternalChannel=void 0;let er=et(77021),en=et(61839),ei=et(88364),es=et(32939),eo=et(69238),eu=et(4213),eh=et(69718),ep=et(14755),ef=et(68200),em=et(41732),eg=et(18304),ey=et(14717),ev=et(91360),eS=et(83316),eC=et(80439),eT=et(50823),eE=et(65700),ew=et(60060),eD=et(6614),eI=et(97564),eR=et(69609),e_=2147483647,eP=1e3,eA=18e5,ex=new Map,eO=16777216,ek=1048576;let ChannelSubchannelWrapper=class ChannelSubchannelWrapper extends eR.BaseSubchannelWrapper{constructor($,ee){super($),this.channel=ee,this.refCount=0,this.subchannelStateListener=($,et,er,en)=>{ee.throttleKeepalive(en)},$.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}};let InternalChannel=class InternalChannel{constructor($,ee,et){var eC,eT,eE,ew,eR,eN,eM,eF;if(this.credentials=ee,this.options=et,this.connectivityState=ev.ConnectivityState.IDLE,this.currentPicker=new es.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new eS.ChannelzCallTracker,this.childrenTracker=new eS.ChannelzChildrenTracker,"string"!=typeof $)throw TypeError("Channel target must be a string");if(!(ee instanceof er.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(et&&"object"!=typeof et)throw TypeError("Channel options must be an object");this.originalTarget=$;let eL=(0,ey.parseUri)($);if(null===eL)throw Error(`Could not parse target name "${$}"`);let eB=(0,ep.mapUriDefaultScheme)(eL);if(null===eB)throw Error(`Could not find a default scheme for target name "${$}"`);this.callRefTimer=setInterval(()=>{},e_),null===(eT=(eC=this.callRefTimer).unref)||void 0===eT||eT.call(eC),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new eS.ChannelzTrace,this.channelzRef=(0,eS.registerChannelzChannel)($,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,ep.getDefaultAuthority)(eB);let eV=(0,eg.mapProxyName)(eB,et);this.target=eV.target,this.options=Object.assign({},this.options,eV.extraOptions),this.subchannelPool=(0,ei.getSubchannelPool)((null!==(eE=et["grpc.use_local_subchannel_pool"])&&void 0!==eE?eE:0)===0),this.retryBufferTracker=new eI.MessageBufferTracker(null!==(ew=et["grpc.retry_buffer_size"])&&void 0!==ew?ew:eO,null!==(eR=et["grpc.per_rpc_retry_buffer_size"])&&void 0!==eR?eR:ek),this.keepaliveTime=null!==(eN=et["grpc.keepalive_time_ms"])&&void 0!==eN?eN:-1,this.idleTimeoutMs=Math.max(null!==(eM=et["grpc.client_idle_timeout_ms"])&&void 0!==eM?eM:eA,eP);let ej={createSubchannel:($,ee)=>{let et=this.subchannelPool.getOrCreateSubchannel(this.target,$,Object.assign({},this.options,ee),this.credentials);et.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",et.getChannelzRef());let er=new ChannelSubchannelWrapper(et,this);return this.wrappedSubchannels.add(er),er},updateState:($,ee)=>{this.currentPicker=ee;let et=this.pickQueue.slice();for(let $ of(this.pickQueue=[],this.callRefTimerUnref(),et))$.doPick();this.updateState($)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:$=>{this.channelzEnabled&&this.childrenTracker.refChild($)},removeChannelzChild:$=>{this.channelzEnabled&&this.childrenTracker.unrefChild($)}};this.resolvingLoadBalancer=new en.ResolvingLoadBalancer(this.target,ej,et,($,ee)=>{$.retryThrottling?ex.set(this.getTarget(),new eI.RetryThrottler($.retryThrottling.maxTokens,$.retryThrottling.tokenRatio,ex.get(this.getTarget()))):ex.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=ee,this.currentResolutionError=null,process.nextTick(()=>{let $=this.configSelectionQueue;for(let ee of(this.configSelectionQueue=[],this.callRefTimerUnref(),$))ee.getConfig();this.configSelectionQueue=[]})},$=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+$.code+' and details "'+$.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,eD.restrictControlPlaneStatusCode)($.code,$.details)),{metadata:$.metadata}));let ee=this.configSelectionQueue;for(let et of(this.configSelectionQueue=[],this.callRefTimerUnref(),ee))et.reportResolverError($)}),this.filterStackFactory=new eu.FilterStackFactory([new em.MaxMessageSizeFilterFactory(this.options),new eh.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(et,void 0,2));let eU=Error();(0,ef.trace)(eo.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null===(eF=eU.stack)||void 0===eF?void 0:eF.substring(eU.stack.indexOf("\n")+1)))}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace($,ee){(0,ef.trace)(null!=ee?ee:eo.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,ey.uriToString)(this.target)+" "+$)}callRefTimerRef(){var $,ee,et,er;(null===(ee=($=this.callRefTimer).hasRef)||void 0===ee?void 0:ee.call($))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null===(er=(et=this.callRefTimer).ref)||void 0===er||er.call(et))}callRefTimerUnref(){var $,ee;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null===(ee=($=this.callRefTimer).unref)||void 0===ee||ee.call($))}removeConnectivityStateWatcher($){let ee=this.connectivityStateWatchers.findIndex(ee=>ee===$);ee>=0&&this.connectivityStateWatchers.splice(ee,1)}updateState($){(0,ef.trace)(eo.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,ey.uriToString)(this.target)+" "+ev.ConnectivityState[this.connectivityState]+" -> "+ev.ConnectivityState[$]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+ev.ConnectivityState[$]),this.connectivityState=$;let ee=this.connectivityStateWatchers.slice();for(let et of ee)$!==et.currentState&&(et.timer&&clearTimeout(et.timer),this.removeConnectivityStateWatcher(et),et.callback());$!==ev.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive($){if($>this.keepaliveTime)for(let ee of(this.keepaliveTime=$,this.wrappedSubchannels))ee.throttleKeepalive($)}removeWrappedSubchannel($){this.wrappedSubchannels.delete($)}doPick($,ee){return this.currentPicker.pick({metadata:$,extraPickInfo:ee})}queueCallForPick($){this.pickQueue.push($),this.callRefTimerRef()}getConfig($,ee){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector($,ee)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig($){this.configSelectionQueue.push($),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(ev.ConnectivityState.IDLE),this.currentPicker=new es.QueuePicker(this.resolvingLoadBalancer)}maybeStartIdleTimer(){var $,ee;0===this.callCount&&(this.idleTimer=setTimeout(()=>{this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()},this.idleTimeoutMs),null===(ee=($=this.idleTimer).unref)||void 0===ee||ee.call($))}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1,this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}onCallEnd($){this.channelzEnabled&&($.code===eo.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.maybeStartIdleTimer()}createLoadBalancingCall($,ee,et,er,en){let ei=(0,ew.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+ei+'] method="'+ee+'"'),new eC.LoadBalancingCall(this,$,ee,et,er,en,ei)}createRetryingCall($,ee,et,er,en){let ei=(0,ew.getNextCallNumber)();return this.trace("createRetryingCall ["+ei+'] method="'+ee+'"'),new eI.RetryingCall(this,$,ee,et,er,en,ei,this.retryBufferTracker,ex.get(this.getTarget()))}createInnerCall($,ee,et,er,en){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall($,ee,et,er,en):this.createRetryingCall($,ee,et,er,en)}createResolvingCall($,ee,et,er,en){let ei=(0,ew.getNextCallNumber)();this.trace("createResolvingCall ["+ei+'] method="'+$+'", deadline='+(0,eT.deadlineToString)(ee));let es={deadline:ee,flags:null!=en?en:eo.Propagate.DEFAULTS,host:null!=et?et:this.defaultAuthority,parentCall:er},eu=new eE.ResolvingCall(this,$,es,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),ei);return this.onCallStart(),eu.addStatusWatcher($=>{this.onCallEnd($)}),eu}close(){this.resolvingLoadBalancer.destroy(),this.updateState(ev.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.channelzEnabled&&(0,eS.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,ey.uriToString)(this.target)}getConnectivityState($){let ee=this.connectivityState;return $&&(this.resolvingLoadBalancer.exitIdle(),this.maybeStartIdleTimer()),ee}watchConnectivityState($,ee,et){if(this.connectivityState===ev.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let er=null;if(ee!==1/0){let $=ee instanceof Date?ee:new Date(ee),ei=new Date;if(ee===-1/0||$<=ei){process.nextTick(et,Error("Deadline passed without connectivity state change"));return}er=setTimeout(()=>{this.removeConnectivityStateWatcher(en),et(Error("Deadline passed without connectivity state change"))},$.getTime()-ei.getTime())}let en={currentState:$,callback:et,timer:er};this.connectivityStateWatchers.push(en)}getChannelzRef(){return this.channelzRef}createCall($,ee,et,er,en){if("string"!=typeof $)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof ee||ee instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===ev.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall($,ee,et,er,en)}};ee.InternalChannel=InternalChannel},38390:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.ChildLoadBalancerHandler=void 0;let er=et(77203),en=et(91360),ei="child_load_balancer_helper";let ChildLoadBalancerHandler=class ChildLoadBalancerHandler{constructor($){this.channelControlHelper=$,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor($){this.parent=$,this.child=null}createSubchannel($,ee){return this.parent.channelControlHelper.createSubchannel($,ee)}updateState($,ee){var et;if(this.calledByPendingChild()){if($===en.ConnectivityState.CONNECTING)return;null===(et=this.parent.currentChild)||void 0===et||et.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState($,ee)}requestReresolution(){var $;let ee=null!==($=this.parent.pendingChild)&&void 0!==$?$:this.parent.currentChild;this.child===ee&&this.parent.channelControlHelper.requestReresolution()}setChild($){this.child=$}addChannelzChild($){this.parent.channelControlHelper.addChannelzChild($)}removeChannelzChild($){this.parent.channelControlHelper.removeChannelzChild($)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance($,ee){return $.getLoadBalancerName()!==ee.getLoadBalancerName()}updateAddressList($,ee,et){let en;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,ee)){let $=new this.ChildPolicyHelper(this),et=(0,er.createLoadBalancer)(ee,$);$.setChild(et),null===this.currentChild?(this.currentChild=et,en=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=et,en=this.pendingChild)}else en=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=ee,en.updateAddressList($,ee,et)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return ei}};ee.ChildLoadBalancerHandler=ChildLoadBalancerHandler},35683:($,ee,et)=>{"use strict";var er;Object.defineProperty(ee,"__esModule",{value:!0}),ee.setup=ee.OutlierDetectionLoadBalancer=ee.OutlierDetectionLoadBalancingConfig=void 0;let en=et(91360),ei=et(69238),es=et(89589),eo=et(86868),eu=et(77203),eh=et(38390),ep=et(32939),ef=et(72782),em=et(69609),eg=et(68200),ey="outlier_detection";function trace($){eg.trace(ei.LogVerbosity.DEBUG,ey,$)}let ev="outlier_detection",eS=(null!==(er=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)&&void 0!==er?er:"true")==="true",eC={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},eT={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function validateFieldType($,ee,et,er){if(ee in $&&typeof $[ee]!==et){let en=er?`${er}.${ee}`:ee;throw Error(`outlier detection config ${en} parse error: expected ${et}, got ${typeof $[ee]}`)}}function validatePositiveDuration($,ee,et){let er=et?`${et}.${ee}`:ee;if(ee in $){if(!(0,es.isDuration)($[ee]))throw Error(`outlier detection config ${er} parse error: expected Duration, got ${typeof $[ee]}`);if(!($[ee].seconds>=0&&$[ee].seconds<=315576e6&&$[ee].nanos>=0&&$[ee].nanos<=999999999))throw Error(`outlier detection config ${er} parse error: values out of range for non-negative Duaration`)}}function validatePercentage($,ee,et){let er=et?`${et}.${ee}`:ee;if(validateFieldType($,ee,"number",et),ee in $&&!($[ee]>=0&&$[ee]<=100))throw Error(`outlier detection config ${er} parse error: value out of range for percentage (0-100)`)}let OutlierDetectionLoadBalancingConfig=class OutlierDetectionLoadBalancingConfig{constructor($,ee,et,er,en,ei,es){if(this.childPolicy=es,es.length>0&&"pick_first"===es[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=$?$:1e4,this.baseEjectionTimeMs=null!=ee?ee:3e4,this.maxEjectionTimeMs=null!=et?et:3e5,this.maxEjectionPercent=null!=er?er:10,this.successRateEjection=en?Object.assign(Object.assign({},eC),en):null,this.failurePercentageEjection=ei?Object.assign(Object.assign({},eT),ei):null}getLoadBalancerName(){return ev}toJsonObject(){return{interval:(0,es.msToDuration)(this.intervalMs),base_ejection_time:(0,es.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,es.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map($=>$.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy($){return new OutlierDetectionLoadBalancingConfig(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,$)}static createFromJson($){var ee;if(validatePositiveDuration($,"interval"),validatePositiveDuration($,"base_ejection_time"),validatePositiveDuration($,"max_ejection_time"),validatePercentage($,"max_ejection_percent"),"success_rate_ejection"in $){if("object"!=typeof $.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");validateFieldType($.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),validatePercentage($.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),validateFieldType($.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),validateFieldType($.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in $){if("object"!=typeof $.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");validatePercentage($.failure_percentage_ejection,"threshold","failure_percentage_ejection"),validatePercentage($.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),validateFieldType($.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),validateFieldType($.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new OutlierDetectionLoadBalancingConfig($.interval?(0,es.durationToMs)($.interval):null,$.base_ejection_time?(0,es.durationToMs)($.base_ejection_time):null,$.max_ejection_time?(0,es.durationToMs)($.max_ejection_time):null,null!==(ee=$.max_ejection_percent)&&void 0!==ee?ee:null,$.success_rate_ejection,$.failure_percentage_ejection,$.child_policy.map(eu.validateLoadBalancingConfig))}};ee.OutlierDetectionLoadBalancingConfig=OutlierDetectionLoadBalancingConfig;let OutlierDetectionSubchannelWrapper=class OutlierDetectionSubchannelWrapper extends em.BaseSubchannelWrapper{constructor($,ee){super($),this.mapEntry=ee,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=$.getConnectivityState(),$.addConnectivityStateListener(($,ee,et,er)=>{if(this.childSubchannelState=et,!this.ejected)for(let $ of this.stateListeners)$(this,ee,et,er)})}getConnectivityState(){return this.ejected?en.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener($){this.stateListeners.push($)}removeConnectivityStateListener($){let ee=this.stateListeners.indexOf($);ee>-1&&this.stateListeners.splice(ee,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let $=this.mapEntry.subchannelWrappers.indexOf(this);$>=0&&this.mapEntry.subchannelWrappers.splice($,1)}}eject(){for(let $ of(this.ejected=!0,this.stateListeners))$(this,this.childSubchannelState,en.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(let $ of(this.ejected=!1,this.stateListeners))$(this,en.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function createEmptyBucket(){return{success:0,failure:0}}let CallCounter=class CallCounter{constructor(){this.activeBucket=createEmptyBucket(),this.inactiveBucket=createEmptyBucket()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=createEmptyBucket()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}};let OutlierDetectionPicker=class OutlierDetectionPicker{constructor($,ee){this.wrappedPicker=$,this.countCalls=ee}pick($){let ee=this.wrappedPicker.pick($);if(ee.pickResultType!==ep.PickResultType.COMPLETE)return ee;{let $=ee.subchannel,et=$.getMapEntry();if(!et)return Object.assign(Object.assign({},ee),{subchannel:$.getWrappedSubchannel()});{let er=ee.onCallEnded;return this.countCalls&&(er=$=>{var er;$===ei.Status.OK?et.counter.addSuccess():et.counter.addFailure(),null===(er=ee.onCallEnded)||void 0===er||er.call(ee,$)}),Object.assign(Object.assign({},ee),{subchannel:$.getWrappedSubchannel(),onCallEnded:er})}}}};let OutlierDetectionLoadBalancer=class OutlierDetectionLoadBalancer{constructor($){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new eh.ChildLoadBalancerHandler((0,eo.createChildChannelControlHelper)($,{createSubchannel:(ee,et)=>{let er=$.createSubchannel(ee,et),en=this.addressMap.get((0,ef.subchannelAddressToString)(ee)),ei=new OutlierDetectionSubchannelWrapper(er,en);return(null==en?void 0:en.currentEjectionTimestamp)!==null&&ei.eject(),null==en||en.subchannelWrappers.push(ei),ei},updateState:(ee,et)=>{ee===en.ConnectivityState.READY?$.updateState(ee,new OutlierDetectionPicker(et,this.isCountingEnabled())):$.updateState(ee,et)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let $=0;for(let ee of this.addressMap.values())null!==ee.currentEjectionTimestamp&&($+=1);return 100*$/this.addressMap.size}runSuccessRateCheck($){if(!this.latestConfig)return;let ee=this.latestConfig.getSuccessRateEjectionConfig();if(!ee)return;trace("Running success rate check");let et=ee.request_volume,er=0,en=[];for(let[$,ee]of this.addressMap){let ei=ee.counter.getLastSuccesses(),es=ee.counter.getLastFailures();trace("Stats for "+$+": successes="+ei+" failures="+es+" targetRequestVolume="+et),ei+es>=et&&(er+=1,en.push(ei/(ei+es)))}if(trace("Found "+er+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+en+"]"),er<ee.minimum_hosts)return;let ei=en.reduce(($,ee)=>$+ee)/en.length,es=0;for(let $ of en){let ee=$-ei;es+=ee*ee}let eo=es/en.length,eu=Math.sqrt(eo),eh=ei-eu*(ee.stdev_factor/1e3);for(let[er,en]of(trace("stdev="+eu+" ejectionThreshold="+eh),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let ei=en.counter.getLastSuccesses(),es=en.counter.getLastFailures();if(ei+es<et)continue;let eo=ei/(ei+es);if(trace("Checking candidate "+er+" successRate="+eo),eo<eh){let et=100*Math.random();trace("Candidate "+er+" randomNumber="+et+" enforcement_percentage="+ee.enforcement_percentage),et<ee.enforcement_percentage&&(trace("Ejecting candidate "+er),this.eject(en,$))}}}runFailurePercentageCheck($){if(!this.latestConfig)return;let ee=this.latestConfig.getFailurePercentageEjectionConfig();if(!ee)return;trace("Running failure percentage check. threshold="+ee.threshold+" request volume threshold="+ee.request_volume);let et=0;for(let $ of this.addressMap.values()){let er=$.counter.getLastSuccesses(),en=$.counter.getLastFailures();er+en>=ee.request_volume&&(et+=1)}if(!(et<ee.minimum_hosts))for(let[et,er]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let en=er.counter.getLastSuccesses(),ei=er.counter.getLastFailures();if(trace("Candidate successes="+en+" failures="+ei),en+ei<ee.request_volume)continue;let es=100*ei/(ei+en);if(es>ee.threshold){let en=100*Math.random();trace("Candidate "+et+" randomNumber="+en+" enforcement_percentage="+ee.enforcement_percentage),en<ee.enforcement_percentage&&(trace("Ejecting candidate "+et),this.eject(er,$))}}}eject($,ee){for(let ee of($.currentEjectionTimestamp=new Date,$.ejectionTimeMultiplier+=1,$.subchannelWrappers))ee.eject()}uneject($){for(let ee of($.currentEjectionTimestamp=null,$.subchannelWrappers))ee.uneject()}switchAllBuckets(){for(let $ of this.addressMap.values())$.counter.switchBuckets()}startTimer($){var ee,et;this.ejectionTimer=setTimeout(()=>this.runChecks(),$),null===(et=(ee=this.ejectionTimer).unref)||void 0===et||et.call(ee)}runChecks(){let $=new Date;if(trace("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[ee,et]of(this.timerStartTime=$,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck($),this.runFailurePercentageCheck($),this.addressMap.entries()))if(null===et.currentEjectionTimestamp)et.ejectionTimeMultiplier>0&&(et.ejectionTimeMultiplier-=1);else{let $=this.latestConfig.getBaseEjectionTimeMs(),er=this.latestConfig.getMaxEjectionTimeMs(),en=new Date(et.currentEjectionTimestamp.getTime());en.setMilliseconds(en.getMilliseconds()+Math.min($*et.ejectionTimeMultiplier,Math.max($,er))),en<new Date&&(trace("Unejecting "+ee),this.uneject(et))}}updateAddressList($,ee,et){if(!(ee instanceof OutlierDetectionLoadBalancingConfig))return;let er=new Set;for(let ee of $)er.add((0,ef.subchannelAddressToString)(ee));for(let $ of er)this.addressMap.has($)||(trace("Adding map entry for "+$),this.addressMap.set($,{counter:new CallCounter,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let $ of this.addressMap.keys())er.has($)||(trace("Removing map entry for "+$),this.addressMap.delete($));let en=(0,eu.getFirstUsableConfig)(ee.getChildPolicy(),!0);if(this.childBalancer.updateAddressList($,en,et),ee.getSuccessRateEjectionConfig()||ee.getFailurePercentageEjectionConfig()){if(this.timerStartTime){trace("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let $=ee.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer($)}else trace("Starting new timer"),this.timerStartTime=new Date,this.startTimer(ee.getIntervalMs()),this.switchAllBuckets()}else for(let $ of(trace("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject($),$.ejectionTimeMultiplier=0;this.latestConfig=ee}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return ev}};function setup(){eS&&(0,eo.registerLoadBalancerType)(ev,OutlierDetectionLoadBalancer,OutlierDetectionLoadBalancingConfig)}ee.OutlierDetectionLoadBalancer=OutlierDetectionLoadBalancer,ee.setup=setup},72190:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.setup=ee.PickFirstLoadBalancer=ee.shuffled=ee.PickFirstLoadBalancingConfig=void 0;let er=et(77203),en=et(91360),ei=et(32939),es=et(68200),eo=et(69238),eu="pick_first";function trace($){es.trace(eo.LogVerbosity.DEBUG,eu,$)}let eh="pick_first",ep=250;let PickFirstLoadBalancingConfig=class PickFirstLoadBalancingConfig{constructor($){this.shuffleAddressList=$}getLoadBalancerName(){return eh}toJsonObject(){return{[eh]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson($){if("shuffleAddressList"in $&&"boolean"!=typeof $.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new PickFirstLoadBalancingConfig(!0===$.shuffleAddressList)}};ee.PickFirstLoadBalancingConfig=PickFirstLoadBalancingConfig;let PickFirstPicker=class PickFirstPicker{constructor($){this.subchannel=$}pick($){return{pickResultType:ei.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function shuffled($){let ee=$.slice();for(let $=ee.length-1;$>1;$--){let et=Math.floor(Math.random()*($+1)),er=ee[$];ee[$]=ee[et],ee[et]=er}return ee}ee.shuffled=shuffled;let PickFirstLoadBalancer=class PickFirstLoadBalancer{constructor($){this.channelControlHelper=$,this.children=[],this.currentState=en.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=($,ee,et)=>{this.onSubchannelStateUpdate($,ee,et)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every($=>$.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(en.ConnectivityState.READY,new PickFirstPicker(this.currentPick)):0===this.children.length?this.updateState(en.ConnectivityState.IDLE,new ei.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(en.ConnectivityState.TRANSIENT_FAILURE,new ei.UnavailablePicker):this.updateState(en.ConnectivityState.CONNECTING,new ei.QueuePicker(this))}maybeEnterStickyTransientFailureMode(){if(!this.stickyTransientFailureMode&&this.allChildrenHaveReportedTF()){for(let{subchannel:$}of(this.stickyTransientFailureMode=!0,this.channelControlHelper.requestReresolution(),this.children))$.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){let $=this.currentPick;this.currentPick=null,$.unref(),$.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild($.getChannelzRef())}}onSubchannelStateUpdate($,ee,et){var er;if(null===(er=this.currentPick)||void 0===er?void 0:er.realSubchannelEquals($)){et!==en.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.channelControlHelper.requestReresolution());return}for(let[ee,er]of this.children.entries())if($.realSubchannelEquals(er.subchannel)){et===en.ConnectivityState.READY&&this.pickSubchannel(er.subchannel),et===en.ConnectivityState.TRANSIENT_FAILURE&&(er.hasReportedTransientFailure=!0,this.maybeEnterStickyTransientFailureMode(),ee===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(ee+1)),er.subchannel.startConnecting();return}}startNextSubchannelConnecting($){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels&&!this.stickyTransientFailureMode){for(let[ee,et]of this.children.entries())if(ee>=$){let $=et.subchannel.getConnectivityState();if($===en.ConnectivityState.IDLE||$===en.ConnectivityState.CONNECTING){this.startConnecting(ee);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting($){var ee,et;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=$,this.children[$].subchannel.getConnectivityState()===en.ConnectivityState.IDLE&&(trace("Start connecting to subchannel with address "+this.children[$].subchannel.getAddress()),process.nextTick(()=>{var ee;null===(ee=this.children[$])||void 0===ee||ee.subchannel.startConnecting()})),this.connectionDelayTimeout=null===(et=(ee=setTimeout(()=>{this.startNextSubchannelConnecting($+1)},ep)).unref)||void 0===et?void 0:et.call(ee)}pickSubchannel($){this.currentPick&&$.realSubchannelEquals(this.currentPick)||(trace("Pick subchannel with address "+$.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=$,$.ref(),this.channelControlHelper.addChannelzChild($.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState($,ee){trace(en.ConnectivityState[this.currentState]+" -> "+en.ConnectivityState[$]),this.currentState=$,this.channelControlHelper.updateState($,ee)}resetSubchannelList(){for(let $ of this.children)$.subchannel!==this.currentPick&&$.subchannel.removeConnectivityStateListener(this.subchannelStateListener),$.subchannel.unref(),this.channelControlHelper.removeChannelzChild($.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1}updateAddressList($,ee){if(!(ee instanceof PickFirstLoadBalancingConfig))return;ee.getShuffleAddressList()&&($=shuffled($));let et=$.map($=>({subchannel:this.channelControlHelper.createSubchannel($,{}),hasReportedTransientFailure:!1}));for(let{subchannel:$}of et)$.ref(),this.channelControlHelper.addChannelzChild($.getChannelzRef());for(let{subchannel:$}of(this.resetSubchannelList(),this.children=et,this.children))if($.addConnectivityStateListener(this.subchannelStateListener),$.getConnectivityState()===en.ConnectivityState.READY){this.pickSubchannel($);return}for(let $ of this.children)$.subchannel.getConnectivityState()===en.ConnectivityState.TRANSIENT_FAILURE&&($.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}exitIdle(){}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return eh}};function setup(){(0,er.registerLoadBalancerType)(eh,PickFirstLoadBalancer,PickFirstLoadBalancingConfig),(0,er.registerDefaultLoadBalancerType)(eh)}ee.PickFirstLoadBalancer=PickFirstLoadBalancer,ee.setup=setup},19580:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.setup=ee.RoundRobinLoadBalancer=void 0;let er=et(77203),en=et(91360),ei=et(32939),es=et(72782),eo=et(68200),eu=et(69238),eh="round_robin";function trace($){eo.trace(eu.LogVerbosity.DEBUG,eh,$)}let ep="round_robin";let RoundRobinLoadBalancingConfig=class RoundRobinLoadBalancingConfig{getLoadBalancerName(){return ep}constructor(){}toJsonObject(){return{[ep]:{}}}static createFromJson($){return new RoundRobinLoadBalancingConfig}};let RoundRobinPicker=class RoundRobinPicker{constructor($,ee=0){this.subchannelList=$,this.nextIndex=ee}pick($){let ee=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:ei.PickResultType.COMPLETE,subchannel:ee,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}};let RoundRobinLoadBalancer=class RoundRobinLoadBalancer{constructor($){this.channelControlHelper=$,this.subchannels=[],this.currentState=en.ConnectivityState.IDLE,this.currentReadyPicker=null,this.subchannelStateListener=($,ee,et)=>{this.calculateAndUpdateState(),(et===en.ConnectivityState.TRANSIENT_FAILURE||et===en.ConnectivityState.IDLE)&&(this.channelControlHelper.requestReresolution(),$.startConnecting())}}countSubchannelsWithState($){return this.subchannels.filter(ee=>ee.getConnectivityState()===$).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(en.ConnectivityState.READY)>0){let $=this.subchannels.filter($=>$.getConnectivityState()===en.ConnectivityState.READY),ee=0;null!==this.currentReadyPicker&&(ee=$.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(ee=0),this.updateState(en.ConnectivityState.READY,new RoundRobinPicker($,ee))}else this.countSubchannelsWithState(en.ConnectivityState.CONNECTING)>0?this.updateState(en.ConnectivityState.CONNECTING,new ei.QueuePicker(this)):this.countSubchannelsWithState(en.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(en.ConnectivityState.TRANSIENT_FAILURE,new ei.UnavailablePicker):this.updateState(en.ConnectivityState.IDLE,new ei.QueuePicker(this))}updateState($,ee){trace(en.ConnectivityState[this.currentState]+" -> "+en.ConnectivityState[$]),$===en.ConnectivityState.READY?this.currentReadyPicker=ee:this.currentReadyPicker=null,this.currentState=$,this.channelControlHelper.updateState($,ee)}resetSubchannelList(){for(let $ of this.subchannels)$.removeConnectivityStateListener(this.subchannelStateListener),$.unref(),this.channelControlHelper.removeChannelzChild($.getChannelzRef());this.subchannels=[]}updateAddressList($,ee){for(let ee of(this.resetSubchannelList(),trace("Connect to address list "+$.map($=>(0,es.subchannelAddressToString)($))),this.subchannels=$.map($=>this.channelControlHelper.createSubchannel($,{})),this.subchannels)){ee.ref(),ee.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(ee.getChannelzRef());let $=ee.getConnectivityState();($===en.ConnectivityState.IDLE||$===en.ConnectivityState.TRANSIENT_FAILURE)&&ee.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let $ of this.subchannels)$.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return ep}};function setup(){(0,er.registerLoadBalancerType)(ep,RoundRobinLoadBalancer,RoundRobinLoadBalancingConfig)}ee.RoundRobinLoadBalancer=RoundRobinLoadBalancer,ee.setup=setup},77203:($,ee)=>{"use strict";function createChildChannelControlHelper($,ee){var et,er,en,ei,es,eo,eu,eh,ep,ef;return{createSubchannel:null!==(er=null===(et=ee.createSubchannel)||void 0===et?void 0:et.bind(ee))&&void 0!==er?er:$.createSubchannel.bind($),updateState:null!==(ei=null===(en=ee.updateState)||void 0===en?void 0:en.bind(ee))&&void 0!==ei?ei:$.updateState.bind($),requestReresolution:null!==(eo=null===(es=ee.requestReresolution)||void 0===es?void 0:es.bind(ee))&&void 0!==eo?eo:$.requestReresolution.bind($),addChannelzChild:null!==(eh=null===(eu=ee.addChannelzChild)||void 0===eu?void 0:eu.bind(ee))&&void 0!==eh?eh:$.addChannelzChild.bind($),removeChannelzChild:null!==(ef=null===(ep=ee.removeChannelzChild)||void 0===ep?void 0:ep.bind(ee))&&void 0!==ef?ef:$.removeChannelzChild.bind($)}}Object.defineProperty(ee,"__esModule",{value:!0}),ee.validateLoadBalancingConfig=ee.getFirstUsableConfig=ee.isLoadBalancerNameRegistered=ee.createLoadBalancer=ee.registerDefaultLoadBalancerType=ee.registerLoadBalancerType=ee.createChildChannelControlHelper=void 0,ee.createChildChannelControlHelper=createChildChannelControlHelper;let et={},er=null;function registerLoadBalancerType($,ee,er){et[$]={LoadBalancer:ee,LoadBalancingConfig:er}}function registerDefaultLoadBalancerType($){er=$}function createLoadBalancer($,ee){let er=$.getLoadBalancerName();return er in et?new et[er].LoadBalancer(ee):null}function isLoadBalancerNameRegistered($){return $ in et}function getFirstUsableConfig($,ee=!1){for(let ee of $)if(ee.getLoadBalancerName() in et)return ee;return ee&&er?new et[er].LoadBalancingConfig:null}function validateLoadBalancingConfig($){if(!(null!==$&&"object"==typeof $))throw Error("Load balancing config must be an object");let ee=Object.keys($);if(1!==ee.length)throw Error("Provided load balancing config has multiple conflicting entries");let er=ee[0];if(er in et)return et[er].LoadBalancingConfig.createFromJson($[er]);throw Error(`Unrecognized load balancing config name ${er}`)}ee.registerLoadBalancerType=registerLoadBalancerType,ee.registerDefaultLoadBalancerType=registerDefaultLoadBalancerType,ee.createLoadBalancer=createLoadBalancer,ee.isLoadBalancerNameRegistered=isLoadBalancerNameRegistered,ee.getFirstUsableConfig=getFirstUsableConfig,ee.validateLoadBalancingConfig=validateLoadBalancingConfig},80439:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.LoadBalancingCall=void 0;let er=et(91360),en=et(69238),ei=et(50823),es=et(32908),eo=et(32939),eu=et(14717),eh=et(68200),ep=et(6614),ef=et(85158),em="load_balancing_call";let LoadBalancingCall=class LoadBalancingCall{constructor($,ee,et,er,en,ei,es){var eo,eh;this.channel=$,this.callConfig=ee,this.methodName=et,this.host=er,this.credentials=en,this.deadline=ei,this.callNumber=es,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let ep=this.methodName.split("/"),ef="";ep.length>=2&&(ef=ep[1]);let em=null!==(eh=null===(eo=(0,eu.splitHostPort)(this.host))||void 0===eo?void 0:eo.host)&&void 0!==eh?eh:"localhost";this.serviceUrl=`https://${em}/${ef}`}trace($){eh.trace(en.LogVerbosity.DEBUG,em,"["+this.callNumber+"] "+$)}outputStatus($,ee){var et,er;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+$.code+' details="'+$.details+'"');let en=Object.assign(Object.assign({},$),{progress:ee});null===(et=this.listener)||void 0===et||et.onReceiveStatus(en),null===(er=this.onCallEnded)||void 0===er||er.call(this,en.code)}}doPick(){var $,ee;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let et=this.channel.doPick(this.metadata,this.callConfig.pickInformation),eu=et.subchannel?"("+et.subchannel.getChannelzRef().id+") "+et.subchannel.getAddress():""+et.subchannel;switch(this.trace("Pick result: "+eo.PickResultType[et.pickResultType]+" subchannel: "+eu+" status: "+(null===($=et.status)||void 0===$?void 0:$.code)+" "+(null===(ee=et.status)||void 0===ee?void 0:ee.details)),et.pickResultType){case eo.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then($=>{var ee,eo,eh;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let ep=this.metadata.clone();if(ep.merge($),ep.get("authorization").length>1&&this.outputStatus({code:en.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new es.Metadata},"PROCESSED"),et.subchannel.getConnectivityState()!==er.ConnectivityState.READY){this.trace("Picked subchannel "+eu+" has state "+er.ConnectivityState[et.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&ep.set("grpc-timeout",(0,ei.getDeadlineTimeoutString)(this.deadline));try{this.child=et.subchannel.getRealSubchannel().createCall(ep,this.host,this.methodName,{onReceiveMetadata:$=>{this.trace("Received metadata"),this.listener.onReceiveMetadata($)},onReceiveMessage:$=>{this.trace("Received message"),this.listener.onReceiveMessage($)},onReceiveStatus:$=>{this.trace("Received status"),$.rstCode===ef.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus($,"REFUSED"):this.outputStatus($,"PROCESSED")}})}catch($){this.trace("Failed to start call on picked subchannel "+eu+" with error "+$.message),this.outputStatus({code:en.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+$.message,metadata:new es.Metadata},"NOT_STARTED");return}null===(eo=(ee=this.callConfig).onCommitted)||void 0===eo||eo.call(ee),null===(eh=et.onCallStarted)||void 0===eh||eh.call(et),this.onCallEnded=et.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},$=>{let{code:ee,details:et}=(0,ep.restrictControlPlaneStatusCode)("number"==typeof $.code?$.code:en.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${$.message}`);this.outputStatus({code:ee,details:et,metadata:new es.Metadata},"PROCESSED")});break;case eo.PickResultType.DROP:let{code:eh,details:em}=(0,ep.restrictControlPlaneStatusCode)(et.status.code,et.status.details);setImmediate(()=>{this.outputStatus({code:eh,details:em,metadata:et.status.metadata},"DROP")});break;case eo.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:$,details:ee}=(0,ep.restrictControlPlaneStatusCode)(et.status.code,et.status.details);setImmediate(()=>{this.outputStatus({code:$,details:ee,metadata:et.status.metadata},"PROCESSED")})}break;case eo.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus($,ee){var et;this.trace("cancelWithStatus code: "+$+' details: "'+ee+'"'),null===(et=this.child)||void 0===et||et.cancelWithStatus($,ee),this.outputStatus({code:$,details:ee,metadata:new es.Metadata},"PROCESSED")}getPeer(){var $,ee;return null!==(ee=null===($=this.child)||void 0===$?void 0:$.getPeer())&&void 0!==ee?ee:this.channel.getTarget()}start($,ee){this.trace("start called"),this.listener=ee,this.metadata=$,this.doPick()}sendMessageWithContext($,ee){this.trace("write() called with message of length "+ee.length),this.child?this.child.sendMessageWithContext($,ee):this.pendingMessage={context:$,message:ee}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials($){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}};ee.LoadBalancingCall=LoadBalancingCall},68200:($,ee,et)=>{"use strict";var er,en,ei,es;Object.defineProperty(ee,"__esModule",{value:!0}),ee.isTracerEnabled=ee.trace=ee.log=ee.setLoggerVerbosity=ee.setLogger=ee.getLogger=void 0;let eo=et(69238),eu={error:($,...ee)=>{console.error("E "+$,...ee)},info:($,...ee)=>{console.error("I "+$,...ee)},debug:($,...ee)=>{console.error("D "+$,...ee)}},eh=eu,ep=eo.LogVerbosity.ERROR,ef=null!==(en=null!==(er=process.env.GRPC_NODE_VERBOSITY)&&void 0!==er?er:process.env.GRPC_VERBOSITY)&&void 0!==en?en:"";switch(ef.toUpperCase()){case"DEBUG":ep=eo.LogVerbosity.DEBUG;break;case"INFO":ep=eo.LogVerbosity.INFO;break;case"ERROR":ep=eo.LogVerbosity.ERROR;break;case"NONE":ep=eo.LogVerbosity.NONE}let getLogger=()=>eh;ee.getLogger=getLogger;let setLogger=$=>{eh=$};ee.setLogger=setLogger;let setLoggerVerbosity=$=>{ep=$};ee.setLoggerVerbosity=setLoggerVerbosity;let log=($,...ee)=>{let et;if($>=ep){switch($){case eo.LogVerbosity.DEBUG:et=eh.debug;break;case eo.LogVerbosity.INFO:et=eh.info;break;case eo.LogVerbosity.ERROR:et=eh.error}et||(et=eh.error),et&&et.bind(eh)(...ee)}};ee.log=log;let em=null!==(es=null!==(ei=process.env.GRPC_NODE_TRACE)&&void 0!==ei?ei:process.env.GRPC_TRACE)&&void 0!==es?es:"",eg=new Set,ey=new Set;for(let $ of em.split(","))$.startsWith("-")?ey.add($.substring(1)):eg.add($);let ev=eg.has("all");function trace($,et,er){isTracerEnabled(et)&&(0,ee.log)($,new Date().toISOString()+" | "+et+" | "+er)}function isTracerEnabled($){return!ey.has($)&&(ev||eg.has($))}ee.trace=trace,ee.isTracerEnabled=isTracerEnabled},47697:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.loadPackageDefinition=ee.makeClientConstructor=void 0;let er=et(47307),en={unary:er.Client.prototype.makeUnaryRequest,server_stream:er.Client.prototype.makeServerStreamRequest,client_stream:er.Client.prototype.makeClientStreamRequest,bidi:er.Client.prototype.makeBidiStreamRequest};function isPrototypePolluted($){return["__proto__","prototype","constructor"].includes($)}function makeClientConstructor($,ee,et){et||(et={});let ServiceClientImpl=class ServiceClientImpl extends er.Client{};return Object.keys($).forEach(ee=>{let et;if(isPrototypePolluted(ee))return;let er=$[ee];if("string"==typeof ee&&"$"===ee.charAt(0))throw Error("Method names cannot start with $");et=er.requestStream?er.responseStream?"bidi":"client_stream":er.responseStream?"server_stream":"unary";let ei=er.requestSerialize,es=er.responseDeserialize,eo=partial(en[et],er.path,ei,es);ServiceClientImpl.prototype[ee]=eo,Object.assign(ServiceClientImpl.prototype[ee],er),er.originalName&&!isPrototypePolluted(er.originalName)&&(ServiceClientImpl.prototype[er.originalName]=ServiceClientImpl.prototype[ee])}),ServiceClientImpl.service=$,ServiceClientImpl.serviceName=ee,ServiceClientImpl}function partial($,ee,et,er){return function(...en){return $.call(this,ee,et,er,...en)}}function isProtobufTypeDefinition($){return"format"in $}function loadPackageDefinition($){let ee={};for(let et in $)if(Object.prototype.hasOwnProperty.call($,et)){let er=$[et],en=et.split(".");if(en.some($=>isPrototypePolluted($)))continue;let ei=en[en.length-1],es=ee;for(let $ of en.slice(0,-1))es[$]||(es[$]={}),es=es[$];isProtobufTypeDefinition(er)?es[ei]=er:es[ei]=makeClientConstructor(er,ei,{})}return ee}ee.makeClientConstructor=makeClientConstructor,ee.loadPackageDefinition=loadPackageDefinition},41732:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.MaxMessageSizeFilterFactory=ee.MaxMessageSizeFilter=void 0;let er=et(81818),en=et(69238),ei=et(32908);let MaxMessageSizeFilter=class MaxMessageSizeFilter extends er.BaseFilter{constructor($){super(),this.maxSendMessageSize=en.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=en.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,"grpc.max_send_message_length"in $&&(this.maxSendMessageSize=$["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in $&&(this.maxReceiveMessageSize=$["grpc.max_receive_message_length"])}async sendMessage($){if(-1===this.maxSendMessageSize)return $;{let ee=await $;if(!(ee.message.length>this.maxSendMessageSize))return ee;throw{code:en.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${ee.message.length} vs. ${this.maxSendMessageSize})`,metadata:new ei.Metadata}}}async receiveMessage($){if(-1===this.maxReceiveMessageSize)return $;{let ee=await $;if(!(ee.length>this.maxReceiveMessageSize))return ee;throw{code:en.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${ee.length} vs. ${this.maxReceiveMessageSize})`,metadata:new ei.Metadata}}}};ee.MaxMessageSizeFilter=MaxMessageSizeFilter;let MaxMessageSizeFilterFactory=class MaxMessageSizeFilterFactory{constructor($){this.options=$}createFilter(){return new MaxMessageSizeFilter(this.options)}};ee.MaxMessageSizeFilterFactory=MaxMessageSizeFilterFactory},32908:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.Metadata=void 0;let er=et(68200),en=et(69238),ei=et(9006),es=/^[0-9a-z_.-]+$/,eo=/^[ -~]*$/;function isLegalKey($){return es.test($)}function isLegalNonBinaryValue($){return eo.test($)}function isBinaryKey($){return $.endsWith("-bin")}function isCustomMetadata($){return!$.startsWith("grpc-")}function normalizeKey($){return $.toLowerCase()}function validate($,ee){if(!isLegalKey($))throw Error('Metadata key "'+$+'" contains illegal characters');if(null!=ee){if(isBinaryKey($)){if(!Buffer.isBuffer(ee))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(ee))throw Error("keys that don't end with '-bin' must have String values");if(!isLegalNonBinaryValue(ee))throw Error('Metadata string value "'+ee+'" contains illegal characters')}}}let Metadata=class Metadata{constructor($={}){this.internalRepr=new Map,this.options=$}set($,ee){validate($=normalizeKey($),ee),this.internalRepr.set($,[ee])}add($,ee){validate($=normalizeKey($),ee);let et=this.internalRepr.get($);void 0===et?this.internalRepr.set($,[ee]):et.push(ee)}remove($){$=normalizeKey($),this.internalRepr.delete($)}get($){return $=normalizeKey($),this.internalRepr.get($)||[]}getMap(){let $={};for(let[ee,et]of this.internalRepr)if(et.length>0){let er=et[0];$[ee]=Buffer.isBuffer(er)?Buffer.from(er):er}return $}clone(){let $=new Metadata(this.options),ee=$.internalRepr;for(let[$,et]of this.internalRepr){let er=et.map($=>Buffer.isBuffer($)?Buffer.from($):$);ee.set($,er)}return $}merge($){for(let[ee,et]of $.internalRepr){let $=(this.internalRepr.get(ee)||[]).concat(et);this.internalRepr.set(ee,$)}}setOptions($){this.options=$}getOptions(){return this.options}toHttp2Headers(){let $={};for(let[ee,et]of this.internalRepr)$[ee]=et.map(bufToString);return $}toJSON(){let $={};for(let[ee,et]of this.internalRepr)$[ee]=et;return $}static fromHttp2Headers($){let ee=new Metadata;for(let et of Object.keys($)){if(":"===et.charAt(0))continue;let es=$[et];try{isBinaryKey(et)?Array.isArray(es)?es.forEach($=>{ee.add(et,Buffer.from($,"base64"))}):void 0!==es&&(isCustomMetadata(et)?es.split(",").forEach($=>{ee.add(et,Buffer.from($.trim(),"base64"))}):ee.add(et,Buffer.from(es,"base64"))):Array.isArray(es)?es.forEach($=>{ee.add(et,$)}):void 0!==es&&ee.add(et,es)}catch(ee){let $=`Failed to add metadata entry ${et}: ${es}. ${(0,ei.getErrorMessage)(ee)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,er.log)(en.LogVerbosity.ERROR,$)}}return ee}};ee.Metadata=Metadata;let bufToString=$=>Buffer.isBuffer($)?$.toString("base64"):$},32939:($,ee,et)=>{"use strict";var er;Object.defineProperty(ee,"__esModule",{value:!0}),ee.QueuePicker=ee.UnavailablePicker=ee.PickResultType=void 0;let en=et(32908),ei=et(69238);!function($){$[$.COMPLETE=0]="COMPLETE",$[$.QUEUE=1]="QUEUE",$[$.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",$[$.DROP=3]="DROP"}(er||(ee.PickResultType=er={}));let UnavailablePicker=class UnavailablePicker{constructor($){void 0!==$?this.status=$:this.status={code:ei.Status.UNAVAILABLE,details:"No connection established",metadata:new en.Metadata}}pick($){return{pickResultType:er.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};ee.UnavailablePicker=UnavailablePicker;let QueuePicker=class QueuePicker{constructor($){this.loadBalancer=$,this.calledExitIdle=!1}pick($){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:er.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};ee.QueuePicker=QueuePicker},84988:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.setup=void 0;let er=et(14755),en=et(9523),ei=et(73837),es=et(45914),eo=et(69238),eu=et(32908),eh=et(68200),ep=et(69238),ef=et(14717),em=et(41808),eg=et(77257),ey="dns_resolver";function trace($){eh.trace(ep.LogVerbosity.DEBUG,ey,$)}let ev=443,eS=3e4,eC=ei.promisify(en.resolveTxt),eT=ei.promisify(en.lookup);function mergeArrays(...$){let ee=[];for(let et=0;et<Math.max.apply(null,$.map($=>$.length));et++)for(let er of $)et<er.length&&ee.push(er[et]);return ee}let DnsResolver=class DnsResolver{constructor($,ee,et){var er,en,ei;this.target=$,this.listener=ee,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,trace("Resolver constructed for target "+(0,ef.uriToString)($));let es=(0,ef.splitHostPort)($.path);null===es?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,em.isIPv4)(es.host)||(0,em.isIPv6)(es.host)?(this.ipResult=[{host:es.host,port:null!==(er=es.port)&&void 0!==er?er:ev}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=es.host,this.port=null!==(en=es.port)&&void 0!==en?en:ev),this.percentage=100*Math.random(),1===et["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:eo.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,ef.uriToString)(this.target)}`,metadata:new eu.Metadata};let eh={initialDelay:et["grpc.initial_reconnect_backoff_ms"],maxDelay:et["grpc.max_reconnect_backoff_ms"]};this.backoff=new eg.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},eh),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!==(ei=et["grpc.dns_min_time_between_resolutions_ms"])&&void 0!==ei?ei:eS,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){trace("Returning IP address for target "+(0,ef.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)trace("Failed to parse DNS address "+(0,ef.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:eo.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,ef.uriToString)(this.target)}`,metadata:new eu.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;trace("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let $=this.dnsHostname;this.pendingLookupPromise=eT($,{all:!0}),this.pendingLookupPromise.then($=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let ee=$.filter($=>4===$.family),et=$.filter($=>6===$.family);this.latestLookupResult=mergeArrays(et,ee).map($=>({host:$.address,port:+this.port}));let er="["+this.latestLookupResult.map($=>$.host+":"+$.port).join(",")+"]";if(trace("Resolved addresses for target "+(0,ef.uriToString)(this.target)+": "+er),0===this.latestLookupResult.length){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},$=>{null!==this.pendingLookupPromise&&(trace("Resolution error for target "+(0,ef.uriToString)(this.target)+": "+$.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=eC($),this.pendingTxtPromise.then($=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,es.extractAndSelectServiceConfig)($,this.percentage)}catch($){this.latestServiceConfigError={code:eo.Status.UNAVAILABLE,details:`Parsing service config failed with error ${$.message}`,metadata:new eu.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},$=>{}))}}startNextResolutionTimer(){var $,ee;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null===(ee=($=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)||void 0===ee?void 0:ee.call($),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?trace('resolution update delayed by "min time between resolutions" rate limit'):trace("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null}static getDefaultAuthority($){return $.path}};function setup(){(0,er.registerResolver)("dns",DnsResolver),(0,er.registerDefaultScheme)("dns")}ee.setup=setup},96633:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.setup=void 0;let er=et(41808),en=et(69238),ei=et(32908),es=et(14755),eo=et(14717),eu=et(68200),eh="ip_resolver";function trace($){eu.trace(en.LogVerbosity.DEBUG,eh,$)}let ep="ipv4",ef="ipv6",em=443;let IpResolver=class IpResolver{constructor($,ee,et){var es;this.listener=ee,this.addresses=[],this.error=null,trace("Resolver constructed for target "+(0,eo.uriToString)($));let eu=[];if(!($.scheme===ep||$.scheme===ef)){this.error={code:en.Status.UNAVAILABLE,details:`Unrecognized scheme ${$.scheme} in IP resolver`,metadata:new ei.Metadata};return}let eh=$.path.split(",");for(let ee of eh){let et=(0,eo.splitHostPort)(ee);if(null===et||$.scheme===ep&&!(0,er.isIPv4)(et.host)||$.scheme===ef&&!(0,er.isIPv6)(et.host)){this.error={code:en.Status.UNAVAILABLE,details:`Failed to parse ${$.scheme} address ${ee}`,metadata:new ei.Metadata};return}eu.push({host:et.host,port:null!==(es=et.port)&&void 0!==es?es:em})}this.addresses=eu,trace("Parsed "+$.scheme+" address list "+this.addresses)}updateResolution(){process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})})}destroy(){}static getDefaultAuthority($){return $.path.split(",")[0]}};function setup(){(0,es.registerResolver)(ep,IpResolver),(0,es.registerResolver)(ef,IpResolver)}ee.setup=setup},50864:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.setup=void 0;let er=et(14755);let UdsResolver=class UdsResolver{constructor($,ee,et){let er;this.listener=ee,this.addresses=[],er=""===$.authority?"/"+$.path:$.path,this.addresses=[{path:er}]}updateResolution(){process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{})}destroy(){}static getDefaultAuthority($){return"localhost"}};function setup(){(0,er.registerResolver)("unix",UdsResolver)}ee.setup=setup},14755:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.mapUriDefaultScheme=ee.getDefaultAuthority=ee.createResolver=ee.registerDefaultScheme=ee.registerResolver=void 0;let er=et(14717),en={},ei=null;function registerResolver($,ee){en[$]=ee}function registerDefaultScheme($){ei=$}function createResolver($,ee,et){if(void 0!==$.scheme&&$.scheme in en)return new en[$.scheme]($,ee,et);throw Error(`No resolver could be created for target ${(0,er.uriToString)($)}`)}function getDefaultAuthority($){if(void 0!==$.scheme&&$.scheme in en)return en[$.scheme].getDefaultAuthority($);throw Error(`Invalid target ${(0,er.uriToString)($)}`)}function mapUriDefaultScheme($){return void 0!==$.scheme&&$.scheme in en?$:null!==ei?{scheme:ei,authority:void 0,path:(0,er.uriToString)($)}:null}ee.registerResolver=registerResolver,ee.registerDefaultScheme=registerDefaultScheme,ee.createResolver=createResolver,ee.getDefaultAuthority=getDefaultAuthority,ee.mapUriDefaultScheme=mapUriDefaultScheme},65700:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.ResolvingCall=void 0;let er=et(69238),en=et(50823),ei=et(32908),es=et(68200),eo=et(6614),eu="resolving_call";let ResolvingCall=class ResolvingCall{constructor($,ee,et,ei,es,eo){this.channel=$,this.method=ee,this.filterStackFactory=ei,this.credentials=es,this.callNumber=eo,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=et.deadline,this.host=et.host,et.parentCall&&(et.flags&er.Propagate.CANCELLATION&&et.parentCall.on("cancelled",()=>{this.cancelWithStatus(er.Status.CANCELLED,"Cancelled by parent call")}),et.flags&er.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+et.parentCall.getDeadline()),this.deadline=(0,en.minDeadline)(this.deadline,et.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace($){es.trace(er.LogVerbosity.DEBUG,eu,"["+this.callNumber+"] "+$)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,en.deadlineToString)(this.deadline));let $=(0,en.getRelativeTimeout)(this.deadline);if($!==1/0){this.trace("Deadline will be reached in "+$+"ms");let handleDeadline=()=>{this.cancelWithStatus(er.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};$<=0?process.nextTick(handleDeadline):this.deadlineTimer=setTimeout(handleDeadline,$)}}outputStatus($){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let ee=this.filterStack.receiveTrailers($);this.trace("ended with status: code="+ee.code+' details="'+ee.details+'"'),this.statusWatchers.forEach($=>$(ee)),process.nextTick(()=>{var $;null===($=this.listener)||void 0===$||$.onReceiveStatus(ee)})}}sendMessageOnChild($,ee){if(!this.child)throw Error("sendMessageonChild called with child not populated");let et=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:ee,flags:$.flags})).then(ee=>{this.writeFilterPending=!1,et.sendMessageWithContext($,ee.message),this.pendingHalfClose&&et.halfClose()},$=>{this.cancelWithStatus($.code,$.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let $=this.channel.getConfig(this.method,this.metadata);if("NONE"===$.type){this.channel.queueCallForConfig(this);return}if("ERROR"===$.type){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus($.error);return}let ee=$.config;if(ee.status!==er.Status.OK){let{code:$,details:et}=(0,eo.restrictControlPlaneStatusCode)(ee.status,"Failed to route call to method "+this.method);this.outputStatus({code:$,details:et,metadata:new ei.Metadata});return}if(ee.methodConfig.timeout){let $=new Date;$.setSeconds($.getSeconds()+ee.methodConfig.timeout.seconds),$.setMilliseconds($.getMilliseconds()+ee.methodConfig.timeout.nanos/1e6),this.deadline=(0,en.minDeadline)(this.deadline,$),this.runDeadlineTimer()}this.filterStackFactory.push(ee.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then($=>{this.child=this.channel.createInnerCall(ee,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start($,{onReceiveMetadata:$=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata($))},onReceiveMessage:$=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage($).then($=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage($),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},$=>{this.cancelWithStatus($.code,$.details)})},onReceiveStatus:$=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=$:this.outputStatus($)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},$=>{this.outputStatus($)})}reportResolverError($){var ee;(null===(ee=this.metadata)||void 0===ee?void 0:ee.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus($)}cancelWithStatus($,ee){var et;this.trace("cancelWithStatus code: "+$+' details: "'+ee+'"'),null===(et=this.child)||void 0===et||et.cancelWithStatus($,ee),this.outputStatus({code:$,details:ee,metadata:new ei.Metadata})}getPeer(){var $,ee;return null!==(ee=null===($=this.child)||void 0===$?void 0:$.getPeer())&&void 0!==ee?ee:this.channel.getTarget()}start($,ee){this.trace("start called"),this.metadata=$.clone(),this.listener=ee,this.getConfig()}sendMessageWithContext($,ee){this.trace("write() called with message of length "+ee.length),this.child?this.sendMessageOnChild($,ee):this.pendingMessage={context:$,message:ee}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials($){this.credentials=this.credentials.compose($)}addStatusWatcher($){this.statusWatchers.push($)}getCallNumber(){return this.callNumber}};ee.ResolvingCall=ResolvingCall},61839:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.ResolvingLoadBalancer=void 0;let er=et(77203),en=et(45914),ei=et(91360),es=et(14755),eo=et(32939),eu=et(77257),eh=et(69238),ep=et(32908),ef=et(68200),em=et(69238),eg=et(14717),ey=et(38390),ev="resolving_load_balancer";function trace($){ef.trace(em.LogVerbosity.DEBUG,ev,$)}let eS=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function hasMatchingName($,ee,et,er){for(let en of et.name)switch(er){case"EMPTY":if(!en.service&&!en.method)return!0;break;case"SERVICE":if(en.service===$&&!en.method)return!0;break;case"SERVICE_AND_METHOD":if(en.service===$&&en.method===ee)return!0}return!1}function findMatchingConfig($,ee,et,er){for(let en of et)if(hasMatchingName($,ee,en,er))return en;return null}function getDefaultConfigSelector($){return function(ee,et){var er,en;let ei=ee.split("/").filter($=>$.length>0),es=null!==(er=ei[0])&&void 0!==er?er:"",eo=null!==(en=ei[1])&&void 0!==en?en:"";if($&&$.methodConfig)for(let ee of eS){let et=findMatchingConfig(es,eo,$.methodConfig,ee);if(et)return{methodConfig:et,pickInformation:{},status:eh.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:eh.Status.OK,dynamicFilterFactories:[]}}}let ResolvingLoadBalancer=class ResolvingLoadBalancer{constructor($,ee,et,ef,em){this.target=$,this.channelControlHelper=ee,this.onSuccessfulResolution=ef,this.onFailedResolution=em,this.latestChildState=ei.ConnectivityState.IDLE,this.latestChildPicker=new eo.QueuePicker(this),this.currentState=ei.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,et["grpc.service_config"]?this.defaultServiceConfig=(0,en.validateServiceConfig)(JSON.parse(et["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(ei.ConnectivityState.IDLE,new eo.QueuePicker(this)),this.childLoadBalancer=new ey.ChildLoadBalancerHandler({createSubchannel:ee.createSubchannel.bind(ee),requestReresolution:()=>{this.backoffTimeout.isRunning()?(trace("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:($,ee)=>{this.latestChildState=$,this.latestChildPicker=ee,this.updateState($,ee)},addChannelzChild:ee.addChannelzChild.bind(ee),removeChannelzChild:ee.removeChannelzChild.bind(ee)}),this.innerResolver=(0,es.createResolver)($,{onSuccessfulResolution:($,ee,et,en,ei)=>{var es;this.backoffTimeout.stop(),this.backoffTimeout.reset();let eo=null;null===ee?null===et?(this.previousServiceConfig=null,eo=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(et):eo=this.previousServiceConfig:(eo=ee,this.previousServiceConfig=ee);let eu=null!==(es=null==eo?void 0:eo.loadBalancingConfig)&&void 0!==es?es:[],ef=(0,er.getFirstUsableConfig)(eu,!0);if(null===ef){this.handleResolutionFailure({code:eh.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new ep.Metadata});return}this.childLoadBalancer.updateAddressList($,ef,ei);let em=null!=eo?eo:this.defaultServiceConfig;this.onSuccessfulResolution(em,null!=en?en:getDefaultConfigSelector(em))},onError:$=>{this.handleResolutionFailure($)}},et);let eg={initialDelay:et["grpc.initial_reconnect_backoff_ms"],maxDelay:et["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new eu.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},eg),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===ei.ConnectivityState.IDLE&&this.updateState(ei.ConnectivityState.CONNECTING,new eo.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState($,ee){trace((0,eg.uriToString)(this.target)+" "+ei.ConnectivityState[this.currentState]+" -> "+ei.ConnectivityState[$]),$===ei.ConnectivityState.IDLE&&(ee=new eo.QueuePicker(this)),this.currentState=$,this.channelControlHelper.updateState($,ee)}handleResolutionFailure($){this.latestChildState===ei.ConnectivityState.IDLE&&(this.updateState(ei.ConnectivityState.TRANSIENT_FAILURE,new eo.UnavailablePicker($)),this.onFailedResolution($))}exitIdle(){(this.currentState===ei.ConnectivityState.IDLE||this.currentState===ei.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList($,ee){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=ei.ConnectivityState.IDLE,this.latestChildPicker=new eo.QueuePicker(this),this.currentState=ei.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};ee.ResolvingLoadBalancer=ResolvingLoadBalancer},97564:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.RetryingCall=ee.MessageBufferTracker=ee.RetryThrottler=void 0;let er=et(69238),en=et(32908),ei=et(68200),es="retrying_call";let RetryThrottler=class RetryThrottler{constructor($,ee,et){this.maxTokens=$,this.tokenRatio=ee,et?this.tokens=et.tokens*($/et.maxTokens):this.tokens=$}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};ee.RetryThrottler=RetryThrottler;let MessageBufferTracker=class MessageBufferTracker{constructor($,ee){this.totalLimit=$,this.limitPerCall=ee,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate($,ee){var et;let er=null!==(et=this.allocatedPerCall.get(ee))&&void 0!==et?et:0;return!(this.limitPerCall-er<$)&&!(this.totalLimit-this.totalAllocated<$)&&(this.allocatedPerCall.set(ee,er+$),this.totalAllocated+=$,!0)}free($,ee){var et;if(this.totalAllocated<$)throw Error(`Invalid buffer allocation state: call ${ee} freed ${$} > total allocated ${this.totalAllocated}`);this.totalAllocated-=$;let er=null!==(et=this.allocatedPerCall.get(ee))&&void 0!==et?et:0;if(er<$)throw Error(`Invalid buffer allocation state: call ${ee} freed ${$} > allocated for call ${er}`);this.allocatedPerCall.set(ee,er-$)}freeAll($){var ee;let et=null!==(ee=this.allocatedPerCall.get($))&&void 0!==ee?ee:0;if(this.totalAllocated<et)throw Error(`Invalid buffer allocation state: call ${$} allocated ${et} > total allocated ${this.totalAllocated}`);this.totalAllocated-=et,this.allocatedPerCall.delete($)}};ee.MessageBufferTracker=MessageBufferTracker;let eo="grpc-previous-rpc-attempts";let RetryingCall=class RetryingCall{constructor($,ee,et,er,en,ei,es,eo,eu){if(this.channel=$,this.callConfig=ee,this.methodName=et,this.host=er,this.credentials=en,this.deadline=ei,this.callNumber=es,this.bufferTracker=eo,this.retryThrottler=eu,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,ee.methodConfig.retryPolicy){this.state="RETRY";let $=ee.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number($.initialBackoff.substring(0,$.initialBackoff.length-1))}else ee.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace($){ei.trace(er.LogVerbosity.DEBUG,es,"["+this.callNumber+"] "+$)}reportStatus($){this.trace("ended with status: code="+$.code+' details="'+$.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var ee;null===(ee=this.listener)||void 0===ee||ee.onReceiveStatus({code:$.code,details:$.details,metadata:$.metadata})})}cancelWithStatus($,ee){for(let{call:et}of(this.trace("cancelWithStatus code: "+$+' details: "'+ee+'"'),this.reportStatus({code:$,details:ee,metadata:new en.Metadata}),this.underlyingCalls))et.cancelWithStatus($,ee)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry($){var ee;return null!==(ee=this.writeBuffer[$-this.writeBufferOffset])&&void 0!==ee?ee:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;let $=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let ee=this.writeBufferOffset;ee<$;ee++){let $=this.getBufferEntry(ee);$.allocated&&this.bufferTracker.free($.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice($-this.writeBufferOffset),this.writeBufferOffset=$}commitCall($){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[$].state){this.trace("Committing call ["+this.underlyingCalls[$].call.getCallNumber()+"] at index "+$),this.state="COMMITTED",this.committedCallIndex=$;for(let ee=0;ee<this.underlyingCalls.length;ee++)ee!==$&&"COMPLETED"!==this.underlyingCalls[ee].state&&(this.underlyingCalls[ee].state="COMPLETED",this.underlyingCalls[ee].call.cancelWithStatus(er.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let $=-1,ee=-1;for(let[et,er]of this.underlyingCalls.entries())"ACTIVE"===er.state&&er.nextMessageToSend>$&&($=er.nextMessageToSend,ee=et);-1===ee?this.state="TRANSPARENT_ONLY":this.commitCall(ee)}isStatusCodeInList($,ee){return $.some($=>$===ee||$.toString().toLowerCase()===er.Status[ee].toLowerCase())}getNextRetryBackoffMs(){var $;let ee=null===($=this.callConfig)||void 0===$?void 0:$.methodConfig.retryPolicy;if(!ee)return 0;let et=Math.random()*this.nextRetryBackoffSec*1e3,er=Number(ee.maxBackoff.substring(0,ee.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*ee.backoffMultiplier,er),et}maybeRetryCall($,ee){let et;if("RETRY"!==this.state){ee(!1);return}let er=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(er.maxAttempts,5)){ee(!1);return}if(null===$)et=this.getNextRetryBackoffMs();else if($<0){this.state="TRANSPARENT_ONLY",ee(!1);return}else et=$,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var $,et;if("RETRY"!==this.state){ee(!1);return}(null===(et=null===($=this.retryThrottler)||void 0===$?void 0:$.canRetryCall())||void 0===et||et)&&(ee(!0),this.attempts+=1,this.startNewAttempt())},et)}countActiveCalls(){let $=0;for(let ee of this.underlyingCalls)(null==ee?void 0:ee.state)==="ACTIVE"&&($+=1);return $}handleProcessedStatus($,ee,et){var er,en,ei;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(ee),this.reportStatus($);break;case"HEDGING":if(this.isStatusCodeInList(null!==(er=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)&&void 0!==er?er:[],$.code)){let er;if(null===(en=this.retryThrottler)||void 0===en||en.addCallFailed(),null===et)er=0;else if(et<0){this.state="TRANSPARENT_ONLY",this.commitCall(ee),this.reportStatus($);return}else er=et;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(ee),this.reportStatus($))},er)}else this.commitCall(ee),this.reportStatus($);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,$.code)?(null===(ei=this.retryThrottler)||void 0===ei||ei.addCallFailed(),this.maybeRetryCall(et,et=>{et||(this.commitCall(ee),this.reportStatus($))})):(this.commitCall(ee),this.reportStatus($))}}getPushback($){let ee=$.get("grpc-retry-pushback-ms");if(0===ee.length)return null;try{return parseInt(ee[0])}catch($){return -1}}handleChildStatus($,ee){var et;if("COMPLETED"===this.underlyingCalls[ee].state)return;if(this.trace("state="+this.state+" handling status with progress "+$.progress+" from child ["+this.underlyingCalls[ee].call.getCallNumber()+"] in state "+this.underlyingCalls[ee].state),this.underlyingCalls[ee].state="COMPLETED",$.code===er.Status.OK){null===(et=this.retryThrottler)||void 0===et||et.addCallSucceeded(),this.commitCall(ee),this.reportStatus($);return}if("COMMITTED"===this.state){this.reportStatus($);return}let en=this.getPushback($.metadata);switch($.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus($,ee,en):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(ee),this.reportStatus($);break;case"PROCESSED":this.handleProcessedStatus($,ee,en)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let $=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min($.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var $,ee,et;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let er=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(er.maxAttempts,5))return;let en=null!==($=er.hedgingDelay)&&void 0!==$?$:"0s",ei=Number(en.substring(0,en.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*ei),null===(et=(ee=this.hedgingTimer).unref)||void 0===et||et.call(ee)}startNewAttempt(){let $=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+$.getCallNumber()+"] for attempt "+this.attempts);let ee=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:$,nextMessageToSend:0});let et=this.attempts-1,er=this.initialMetadata.clone();et>0&&er.set(eo,`${et}`);let en=!1;$.start(er,{onReceiveMetadata:er=>{this.trace("Received metadata from child ["+$.getCallNumber()+"]"),this.commitCall(ee),en=!0,et>0&&er.set(eo,`${et}`),"ACTIVE"===this.underlyingCalls[ee].state&&this.listener.onReceiveMetadata(er)},onReceiveMessage:et=>{this.trace("Received message from child ["+$.getCallNumber()+"]"),this.commitCall(ee),"ACTIVE"===this.underlyingCalls[ee].state&&this.listener.onReceiveMessage(et)},onReceiveStatus:er=>{this.trace("Received status from child ["+$.getCallNumber()+"]"),!en&&et>0&&er.metadata.set(eo,`${et}`),this.handleChildStatus(er,ee)}}),this.sendNextChildMessage(ee),this.readStarted&&$.startRead()}start($,ee){this.trace("start called"),this.listener=ee,this.initialMetadata=$,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted($){var ee,et;let er=this.underlyingCalls[$],en=er.nextMessageToSend;null===(et=(ee=this.getBufferEntry(en)).callback)||void 0===et||et.call(ee),this.clearSentMessages(),er.nextMessageToSend+=1,this.sendNextChildMessage($)}sendNextChildMessage($){let ee=this.underlyingCalls[$];if("COMPLETED"!==ee.state&&this.getBufferEntry(ee.nextMessageToSend)){let et=this.getBufferEntry(ee.nextMessageToSend);switch(et.entryType){case"MESSAGE":ee.call.sendMessageWithContext({callback:ee=>{this.handleChildWriteCompleted($)}},et.message.message);break;case"HALF_CLOSE":ee.nextMessageToSend+=1,ee.call.halfClose()}}}sendMessageWithContext($,ee){var et;this.trace("write() called with message of length "+ee.length);let er={message:ee,flags:$.flags},en=this.getNextBufferIndex(),ei={entryType:"MESSAGE",message:er,allocated:this.bufferTracker.allocate(ee.length,this.callNumber)};if(this.writeBuffer.push(ei),ei.allocated)for(let[er,ei]of(null===(et=$.callback)||void 0===et||et.call($),this.underlyingCalls.entries()))"ACTIVE"===ei.state&&ei.nextMessageToSend===en&&ei.call.sendMessageWithContext({callback:$=>{this.handleChildWriteCompleted(er)}},ee);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;let et=this.underlyingCalls[this.committedCallIndex];ei.callback=$.callback,"ACTIVE"===et.state&&et.nextMessageToSend===en&&et.call.sendMessageWithContext({callback:$=>{this.handleChildWriteCompleted(this.committedCallIndex)}},ee)}}startRead(){for(let $ of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==$?void 0:$.state)==="ACTIVE"&&$.call.startRead()}halfClose(){this.trace("halfClose called");let $=this.getNextBufferIndex();for(let ee of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==ee?void 0:ee.state)==="ACTIVE"&&ee.nextMessageToSend===$&&(ee.nextMessageToSend+=1,ee.call.halfClose())}setCredentials($){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};ee.RetryingCall=RetryingCall},17574:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.Http2ServerCallStream=ee.ServerDuplexStreamImpl=ee.ServerWritableStreamImpl=ee.ServerReadableStreamImpl=ee.ServerUnaryCallImpl=void 0;let er=et(82361),en=et(85158),ei=et(12781),es=et(59796),eo=et(73837),eu=et(69238),eh=et(32908),ep=et(80272),ef=et(68200),em=et(9006),eg="server_call",ey=(0,eo.promisify)(es.unzip),ev=(0,eo.promisify)(es.inflate);function trace($){ef.trace(eu.LogVerbosity.DEBUG,eg,$)}let eS="grpc-accept-encoding",eC="grpc-encoding",eT="grpc-message",eE="grpc-status",ew="grpc-timeout",eD=/(\d{1,8})\s*([HMSmun])/,eI={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},eR={[eS]:"identity,deflate,gzip",[eC]:"identity"},e_={[en.constants.HTTP2_HEADER_STATUS]:en.constants.HTTP_STATUS_OK,[en.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},eP={waitForTrailers:!0};let ServerUnaryCallImpl=class ServerUnaryCallImpl extends er.EventEmitter{constructor($,ee,et){super(),this.call=$,this.metadata=ee,this.request=et,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata($){this.call.sendMetadata($)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};ee.ServerUnaryCallImpl=ServerUnaryCallImpl;let ServerReadableStreamImpl=class ServerReadableStreamImpl extends ei.Readable{constructor($,ee,et,er){super({objectMode:!0}),this.call=$,this.metadata=ee,this.deserialize=et,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,er)}_read($){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata($){this.call.sendMetadata($)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};ee.ServerReadableStreamImpl=ServerReadableStreamImpl;let ServerWritableStreamImpl=class ServerWritableStreamImpl extends ei.Writable{constructor($,ee,et,er){super({objectMode:!0}),this.call=$,this.metadata=ee,this.serialize=et,this.request=er,this.cancelled=!1,this.trailingMetadata=new eh.Metadata,this.call.setupSurfaceCall(this),this.on("error",$=>{this.call.sendError($),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata($){this.call.sendMetadata($)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write($,ee,et){try{let ee=this.call.serializeMessage($);if(!this.call.write(ee)){this.call.once("drain",et);return}}catch($){this.emit("error",{details:(0,em.getErrorMessage)($),code:eu.Status.INTERNAL})}et()}_final($){this.call.sendStatus({code:eu.Status.OK,details:"OK",metadata:this.trailingMetadata}),$(null)}end($){return $&&(this.trailingMetadata=$),super.end()}};ee.ServerWritableStreamImpl=ServerWritableStreamImpl;let ServerDuplexStreamImpl=class ServerDuplexStreamImpl extends ei.Duplex{constructor($,ee,et,er,en){super({objectMode:!0}),this.call=$,this.metadata=ee,this.serialize=et,this.deserialize=er,this.cancelled=!1,this.trailingMetadata=new eh.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,en),this.on("error",$=>{this.call.sendError($),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata($){this.call.sendMetadata($)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end($){return $&&(this.trailingMetadata=$),super.end()}};ee.ServerDuplexStreamImpl=ServerDuplexStreamImpl,ServerDuplexStreamImpl.prototype._read=ServerReadableStreamImpl.prototype._read,ServerDuplexStreamImpl.prototype._write=ServerWritableStreamImpl.prototype._write,ServerDuplexStreamImpl.prototype._final=ServerWritableStreamImpl.prototype._final;let Http2ServerCallStream=class Http2ServerCallStream extends er.EventEmitter{constructor($,ee,et){super(),this.stream=$,this.handler=ee,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=eu.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=eu.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",$=>{}),this.stream.once("close",()=>{var $;trace("Request to method "+(null===($=this.handler)||void 0===$?void 0:$.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:eu.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in et&&(this.maxSendMessageSize=et["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in et&&(this.maxReceiveMessageSize=et["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage($,ee){return"deflate"===ee?ev($.subarray(5)):"gzip"===ee?ey($.subarray(5)):"identity"===ee?$.subarray(5):Promise.reject({code:eu.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${ee}"`})}sendMetadata($){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let ee=$?$.toHttp2Headers():null,et=Object.assign(Object.assign(Object.assign({},e_),eR),ee);this.stream.respond(et,eP)}receiveMetadata($){let ee=eh.Metadata.fromHttp2Headers($);ef.isTracerEnabled(eg)&&trace("Request to "+this.handler.path+" received headers "+JSON.stringify(ee.toJSON()));let et=ee.get(ew);if(et.length>0){let $=et[0].toString().match(eD);if(null===$){let $=Error("Invalid deadline");return $.code=eu.Status.OUT_OF_RANGE,this.sendError($),ee}let er=+$[1]*eI[$[2]]|0,en=new Date;this.deadline=en.setMilliseconds(en.getMilliseconds()+er),this.deadlineTimer=setTimeout(handleExpiredDeadline,er,this),ee.remove(ew)}return ee.remove(en.constants.HTTP2_HEADER_ACCEPT_ENCODING),ee.remove(en.constants.HTTP2_HEADER_TE),ee.remove(en.constants.HTTP2_HEADER_CONTENT_TYPE),ee.remove("grpc-accept-encoding"),ee}receiveUnaryMessage($){return new Promise((ee,et)=>{let{stream:er}=this,en=0,ei=this,es=[],eo=this.maxReceiveMessageSize;function onData($){if(en+=$.byteLength,-1!==eo&&en>eo){er.removeListener("data",onData),er.removeListener("end",onEnd),er.removeListener("error",onEnd),et({code:eu.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${en} vs. ${eo})`});return}es.push($)}function onEnd(eo){if(er.removeListener("data",onData),er.removeListener("end",onEnd),er.removeListener("error",onEnd),void 0!==eo){et({code:eu.Status.INTERNAL,details:eo.message});return}if(0===en){et({code:eu.Status.INTERNAL,details:"received empty unary message"});return}ei.emit("receiveMessage");let eh=Buffer.concat(es,en),ep=1===eh.readUInt8(0),ef=ep?$:"identity",em=ei.getDecompressedMessage(eh,ef);if(Buffer.isBuffer(em)){ee(ei.deserializeMessageWithInternalError(em));return}em.then($=>ee(ei.deserializeMessageWithInternalError($)),ee=>et(ee.code?ee:{code:eu.Status.INTERNAL,details:`Received "grpc-encoding" header "${$}" but ${$} decompression failed`}))}this.stream.on("data",onData),this.stream.on("end",onEnd),this.stream.on("error",onEnd)})}async deserializeMessageWithInternalError($){try{return this.deserializeMessage($)}catch($){throw{details:(0,em.getErrorMessage)($),code:eu.Status.INTERNAL}}}serializeMessage($){let ee=this.handler.serialize($),et=ee.byteLength,er=Buffer.allocUnsafe(et+5);return er.writeUInt8(0,0),er.writeUInt32BE(et,1),ee.copy(er,5),er}deserializeMessage($){return this.handler.deserialize($)}async sendUnaryMessage($,ee,et,er){if(!this.checkCancelled()){if(void 0===et&&(et=null),$){!Object.prototype.hasOwnProperty.call($,"metadata")&&et&&($.metadata=et),this.sendError($);return}try{let $=this.serializeMessage(ee);this.write($),this.sendStatus({code:eu.Status.OK,details:"OK",metadata:et})}catch($){this.sendError({details:(0,em.getErrorMessage)($),code:eu.Status.INTERNAL})}}}sendStatus($){var ee,et;if(this.emit("callEnd",$.code),this.emit("streamEnd",$.code===eu.Status.OK),!this.checkCancelled()){if(trace("Request to method "+(null===(ee=this.handler)||void 0===ee?void 0:ee.path)+" ended with status code: "+eu.Status[$.code]+" details: "+$.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var ee;let et=Object.assign({[eE]:$.code,[eT]:encodeURI($.details)},null===(ee=$.metadata)||void 0===ee?void 0:ee.toHttp2Headers());this.stream.sendTrailers(et),this.statusSent=!0}),this.stream.end());else{let ee=Object.assign(Object.assign({[eE]:$.code,[eT]:encodeURI($.details)},e_),null===(et=$.metadata)||void 0===et?void 0:et.toHttp2Headers());this.stream.respond(ee,{endStream:!0}),this.statusSent=!0}}}sendError($){let ee={code:eu.Status.UNKNOWN,details:"message"in $?$.message:"Unknown Error",metadata:"metadata"in $&&void 0!==$.metadata?$.metadata:null};"code"in $&&"number"==typeof $.code&&Number.isInteger($.code)&&(ee.code=$.code,"details"in $&&"string"==typeof $.details&&(ee.details=$.details)),this.sendStatus(ee)}write($){if(!this.checkCancelled()){if(-1!==this.maxSendMessageSize&&$.length>this.maxSendMessageSize){this.sendError({code:eu.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${$.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write($)}}resume(){this.stream.resume()}setupSurfaceCall($){this.once("cancelled",ee=>{$.cancelled=!0,$.emit("cancelled",ee)}),this.once("callEnd",ee=>$.emit("callEnd",ee))}setupReadable($,ee){let et=new ep.StreamDecoder,er=!1,en=!1,ei=!1,maybePushEnd=async()=>{ei||!er||en||(ei=!0,await this.pushOrBufferMessage($,null))};this.stream.on("data",async er=>{let ei=et.write(er);for(let et of(en=!0,this.stream.pause(),ei)){if(-1!==this.maxReceiveMessageSize&&et.length>this.maxReceiveMessageSize){this.sendError({code:eu.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${et.length} vs. ${this.maxReceiveMessageSize})`});return}this.emit("receiveMessage");let er=1===et.readUInt8(0),en=er?ee:"identity",ei=await this.getDecompressedMessage(et,en);if(!ei)return;await this.pushOrBufferMessage($,ei)}en=!1,this.stream.resume(),await maybePushEnd()}),this.stream.once("end",async()=>{er=!0,await maybePushEnd()})}consumeUnpushedMessages($){for(this.canPush=!0;this.messagesToPush.length>0;){let ee=this.messagesToPush.shift(),et=$.push(ee);if(null===ee||!1===et){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage($,ee){this.isPushPending?this.bufferedMessages.push(ee):await this.pushMessage($,ee)}async pushMessage($,ee){if(null===ee){trace("Received end of stream"),this.canPush?$.push(null):this.messagesToPush.push(null);return}trace("Received message of length "+ee.length),this.isPushPending=!0;try{let et=await this.deserializeMessage(ee);this.canPush?$.push(et)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(et)}catch(et){this.bufferedMessages.length=0;let ee=(0,em.getErrorCode)(et);(null===ee||ee<eu.Status.OK||ee>eu.Status.UNAUTHENTICATED)&&(ee=eu.Status.INTERNAL),$.emit("error",{details:(0,em.getErrorMessage)(et),code:ee})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage($,this.bufferedMessages.shift())}getPeer(){var $;let ee=null===($=this.stream.session)||void 0===$?void 0:$.socket;return null!=ee&&ee.remoteAddress?ee.remotePort?`${ee.remoteAddress}:${ee.remotePort}`:ee.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};function handleExpiredDeadline($){let ee=Error("Deadline exceeded");ee.code=eu.Status.DEADLINE_EXCEEDED,$.sendError(ee),$.cancelled=!0,$.emit("cancelled","deadline")}ee.Http2ServerCallStream=Http2ServerCallStream},62501:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.ServerCredentials=void 0;let er=et(66801);let ServerCredentials=class ServerCredentials{static createInsecure(){return new InsecureServerCredentials}static createSsl($,ee,et=!1){if(null!==$&&!Buffer.isBuffer($))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(ee))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof et)throw TypeError("checkClientCertificate must be a boolean");let en=[],ei=[];for(let $=0;$<ee.length;$++){let et=ee[$];if(null===et||"object"!=typeof et)throw TypeError(`keyCertPair[${$}] must be an object`);if(!Buffer.isBuffer(et.private_key))throw TypeError(`keyCertPair[${$}].private_key must be a Buffer`);if(!Buffer.isBuffer(et.cert_chain))throw TypeError(`keyCertPair[${$}].cert_chain must be a Buffer`);en.push(et.cert_chain),ei.push(et.private_key)}return new SecureServerCredentials({ca:$||(0,er.getDefaultRootsData)()||void 0,cert:en,key:ei,requestCert:et,ciphers:er.CIPHER_SUITES})}};ee.ServerCredentials=ServerCredentials;let InsecureServerCredentials=class InsecureServerCredentials extends ServerCredentials{_isSecure(){return!1}_getSettings(){return null}};let SecureServerCredentials=class SecureServerCredentials extends ServerCredentials{constructor($){super(),this.options=$}_isSecure(){return!0}_getSettings(){return this.options}}},92903:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.Server=void 0;let er=et(85158),en=et(69238),ei=et(17574),es=et(62501),eo=et(14755),eu=et(68200),eh=et(72782),ep=et(14717),ef=et(83316),em=2147483647,eg=2147483647,ey=2e4,{HTTP2_HEADER_PATH:ev}=er.constants,eS="server";function noop(){}function getUnimplementedStatusResponse($){return{code:en.Status.UNIMPLEMENTED,details:`The server does not implement the method ${$}`}}function getDefaultHandler($,ee){let et=getUnimplementedStatusResponse(ee);switch($){case"unary":return($,ee)=>{ee(et,null)};case"clientStream":return($,ee)=>{ee(et,null)};case"serverStream":return $=>{$.emit("error",et)};case"bidi":return $=>{$.emit("error",et)};default:throw Error(`Invalid handlerType ${$}`)}}let Server=class Server{constructor($){var ee,et,er,en;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new ef.ChannelzTrace,this.callTracker=new ef.ChannelzCallTracker,this.listenerChildrenTracker=new ef.ChannelzChildrenTracker,this.sessionChildrenTracker=new ef.ChannelzChildrenTracker,this.options=null!=$?$:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,ef.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!==(ee=this.options["grpc.max_connection_age_ms"])&&void 0!==ee?ee:em,this.maxConnectionAgeGraceMs=null!==(et=this.options["grpc.max_connection_age_grace_ms"])&&void 0!==et?et:em,this.keepaliveTimeMs=null!==(er=this.options["grpc.keepalive_time_ms"])&&void 0!==er?er:eg,this.keepaliveTimeoutMs=null!==(en=this.options["grpc.keepalive_timeout_ms"])&&void 0!==en?en:ey,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter($){return()=>{var ee,et,er;let en;let ei=this.sessions.get($),es=$.socket,eo=es.remoteAddress?(0,eh.stringToSubchannelAddress)(es.remoteAddress,es.remotePort):null,eu=es.localAddress?(0,eh.stringToSubchannelAddress)(es.localAddress,es.localPort):null;if($.encrypted){let $=es,et=$.getCipher(),er=$.getCertificate(),ei=$.getPeerCertificate();en={cipherSuiteStandardName:null!==(ee=et.standardName)&&void 0!==ee?ee:null,cipherSuiteOtherName:et.standardName?null:et.name,localCertificate:er&&"raw"in er?er.raw:null,remoteCertificate:ei&&"raw"in ei?ei.raw:null}}else en=null;let ep={remoteAddress:eo,localAddress:eu,security:en,remoteName:null,streamsStarted:ei.streamTracker.callsStarted,streamsSucceeded:ei.streamTracker.callsSucceeded,streamsFailed:ei.streamTracker.callsFailed,messagesSent:ei.messagesSent,messagesReceived:ei.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:ei.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:ei.lastMessageSentTimestamp,lastMessageReceivedTimestamp:ei.lastMessageReceivedTimestamp,localFlowControlWindow:null!==(et=$.state.localWindowSize)&&void 0!==et?et:null,remoteFlowControlWindow:null!==(er=$.state.remoteWindowSize)&&void 0!==er?er:null};return ep}}trace($){eu.trace(en.LogVerbosity.DEBUG,eS,"("+this.channelzRef.id+") "+$)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService($,ee){if(null===$||"object"!=typeof $||null===ee||"object"!=typeof ee)throw Error("addService() requires two objects as arguments");let et=Object.keys($);if(0===et.length)throw Error("Cannot add an empty service to a server");et.forEach(et=>{let er,en;let ei=$[et];er=ei.requestStream?ei.responseStream?"bidi":"clientStream":ei.responseStream?"serverStream":"unary";let es=ee[et];void 0===es&&"string"==typeof ei.originalName&&(es=ee[ei.originalName]),en=void 0!==es?es.bind(ee):getDefaultHandler(er,et);let eo=this.register(ei.path,en,ei.responseSerialize,ei.requestDeserialize,er);if(!1===eo)throw Error(`Method handler for ${ei.path} already provided.`)})}removeService($){if(null===$||"object"!=typeof $)throw Error("removeService() requires object as argument");let ee=Object.keys($);ee.forEach(ee=>{let et=$[ee];this.unregister(et.path)})}bind($,ee){throw Error("Not implemented. Use bindAsync() instead")}bindAsync($,ee,et){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof $)throw TypeError("port must be a string");if(null===ee||!(ee instanceof es.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof et)throw TypeError("callback must be a function");let ei=(0,ep.parseUri)($);if(null===ei)throw Error(`Could not parse port "${$}"`);let em=(0,eo.mapUriDefaultScheme)(ei);if(null===em)throw Error(`Could not get a default scheme for port "${$}"`);let eg={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?eg.maxSessionMemory=this.options["grpc-node.max_session_memory"]:eg.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(eg.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let deferredCallback=($,ee)=>{process.nextTick(()=>et($,ee))},setupServer=()=>{let $;if(ee._isSecure()){let et=Object.assign(eg,ee._getSettings());et.enableTrace=1===this.options["grpc-node.tls_enable_trace"],($=er.createSecureServer(et)).on("secureConnection",$=>{$.on("error",$=>{this.trace("An incoming TLS connection closed with error: "+$.message)})})}else $=er.createServer(eg);return $.setTimeout(0,noop),this._setupHandlers($),$},bindSpecificPort=($,ee,et)=>0===$.length?Promise.resolve({port:ee,count:et}):Promise.all($.map($=>{let et;this.trace("Attempting to bind "+(0,eh.subchannelAddressToString)($)),et=(0,eh.isTcpSubchannelAddress)($)?{host:$.host,port:ee}:$;let er=setupServer();return new Promise((en,ei)=>{let onError=ee=>{this.trace("Failed to bind "+(0,eh.subchannelAddressToString)($)+" with error "+ee.message),en(ee)};er.once("error",onError),er.listen(et,()=>{let $;if(this.shutdown){er.close(),en(Error("bindAsync failed because server is shutdown"));return}let et=er.address();$="string"==typeof et?{path:et}:{host:et.address,port:et.port};let ei=(0,ef.registerChannelzSocket)((0,eh.subchannelAddressToString)($),()=>({localAddress:$,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(ei),this.http2ServerList.push({server:er,channelzRef:ei}),this.trace("Successfully bound "+(0,eh.subchannelAddressToString)($)),en("port"in $?$.port:ee),er.removeListener("error",onError)})})})).then($=>{let er=0;for(let et of $)if("number"==typeof et&&(er+=1,et!==ee))throw Error("Invalid state: multiple port numbers added from single address");return{port:ee,count:er+et}}),bindWildcardPort=$=>{if(0===$.length)return Promise.resolve({port:0,count:0});let ee=$[0],et=setupServer();return new Promise((er,en)=>{let onError=et=>{this.trace("Failed to bind "+(0,eh.subchannelAddressToString)(ee)+" with error "+et.message),er(bindWildcardPort($.slice(1)))};et.once("error",onError),et.listen(ee,()=>{if(this.shutdown){et.close(),er({port:0,count:0});return}let ee=et.address(),en={host:ee.address,port:ee.port},ei=(0,ef.registerChannelzSocket)((0,eh.subchannelAddressToString)(en),()=>({localAddress:en,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(ei),this.http2ServerList.push({server:et,channelzRef:ei}),this.trace("Successfully bound "+(0,eh.subchannelAddressToString)(en)),er(bindSpecificPort($.slice(1),ee.port,1)),et.removeListener("error",onError)})})},ey={onSuccessfulResolution:(ee,et,er)=>{let ei;if(ey.onSuccessfulResolution=()=>{},this.shutdown&&deferredCallback(Error("bindAsync failed because server is shutdown"),0),0===ee.length){deferredCallback(Error(`No addresses resolved for port ${$}`),0);return}(ei=(0,eh.isTcpSubchannelAddress)(ee[0])?0===ee[0].port?bindWildcardPort(ee):bindSpecificPort(ee,ee[0].port,0):bindSpecificPort(ee,1,0)).then($=>{if(0===$.count){let $=`No address added out of total ${ee.length} resolved`;eu.log(en.LogVerbosity.ERROR,$),deferredCallback(Error($),0)}else $.count<ee.length&&eu.log(en.LogVerbosity.INFO,`WARNING Only ${$.count} addresses added out of total ${ee.length} resolved`),deferredCallback(null,$.port)},$=>{let et=`No address added out of total ${ee.length} resolved`;eu.log(en.LogVerbosity.ERROR,et),deferredCallback(Error(et),0)})},onError:$=>{deferredCallback(Error($.details),0)}},ev=(0,eo.createResolver)(em,ey,this.options);ev.updateResolution()}forceShutdown(){for(let{server:$,channelzRef:ee}of this.http2ServerList)$.listening&&$.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(ee),(0,ef.unregisterChannelzRef)(ee))});this.started=!1,this.shutdown=!0,this.sessions.forEach(($,ee)=>{ee.destroy(er.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,ef.unregisterChannelzRef)(this.channelzRef)}register($,ee,et,er,en){return!this.handlers.has($)&&(this.handlers.set($,{func:ee,serialize:et,deserialize:er,type:en,path:$}),!0)}unregister($){return this.handlers.delete($)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:$})=>!0!==$.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown($){let wrappedCallback=ee=>{this.channelzEnabled&&(0,ef.unregisterChannelzRef)(this.channelzRef),$(ee)},ee=0;function maybeCallback(){0==--ee&&wrappedCallback()}for(let{server:$,channelzRef:et}of(this.started=!1,this.shutdown=!0,this.http2ServerList))$.listening&&(ee++,$.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(et),(0,ef.unregisterChannelzRef)(et)),maybeCallback()}));this.sessions.forEach(($,et)=>{et.closed||(ee+=1,et.close(maybeCallback))}),0===ee&&wrappedCallback()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType($,ee){let et=ee[er.constants.HTTP2_HEADER_CONTENT_TYPE];return!!("string"==typeof et&&et.startsWith("application/grpc"))||($.respond({[er.constants.HTTP2_HEADER_STATUS]:er.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler($){this.trace("Received call to method "+$+" at address "+this.serverAddressString);let ee=this.handlers.get($);return void 0===ee?(this.trace("No handler registered for method "+$+". Sending UNIMPLEMENTED status."),null):ee}_respondWithError($,ee,et=null){let er=new ei.Http2ServerCallStream(ee,null,this.options);void 0===$.code&&($.code=en.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==et||et.streamTracker.addCallFailed()),er.sendError($)}_channelzHandler($,ee){let et=this.sessions.get($.session);if(this.callTracker.addCallStarted(),null==et||et.streamTracker.addCallStarted(),!this._verifyContentType($,ee)){this.callTracker.addCallFailed(),null==et||et.streamTracker.addCallFailed();return}let er=ee[ev],es=this._retrieveHandler(er);if(!es){this._respondWithError(getUnimplementedStatusResponse(er),$,et);return}let eo=new ei.Http2ServerCallStream($,es,this.options);eo.once("callEnd",$=>{$===en.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),et&&(eo.once("streamEnd",$=>{$?et.streamTracker.addCallSucceeded():et.streamTracker.addCallFailed()}),eo.on("sendMessage",()=>{et.messagesSent+=1,et.lastMessageSentTimestamp=new Date}),eo.on("receiveMessage",()=>{et.messagesReceived+=1,et.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(eo,es,ee)||(this.callTracker.addCallFailed(),null==et||et.streamTracker.addCallFailed(),eo.sendError({code:en.Status.INTERNAL,details:`Unknown handler type: ${es.type}`}))}_streamHandler($,ee){if(!0!==this._verifyContentType($,ee))return;let et=ee[ev],er=this._retrieveHandler(et);if(!er){this._respondWithError(getUnimplementedStatusResponse(et),$,null);return}let es=new ei.Http2ServerCallStream($,er,this.options);this._runHandlerForCall(es,er,ee)||es.sendError({code:en.Status.INTERNAL,details:`Unknown handler type: ${er.type}`})}_runHandlerForCall($,ee,et){var er;let en=$.receiveMetadata(et),ei=null!==(er=en.get("grpc-encoding")[0])&&void 0!==er?er:"identity";en.remove("grpc-encoding");let{type:es}=ee;if("unary"===es)handleUnary($,ee,en,ei);else if("clientStream"===es)handleClientStreaming($,ee,en,ei);else if("serverStream"===es)handleServerStreaming($,ee,en,ei);else{if("bidi"!==es)return!1;handleBidiStreaming($,ee,en,ei)}return!0}_setupHandlers($){if(null===$)return;let ee=$.address(),et="null";ee&&(et="string"==typeof ee?ee:ee.address+":"+ee.port),this.serverAddressString=et;let en=this.channelzEnabled?this._channelzHandler:this._streamHandler;$.on("stream",en.bind(this)),$.on("session",$=>{var ee,et,en,ei,es;if(!this.started){$.destroy();return}let eo=(0,ef.registerChannelzSocket)(null!==(ee=$.socket.remoteAddress)&&void 0!==ee?ee:"unknown",this.getChannelzSessionInfoGetter($),this.channelzEnabled),eu={ref:eo,streamTracker:new ef.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set($,eu);let eh=$.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+eh),this.sessionChildrenTracker.refChild(eo));let ep=null,eg=null,ey=!1;if(this.maxConnectionAgeMs!==em){let ee=this.maxConnectionAgeMs/10,ei=Math.random()*ee*2-ee;ep=null===(en=(et=setTimeout(()=>{var ee,et;ey=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+eh);try{$.goaway(er.constants.NGHTTP2_NO_ERROR,2147483647,Buffer.from("max_age"))}catch(ee){$.destroy();return}$.close(),this.maxConnectionAgeGraceMs!==em&&(eg=null===(et=(ee=setTimeout(()=>{$.destroy()},this.maxConnectionAgeGraceMs)).unref)||void 0===et?void 0:et.call(ee))},this.maxConnectionAgeMs+ei)).unref)||void 0===en?void 0:en.call(et)}let ev=null===(es=(ei=setInterval(()=>{var ee,et;let er=null===(et=(ee=setTimeout(()=>{ey=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+eh),$.close()},this.keepaliveTimeoutMs)).unref)||void 0===et?void 0:et.call(ee);try{$.ping(($,ee,et)=>{clearTimeout(er)})}catch(ee){$.destroy()}},this.keepaliveTimeMs)).unref)||void 0===es?void 0:es.call(ei);$.on("close",()=>{this.channelzEnabled&&(ey||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+eh),this.sessionChildrenTracker.unrefChild(eo),(0,ef.unregisterChannelzRef)(eo)),ep&&clearTimeout(ep),eg&&clearTimeout(eg),ev&&clearTimeout(ev),this.sessions.delete($)})})}};async function handleUnary($,ee,et,er){try{let en=await $.receiveUnaryMessage(er);if(void 0===en||$.cancelled)return;let es=new ei.ServerUnaryCallImpl($,et,en);ee.func(es,(ee,et,er,en)=>{$.sendUnaryMessage(ee,et,er,en)})}catch(ee){$.sendError(ee)}}function handleClientStreaming($,ee,et,er){let en=new ei.ServerReadableStreamImpl($,et,ee.deserialize,er);function respond(ee,et,er,ei){en.destroy(),$.sendUnaryMessage(ee,et,er,ei)}$.cancelled||(en.on("error",respond),ee.func(en,respond))}async function handleServerStreaming($,ee,et,er){try{let en=await $.receiveUnaryMessage(er);if(void 0===en||$.cancelled)return;let es=new ei.ServerWritableStreamImpl($,et,ee.serialize,en);ee.func(es)}catch(ee){$.sendError(ee)}}function handleBidiStreaming($,ee,et,er){let en=new ei.ServerDuplexStreamImpl($,et,ee.serialize,ee.deserialize,er);$.cancelled||ee.func(en)}ee.Server=Server},45914:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.extractAndSelectServiceConfig=ee.validateServiceConfig=ee.validateRetryThrottling=void 0;let er=et(22037),en=et(69238),ei=et(77203),es=/^\d+(\.\d{1,9})?s$/,eo="node";function validateName($){if("service"in $&&""!==$.service){if("string"!=typeof $.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof $.service}`);if(!("method"in $)||""===$.method)return{service:$.service};if("string"!=typeof $.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof $.service}`);return{service:$.service,method:$.method}}if("method"in $&&void 0!==$.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}function validateRetryPolicy($){if(!("maxAttempts"in $)||!Number.isInteger($.maxAttempts)||$.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in $)||"string"!=typeof $.initialBackoff||!es.test($.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in $)||"string"!=typeof $.maxBackoff||!es.test($.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in $)||"number"!=typeof $.backoffMultiplier||$.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in $&&Array.isArray($.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===$.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let ee of $.retryableStatusCodes)if("number"==typeof ee){if(!Object.values(en.Status).includes(ee))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof ee){if(!Object.values(en.Status).includes(ee.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:$.maxAttempts,initialBackoff:$.initialBackoff,maxBackoff:$.maxBackoff,backoffMultiplier:$.backoffMultiplier,retryableStatusCodes:$.retryableStatusCodes}}function validateHedgingPolicy($){if(!("maxAttempts"in $)||!Number.isInteger($.maxAttempts)||$.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in $&&("string"!=typeof $.hedgingDelay||!es.test($.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in $&&Array.isArray($.nonFatalStatusCodes))for(let ee of $.nonFatalStatusCodes)if("number"==typeof ee){if(!Object.values(en.Status).includes(ee))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof ee){if(!Object.values(en.Status).includes(ee.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let ee={maxAttempts:$.maxAttempts};return $.hedgingDelay&&(ee.hedgingDelay=$.hedgingDelay),$.nonFatalStatusCodes&&(ee.nonFatalStatusCodes=$.nonFatalStatusCodes),ee}function validateMethodConfig($){var ee;let et={name:[]};if(!("name"in $)||!Array.isArray($.name))throw Error("Invalid method config: invalid name array");for(let ee of $.name)et.name.push(validateName(ee));if("waitForReady"in $){if("boolean"!=typeof $.waitForReady)throw Error("Invalid method config: invalid waitForReady");et.waitForReady=$.waitForReady}if("timeout"in $){if("object"==typeof $.timeout){if(!("seconds"in $.timeout)||"number"!=typeof $.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in $.timeout)||"number"!=typeof $.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");et.timeout=$.timeout}else if("string"==typeof $.timeout&&es.test($.timeout)){let er=$.timeout.substring(0,$.timeout.length-1).split(".");et.timeout={seconds:0|er[0],nanos:(null!==(ee=er[1])&&void 0!==ee?ee:0)|0}}else throw Error("Invalid method config: invalid timeout")}if("maxRequestBytes"in $){if("number"!=typeof $.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");et.maxRequestBytes=$.maxRequestBytes}if("maxResponseBytes"in $){if("number"!=typeof $.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");et.maxResponseBytes=$.maxResponseBytes}if("retryPolicy"in $){if("hedgingPolicy"in $)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");et.retryPolicy=validateRetryPolicy($.retryPolicy)}else"hedgingPolicy"in $&&(et.hedgingPolicy=validateHedgingPolicy($.hedgingPolicy));return et}function validateRetryThrottling($){if(!("maxTokens"in $)||"number"!=typeof $.maxTokens||$.maxTokens<=0||$.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in $)||"number"!=typeof $.tokenRatio||$.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+$.maxTokens.toFixed(3),tokenRatio:+$.tokenRatio.toFixed(3)}}function validateServiceConfig($){let ee={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in $){if("string"==typeof $.loadBalancingPolicy)ee.loadBalancingPolicy=$.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy")}if("loadBalancingConfig"in $){if(Array.isArray($.loadBalancingConfig))for(let et of $.loadBalancingConfig)ee.loadBalancingConfig.push((0,ei.validateLoadBalancingConfig)(et));else throw Error("Invalid service config: invalid loadBalancingConfig")}if("methodConfig"in $&&Array.isArray($.methodConfig))for(let et of $.methodConfig)ee.methodConfig.push(validateMethodConfig(et));"retryThrottling"in $&&(ee.retryThrottling=validateRetryThrottling($.retryThrottling));let et=[];for(let $ of ee.methodConfig)for(let ee of $.name){for(let $ of et)if(ee.service===$.service&&ee.method===$.method)throw Error(`Invalid service config: duplicate name ${ee.service}/${ee.method}`);et.push(ee)}return ee}function validateCanaryConfig($){if(!("serviceConfig"in $))throw Error("Invalid service config choice: missing service config");let ee={serviceConfig:validateServiceConfig($.serviceConfig)};if("clientLanguage"in $){if(Array.isArray($.clientLanguage))for(let et of(ee.clientLanguage=[],$.clientLanguage))if("string"==typeof et)ee.clientLanguage.push(et);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage")}if("clientHostname"in $){if(Array.isArray($.clientHostname))for(let et of(ee.clientHostname=[],$.clientHostname))if("string"==typeof et)ee.clientHostname.push(et);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname")}if("percentage"in $){if("number"==typeof $.percentage&&0<=$.percentage&&$.percentage<=100)ee.percentage=$.percentage;else throw Error("Invalid service config choice: invalid percentage")}let et=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let ee in $)if(!et.includes(ee))throw Error(`Invalid service config choice: unexpected field ${ee}`);return ee}function validateAndSelectCanaryConfig($,ee){if(!Array.isArray($))throw Error("Invalid service config list");for(let et of $){let $=validateCanaryConfig(et);if("number"!=typeof $.percentage||!(ee>$.percentage)){if(Array.isArray($.clientHostname)){let ee=!1;for(let et of $.clientHostname)et===er.hostname()&&(ee=!0);if(!ee)continue}if(Array.isArray($.clientLanguage)){let ee=!1;for(let et of $.clientLanguage)et===eo&&(ee=!0);if(!ee)continue}return $.serviceConfig}}throw Error("No matching service config found")}function extractAndSelectServiceConfig($,ee){for(let et of $)if(et.length>0&&et[0].startsWith("grpc_config=")){let $=et.join("").substring(12),er=JSON.parse($);return validateAndSelectCanaryConfig(er,ee)}return null}ee.validateRetryThrottling=validateRetryThrottling,ee.validateServiceConfig=validateServiceConfig,ee.extractAndSelectServiceConfig=extractAndSelectServiceConfig},9929:($,ee)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.StatusBuilder=void 0;let StatusBuilder=class StatusBuilder{constructor(){this.code=null,this.details=null,this.metadata=null}withCode($){return this.code=$,this}withDetails($){return this.details=$,this}withMetadata($){return this.metadata=$,this}build(){let $={};return null!==this.code&&($.code=this.code),null!==this.details&&($.details=this.details),null!==this.metadata&&($.metadata=this.metadata),$}};ee.StatusBuilder=StatusBuilder},80272:($,ee)=>{"use strict";var et;Object.defineProperty(ee,"__esModule",{value:!0}),ee.StreamDecoder=void 0,function($){$[$.NO_DATA=0]="NO_DATA",$[$.READING_SIZE=1]="READING_SIZE",$[$.READING_MESSAGE=2]="READING_MESSAGE"}(et||(et={}));let StreamDecoder=class StreamDecoder{constructor(){this.readState=et.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write($){let ee,er=0,en=[];for(;er<$.length;)switch(this.readState){case et.NO_DATA:this.readCompressFlag=$.slice(er,er+1),er+=1,this.readState=et.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case et.READING_SIZE:if(ee=Math.min($.length-er,this.readSizeRemaining),$.copy(this.readPartialSize,4-this.readSizeRemaining,er,er+ee),this.readSizeRemaining-=ee,er+=ee,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=et.READING_MESSAGE;else{let $=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=et.NO_DATA,en.push($)}}break;case et.READING_MESSAGE:if(ee=Math.min($.length-er,this.readMessageRemaining),this.readPartialMessage.push($.slice(er,er+ee)),this.readMessageRemaining-=ee,er+=ee,0===this.readMessageRemaining){let $=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),ee=Buffer.concat($,this.readMessageSize+5);this.readState=et.NO_DATA,en.push(ee)}break;default:throw Error("Unexpected read state")}return en}};ee.StreamDecoder=StreamDecoder},72782:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.stringToSubchannelAddress=ee.subchannelAddressToString=ee.subchannelAddressEqual=ee.isTcpSubchannelAddress=void 0;let er=et(41808);function isTcpSubchannelAddress($){return"port"in $}function subchannelAddressEqual($,ee){return!$&&!ee||!!$&&!!ee&&(isTcpSubchannelAddress($)?isTcpSubchannelAddress(ee)&&$.host===ee.host&&$.port===ee.port:!isTcpSubchannelAddress(ee)&&$.path===ee.path)}function subchannelAddressToString($){return isTcpSubchannelAddress($)?$.host+":"+$.port:$.path}ee.isTcpSubchannelAddress=isTcpSubchannelAddress,ee.subchannelAddressEqual=subchannelAddressEqual,ee.subchannelAddressToString=subchannelAddressToString;let en=443;function stringToSubchannelAddress($,ee){return(0,er.isIP)($)?{host:$,port:null!=ee?ee:en}:{path:$}}ee.stringToSubchannelAddress=stringToSubchannelAddress},32210:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.Http2SubchannelCall=void 0;let er=et(85158),en=et(22037),ei=et(69238),es=et(32908),eo=et(80272),eu=et(68200),eh=et(69238),ep="subchannel_call";function getSystemErrorName($){for(let[ee,et]of Object.entries(en.constants.errno))if(et===$)return ee;return"Unknown system error "+$}let Http2SubchannelCall=class Http2SubchannelCall{constructor($,ee,et,en,eu){this.http2Stream=$,this.callEventTracker=ee,this.listener=et,this.transport=en,this.callId=eu,this.decoder=new eo.StreamDecoder,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=ei.Status.UNKNOWN,this.finalStatus=null,this.internalError=null,$.on("response",($,ee)=>{let et="";for(let ee of Object.keys($))et+="		"+ee+": "+$[ee]+"\n";switch(this.trace("Received server headers:\n"+et),$[":status"]){case 400:this.mappedStatusCode=ei.Status.INTERNAL;break;case 401:this.mappedStatusCode=ei.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=ei.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=ei.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=ei.Status.UNAVAILABLE;break;default:this.mappedStatusCode=ei.Status.UNKNOWN}if(ee&er.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers($);else{let ee;try{ee=es.Metadata.fromHttp2Headers($)}catch($){this.endCall({code:ei.Status.UNKNOWN,details:$.message,metadata:new es.Metadata});return}this.listener.onReceiveMetadata(ee)}}),$.on("trailers",$=>{this.handleTrailers($)}),$.on("data",$=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+$.length);let ee=this.decoder.write($);for(let $ of ee)this.trace("parsed message of length "+$.length),this.callEventTracker.addMessageReceived(),this.tryPush($)}),$.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),$.on("close",()=>{process.nextTick(()=>{var ee;let et;if(this.trace("HTTP/2 stream closed with code "+$.rstCode),(null===(ee=this.finalStatus)||void 0===ee?void 0:ee.code)===ei.Status.OK)return;let en="";switch($.rstCode){case er.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;et=ei.Status.INTERNAL,en=`Received RST_STREAM with code ${$.rstCode}`;break;case er.constants.NGHTTP2_REFUSED_STREAM:et=ei.Status.UNAVAILABLE,en="Stream refused by server";break;case er.constants.NGHTTP2_CANCEL:et=ei.Status.CANCELLED,en="Call cancelled";break;case er.constants.NGHTTP2_ENHANCE_YOUR_CALM:et=ei.Status.RESOURCE_EXHAUSTED,en="Bandwidth exhausted or memory limit exceeded";break;case er.constants.NGHTTP2_INADEQUATE_SECURITY:et=ei.Status.PERMISSION_DENIED,en="Protocol not secure enough";break;case er.constants.NGHTTP2_INTERNAL_ERROR:et=ei.Status.INTERNAL,null===this.internalError?en=`Received RST_STREAM with code ${$.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(et=ei.Status.UNAVAILABLE,en=this.internalError.message):en=`Received RST_STREAM with code ${$.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:et=ei.Status.INTERNAL,en=`Received RST_STREAM with code ${$.rstCode}`}this.endCall({code:et,details:en,metadata:new es.Metadata,rstCode:$.rstCode})})}),$.on("error",$=>{"ERR_HTTP2_STREAM_ERROR"!==$.code&&(this.trace("Node error event: message="+$.message+" code="+$.code+" errno="+getSystemErrorName($.errno)+" syscall="+$.syscall),this.internalError=$),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:ei.Status.UNAVAILABLE,details:"Connection dropped",metadata:new es.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace($){eu.trace(eh.LogVerbosity.DEBUG,ep,"["+this.callId+"] "+$)}endCall($){(null===this.finalStatus||this.finalStatus.code===ei.Status.OK)&&(this.finalStatus=$,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===ei.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push($){this.trace("pushing to reader message of length "+($ instanceof Buffer?$.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage($),this.maybeOutputStatus())})}tryPush($){this.canPush?(this.http2Stream.pause(),this.push($)):(this.trace("unpushedReadMessages.push message of length "+$.length),this.unpushedReadMessages.push($))}handleTrailers($){let ee;this.callEventTracker.onStreamEnd(!0);let et="";for(let ee of Object.keys($))et+="		"+ee+": "+$[ee]+"\n";this.trace("Received server trailers:\n"+et);try{ee=es.Metadata.fromHttp2Headers($)}catch($){ee=new es.Metadata}let er=ee.getMap(),en=this.mappedStatusCode;if(en===ei.Status.UNKNOWN&&"string"==typeof er["grpc-status"]){let $=Number(er["grpc-status"]);$ in ei.Status&&(en=$,this.trace("received status code "+$+" from server")),ee.remove("grpc-status")}let eo="";if("string"==typeof er["grpc-message"]){try{eo=decodeURI(er["grpc-message"])}catch($){eo=er["grpc-message"]}ee.remove("grpc-message"),this.trace('received status details string "'+eo+'" from server')}let eu={code:en,details:eo,metadata:ee};this.endCall(eu)}destroyHttp2Stream(){var $;if(!this.http2Stream.destroyed){let ee;ee=(null===($=this.finalStatus)||void 0===$?void 0:$.code)===ei.Status.OK?er.constants.NGHTTP2_NO_ERROR:er.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+ee),this.http2Stream.close(ee)}}cancelWithStatus($,ee){this.trace("cancelWithStatus code: "+$+' details: "'+ee+'"'),this.endCall({code:$,details:ee,metadata:new es.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==ei.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let $=this.unpushedReadMessages.shift();this.push($);return}this.http2Stream.resume()}sendMessageWithContext($,ee){this.trace("write() called with message of length "+ee.length);let cb=ee=>{process.nextTick(()=>{var et;let er=ei.Status.UNAVAILABLE;(null==ee?void 0:ee.code)==="ERR_STREAM_WRITE_AFTER_END"&&(er=ei.Status.INTERNAL),ee&&this.cancelWithStatus(er,`Write error: ${ee.message}`),null===(et=$.callback)||void 0===et||et.call($)})};this.trace("sending data chunk of length "+ee.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(ee,cb)}catch($){this.endCall({code:ei.Status.UNAVAILABLE,details:`Write failed with error ${$.message}`,metadata:new es.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};ee.Http2SubchannelCall=Http2SubchannelCall},69609:($,ee)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.BaseSubchannelWrapper=void 0;let BaseSubchannelWrapper=class BaseSubchannelWrapper{constructor($){this.child=$}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener($){this.child.addConnectivityStateListener($)}removeConnectivityStateListener($){this.child.removeConnectivityStateListener($)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive($){this.child.throttleKeepalive($)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals($){return this.getRealSubchannel()===$.getRealSubchannel()}};ee.BaseSubchannelWrapper=BaseSubchannelWrapper},88364:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.getSubchannelPool=ee.SubchannelPool=void 0;let er=et(70332),en=et(53904),ei=et(72782),es=et(14717),eo=et(16559),eu=1e4;let SubchannelPool=class SubchannelPool{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let $=!0;for(let ee in this.pool){let et=this.pool[ee],er=et.filter($=>!$.subchannel.unrefIfOneRef());er.length>0&&($=!1),this.pool[ee]=er}$&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var $,ee;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},eu),null===(ee=($=this.cleanupTimer).unref)||void 0===ee||ee.call($))}getOrCreateSubchannel($,ee,et,eu){this.ensureCleanupTask();let eh=(0,es.uriToString)($);if(eh in this.pool){let $=this.pool[eh];for(let en of $)if((0,ei.subchannelAddressEqual)(ee,en.subchannelAddress)&&(0,er.channelOptionsEqual)(et,en.channelArguments)&&eu._equals(en.channelCredentials))return en.subchannel}let ep=new en.Subchannel($,ee,et,eu,new eo.Http2SubchannelConnector($));return eh in this.pool||(this.pool[eh]=[]),this.pool[eh].push({subchannelAddress:ee,channelArguments:et,channelCredentials:eu,subchannel:ep}),ep.ref(),ep}};ee.SubchannelPool=SubchannelPool;let eh=new SubchannelPool;function getSubchannelPool($){return $?eh:new SubchannelPool}ee.getSubchannelPool=getSubchannelPool},53904:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.Subchannel=void 0;let er=et(91360),en=et(77257),ei=et(68200),es=et(69238),eo=et(14717),eu=et(72782),eh=et(83316),ep="subchannel",ef=2147483647;let Subchannel=class Subchannel{constructor($,ee,et,ei,es){var eo;this.channelTarget=$,this.subchannelAddress=ee,this.options=et,this.credentials=ei,this.connector=es,this.connectivityState=er.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new eh.ChannelzCallTracker,this.childrenTracker=new eh.ChannelzChildrenTracker,this.streamTracker=new eh.ChannelzCallTracker;let ep={initialDelay:et["grpc.initial_reconnect_backoff_ms"],maxDelay:et["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new en.BackoffTimeout(()=>{this.handleBackoffTimer()},ep),this.backoffTimeout.unref(),this.subchannelAddressString=(0,eu.subchannelAddressToString)(ee),this.keepaliveTime=null!==(eo=et["grpc.keepalive_time_ms"])&&void 0!==eo?eo:-1,0===et["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new eh.ChannelzTrace,this.channelzRef=(0,eh.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(et,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace($){ei.trace(es.LogVerbosity.DEBUG,ep,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+$)}refTrace($){ei.trace(es.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+$)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([er.ConnectivityState.TRANSIENT_FAILURE],er.ConnectivityState.CONNECTING):this.transitionToState([er.ConnectivityState.TRANSIENT_FAILURE],er.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let $=this.options;if($["grpc.keepalive_time_ms"]){let ee=Math.min(this.keepaliveTime,ef);$=Object.assign(Object.assign({},$),{"grpc.keepalive_time_ms":ee})}this.connector.connect(this.subchannelAddress,this.credentials,$).then($=>{this.transitionToState([er.ConnectivityState.CONNECTING],er.ConnectivityState.READY)&&(this.transport=$,this.channelzEnabled&&this.childrenTracker.refChild($.getChannelzRef()),$.addDisconnectListener($=>{this.transitionToState([er.ConnectivityState.READY],er.ConnectivityState.IDLE),$&&this.keepaliveTime>0&&(this.keepaliveTime*=2,ei.log(es.LogVerbosity.ERROR,`Connection to ${(0,eo.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))}))},$=>{this.transitionToState([er.ConnectivityState.CONNECTING],er.ConnectivityState.TRANSIENT_FAILURE)})}transitionToState($,ee){var et,en;if(-1===$.indexOf(this.connectivityState))return!1;this.trace(er.ConnectivityState[this.connectivityState]+" -> "+er.ConnectivityState[ee]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+er.ConnectivityState[ee]);let ei=this.connectivityState;switch(this.connectivityState=ee,ee){case er.ConnectivityState.READY:this.stopBackoff();break;case er.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case er.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null===(et=this.transport)||void 0===et||et.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case er.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null===(en=this.transport)||void 0===en||en.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${ee}`)}for(let $ of this.stateListeners)$(this,ei,ee,this.keepaliveTime);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,eh.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([er.ConnectivityState.CONNECTING,er.ConnectivityState.READY],er.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall($,ee,et,er){let en;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),en={onCallEnd:$=>{$.code===es.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):en={},this.transport.createCall($,ee,et,er,en)}startConnecting(){process.nextTick(()=>{this.transitionToState([er.ConnectivityState.IDLE],er.ConnectivityState.CONNECTING)||this.connectivityState!==er.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener($){this.stateListeners.add($)}removeConnectivityStateListener($){this.stateListeners.delete($)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([er.ConnectivityState.TRANSIENT_FAILURE],er.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals($){return $.getRealSubchannel()===this}throttleKeepalive($){$>this.keepaliveTime&&(this.keepaliveTime=$)}};ee.Subchannel=Subchannel},66801:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.getDefaultRootsData=ee.CIPHER_SUITES=void 0;let er=et(57147);ee.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let en=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,ei=null;function getDefaultRootsData(){return en?(null===ei&&(ei=er.readFileSync(en)),ei):null}ee.getDefaultRootsData=getDefaultRootsData},16559:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.Http2SubchannelConnector=void 0;let er=et(85158),en=et(24404),ei=et(83316),es=et(69238),eo=et(18304),eu=et(68200),eh=et(14755),ep=et(72782),ef=et(14717),em=et(41808),eg=et(32210),ey=et(60060),ev="transport",eS="transport_flowctrl",eC=et(81513).i8,{HTTP2_HEADER_AUTHORITY:eT,HTTP2_HEADER_CONTENT_TYPE:eE,HTTP2_HEADER_METHOD:ew,HTTP2_HEADER_PATH:eD,HTTP2_HEADER_TE:eI,HTTP2_HEADER_USER_AGENT:eR}=er.constants,e_=2e4,eP=Buffer.from("too_many_pings","ascii");let Http2Transport=class Http2Transport{constructor($,ee,et,en){this.session=$,this.remoteName=en,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=e_,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new ei.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,ep.subchannelAddressToString)(ee),0===et["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,ei.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[et["grpc.primary_user_agent"],`grpc-node-js/${eC}`,et["grpc.secondary_user_agent"]].filter($=>$).join(" "),"grpc.keepalive_time_ms"in et&&(this.keepaliveTimeMs=et["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in et&&(this.keepaliveTimeoutMs=et["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in et?this.keepaliveWithoutCalls=1===et["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,$.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),$.once("goaway",($,ee,et)=>{let en=!1;$===er.constants.NGHTTP2_ENHANCE_YOUR_CALM&&et.equals(eP)&&(en=!0),this.trace("connection closed by GOAWAY with code "+$),this.reportDisconnectToOwner(en)}),$.once("error",$=>{this.trace("connection closed with error "+$.message)}),eu.isTracerEnabled(ev)&&($.on("remoteSettings",ee=>{this.trace("new settings received"+(this.session!==$?" on the old connection":"")+": "+JSON.stringify(ee))}),$.on("localSettings",ee=>{this.trace("local settings acknowledged by remote"+(this.session!==$?" on the old connection":"")+": "+JSON.stringify(ee))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var $,ee,et;let er;let en=this.session.socket,ei=en.remoteAddress?(0,ep.stringToSubchannelAddress)(en.remoteAddress,en.remotePort):null,es=en.localAddress?(0,ep.stringToSubchannelAddress)(en.localAddress,en.localPort):null;if(this.session.encrypted){let ee=en,et=ee.getCipher(),ei=ee.getCertificate(),es=ee.getPeerCertificate();er={cipherSuiteStandardName:null!==($=et.standardName)&&void 0!==$?$:null,cipherSuiteOtherName:et.standardName?null:et.name,localCertificate:ei&&"raw"in ei?ei.raw:null,remoteCertificate:es&&"raw"in es?es.raw:null}}else er=null;let eo={remoteAddress:ei,localAddress:es,security:er,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!==(ee=this.session.state.localWindowSize)&&void 0!==ee?ee:null,remoteFlowControlWindow:null!==(et=this.session.state.remoteWindowSize)&&void 0!==et?et:null};return eo}trace($){eu.trace(es.LogVerbosity.DEBUG,ev,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+$)}keepaliveTrace($){eu.trace(es.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+$)}flowControlTrace($){eu.trace(es.LogVerbosity.DEBUG,eS,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+$)}internalsTrace($){eu.trace(es.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+$)}reportDisconnectToOwner($){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(ee=>ee($)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let $ of this.activeCalls)$.onDisconnect()})}addDisconnectListener($){this.disconnectListeners.push($)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var $,ee;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null===(ee=($=this.keepaliveTimeoutId).unref)||void 0===ee||ee.call($));try{this.session.ping(($,ee,et)=>{$&&(this.keepaliveTrace("Ping failed with error "+$.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch($){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var $,ee;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null===(ee=($=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)||void 0===ee?void 0:ee.call($)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall($){this.activeCalls.delete($),0===this.activeCalls.size&&this.session.unref()}addActiveCall($){this.activeCalls.add($),1!==this.activeCalls.size||(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall($,ee,et,er,en){let ei,es,eo;let eu=$.toHttp2Headers();eu[eT]=ee,eu[eR]=this.userAgent,eu[eE]="application/grpc",eu[ew]="POST",eu[eD]=et,eu[eI]="trailers";try{ei=this.session.request(eu)}catch($){throw this.handleDisconnect(),$}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),es={addMessageSent:()=>{var $;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null===($=en.addMessageSent)||void 0===$||$.call(en)},addMessageReceived:()=>{var $;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null===($=en.addMessageReceived)||void 0===$||$.call(en)},onCallEnd:$=>{var ee;null===(ee=en.onCallEnd)||void 0===ee||ee.call(en,$),this.removeActiveCall(eo)},onStreamEnd:$=>{var ee;$?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null===(ee=en.onStreamEnd)||void 0===ee||ee.call(en,$)}}):es={addMessageSent:()=>{var $;null===($=en.addMessageSent)||void 0===$||$.call(en)},addMessageReceived:()=>{var $;null===($=en.addMessageReceived)||void 0===$||$.call(en)},onCallEnd:$=>{var ee;null===(ee=en.onCallEnd)||void 0===ee||ee.call(en,$),this.removeActiveCall(eo)},onStreamEnd:$=>{var ee;null===(ee=en.onStreamEnd)||void 0===ee||ee.call(en,$)}},eo=new eg.Http2SubchannelCall(ei,es,er,this,(0,ey.getNextCallNumber)()),this.addActiveCall(eo),eo}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}shutdown(){this.session.close(),(0,ei.unregisterChannelzRef)(this.channelzRef)}};let Http2SubchannelConnector=class Http2SubchannelConnector{constructor($){this.channelTarget=$,this.session=null,this.isShutdown=!1}trace($){eu.trace(es.LogVerbosity.DEBUG,ev,(0,ef.uriToString)(this.channelTarget)+" "+$)}createSession($,ee,et,ei){return this.isShutdown?Promise.reject():new Promise((es,eo)=>{var eu,eg,ey;let ev;ei.realTarget?(ev=(0,ef.uriToString)(ei.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,ef.uriToString)(ei.realTarget))):(ev=null,this.trace("creating HTTP/2 session to "+(0,ep.subchannelAddressToString)($)));let eS=(0,eh.getDefaultAuthority)(null!==(eu=ei.realTarget)&&void 0!==eu?eu:this.channelTarget),eC=ee._getConnectionOptions()||{};eC.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in et?eC.maxSessionMemory=et["grpc-node.max_session_memory"]:eC.maxSessionMemory=Number.MAX_SAFE_INTEGER;let eT="http://";if("secureContext"in eC){if(eT="https://",et["grpc.ssl_target_name_override"]){let $=et["grpc.ssl_target_name_override"];eC.checkServerIdentity=(ee,et)=>(0,en.checkServerIdentity)($,et),eC.servername=$}else{let $=null!==(ey=null===(eg=(0,ef.splitHostPort)(eS))||void 0===eg?void 0:eg.host)&&void 0!==ey?ey:"localhost";eC.servername=$}ei.socket&&(eC.createConnection=($,ee)=>ei.socket)}else eC.createConnection=(ee,et)=>ei.socket?ei.socket:em.connect($);eC=Object.assign(Object.assign(Object.assign({},eC),$),{enableTrace:1===et["grpc-node.tls_enable_trace"]});let eE=er.connect(eT+eS,eC);this.session=eE,eE.unref(),eE.once("connect",()=>{eE.removeAllListeners(),es(new Http2Transport(eE,$,et,ev)),this.session=null}),eE.once("close",()=>{this.session=null,eo()}),eE.once("error",$=>{this.trace("connection failed with error "+$.message)})})}connect($,ee,et){var er,ei;if(this.isShutdown)return Promise.reject();let es=ee._getConnectionOptions()||{};if("secureContext"in es){if(es.ALPNProtocols=["h2"],et["grpc.ssl_target_name_override"]){let $=et["grpc.ssl_target_name_override"];es.checkServerIdentity=(ee,et)=>(0,en.checkServerIdentity)($,et),es.servername=$}else if("grpc.http_connect_target"in et){let $=(0,eh.getDefaultAuthority)(null!==(er=(0,ef.parseUri)(et["grpc.http_connect_target"]))&&void 0!==er?er:{path:"localhost"}),ee=(0,ef.splitHostPort)($);es.servername=null!==(ei=null==ee?void 0:ee.host)&&void 0!==ei?ei:$}et["grpc-node.tls_enable_trace"]&&(es.enableTrace=!0)}return(0,eo.getProxiedConnection)($,et,es).then(er=>this.createSession($,ee,et,er))}shutdown(){var $;this.isShutdown=!0,null===($=this.session)||void 0===$||$.close(),this.session=null}};ee.Http2SubchannelConnector=Http2SubchannelConnector},14717:($,ee)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),ee.uriToString=ee.splitHostPort=ee.parseUri=void 0;let et=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function parseUri($){let ee=et.exec($);return null===ee?null:{scheme:ee[1],authority:ee[2],path:ee[3]}}ee.parseUri=parseUri;let er=/^\d+$/;function splitHostPort($){if($.startsWith("[")){let ee=$.indexOf("]");if(-1===ee)return null;let et=$.substring(1,ee);if(-1===et.indexOf(":"))return null;if(!($.length>ee+1))return{host:et};if(":"!==$[ee+1])return null;{let en=$.substring(ee+2);return er.test(en)?{host:et,port:+en}:null}}{let ee=$.split(":");return 2!==ee.length?{host:$}:er.test(ee[1])?{host:ee[0],port:+ee[1]}:null}}function uriToString($){let ee="";return void 0!==$.scheme&&(ee+=$.scheme+":"),void 0!==$.authority&&(ee+="//"+$.authority+"/"),ee+=$.path}ee.splitHostPort=splitHostPort,ee.uriToString=uriToString},18196:($,ee,et)=>{"use strict";var er;/**
 * @license
 * Copyright 2018 gRPC authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */er={value:!0},er=er=ee.im=ee.J_=er=er=er=void 0;let en=et(19977),ei=et(75962),es=et(95307),eo=et(9234),eu=et(16933);er=eu,er=function($){return"@type"in $&&"string"==typeof $["@type"]};let eh={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function joinName($,ee){return""===$?ee:$+"."+ee}function isHandledReflectionObject($){return $ instanceof ei.Service||$ instanceof ei.Type||$ instanceof ei.Enum}function isNamespaceBase($){return $ instanceof ei.Namespace||$ instanceof ei.Root}function getAllHandledReflectionObjects($,ee){let et=joinName(ee,$.name);return isHandledReflectionObject($)?[[et,$]]:isNamespaceBase($)&&void 0!==$.nested?Object.keys($.nested).map(ee=>getAllHandledReflectionObjects($.nested[ee],et)).reduce(($,ee)=>$.concat(ee),[]):[]}function createDeserializer($,ee){return function(et){return $.toObject($.decode(et),ee)}}function createSerializer($){return function(ee){if(Array.isArray(ee))throw Error(`Failed to serialize message: expected object with ${$.name} structure, got array instead`);let et=$.fromObject(ee);return $.encode(et).finish()}}function createMethodDefinition($,ee,et,er){let ei=$.resolvedRequestType,es=$.resolvedResponseType;return{path:"/"+ee+"/"+$.name,requestStream:!!$.requestStream,responseStream:!!$.responseStream,requestSerialize:createSerializer(ei),requestDeserialize:createDeserializer(ei,et),responseSerialize:createSerializer(es),responseDeserialize:createDeserializer(es,et),originalName:en($.name),requestType:createMessageDefinition(ei,er),responseType:createMessageDefinition(es,er)}}function createServiceDefinition($,ee,et,er){let en={};for(let ei of $.methodsArray)en[ei.name]=createMethodDefinition(ei,ee,et,er);return en}function createMessageDefinition($,ee){let et=$.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:et.$type.toObject(et,eh),fileDescriptorProtos:ee}}function createEnumDefinition($,ee){let et=$.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:et.$type.toObject(et,eh),fileDescriptorProtos:ee}}function createDefinition($,ee,et,er){if($ instanceof ei.Service)return createServiceDefinition($,ee,et,er);if($ instanceof ei.Type)return createMessageDefinition($,er);if($ instanceof ei.Enum)return createEnumDefinition($,er);throw Error("Type mismatch in reflection object handling")}function createPackageDefinition($,ee){let et={};$.resolveAll();let er=$.toDescriptor("proto3").file,en=er.map($=>Buffer.from(es.FileDescriptorProto.encode($).finish()));for(let[er,ei]of getAllHandledReflectionObjects($,""))et[er]=createDefinition(ei,er,ee,en);return et}function createPackageDefinitionFromDescriptorSet($,ee){ee=ee||{};let et=ei.Root.fromDescriptor($);return et.resolveAll(),createPackageDefinition(et,ee)}function loadSync($,ee){let et=(0,eo.loadProtosWithOptionsSync)($,ee);return createPackageDefinition(et,ee)}function fromJSON($,ee){ee=ee||{};let et=ei.Root.fromJSON($);return et.resolveAll(),createPackageDefinition(et,ee)}er=function($,ee){return(0,eo.loadProtosWithOptions)($,ee).then($=>createPackageDefinition($,ee))},ee.J_=loadSync,ee.im=fromJSON,er=function($,ee){let et=es.FileDescriptorSet.decode($);return createPackageDefinitionFromDescriptorSet(et,ee)},er=function($,ee){let et=es.FileDescriptorSet.fromObject($);return createPackageDefinitionFromDescriptorSet(et,ee)},(0,eo.addCommonProtos)()},9234:($,ee,et)=>{"use strict";/**
 * @license
 * Copyright 2018 gRPC authors.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */Object.defineProperty(ee,"__esModule",{value:!0}),ee.addCommonProtos=ee.loadProtosWithOptionsSync=ee.loadProtosWithOptions=void 0;let er=et(57147),en=et(71017),ei=et(75962);function addIncludePathResolver($,ee){let et=$.resolvePath;$.resolvePath=($,ei)=>{if(en.isAbsolute(ei))return ei;for(let $ of ee){let ee=en.join($,ei);try{return er.accessSync(ee,er.constants.R_OK),ee}catch($){continue}}return process.emitWarning(`${ei} not found in any of the include paths ${ee}`),et($,ei)}}async function loadProtosWithOptions($,ee){let et=new ei.Root;if((ee=ee||{}).includeDirs){if(!Array.isArray(ee.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));addIncludePathResolver(et,ee.includeDirs)}let er=await et.load($,ee);return er.resolveAll(),er}function loadProtosWithOptionsSync($,ee){let et=new ei.Root;if((ee=ee||{}).includeDirs){if(!Array.isArray(ee.includeDirs))throw Error("The includeDirs option must be an array");addIncludePathResolver(et,ee.includeDirs)}let er=et.loadSync($,ee);return er.resolveAll(),er}function addCommonProtos(){let $=et(56541),ee=et(89987),er=et(57674),en=et(73795);ei.common("api",$.nested.google.nested.protobuf.nested),ei.common("descriptor",ee.nested.google.nested.protobuf.nested),ei.common("source_context",er.nested.google.nested.protobuf.nested),ei.common("type",en.nested.google.nested.protobuf.nested)}ee.loadProtosWithOptions=loadProtosWithOptions,ee.loadProtosWithOptionsSync=loadProtosWithOptionsSync,ee.addCommonProtos=addCommonProtos},18670:$=>{"use strict";function asPromise($,ee){for(var et=Array(arguments.length-1),er=0,en=2,ei=!0;en<arguments.length;)et[er++]=arguments[en++];return new Promise(function(en,es){et[er]=function($){if(ei){if(ei=!1,$)es($);else{for(var ee=Array(arguments.length-1),et=0;et<ee.length;)ee[et++]=arguments[et];en.apply(null,ee)}}};try{$.apply(ee||null,et)}catch($){ei&&(ei=!1,es($))}})}$.exports=asPromise},36009:($,ee)=>{"use strict";var et=ee;et.length=function($){var ee=$.length;if(!ee)return 0;for(var et=0;--ee%4>1&&"="===$.charAt(ee);)++et;return Math.ceil(3*$.length)/4-et};for(var er=Array(64),en=Array(123),ei=0;ei<64;)en[er[ei]=ei<26?ei+65:ei<52?ei+71:ei<62?ei-4:ei-59|43]=ei++;et.encode=function($,ee,et){for(var en,ei=null,es=[],eo=0,eu=0;ee<et;){var eh=$[ee++];switch(eu){case 0:es[eo++]=er[eh>>2],en=(3&eh)<<4,eu=1;break;case 1:es[eo++]=er[en|eh>>4],en=(15&eh)<<2,eu=2;break;case 2:es[eo++]=er[en|eh>>6],es[eo++]=er[63&eh],eu=0}eo>8191&&((ei||(ei=[])).push(String.fromCharCode.apply(String,es)),eo=0)}return(eu&&(es[eo++]=er[en],es[eo++]=61,1===eu&&(es[eo++]=61)),ei)?(eo&&ei.push(String.fromCharCode.apply(String,es.slice(0,eo))),ei.join("")):String.fromCharCode.apply(String,es.slice(0,eo))};var es="invalid encoding";et.decode=function($,ee,et){for(var er,ei=et,eo=0,eu=0;eu<$.length;){var eh=$.charCodeAt(eu++);if(61===eh&&eo>1)break;if(void 0===(eh=en[eh]))throw Error(es);switch(eo){case 0:er=eh,eo=1;break;case 1:ee[et++]=er<<2|(48&eh)>>4,er=eh,eo=2;break;case 2:ee[et++]=(15&er)<<4|(60&eh)>>2,er=eh,eo=3;break;case 3:ee[et++]=(3&er)<<6|eh,eo=0}}if(1===eo)throw Error(es);return et-ei},et.test=function($){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test($)}},57311:$=>{"use strict";function codegen($,ee){"string"==typeof $&&(ee=$,$=void 0);var et=[];function Codegen($){if("string"!=typeof $){var ee=toString();if(codegen.verbose&&console.log("codegen: "+ee),ee="return "+ee,$){for(var er=Object.keys($),en=Array(er.length+1),ei=Array(er.length),es=0;es<er.length;)en[es]=er[es],ei[es]=$[er[es++]];return en[es]=ee,Function.apply(null,en).apply(null,ei)}return Function(ee)()}for(var eo=Array(arguments.length-1),eu=0;eu<eo.length;)eo[eu]=arguments[++eu];if(eu=0,$=$.replace(/%([%dfijs])/g,function($,ee){var et=eo[eu++];switch(ee){case"d":case"f":return String(Number(et));case"i":return String(Math.floor(et));case"j":return JSON.stringify(et);case"s":return String(et)}return"%"}),eu!==eo.length)throw Error("parameter count mismatch");return et.push($),Codegen}function toString(er){return"function "+(er||ee||"")+"("+($&&$.join(",")||"")+"){\n  "+et.join("\n  ")+"\n}"}return Codegen.toString=toString,Codegen}$.exports=codegen,codegen.verbose=!1},50107:$=>{"use strict";function EventEmitter(){this._listeners={}}$.exports=EventEmitter,EventEmitter.prototype.on=function($,ee,et){return(this._listeners[$]||(this._listeners[$]=[])).push({fn:ee,ctx:et||this}),this},EventEmitter.prototype.off=function($,ee){if(void 0===$)this._listeners={};else if(void 0===ee)this._listeners[$]=[];else for(var et=this._listeners[$],er=0;er<et.length;)et[er].fn===ee?et.splice(er,1):++er;return this},EventEmitter.prototype.emit=function($){var ee=this._listeners[$];if(ee){for(var et=[],er=1;er<arguments.length;)et.push(arguments[er++]);for(er=0;er<ee.length;)ee[er].fn.apply(ee[er++].ctx,et)}return this}},82651:($,ee,et)=>{"use strict";$.exports=fetch;var er=et(18670),en=et(28031)("fs");function fetch($,ee,et){return("function"==typeof ee?(et=ee,ee={}):ee||(ee={}),et)?!ee.xhr&&en&&en.readFile?en.readFile($,function(er,en){return er&&"undefined"!=typeof XMLHttpRequest?fetch.xhr($,ee,et):er?et(er):et(null,ee.binary?en:en.toString("utf8"))}):fetch.xhr($,ee,et):er(fetch,this,$,ee)}fetch.xhr=function($,ee,et){var er=new XMLHttpRequest;er.onreadystatechange=function(){if(4===er.readyState){if(0!==er.status&&200!==er.status)return et(Error("status "+er.status));if(ee.binary){var $=er.response;if(!$){$=[];for(var en=0;en<er.responseText.length;++en)$.push(255&er.responseText.charCodeAt(en))}return et(null,"undefined"!=typeof Uint8Array?new Uint8Array($):$)}return et(null,er.responseText)}},ee.binary&&("overrideMimeType"in er&&er.overrideMimeType("text/plain; charset=x-user-defined"),er.responseType="arraybuffer"),er.open("GET",$),er.send()}},71188:$=>{"use strict";function factory($){return"undefined"!=typeof Float32Array?function(){var ee=new Float32Array([-0]),et=new Uint8Array(ee.buffer),er=128===et[3];function writeFloat_f32_cpy($,er,en){ee[0]=$,er[en]=et[0],er[en+1]=et[1],er[en+2]=et[2],er[en+3]=et[3]}function writeFloat_f32_rev($,er,en){ee[0]=$,er[en]=et[3],er[en+1]=et[2],er[en+2]=et[1],er[en+3]=et[0]}function readFloat_f32_cpy($,er){return et[0]=$[er],et[1]=$[er+1],et[2]=$[er+2],et[3]=$[er+3],ee[0]}function readFloat_f32_rev($,er){return et[3]=$[er],et[2]=$[er+1],et[1]=$[er+2],et[0]=$[er+3],ee[0]}$.writeFloatLE=er?writeFloat_f32_cpy:writeFloat_f32_rev,$.writeFloatBE=er?writeFloat_f32_rev:writeFloat_f32_cpy,$.readFloatLE=er?readFloat_f32_cpy:readFloat_f32_rev,$.readFloatBE=er?readFloat_f32_rev:readFloat_f32_cpy}():function(){function writeFloat_ieee754($,ee,et,er){var en=ee<0?1:0;if(en&&(ee=-ee),0===ee)$(1/ee>0?0:2147483648,et,er);else if(isNaN(ee))$(2143289344,et,er);else if(ee>34028234663852886e22)$((en<<31|2139095040)>>>0,et,er);else if(ee<11754943508222875e-54)$((en<<31|Math.round(ee/1401298464324817e-60))>>>0,et,er);else{var ei=Math.floor(Math.log(ee)/Math.LN2),es=8388607&Math.round(ee*Math.pow(2,-ei)*8388608);$((en<<31|ei+127<<23|es)>>>0,et,er)}}function readFloat_ieee754($,ee,et){var er=$(ee,et),en=(er>>31)*2+1,ei=er>>>23&255,es=8388607&er;return 255===ei?es?NaN:en*(1/0):0===ei?1401298464324817e-60*en*es:en*Math.pow(2,ei-150)*(es+8388608)}$.writeFloatLE=writeFloat_ieee754.bind(null,writeUintLE),$.writeFloatBE=writeFloat_ieee754.bind(null,writeUintBE),$.readFloatLE=readFloat_ieee754.bind(null,readUintLE),$.readFloatBE=readFloat_ieee754.bind(null,readUintBE)}(),"undefined"!=typeof Float64Array?function(){var ee=new Float64Array([-0]),et=new Uint8Array(ee.buffer),er=128===et[7];function writeDouble_f64_cpy($,er,en){ee[0]=$,er[en]=et[0],er[en+1]=et[1],er[en+2]=et[2],er[en+3]=et[3],er[en+4]=et[4],er[en+5]=et[5],er[en+6]=et[6],er[en+7]=et[7]}function writeDouble_f64_rev($,er,en){ee[0]=$,er[en]=et[7],er[en+1]=et[6],er[en+2]=et[5],er[en+3]=et[4],er[en+4]=et[3],er[en+5]=et[2],er[en+6]=et[1],er[en+7]=et[0]}function readDouble_f64_cpy($,er){return et[0]=$[er],et[1]=$[er+1],et[2]=$[er+2],et[3]=$[er+3],et[4]=$[er+4],et[5]=$[er+5],et[6]=$[er+6],et[7]=$[er+7],ee[0]}function readDouble_f64_rev($,er){return et[7]=$[er],et[6]=$[er+1],et[5]=$[er+2],et[4]=$[er+3],et[3]=$[er+4],et[2]=$[er+5],et[1]=$[er+6],et[0]=$[er+7],ee[0]}$.writeDoubleLE=er?writeDouble_f64_cpy:writeDouble_f64_rev,$.writeDoubleBE=er?writeDouble_f64_rev:writeDouble_f64_cpy,$.readDoubleLE=er?readDouble_f64_cpy:readDouble_f64_rev,$.readDoubleBE=er?readDouble_f64_rev:readDouble_f64_cpy}():function(){function writeDouble_ieee754($,ee,et,er,en,ei){var es,eo=er<0?1:0;if(eo&&(er=-er),0===er)$(0,en,ei+ee),$(1/er>0?0:2147483648,en,ei+et);else if(isNaN(er))$(0,en,ei+ee),$(2146959360,en,ei+et);else if(er>17976931348623157e292)$(0,en,ei+ee),$((eo<<31|2146435072)>>>0,en,ei+et);else if(er<22250738585072014e-324)$((es=er/5e-324)>>>0,en,ei+ee),$((eo<<31|es/4294967296)>>>0,en,ei+et);else{var eu=Math.floor(Math.log(er)/Math.LN2);1024===eu&&(eu=1023),$(4503599627370496*(es=er*Math.pow(2,-eu))>>>0,en,ei+ee),$((eo<<31|eu+1023<<20|1048576*es&1048575)>>>0,en,ei+et)}}function readDouble_ieee754($,ee,et,er,en){var ei=$(er,en+ee),es=$(er,en+et),eo=(es>>31)*2+1,eu=es>>>20&2047,eh=4294967296*(1048575&es)+ei;return 2047===eu?eh?NaN:eo*(1/0):0===eu?5e-324*eo*eh:eo*Math.pow(2,eu-1075)*(eh+4503599627370496)}$.writeDoubleLE=writeDouble_ieee754.bind(null,writeUintLE,0,4),$.writeDoubleBE=writeDouble_ieee754.bind(null,writeUintBE,4,0),$.readDoubleLE=readDouble_ieee754.bind(null,readUintLE,0,4),$.readDoubleBE=readDouble_ieee754.bind(null,readUintBE,4,0)}(),$}function writeUintLE($,ee,et){ee[et]=255&$,ee[et+1]=$>>>8&255,ee[et+2]=$>>>16&255,ee[et+3]=$>>>24}function writeUintBE($,ee,et){ee[et]=$>>>24,ee[et+1]=$>>>16&255,ee[et+2]=$>>>8&255,ee[et+3]=255&$}function readUintLE($,ee){return($[ee]|$[ee+1]<<8|$[ee+2]<<16|$[ee+3]<<24)>>>0}function readUintBE($,ee){return($[ee]<<24|$[ee+1]<<16|$[ee+2]<<8|$[ee+3])>>>0}$.exports=factory(factory)},28031:module=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},52768:($,ee)=>{"use strict";var et=ee,er=et.isAbsolute=function($){return/^(?:\/|\w+:)/.test($)},en=et.normalize=function($){var ee=($=$.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),et=er($),en="";et&&(en=ee.shift()+"/");for(var ei=0;ei<ee.length;)".."===ee[ei]?ei>0&&".."!==ee[ei-1]?ee.splice(--ei,2):et?ee.splice(ei,1):++ei:"."===ee[ei]?ee.splice(ei,1):++ei;return en+ee.join("/")};et.resolve=function($,ee,et){return(et||(ee=en(ee)),er(ee))?ee:(et||($=en($)),($=$.replace(/(?:\/|^)[^/]+$/,"")).length?en($+"/"+ee):ee)}},14314:$=>{"use strict";function pool($,ee,et){var er=et||8192,en=er>>>1,ei=null,es=er;return function(et){if(et<1||et>en)return $(et);es+et>er&&(ei=$(er),es=0);var eo=ee.call(ei,es,es+=et);return 7&es&&(es=(7|es)+1),eo}}$.exports=pool},67148:($,ee)=>{"use strict";var et=ee;et.length=function($){for(var ee=0,et=0,er=0;er<$.length;++er)(et=$.charCodeAt(er))<128?ee+=1:et<2048?ee+=2:(64512&et)==55296&&(64512&$.charCodeAt(er+1))==56320?(++er,ee+=4):ee+=3;return ee},et.read=function($,ee,et){if(et-ee<1)return"";for(var er,en=null,ei=[],es=0;ee<et;)(er=$[ee++])<128?ei[es++]=er:er>191&&er<224?ei[es++]=(31&er)<<6|63&$[ee++]:er>239&&er<365?(er=((7&er)<<18|(63&$[ee++])<<12|(63&$[ee++])<<6|63&$[ee++])-65536,ei[es++]=55296+(er>>10),ei[es++]=56320+(1023&er)):ei[es++]=(15&er)<<12|(63&$[ee++])<<6|63&$[ee++],es>8191&&((en||(en=[])).push(String.fromCharCode.apply(String,ei)),es=0);return en?(es&&en.push(String.fromCharCode.apply(String,ei.slice(0,es))),en.join("")):String.fromCharCode.apply(String,ei.slice(0,es))},et.write=function($,ee,et){for(var er,en,ei=et,es=0;es<$.length;++es)(er=$.charCodeAt(es))<128?ee[et++]=er:(er<2048?ee[et++]=er>>6|192:((64512&er)==55296&&(64512&(en=$.charCodeAt(es+1)))==56320?(er=65536+((1023&er)<<10)+(1023&en),++es,ee[et++]=er>>18|240,ee[et++]=er>>12&63|128):ee[et++]=er>>12|224,ee[et++]=er>>6&63|128),ee[et++]=63&er|128);return et-ei}},19977:$=>{var ee=1/0,et="[object Symbol]",er=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,en=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ei="\ud800-\udfff",es="\\u0300-\\u036f\\ufe20-\\ufe23",eo="\\u20d0-\\u20f0",eu="\\u2700-\\u27bf",eh="a-z\\xdf-\\xf6\\xf8-\\xff",ep="A-Z\\xc0-\\xd6\\xd8-\\xde",ef="\\ufe0e\\ufe0f",em="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",eg="[']",ey="["+ei+"]",ev="["+em+"]",eS="["+es+eo+"]",eC="\\d+",eT="["+eu+"]",eE="["+eh+"]",ew="[^"+ei+em+eC+eu+eh+ep+"]",eD="\ud83c[\udffb-\udfff]",eI="[^"+ei+"]",eR="(?:\ud83c[\udde6-\uddff]){2}",e_="[\ud800-\udbff][\udc00-\udfff]",eP="["+ep+"]",eA="\\u200d",ex="(?:"+eE+"|"+ew+")",eO="(?:"+eP+"|"+ew+")",ek="(?:"+eg+"(?:d|ll|m|re|s|t|ve))?",eN="(?:"+eg+"(?:D|LL|M|RE|S|T|VE))?",eM="(?:"+eS+"|"+eD+")?",eF="["+ef+"]?",eL="(?:"+eA+"(?:"+[eI,eR,e_].join("|")+")"+eF+eM+")*",eB=eF+eM+eL,eV="(?:"+[eT,eR,e_].join("|")+")"+eB,ej="(?:"+[eI+eS+"?",eS,eR,e_,ey].join("|")+")",eU=RegExp(eg,"g"),eq=RegExp(eS,"g"),ez=RegExp(eD+"(?="+eD+")|"+ej+eB,"g"),eK=RegExp([eP+"?"+eE+"+"+ek+"(?="+[ev,eP,"$"].join("|")+")",eO+"+"+eN+"(?="+[ev,eP+ex,"$"].join("|")+")",eP+"?"+ex+"+"+ek,eP+"+"+eN,eC,eV].join("|"),"g"),eW=RegExp("["+eA+ei+es+eo+ef+"]"),eG=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,e$={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"ss"},eH="object"==typeof global&&global&&global.Object===Object&&global,eQ="object"==typeof self&&self&&self.Object===Object&&self,eY=eH||eQ||Function("return this")();function arrayReduce($,ee,et,er){var en=-1,ei=$?$.length:0;for(er&&ei&&(et=$[++en]);++en<ei;)et=ee(et,$[en],en,$);return et}function asciiToArray($){return $.split("")}function asciiWords($){return $.match(er)||[]}var eJ=function($){return function(ee){return null==$?void 0:$[ee]}}(e$);function hasUnicode($){return eW.test($)}function hasUnicodeWord($){return eG.test($)}function stringToArray($){return hasUnicode($)?unicodeToArray($):asciiToArray($)}function unicodeToArray($){return $.match(ez)||[]}function unicodeWords($){return $.match(eK)||[]}var eX=Object.prototype.toString,eZ=eY.Symbol,e0=eZ?eZ.prototype:void 0,e1=e0?e0.toString:void 0;function baseSlice($,ee,et){var er=-1,en=$.length;ee<0&&(ee=-ee>en?0:en+ee),(et=et>en?en:et)<0&&(et+=en),en=ee>et?0:et-ee>>>0,ee>>>=0;for(var ei=Array(en);++er<en;)ei[er]=$[er+ee];return ei}function baseToString($){if("string"==typeof $)return $;if(isSymbol($))return e1?e1.call($):"";var et=$+"";return"0"==et&&1/$==-ee?"-0":et}function castSlice($,ee,et){var er=$.length;return et=void 0===et?er:et,!ee&&et>=er?$:baseSlice($,ee,et)}function createCaseFirst($){return function(ee){var et=hasUnicode(ee=toString(ee))?stringToArray(ee):void 0,er=et?et[0]:ee.charAt(0),en=et?castSlice(et,1).join(""):ee.slice(1);return er[$]()+en}}function isObjectLike($){return!!$&&"object"==typeof $}function isSymbol($){return"symbol"==typeof $||isObjectLike($)&&eX.call($)==et}function toString($){return null==$?"":baseToString($)}var e2=function($){return function(ee){return arrayReduce(words(deburr(ee).replace(eU,"")),$,"")}}(function($,ee,et){return ee=ee.toLowerCase(),$+(et?capitalize(ee):ee)});function capitalize($){return e3(toString($).toLowerCase())}function deburr($){return($=toString($))&&$.replace(en,eJ).replace(eq,"")}var e3=createCaseFirst("toUpperCase");function words($,ee,et){return($=toString($),void 0===(ee=et?void 0:ee))?hasUnicodeWord($)?unicodeWords($):asciiWords($):$.match(ee)||[]}$.exports=e2},83093:($,ee)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),function($,ee){for(var et in ee)Object.defineProperty($,et,{enumerable:!0,get:ee[et]})}(ee,{RSC:function(){return et},ACTION:function(){return er},NEXT_ROUTER_STATE_TREE:function(){return en},NEXT_ROUTER_PREFETCH:function(){return ei},NEXT_URL:function(){return es},RSC_CONTENT_TYPE_HEADER:function(){return eo},RSC_VARY_HEADER:function(){return eu},FLIGHT_PARAMETERS:function(){return eh},NEXT_RSC_UNION_QUERY:function(){return ep}});let et="RSC",er="Next-Action",en="Next-Router-State-Tree",ei="Next-Router-Prefetch",es="Next-Url",eo="text/x-component",eu=et+", "+en+", "+ei+", "+es,eh=[[et],[en],[ei]],ep="_rsc";("function"==typeof ee.default||"object"==typeof ee.default&&null!==ee.default)&&void 0===ee.default.__esModule&&(Object.defineProperty(ee.default,"__esModule",{value:!0}),Object.assign(ee.default,ee),$.exports=ee.default)},78582:$=>{"use strict";(()=>{"undefined"!=typeof __nccwpck_require__&&(__nccwpck_require__.ab=__dirname+"/");var ee={};(()=>{var $=ee;/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */$.parse=parse,$.serialize=serialize;var et=decodeURIComponent,er=encodeURIComponent,en=/; */,ei=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function parse($,ee){if("string"!=typeof $)throw TypeError("argument str must be a string");for(var er={},ei=ee||{},es=$.split(en),eo=ei.decode||et,eu=0;eu<es.length;eu++){var eh=es[eu],ep=eh.indexOf("=");if(!(ep<0)){var ef=eh.substr(0,ep).trim(),em=eh.substr(++ep,eh.length).trim();'"'==em[0]&&(em=em.slice(1,-1)),void 0==er[ef]&&(er[ef]=tryDecode(em,eo))}}return er}function serialize($,ee,et){var en=et||{},es=en.encode||er;if("function"!=typeof es)throw TypeError("option encode is invalid");if(!ei.test($))throw TypeError("argument name is invalid");var eo=es(ee);if(eo&&!ei.test(eo))throw TypeError("argument val is invalid");var eu=$+"="+eo;if(null!=en.maxAge){var eh=en.maxAge-0;if(isNaN(eh)||!isFinite(eh))throw TypeError("option maxAge is invalid");eu+="; Max-Age="+Math.floor(eh)}if(en.domain){if(!ei.test(en.domain))throw TypeError("option domain is invalid");eu+="; Domain="+en.domain}if(en.path){if(!ei.test(en.path))throw TypeError("option path is invalid");eu+="; Path="+en.path}if(en.expires){if("function"!=typeof en.expires.toUTCString)throw TypeError("option expires is invalid");eu+="; Expires="+en.expires.toUTCString()}if(en.httpOnly&&(eu+="; HttpOnly"),en.secure&&(eu+="; Secure"),en.sameSite)switch("string"==typeof en.sameSite?en.sameSite.toLowerCase():en.sameSite){case!0:case"strict":eu+="; SameSite=Strict";break;case"lax":eu+="; SameSite=Lax";break;case"none":eu+="; SameSite=None";break;default:throw TypeError("option sameSite is invalid")}return eu}function tryDecode($,ee){try{return ee($)}catch(ee){return $}}})(),$.exports=ee})()},62982:($,ee)=>{"use strict";function lexer($){for(var ee=[],et=0;et<$.length;){var er=$[et];if("*"===er||"+"===er||"?"===er){ee.push({type:"MODIFIER",index:et,value:$[et++]});continue}if("\\"===er){ee.push({type:"ESCAPED_CHAR",index:et++,value:$[et++]});continue}if("{"===er){ee.push({type:"OPEN",index:et,value:$[et++]});continue}if("}"===er){ee.push({type:"CLOSE",index:et,value:$[et++]});continue}if(":"===er){for(var en="",ei=et+1;ei<$.length;){var es=$.charCodeAt(ei);if(es>=48&&es<=57||es>=65&&es<=90||es>=97&&es<=122||95===es){en+=$[ei++];continue}break}if(!en)throw TypeError("Missing parameter name at "+et);ee.push({type:"NAME",index:et,value:en}),et=ei;continue}if("("===er){var eo=1,eu="",ei=et+1;if("?"===$[ei])throw TypeError('Pattern cannot start with "?" at '+ei);for(;ei<$.length;){if("\\"===$[ei]){eu+=$[ei++]+$[ei++];continue}if(")"===$[ei]){if(0==--eo){ei++;break}}else if("("===$[ei]&&(eo++,"?"!==$[ei+1]))throw TypeError("Capturing groups are not allowed at "+ei);eu+=$[ei++]}if(eo)throw TypeError("Unbalanced pattern at "+et);if(!eu)throw TypeError("Missing pattern at "+et);ee.push({type:"PATTERN",index:et,value:eu}),et=ei;continue}ee.push({type:"CHAR",index:et,value:$[et++]})}return ee.push({type:"END",index:et,value:""}),ee}function parse($,ee){void 0===ee&&(ee={});for(var et=lexer($),er=ee.prefixes,en=void 0===er?"./":er,ei="[^"+escapeString(ee.delimiter||"/#?")+"]+?",es=[],eo=0,eu=0,eh="",tryConsume=function($){if(eu<et.length&&et[eu].type===$)return et[eu++].value},mustConsume=function($){var ee=tryConsume($);if(void 0!==ee)return ee;var er=et[eu];throw TypeError("Unexpected "+er.type+" at "+er.index+", expected "+$)},consumeText=function(){for(var $,ee="";$=tryConsume("CHAR")||tryConsume("ESCAPED_CHAR");)ee+=$;return ee};eu<et.length;){var ep=tryConsume("CHAR"),ef=tryConsume("NAME"),em=tryConsume("PATTERN");if(ef||em){var eg=ep||"";-1===en.indexOf(eg)&&(eh+=eg,eg=""),eh&&(es.push(eh),eh=""),es.push({name:ef||eo++,prefix:eg,suffix:"",pattern:em||ei,modifier:tryConsume("MODIFIER")||""});continue}var ey=ep||tryConsume("ESCAPED_CHAR");if(ey){eh+=ey;continue}if(eh&&(es.push(eh),eh=""),tryConsume("OPEN")){var eg=consumeText(),ev=tryConsume("NAME")||"",eS=tryConsume("PATTERN")||"",eC=consumeText();mustConsume("CLOSE"),es.push({name:ev||(eS?eo++:""),pattern:ev&&!eS?ei:eS,prefix:eg,suffix:eC,modifier:tryConsume("MODIFIER")||""});continue}mustConsume("END")}return es}function compile($,ee){return tokensToFunction(parse($,ee),ee)}function tokensToFunction($,ee){void 0===ee&&(ee={});var et=flags(ee),er=ee.encode,en=void 0===er?function($){return $}:er,ei=ee.validate,es=void 0===ei||ei,eo=$.map(function($){if("object"==typeof $)return RegExp("^(?:"+$.pattern+")$",et)});return function(ee){for(var et="",er=0;er<$.length;er++){var ei=$[er];if("string"==typeof ei){et+=ei;continue}var eu=ee?ee[ei.name]:void 0,eh="?"===ei.modifier||"*"===ei.modifier,ep="*"===ei.modifier||"+"===ei.modifier;if(Array.isArray(eu)){if(!ep)throw TypeError('Expected "'+ei.name+'" to not repeat, but got an array');if(0===eu.length){if(eh)continue;throw TypeError('Expected "'+ei.name+'" to not be empty')}for(var ef=0;ef<eu.length;ef++){var em=en(eu[ef],ei);if(es&&!eo[er].test(em))throw TypeError('Expected all "'+ei.name+'" to match "'+ei.pattern+'", but got "'+em+'"');et+=ei.prefix+em+ei.suffix}continue}if("string"==typeof eu||"number"==typeof eu){var em=en(String(eu),ei);if(es&&!eo[er].test(em))throw TypeError('Expected "'+ei.name+'" to match "'+ei.pattern+'", but got "'+em+'"');et+=ei.prefix+em+ei.suffix;continue}if(!eh){var eg=ep?"an array":"a string";throw TypeError('Expected "'+ei.name+'" to be '+eg)}}return et}}function match($,ee){var et=[];return regexpToFunction(pathToRegexp($,et,ee),et,ee)}function regexpToFunction($,ee,et){void 0===et&&(et={});var er=et.decode,en=void 0===er?function($){return $}:er;return function(et){var er=$.exec(et);if(!er)return!1;for(var ei=er[0],es=er.index,eo=Object.create(null),_loop_1=function($){if(void 0===er[$])return"continue";var et=ee[$-1];"*"===et.modifier||"+"===et.modifier?eo[et.name]=er[$].split(et.prefix+et.suffix).map(function($){return en($,et)}):eo[et.name]=en(er[$],et)},eu=1;eu<er.length;eu++)_loop_1(eu);return{path:ei,index:es,params:eo}}}function escapeString($){return $.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function flags($){return $&&$.sensitive?"":"i"}function regexpToRegexp($,ee){if(!ee)return $;var et=$.source.match(/\((?!\?)/g);if(et)for(var er=0;er<et.length;er++)ee.push({name:er,prefix:"",suffix:"",modifier:"",pattern:""});return $}function arrayToRegexp($,ee,et){return RegExp("(?:"+$.map(function($){return pathToRegexp($,ee,et).source}).join("|")+")",flags(et))}function stringToRegexp($,ee,et){return tokensToRegexp(parse($,et),ee,et)}function tokensToRegexp($,ee,et){void 0===et&&(et={});for(var er=et.strict,en=void 0!==er&&er,ei=et.start,es=void 0===ei||ei,eo=et.end,eu=void 0===eo||eo,eh=et.encode,ep=void 0===eh?function($){return $}:eh,ef="["+escapeString(et.endsWith||"")+"]|$",em="["+escapeString(et.delimiter||"/#?")+"]",eg=es?"^":"",ey=0,ev=$;ey<ev.length;ey++){var eS=ev[ey];if("string"==typeof eS)eg+=escapeString(ep(eS));else{var eC=escapeString(ep(eS.prefix)),eT=escapeString(ep(eS.suffix));if(eS.pattern){if(ee&&ee.push(eS),eC||eT){if("+"===eS.modifier||"*"===eS.modifier){var eE="*"===eS.modifier?"?":"";eg+="(?:"+eC+"((?:"+eS.pattern+")(?:"+eT+eC+"(?:"+eS.pattern+"))*)"+eT+")"+eE}else eg+="(?:"+eC+"("+eS.pattern+")"+eT+")"+eS.modifier}else eg+="("+eS.pattern+")"+eS.modifier}else eg+="(?:"+eC+eT+")"+eS.modifier}}if(eu)en||(eg+=em+"?"),eg+=et.endsWith?"(?="+ef+")":"$";else{var ew=$[$.length-1],eD="string"==typeof ew?em.indexOf(ew[ew.length-1])>-1:void 0===ew;en||(eg+="(?:"+em+"(?="+ef+"))?"),eD||(eg+="(?="+em+"|"+ef+")")}return new RegExp(eg,flags(et))}function pathToRegexp($,ee,et){return $ instanceof RegExp?regexpToRegexp($,ee):Array.isArray($)?arrayToRegexp($,ee,et):stringToRegexp($,ee,et)}Object.defineProperty(ee,"__esModule",{value:!0}),ee.parse=parse,ee.compile=compile,ee.tokensToFunction=tokensToFunction,ee.match=match,ee.regexpToFunction=regexpToFunction,ee.tokensToRegexp=tokensToRegexp,ee.pathToRegexp=pathToRegexp},1209:($,ee)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),function($,ee){for(var et in ee)Object.defineProperty($,et,{enumerable:!0,get:ee[et]})}(ee,{NEXT_QUERY_PARAM_PREFIX:function(){return et},PRERENDER_REVALIDATE_HEADER:function(){return er},PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER:function(){return en},NEXT_CACHE_TAGS_HEADER:function(){return ei},NEXT_CACHE_SOFT_TAGS_HEADER:function(){return es},NEXT_CACHE_REVALIDATED_TAGS_HEADER:function(){return eo},NEXT_CACHE_REVALIDATE_TAG_TOKEN_HEADER:function(){return eu},NEXT_CACHE_TAG_MAX_LENGTH:function(){return eh},NEXT_CACHE_SOFT_TAG_MAX_LENGTH:function(){return ep},NEXT_CACHE_IMPLICIT_TAG_ID:function(){return ef},CACHE_ONE_YEAR:function(){return em},MIDDLEWARE_FILENAME:function(){return eg},MIDDLEWARE_LOCATION_REGEXP:function(){return ey},INSTRUMENTATION_HOOK_FILENAME:function(){return ev},PAGES_DIR_ALIAS:function(){return eS},DOT_NEXT_ALIAS:function(){return eC},ROOT_DIR_ALIAS:function(){return eT},APP_DIR_ALIAS:function(){return eE},RSC_MOD_REF_PROXY_ALIAS:function(){return ew},RSC_ACTION_VALIDATE_ALIAS:function(){return eD},RSC_ACTION_PROXY_ALIAS:function(){return eI},RSC_ACTION_CLIENT_WRAPPER_ALIAS:function(){return eR},PUBLIC_DIR_MIDDLEWARE_CONFLICT:function(){return e_},SSG_GET_INITIAL_PROPS_CONFLICT:function(){return eP},SERVER_PROPS_GET_INIT_PROPS_CONFLICT:function(){return eA},SERVER_PROPS_SSG_CONFLICT:function(){return ex},STATIC_STATUS_PAGE_GET_INITIAL_PROPS_ERROR:function(){return eO},SERVER_PROPS_EXPORT_ERROR:function(){return ek},GSP_NO_RETURNED_VALUE:function(){return eN},GSSP_NO_RETURNED_VALUE:function(){return eM},UNSTABLE_REVALIDATE_RENAME_ERROR:function(){return eF},GSSP_COMPONENT_MEMBER_ERROR:function(){return eL},NON_STANDARD_NODE_ENV:function(){return eB},SSG_FALLBACK_EXPORT_ERROR:function(){return eV},ESLINT_DEFAULT_DIRS:function(){return ej},ESLINT_PROMPT_VALUES:function(){return eU},SERVER_RUNTIME:function(){return eq},WEBPACK_LAYERS:function(){return eK},WEBPACK_RESOURCE_QUERIES:function(){return eW}});let et="nxtP",er="x-prerender-revalidate",en="x-prerender-revalidate-if-generated",ei="x-next-cache-tags",es="x-next-cache-soft-tags",eo="x-next-revalidated-tags",eu="x-next-revalidate-tag-token",eh=256,ep=1024,ef="_N_T_",em=31536e3,eg="middleware",ey=`(?:src/)?${eg}`,ev="instrumentation",eS="private-next-pages",eC="private-dot-next",eT="private-next-root-dir",eE="private-next-app-dir",ew="next/dist/build/webpack/loaders/next-flight-loader/module-proxy",eD="private-next-rsc-action-validate",eI="private-next-rsc-action-proxy",eR="private-next-rsc-action-client-wrapper",e_="You can not have a '_next' folder inside of your public folder. This conflicts with the internal '/_next' route. https://nextjs.org/docs/messages/public-next-folder-conflict",eP="You can not use getInitialProps with getStaticProps. To use SSG, please remove your getInitialProps",eA="You can not use getInitialProps with getServerSideProps. Please remove getInitialProps.",ex="You can not use getStaticProps or getStaticPaths with getServerSideProps. To use SSG, please remove getServerSideProps",eO="can not have getInitialProps/getServerSideProps, https://nextjs.org/docs/messages/404-get-initial-props",ek="pages with `getServerSideProps` can not be exported. See more info here: https://nextjs.org/docs/messages/gssp-export",eN="Your `getStaticProps` function did not return an object. Did you forget to add a `return`?",eM="Your `getServerSideProps` function did not return an object. Did you forget to add a `return`?",eF="The `unstable_revalidate` property is available for general use.\nPlease use `revalidate` instead.",eL="can not be attached to a page's component and must be exported from the page. See more info here: https://nextjs.org/docs/messages/gssp-component-member",eB='You are using a non-standard "NODE_ENV" value in your environment. This creates inconsistencies in the project and is strongly advised against. Read more: https://nextjs.org/docs/messages/non-standard-node-env',eV="Pages with `fallback` enabled in `getStaticPaths` can not be exported. See more info here: https://nextjs.org/docs/messages/ssg-fallback-true-export",ej=["app","pages","components","lib","src"],eU=[{title:"Strict",recommended:!0,config:{extends:"next/core-web-vitals"}},{title:"Base",config:{extends:"next"}},{title:"Cancel",config:null}],eq={edge:"edge",experimentalEdge:"experimental-edge",nodejs:"nodejs"},ez={shared:"shared",reactServerComponents:"rsc",serverSideRendering:"ssr",actionBrowser:"action-browser",api:"api",middleware:"middleware",edgeAsset:"edge-asset",appPagesBrowser:"app-pages-browser",appMetadataRoute:"app-metadata-route",appRouteHandler:"app-route-handler"},eK={...ez,GROUP:{server:[ez.reactServerComponents,ez.actionBrowser,ez.appMetadataRoute,ez.appRouteHandler],nonClientServerTarget:[ez.middleware,ez.api],app:[ez.reactServerComponents,ez.actionBrowser,ez.appMetadataRoute,ez.appRouteHandler,ez.serverSideRendering,ez.appPagesBrowser]}},eW={edgeSSREntry:"__next_edge_ssr_entry__",metadata:"__next_metadata__",metadataRoute:"__next_metadata_route__",metadataImageMeta:"__next_metadata_image_meta__"}},96885:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),function($,ee){for(var et in ee)Object.defineProperty($,et,{enumerable:!0,get:ee[et]})}(ee,{fillMetadataSegment:function(){return fillMetadataSegment},normalizeMetadataRoute:function(){return normalizeMetadataRoute}});let er=et(53223),en=_interop_require_default(et(87001)),ei=et(1645),es=et(16136),eo=et(40889),eu=et(94547),eh=et(24029);function _interop_require_default($){return $&&$.__esModule?$:{default:$}}function getMetadataRouteSuffix($){let ee="";return($.includes("(")&&$.includes(")")||$.includes("@"))&&(ee=(0,eo.djb2Hash)($).toString(36).slice(0,6)),ee}function fillMetadataSegment($,ee,et){let er=(0,eu.normalizeAppPath)($),eo=(0,es.getNamedRouteRegex)(er,!1),ep=(0,ei.interpolateDynamicPath)(er,ee,eo),ef=getMetadataRouteSuffix($),em=ef?`-${ef}`:"",{name:eg,ext:ey}=en.default.parse(et);return(0,eh.normalizePathSep)(en.default.join(ep,`${eg}${em}${ey}`))}function normalizeMetadataRoute($){if(!(0,er.isMetadataRoute)($))return $;let ee=$,et="";if("/robots"===$)ee+=".txt";else if("/manifest"===$)ee+=".webmanifest";else if($.endsWith("/sitemap"))ee+=".xml";else{let ee=$.slice(0,-(en.default.basename($).length+1));et=getMetadataRouteSuffix(ee)}if(!ee.endsWith("/route")){let{dir:ei,name:es,ext:eo}=en.default.parse(ee),eu=(0,er.isStaticMetadataRoute)($);ee=en.default.posix.join(ei,`${es}${et?`-${et}`:""}${eo}`,eu?"":"[[...__metadata_id__]]","route")}return ee}},53223:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),function($,ee){for(var et in ee)Object.defineProperty($,et,{enumerable:!0,get:ee[et]})}(ee,{STATIC_METADATA_IMAGES:function(){return en},isMetadataRouteFile:function(){return isMetadataRouteFile},isStaticMetadataRouteFile:function(){return isStaticMetadataRouteFile},isStaticMetadataRoute:function(){return isStaticMetadataRoute},isMetadataRoute:function(){return isMetadataRoute}});let er=et(24029),en={icon:{filename:"icon",extensions:["ico","jpg","jpeg","png","svg"]},apple:{filename:"apple-icon",extensions:["jpg","jpeg","png"]},favicon:{filename:"favicon",extensions:["ico"]},openGraph:{filename:"opengraph-image",extensions:["jpg","jpeg","png","gif"]},twitter:{filename:"twitter-image",extensions:["jpg","jpeg","png","gif"]}},ei=["js","jsx","ts","tsx"],getExtensionRegexString=$=>`(?:${$.join("|")})`;function isMetadataRouteFile($,ee,et){let ei=[RegExp(`^[\\\\/]robots${et?`\\.${getExtensionRegexString(ee.concat("txt"))}$`:""}`),RegExp(`^[\\\\/]manifest${et?`\\.${getExtensionRegexString(ee.concat("webmanifest","json"))}$`:""}`),RegExp("^[\\\\/]favicon\\.ico$"),RegExp(`[\\\\/]sitemap${et?`\\.${getExtensionRegexString(ee.concat("xml"))}$`:""}`),RegExp(`[\\\\/]${en.icon.filename}\\d?${et?`\\.${getExtensionRegexString(ee.concat(en.icon.extensions))}$`:""}`),RegExp(`[\\\\/]${en.apple.filename}\\d?${et?`\\.${getExtensionRegexString(ee.concat(en.apple.extensions))}$`:""}`),RegExp(`[\\\\/]${en.openGraph.filename}\\d?${et?`\\.${getExtensionRegexString(ee.concat(en.openGraph.extensions))}$`:""}`),RegExp(`[\\\\/]${en.twitter.filename}\\d?${et?`\\.${getExtensionRegexString(ee.concat(en.twitter.extensions))}$`:""}`)],es=(0,er.normalizePathSep)($);return ei.some($=>$.test(es))}function isStaticMetadataRouteFile($){return isMetadataRouteFile($,[],!0)}function isStaticMetadataRoute($){return"/robots"===$||"/manifest"===$||isStaticMetadataRouteFile($)}function isMetadataRoute($){let ee=$.replace(/^\/?app\//,"").replace(/\/route$/,"");return"/"!==ee[0]&&(ee="/"+ee),!ee.endsWith("/page")&&isMetadataRouteFile(ee,ei,!1)}},10994:($,ee,et)=>{"use strict";function getCookieParser($){return function(){let{cookie:ee}=$;if(!ee)return{};let{parse:er}=et(78582);return er(Array.isArray(ee)?ee.join("; "):ee)}}Object.defineProperty(ee,"__esModule",{value:!0}),Object.defineProperty(ee,"getCookieParser",{enumerable:!0,get:function(){return getCookieParser}})},86098:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),function($,ee){for(var et in ee)Object.defineProperty($,et,{enumerable:!0,get:ee[et]})}(ee,{INTERCEPTION_ROUTE_MARKERS:function(){return en},isInterceptionRouteAppPath:function(){return isInterceptionRouteAppPath},extractInterceptionRouteInformation:function(){return extractInterceptionRouteInformation}});let er=et(94547),en=["(..)(..)","(.)","(..)","(...)"];function isInterceptionRouteAppPath($){return void 0!==$.split("/").find($=>en.find(ee=>$.startsWith(ee)))}function extractInterceptionRouteInformation($){let ee,et,ei;for(let er of $.split("/"))if(et=en.find($=>er.startsWith($))){[ee,ei]=$.split(et,2);break}if(!ee||!et||!ei)throw Error(`Invalid interception route: ${$}. Must be in the format /<intercepting route>/(..|...|..)(..)/<intercepted route>`);switch(ee=(0,er.normalizeAppPath)(ee),et){case"(.)":ei="/"===ee?`/${ei}`:ee+"/"+ei;break;case"(..)":if("/"===ee)throw Error(`Invalid interception route: ${$}. Cannot use (..) marker at the root level, use (.) instead.`);ei=ee.split("/").slice(0,-1).concat(ei).join("/");break;case"(...)":ei="/"+ei;break;case"(..)(..)":let es=ee.split("/");if(es.length<=2)throw Error(`Invalid interception route: ${$}. Cannot use (..)(..) marker at the root level or one level up.`);ei=es.slice(0,-2).concat(ei).join("/");break;default:throw Error("Invariant: unexpected marker")}return{interceptingRoute:ee,interceptedRoute:ei}}},1645:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),function($,ee){for(var et in ee)Object.defineProperty($,et,{enumerable:!0,get:ee[et]})}(ee,{normalizeVercelUrl:function(){return normalizeVercelUrl},interpolateDynamicPath:function(){return interpolateDynamicPath},getUtils:function(){return getUtils}});let er=et(57310),en=et(83688),ei=et(74016),es=et(16136),eo=et(24727),eu=et(93682),eh=et(2664),ep=et(94547),ef=et(1209);function normalizeVercelUrl($,ee,et,en,ei){if(en&&ee&&ei){let ee=(0,er.parse)($.url,!0);for(let $ of(delete ee.search,Object.keys(ee.query)))($!==ef.NEXT_QUERY_PARAM_PREFIX&&$.startsWith(ef.NEXT_QUERY_PARAM_PREFIX)||(et||Object.keys(ei.groups)).includes($))&&delete ee.query[$];$.url=(0,er.format)(ee)}}function interpolateDynamicPath($,ee,et){if(!et)return $;for(let er of Object.keys(et.groups)){let{optional:en,repeat:ei}=et.groups[er],es=`[${ei?"...":""}${er}]`;en&&(es=`[${es}]`);let eo=$.indexOf(es);if(eo>-1){let et;let en=ee[er];et=Array.isArray(en)?en.map($=>$&&encodeURIComponent($)).join("/"):en?encodeURIComponent(en):"",$=$.slice(0,eo)+et+$.slice(eo+es.length)}}return $}function getUtils({page:$,i18n:ee,basePath:et,rewrites:er,pageIsDynamic:em,trailingSlash:eg,caseSensitive:ey}){let ev,eS,eC;return em&&(ev=(0,es.getNamedRouteRegex)($,!1),eC=(eS=(0,eo.getRouteMatcher)(ev))($)),{handleRewrites:function(es,eo){let ep={},ef=eo.pathname,matchesPage=()=>{let ee=(0,eh.removeTrailingSlash)(ef||"");return ee===(0,eh.removeTrailingSlash)($)||(null==eS?void 0:eS(ee))},checkRewrite=er=>{let eh=(0,ei.getPathMatch)(er.source+(eg?"(/)?":""),{removeUnnamedParams:!0,strict:!0,sensitive:!!ey}),ev=eh(eo.pathname);if((er.has||er.missing)&&ev){let $=(0,eu.matchHas)(es,eo.query,er.has,er.missing);$?Object.assign(ev,$):ev=!1}if(ev){let{parsedDestination:ei,destQuery:es}=(0,eu.prepareDestination)({appendParamsToQuery:!0,destination:er.destination,params:ev,query:eo.query});if(ei.protocol)return!0;if(Object.assign(ep,es,ev),Object.assign(eo.query,ei.query),delete ei.query,Object.assign(eo,ei),ef=eo.pathname,et&&(ef=ef.replace(RegExp(`^${et}`),"")||"/"),ee){let $=(0,en.normalizeLocalePath)(ef,ee.locales);ef=$.pathname,eo.query.nextInternalLocale=$.detectedLocale||ev.nextInternalLocale}if(ef===$)return!0;if(em&&eS){let $=eS(ef);if($)return eo.query={...eo.query,...$},!0}}return!1};for(let $ of er.beforeFiles||[])checkRewrite($);if(ef!==$){let $=!1;for(let ee of er.afterFiles||[])if($=checkRewrite(ee))break;if(!$&&!matchesPage()){for(let ee of er.fallback||[])if($=checkRewrite(ee))break}}return ep},defaultRouteRegex:ev,dynamicRouteMatcher:eS,defaultRouteMatches:eC,getParamsFromRouteMatches:function($,et,er){return(0,eo.getRouteMatcher)(function(){let{groups:$,routeKeys:en}=ev;return{re:{exec:ei=>{let es=Object.fromEntries(new URLSearchParams(ei)),eo=ee&&er&&es["1"]===er;for(let $ of Object.keys(es)){let ee=es[$];if($!==ef.NEXT_QUERY_PARAM_PREFIX&&$.startsWith(ef.NEXT_QUERY_PARAM_PREFIX)){let et=$.substring(ef.NEXT_QUERY_PARAM_PREFIX.length);es[et]=ee,delete es[$]}}let eu=Object.keys(en||{}),filterLocaleItem=$=>{if(ee){let en=Array.isArray($),ei=en?$[0]:$;if("string"==typeof ei&&ee.locales.some($=>$.toLowerCase()===ei.toLowerCase()&&(er=$,et.locale=er,!0)))return en&&$.splice(0,1),!en||0===$.length}return!1};return eu.every($=>es[$])?eu.reduce((ee,et)=>{let er=null==en?void 0:en[et];return er&&!filterLocaleItem(es[et])&&(ee[$[er].pos]=es[et]),ee},{}):Object.keys(es).reduce(($,ee)=>{if(!filterLocaleItem(es[ee])){let et=ee;return eo&&(et=parseInt(ee,10)-1+""),Object.assign($,{[et]:es[ee]})}return $},{})}},groups:$}}())($.headers["x-now-route-matches"])},normalizeDynamicRouteParams:function($,ee){let et=!0;return ev?{params:$=Object.keys(ev.groups).reduce((er,en)=>{let ei=$[en];"string"==typeof ei&&(ei=(0,ep.normalizeRscPath)(ei,!0)),Array.isArray(ei)&&(ei=ei.map($=>("string"==typeof $&&($=(0,ep.normalizeRscPath)($,!0)),$)));let es=eC[en],eo=ev.groups[en].optional,eu=Array.isArray(es)?es.some($=>Array.isArray(ei)?ei.some(ee=>ee.includes($)):null==ei?void 0:ei.includes($)):null==ei?void 0:ei.includes(es);return(eu||void 0===ei&&!(eo&&ee))&&(et=!1),eo&&(!ei||Array.isArray(ei)&&1===ei.length&&("index"===ei[0]||ei[0]===`[[...${en}]]`))&&(ei=void 0,delete $[en]),ei&&"string"==typeof ei&&ev.groups[en].repeat&&(ei=ei.split("/")),ei&&(er[en]=ei),er},{}),hasValidParams:et}:{params:$,hasValidParams:!1}},normalizeVercelUrl:($,ee,et)=>normalizeVercelUrl($,ee,et,em,ev),interpolateDynamicPath:($,ee)=>interpolateDynamicPath($,ee,ev)}}},59405:($,ee)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),Object.defineProperty(ee,"escapeStringRegexp",{enumerable:!0,get:function(){return escapeStringRegexp}});let et=/[|\\{}()[\]^$+*?.-]/,er=/[|\\{}()[\]^$+*?.-]/g;function escapeStringRegexp($){return et.test($)?$.replace(er,"\\$&"):$}},40889:($,ee)=>{"use strict";function djb2Hash($){let ee=5381;for(let et=0;et<$.length;et++){let er=$.charCodeAt(et);ee=(ee<<5)+ee+er}return Math.abs(ee)}function hexHash($){return djb2Hash($).toString(36).slice(0,5)}Object.defineProperty(ee,"__esModule",{value:!0}),function($,ee){for(var et in ee)Object.defineProperty($,et,{enumerable:!0,get:ee[et]})}(ee,{djb2Hash:function(){return djb2Hash},hexHash:function(){return hexHash}})},83688:($,ee)=>{"use strict";function normalizeLocalePath($,ee){let et;let er=$.split("/");return(ee||[]).some(ee=>!!er[1]&&er[1].toLowerCase()===ee.toLowerCase()&&(et=ee,er.splice(1,1),$=er.join("/")||"/",!0)),{pathname:$,detectedLocale:et}}Object.defineProperty(ee,"__esModule",{value:!0}),Object.defineProperty(ee,"normalizeLocalePath",{enumerable:!0,get:function(){return normalizeLocalePath}})},87001:($,ee,et)=>{"use strict";let er;er=et(71017),$.exports=er},36800:($,ee)=>{"use strict";function ensureLeadingSlash($){return $.startsWith("/")?$:"/"+$}Object.defineProperty(ee,"__esModule",{value:!0}),Object.defineProperty(ee,"ensureLeadingSlash",{enumerable:!0,get:function(){return ensureLeadingSlash}})},24029:($,ee)=>{"use strict";function normalizePathSep($){return $.replace(/\\/g,"/")}Object.defineProperty(ee,"__esModule",{value:!0}),Object.defineProperty(ee,"normalizePathSep",{enumerable:!0,get:function(){return normalizePathSep}})},94547:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),function($,ee){for(var et in ee)Object.defineProperty($,et,{enumerable:!0,get:ee[et]})}(ee,{normalizeAppPath:function(){return normalizeAppPath},normalizeRscPath:function(){return normalizeRscPath}});let er=et(36800),en=et(23391);function normalizeAppPath($){return(0,er.ensureLeadingSlash)($.split("/").reduce(($,ee,et,er)=>!ee||(0,en.isGroupSegment)(ee)||"@"===ee[0]||("page"===ee||"route"===ee)&&et===er.length-1?$:$+"/"+ee,""))}function normalizeRscPath($,ee){return ee?$.replace(/\.rsc($|\?)/,"$1"):$}},22730:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),Object.defineProperty(ee,"parseRelativeUrl",{enumerable:!0,get:function(){return parseRelativeUrl}}),et(12261);let er=et(65588);function parseRelativeUrl($,ee){let et=new URL("http://n"),en=ee?new URL(ee,et):$.startsWith(".")?new URL("http://n"):et,{pathname:ei,searchParams:es,search:eo,hash:eu,href:eh,origin:ep}=new URL($,en);if(ep!==et.origin)throw Error("invariant: invalid relative URL, router received "+$);return{pathname:ei,query:(0,er.searchParamsToUrlQuery)(es),search:eo,hash:eu,href:eh.slice(et.origin.length)}}},64547:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),Object.defineProperty(ee,"parseUrl",{enumerable:!0,get:function(){return parseUrl}});let er=et(65588),en=et(22730);function parseUrl($){if($.startsWith("/"))return(0,en.parseRelativeUrl)($);let ee=new URL($);return{hash:ee.hash,hostname:ee.hostname,href:ee.href,pathname:ee.pathname,port:ee.port,protocol:ee.protocol,query:(0,er.searchParamsToUrlQuery)(ee.searchParams),search:ee.search}}},74016:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),Object.defineProperty(ee,"getPathMatch",{enumerable:!0,get:function(){return getPathMatch}});let er=et(62982);function getPathMatch($,ee){let et=[],en=(0,er.pathToRegexp)($,et,{delimiter:"/",sensitive:"boolean"==typeof(null==ee?void 0:ee.sensitive)&&ee.sensitive,strict:null==ee?void 0:ee.strict}),ei=(0,er.regexpToFunction)((null==ee?void 0:ee.regexModifier)?new RegExp(ee.regexModifier(en.source),en.flags):en,et);return($,er)=>{if("string"!=typeof $)return!1;let en=ei($);if(!en)return!1;if(null==ee?void 0:ee.removeUnnamedParams)for(let $ of et)"number"==typeof $.name&&delete en.params[$.name];return{...er,...en.params}}}},93682:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),function($,ee){for(var et in ee)Object.defineProperty($,et,{enumerable:!0,get:ee[et]})}(ee,{matchHas:function(){return matchHas},compileNonPath:function(){return compileNonPath},prepareDestination:function(){return prepareDestination}});let er=et(62982),en=et(59405),ei=et(64547),es=et(86098),eo=et(83093),eu=et(10994);function getSafeParamName($){let ee="";for(let et=0;et<$.length;et++){let er=$.charCodeAt(et);(er>64&&er<91||er>96&&er<123)&&(ee+=$[et])}return ee}function escapeSegment($,ee){return $.replace(RegExp(":"+(0,en.escapeStringRegexp)(ee),"g"),"__ESC_COLON_"+ee)}function unescapeSegments($){return $.replace(/__ESC_COLON_/gi,":")}function matchHas($,ee,et,er){void 0===et&&(et=[]),void 0===er&&(er=[]);let en={},hasMatch=et=>{let er;let ei=et.key;switch(et.type){case"header":ei=ei.toLowerCase(),er=$.headers[ei];break;case"cookie":if("cookies"in $)er=$.cookies[et.key];else{let ee=(0,eu.getCookieParser)($.headers)();er=ee[et.key]}break;case"query":er=ee[ei];break;case"host":{let{host:ee}=(null==$?void 0:$.headers)||{},et=null==ee?void 0:ee.split(":")[0].toLowerCase();er=et}}if(!et.value&&er)return en[getSafeParamName(ei)]=er,!0;if(er){let $=RegExp("^"+et.value+"$"),ee=Array.isArray(er)?er.slice(-1)[0].match($):er.match($);if(ee)return Array.isArray(ee)&&(ee.groups?Object.keys(ee.groups).forEach($=>{en[$]=ee.groups[$]}):"host"===et.type&&ee[0]&&(en.host=ee[0])),!0}return!1},ei=et.every($=>hasMatch($))&&!er.some($=>hasMatch($));return!!ei&&en}function compileNonPath($,ee){if(!$.includes(":"))return $;for(let et of Object.keys(ee))$.includes(":"+et)&&($=$.replace(RegExp(":"+et+"\\*","g"),":"+et+"--ESCAPED_PARAM_ASTERISKS").replace(RegExp(":"+et+"\\?","g"),":"+et+"--ESCAPED_PARAM_QUESTION").replace(RegExp(":"+et+"\\+","g"),":"+et+"--ESCAPED_PARAM_PLUS").replace(RegExp(":"+et+"(?!\\w)","g"),"--ESCAPED_PARAM_COLON"+et));return $=$.replace(/(:|\*|\?|\+|\(|\)|\{|\})/g,"\\$1").replace(/--ESCAPED_PARAM_PLUS/g,"+").replace(/--ESCAPED_PARAM_COLON/g,":").replace(/--ESCAPED_PARAM_QUESTION/g,"?").replace(/--ESCAPED_PARAM_ASTERISKS/g,"*"),(0,er.compile)("/"+$,{validate:!1})(ee).slice(1)}function prepareDestination($){let ee;let et=Object.assign({},$.query);delete et.__nextLocale,delete et.__nextDefaultLocale,delete et.__nextDataReq,delete et.__nextInferredLocaleFromDefault,delete et[eo.NEXT_RSC_UNION_QUERY];let en=$.destination;for(let ee of Object.keys({...$.params,...et}))en=escapeSegment(en,ee);let eu=(0,ei.parseUrl)(en),eh=eu.query,ep=unescapeSegments(""+eu.pathname+(eu.hash||"")),ef=unescapeSegments(eu.hostname||""),em=[],eg=[];(0,er.pathToRegexp)(ep,em),(0,er.pathToRegexp)(ef,eg);let ey=[];em.forEach($=>ey.push($.name)),eg.forEach($=>ey.push($.name));let ev=(0,er.compile)(ep,{validate:!1}),eS=(0,er.compile)(ef,{validate:!1});for(let[ee,et]of Object.entries(eh))Array.isArray(et)?eh[ee]=et.map(ee=>compileNonPath(unescapeSegments(ee),$.params)):"string"==typeof et&&(eh[ee]=compileNonPath(unescapeSegments(et),$.params));let eC=Object.keys($.params).filter($=>"nextInternalLocale"!==$);if($.appendParamsToQuery&&!eC.some($=>ey.includes($)))for(let ee of eC)ee in eh||(eh[ee]=$.params[ee]);if((0,es.isInterceptionRouteAppPath)(ep))for(let ee of ep.split("/")){let et=es.INTERCEPTION_ROUTE_MARKERS.find($=>ee.startsWith($));if(et){$.params["0"]=et;break}}try{ee=ev($.params);let[et,er]=ee.split("#");eu.hostname=eS($.params),eu.pathname=et,eu.hash=(er?"#":"")+(er||""),delete eu.search}catch($){if($.message.match(/Expected .*? to not repeat, but got an array/))throw Error("To use a multi-match in the destination you must add `*` at the end of the param name to signify it should repeat. https://nextjs.org/docs/messages/invalid-multi-match");throw $}return eu.query={...et,...eu.query},{newUrl:ee,destQuery:eh,parsedDestination:eu}}},65588:($,ee)=>{"use strict";function searchParamsToUrlQuery($){let ee={};return $.forEach(($,et)=>{void 0===ee[et]?ee[et]=$:Array.isArray(ee[et])?ee[et].push($):ee[et]=[ee[et],$]}),ee}function stringifyUrlQueryParam($){return"string"!=typeof $&&("number"!=typeof $||isNaN($))&&"boolean"!=typeof $?"":String($)}function urlQueryToSearchParams($){let ee=new URLSearchParams;return Object.entries($).forEach($=>{let[et,er]=$;Array.isArray(er)?er.forEach($=>ee.append(et,stringifyUrlQueryParam($))):ee.set(et,stringifyUrlQueryParam(er))}),ee}function assign($){for(var ee=arguments.length,et=Array(ee>1?ee-1:0),er=1;er<ee;er++)et[er-1]=arguments[er];return et.forEach(ee=>{Array.from(ee.keys()).forEach(ee=>$.delete(ee)),ee.forEach((ee,et)=>$.append(et,ee))}),$}Object.defineProperty(ee,"__esModule",{value:!0}),function($,ee){for(var et in ee)Object.defineProperty($,et,{enumerable:!0,get:ee[et]})}(ee,{searchParamsToUrlQuery:function(){return searchParamsToUrlQuery},urlQueryToSearchParams:function(){return urlQueryToSearchParams},assign:function(){return assign}})},2664:($,ee)=>{"use strict";function removeTrailingSlash($){return $.replace(/\/$/,"")||"/"}Object.defineProperty(ee,"__esModule",{value:!0}),Object.defineProperty(ee,"removeTrailingSlash",{enumerable:!0,get:function(){return removeTrailingSlash}})},24727:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),Object.defineProperty(ee,"getRouteMatcher",{enumerable:!0,get:function(){return getRouteMatcher}});let er=et(12261);function getRouteMatcher($){let{re:ee,groups:et}=$;return $=>{let en=ee.exec($);if(!en)return!1;let decode=$=>{try{return decodeURIComponent($)}catch($){throw new er.DecodeError("failed to decode param")}},ei={};return Object.keys(et).forEach($=>{let ee=et[$],er=en[ee.pos];void 0!==er&&(ei[$]=~er.indexOf("/")?er.split("/").map($=>decode($)):ee.repeat?[decode(er)]:decode(er))}),ei}}},16136:($,ee,et)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),function($,ee){for(var et in ee)Object.defineProperty($,et,{enumerable:!0,get:ee[et]})}(ee,{getRouteRegex:function(){return getRouteRegex},getNamedRouteRegex:function(){return getNamedRouteRegex},getNamedMiddlewareRegex:function(){return getNamedMiddlewareRegex}});let er=et(86098),en=et(59405),ei=et(2664),es="nxtP",eo="nxtI";function parseParameter($){let ee=$.startsWith("[")&&$.endsWith("]");ee&&($=$.slice(1,-1));let et=$.startsWith("...");return et&&($=$.slice(3)),{key:$,repeat:et,optional:ee}}function getParametrizedRoute($){let ee=(0,ei.removeTrailingSlash)($).slice(1).split("/"),et={},es=1;return{parameterizedRoute:ee.map($=>{let ee=er.INTERCEPTION_ROUTE_MARKERS.find(ee=>$.startsWith(ee)),ei=$.match(/\[((?:\[.*\])|.+)\]/);if(ee&&ei){let{key:$,optional:er,repeat:eo}=parseParameter(ei[1]);return et[$]={pos:es++,repeat:eo,optional:er},"/"+(0,en.escapeStringRegexp)(ee)+"([^/]+?)"}if(!ei)return"/"+(0,en.escapeStringRegexp)($);{let{key:$,repeat:ee,optional:er}=parseParameter(ei[1]);return et[$]={pos:es++,repeat:ee,optional:er},ee?er?"(?:/(.+?))?":"/(.+?)":"/([^/]+?)"}}).join(""),groups:et}}function getRouteRegex($){let{parameterizedRoute:ee,groups:et}=getParametrizedRoute($);return{re:RegExp("^"+ee+"(?:/)?$"),groups:et}}function buildGetSafeRouteKey(){let $=0;return()=>{let ee="",et=++$;for(;et>0;)ee+=String.fromCharCode(97+(et-1)%26),et=Math.floor((et-1)/26);return ee}}function getSafeKeyFromSegment($){let{getSafeRouteKey:ee,segment:et,routeKeys:er,keyPrefix:en}=$,{key:ei,optional:es,repeat:eo}=parseParameter(et),eu=ei.replace(/\W/g,"");en&&(eu=""+en+eu);let eh=!1;return(0===eu.length||eu.length>30)&&(eh=!0),isNaN(parseInt(eu.slice(0,1)))||(eh=!0),eh&&(eu=ee()),en?er[eu]=""+en+ei:er[eu]=""+ei,eo?es?"(?:/(?<"+eu+">.+?))?":"/(?<"+eu+">.+?)":"/(?<"+eu+">[^/]+?)"}function getNamedParametrizedRoute($,ee){let et=(0,ei.removeTrailingSlash)($).slice(1).split("/"),eu=buildGetSafeRouteKey(),eh={};return{namedParameterizedRoute:et.map($=>{let et=er.INTERCEPTION_ROUTE_MARKERS.some(ee=>$.startsWith(ee)),ei=$.match(/\[((?:\[.*\])|.+)\]/);return et&&ei?getSafeKeyFromSegment({getSafeRouteKey:eu,segment:ei[1],routeKeys:eh,keyPrefix:ee?eo:void 0}):ei?getSafeKeyFromSegment({getSafeRouteKey:eu,segment:ei[1],routeKeys:eh,keyPrefix:ee?es:void 0}):"/"+(0,en.escapeStringRegexp)($)}).join(""),routeKeys:eh}}function getNamedRouteRegex($,ee){let et=getNamedParametrizedRoute($,ee);return{...getRouteRegex($),namedRegex:"^"+et.namedParameterizedRoute+"(?:/)?$",routeKeys:et.routeKeys}}function getNamedMiddlewareRegex($,ee){let{parameterizedRoute:et}=getParametrizedRoute($),{catchAll:er=!0}=ee;if("/"===et)return{namedRegex:"^/"+(er?".*":"")+"$"};let{namedParameterizedRoute:en}=getNamedParametrizedRoute($,!1);return{namedRegex:"^"+en+(er?"(?:(/.*)?)":"")+"$"}}},23391:($,ee)=>{"use strict";function isGroupSegment($){return"("===$[0]&&$.endsWith(")")}Object.defineProperty(ee,"__esModule",{value:!0}),Object.defineProperty(ee,"isGroupSegment",{enumerable:!0,get:function(){return isGroupSegment}})},12261:($,ee)=>{"use strict";Object.defineProperty(ee,"__esModule",{value:!0}),function($,ee){for(var et in ee)Object.defineProperty($,et,{enumerable:!0,get:ee[et]})}(ee,{WEB_VITALS:function(){return et},execOnce:function(){return execOnce},isAbsoluteUrl:function(){return isAbsoluteUrl},getLocationOrigin:function(){return getLocationOrigin},getURL:function(){return getURL},getDisplayName:function(){return getDisplayName},isResSent:function(){return isResSent},normalizeRepeatedSlashes:function(){return normalizeRepeatedSlashes},loadGetInitialProps:function(){return loadGetInitialProps},SP:function(){return en},ST:function(){return ei},DecodeError:function(){return DecodeError},NormalizeError:function(){return NormalizeError},PageNotFoundError:function(){return PageNotFoundError},MissingStaticPage:function(){return MissingStaticPage},MiddlewareNotFoundError:function(){return MiddlewareNotFoundError},stringifyError:function(){return stringifyError}});let et=["CLS","FCP","FID","INP","LCP","TTFB"];function execOnce($){let ee,et=!1;return function(){for(var er=arguments.length,en=Array(er),ei=0;ei<er;ei++)en[ei]=arguments[ei];return et||(et=!0,ee=$(...en)),ee}}let er=/^[a-zA-Z][a-zA-Z\d+\-.]*?:/,isAbsoluteUrl=$=>er.test($);function getLocationOrigin(){let{protocol:$,hostname:ee,port:et}=window.location;return $+"//"+ee+(et?":"+et:"")}function getURL(){let{href:$}=window.location,ee=getLocationOrigin();return $.substring(ee.length)}function getDisplayName($){return"string"==typeof $?$:$.displayName||$.name||"Unknown"}function isResSent($){return $.finished||$.headersSent}function normalizeRepeatedSlashes($){let ee=$.split("?"),et=ee[0];return et.replace(/\\/g,"/").replace(/\/\/+/g,"/")+(ee[1]?"?"+ee.slice(1).join("?"):"")}async function loadGetInitialProps($,ee){let et=ee.res||ee.ctx&&ee.ctx.res;if(!$.getInitialProps)return ee.ctx&&ee.Component?{pageProps:await loadGetInitialProps(ee.Component,ee.ctx)}:{};let er=await $.getInitialProps(ee);if(et&&isResSent(et))return er;if(!er){let ee='"'+getDisplayName($)+'.getInitialProps()" should resolve to an object. But found "'+er+'" instead.';throw Error(ee)}return er}let en="undefined"!=typeof performance,ei=en&&["mark","measure","getEntriesByName"].every($=>"function"==typeof performance[$]);let DecodeError=class DecodeError extends Error{};let NormalizeError=class NormalizeError extends Error{};let PageNotFoundError=class PageNotFoundError extends Error{constructor($){super(),this.code="ENOENT",this.name="PageNotFoundError",this.message="Cannot find module for page: "+$}};let MissingStaticPage=class MissingStaticPage extends Error{constructor($,ee){super(),this.message="Failed to load static file for page: "+$+" "+ee}};let MiddlewareNotFoundError=class MiddlewareNotFoundError extends Error{constructor(){super(),this.code="ENOENT",this.message="Cannot find the middleware module"}};function stringifyError($){return JSON.stringify({message:$.message,stack:$.stack})}},60080:($,ee,et)=>{"use strict";$.exports=et(10316).vendored["react-shared"].ReactJsxRuntime},57114:($,ee,et)=>{$.exports=et(82778)},95307:($,ee,et)=>{"use strict";var er=et(75962);$.exports=ee=er.descriptor=er.Root.fromJSON(et(89987)).lookup(".google.protobuf");var en=er.Namespace,ei=er.Root,es=er.Enum,eo=er.Type,eu=er.Field,eh=er.MapField,ep=er.OneOf,ef=er.Service,em=er.Method;function Root_toDescriptorRecursive($,et,er){var eh=ee.FileDescriptorProto.create({name:$.filename||($.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});er&&(eh.syntax=er),$ instanceof ei||(eh.package=$.fullName.substring(1));for(var ep,em=0;em<$.nestedArray.length;++em)(ep=$._nestedArray[em])instanceof eo?eh.messageType.push(ep.toDescriptor(er)):ep instanceof es?eh.enumType.push(ep.toDescriptor()):ep instanceof eu?eh.extension.push(ep.toDescriptor(er)):ep instanceof ef?eh.service.push(ep.toDescriptor()):ep instanceof en&&Root_toDescriptorRecursive(ep,et,er);eh.options=toDescriptorOptions($.options,ee.FileOptions),eh.messageType.length+eh.enumType.length+eh.extension.length+eh.service.length&&et.push(eh)}ei.fromDescriptor=function($){"number"==typeof $.length&&($=ee.FileDescriptorSet.decode($));var et=new ei;if($.file)for(var er,en,eh,ep=0;ep<$.file.length;++ep){if(en=et,(er=$.file[ep]).package&&er.package.length&&(en=et.define(er.package)),er.name&&er.name.length&&et.files.push(en.filename=er.name),er.messageType)for(eh=0;eh<er.messageType.length;++eh)en.add(eo.fromDescriptor(er.messageType[eh],er.syntax));if(er.enumType)for(eh=0;eh<er.enumType.length;++eh)en.add(es.fromDescriptor(er.enumType[eh]));if(er.extension)for(eh=0;eh<er.extension.length;++eh)en.add(eu.fromDescriptor(er.extension[eh]));if(er.service)for(eh=0;eh<er.service.length;++eh)en.add(ef.fromDescriptor(er.service[eh]));var em=fromDescriptorOptions(er.options,ee.FileOptions);if(em){var eg=Object.keys(em);for(eh=0;eh<eg.length;++eh)en.setOption(eg[eh],em[eg[eh]])}}return et},ei.prototype.toDescriptor=function($){var et=ee.FileDescriptorSet.create();return Root_toDescriptorRecursive(this,et.file,$),et};var eg=0;eo.fromDescriptor=function($,et){"number"==typeof $.length&&($=ee.DescriptorProto.decode($));var er,en=new eo($.name.length?$.name:"Type"+eg++,fromDescriptorOptions($.options,ee.MessageOptions));if($.oneofDecl)for(er=0;er<$.oneofDecl.length;++er)en.add(ep.fromDescriptor($.oneofDecl[er]));if($.field)for(er=0;er<$.field.length;++er){var ei=eu.fromDescriptor($.field[er],et);en.add(ei),$.field[er].hasOwnProperty("oneofIndex")&&en.oneofsArray[$.field[er].oneofIndex].add(ei)}if($.extension)for(er=0;er<$.extension.length;++er)en.add(eu.fromDescriptor($.extension[er],et));if($.nestedType)for(er=0;er<$.nestedType.length;++er)en.add(eo.fromDescriptor($.nestedType[er],et)),$.nestedType[er].options&&$.nestedType[er].options.mapEntry&&en.setOption("map_entry",!0);if($.enumType)for(er=0;er<$.enumType.length;++er)en.add(es.fromDescriptor($.enumType[er]));if($.extensionRange&&$.extensionRange.length)for(er=0,en.extensions=[];er<$.extensionRange.length;++er)en.extensions.push([$.extensionRange[er].start,$.extensionRange[er].end]);if($.reservedRange&&$.reservedRange.length||$.reservedName&&$.reservedName.length){if(en.reserved=[],$.reservedRange)for(er=0;er<$.reservedRange.length;++er)en.reserved.push([$.reservedRange[er].start,$.reservedRange[er].end]);if($.reservedName)for(er=0;er<$.reservedName.length;++er)en.reserved.push($.reservedName[er])}return en},eo.prototype.toDescriptor=function($){var et,er,en=ee.DescriptorProto.create({name:this.name});for(er=0;er<this.fieldsArray.length;++er)if(en.field.push(et=this._fieldsArray[er].toDescriptor($)),this._fieldsArray[er]instanceof eh){var ei=toDescriptorType(this._fieldsArray[er].keyType,this._fieldsArray[er].resolvedKeyType),ep=toDescriptorType(this._fieldsArray[er].type,this._fieldsArray[er].resolvedType),ef=11===ep||14===ep?this._fieldsArray[er].resolvedType&&shortname(this.parent,this._fieldsArray[er].resolvedType)||this._fieldsArray[er].type:void 0;en.nestedType.push(ee.DescriptorProto.create({name:et.typeName,field:[ee.FieldDescriptorProto.create({name:"key",number:1,label:1,type:ei}),ee.FieldDescriptorProto.create({name:"value",number:2,label:1,type:ep,typeName:ef})],options:ee.MessageOptions.create({mapEntry:!0})}))}for(er=0;er<this.oneofsArray.length;++er)en.oneofDecl.push(this._oneofsArray[er].toDescriptor());for(er=0;er<this.nestedArray.length;++er)this._nestedArray[er]instanceof eu?en.field.push(this._nestedArray[er].toDescriptor($)):this._nestedArray[er]instanceof eo?en.nestedType.push(this._nestedArray[er].toDescriptor($)):this._nestedArray[er]instanceof es&&en.enumType.push(this._nestedArray[er].toDescriptor());if(this.extensions)for(er=0;er<this.extensions.length;++er)en.extensionRange.push(ee.DescriptorProto.ExtensionRange.create({start:this.extensions[er][0],end:this.extensions[er][1]}));if(this.reserved)for(er=0;er<this.reserved.length;++er)"string"==typeof this.reserved[er]?en.reservedName.push(this.reserved[er]):en.reservedRange.push(ee.DescriptorProto.ReservedRange.create({start:this.reserved[er][0],end:this.reserved[er][1]}));return en.options=toDescriptorOptions(this.options,ee.MessageOptions),en};var ey=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;eu.fromDescriptor=function($,et){if("number"==typeof $.length&&($=ee.DescriptorProto.decode($)),"number"!=typeof $.number)throw Error("missing field id");switch(er=$.typeName&&$.typeName.length?$.typeName:fromDescriptorType($.type),$.label){case 1:en=void 0;break;case 2:en="required";break;case 3:en="repeated";break;default:throw Error("illegal label: "+$.label)}var er,en,ei=$.extendee;void 0!==$.extendee&&(ei=ei.length?ei:void 0);var es=new eu($.name.length?$.name:"field"+$.number,$.number,er,en,ei);if(es.options=fromDescriptorOptions($.options,ee.FieldOptions),$.defaultValue&&$.defaultValue.length){var eo=$.defaultValue;switch(eo){case"true":case"TRUE":eo=!0;break;case"false":case"FALSE":eo=!1;break;default:ey.exec(eo)&&(eo=parseInt(eo))}es.setOption("default",eo)}return packableDescriptorType($.type)&&("proto3"===et?$.options&&!$.options.packed&&es.setOption("packed",!1):$.options&&$.options.packed||es.setOption("packed",!1)),es},eu.prototype.toDescriptor=function($){var et=ee.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)et.type=11,et.typeName=er.util.ucFirst(this.name),et.label=3;else{switch(et.type=toDescriptorType(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:et.typeName=this.resolvedType?shortname(this.parent,this.resolvedType):this.type}switch(this.rule){case"repeated":et.label=3;break;case"required":et.label=2;break;default:et.label=1}}if(et.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(et.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(et.options=toDescriptorOptions(this.options,ee.FieldOptions),null!=this.options.default&&(et.defaultValue=String(this.options.default))),"proto3"===$?this.packed||((et.options||(et.options=ee.FieldOptions.create())).packed=!1):this.packed&&((et.options||(et.options=ee.FieldOptions.create())).packed=!0),et};var ev=0;es.fromDescriptor=function($){"number"==typeof $.length&&($=ee.EnumDescriptorProto.decode($));var et={};if($.value)for(var er=0;er<$.value.length;++er){var en=$.value[er].name,ei=$.value[er].number||0;et[en&&en.length?en:"NAME"+ei]=ei}return new es($.name&&$.name.length?$.name:"Enum"+ev++,et,fromDescriptorOptions($.options,ee.EnumOptions))},es.prototype.toDescriptor=function(){for(var $=[],et=0,er=Object.keys(this.values);et<er.length;++et)$.push(ee.EnumValueDescriptorProto.create({name:er[et],number:this.values[er[et]]}));return ee.EnumDescriptorProto.create({name:this.name,value:$,options:toDescriptorOptions(this.options,ee.EnumOptions)})};var eS=0;ep.fromDescriptor=function($){return"number"==typeof $.length&&($=ee.OneofDescriptorProto.decode($)),new ep($.name&&$.name.length?$.name:"oneof"+eS++)},ep.prototype.toDescriptor=function(){return ee.OneofDescriptorProto.create({name:this.name})};var eC=0;ef.fromDescriptor=function($){"number"==typeof $.length&&($=ee.ServiceDescriptorProto.decode($));var et=new ef($.name&&$.name.length?$.name:"Service"+eC++,fromDescriptorOptions($.options,ee.ServiceOptions));if($.method)for(var er=0;er<$.method.length;++er)et.add(em.fromDescriptor($.method[er]));return et},ef.prototype.toDescriptor=function(){for(var $=[],et=0;et<this.methodsArray.length;++et)$.push(this._methodsArray[et].toDescriptor());return ee.ServiceDescriptorProto.create({name:this.name,method:$,options:toDescriptorOptions(this.options,ee.ServiceOptions)})};var eT=0;function fromDescriptorType($){switch($){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+$)}function packableDescriptorType($){switch($){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function toDescriptorType($,ee){switch($){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(ee instanceof es)return 14;if(ee instanceof eo)return ee.group?10:11;throw Error("illegal type: "+$)}function fromDescriptorOptions($,ee){if($){for(var et,en,ei,eo=[],eu=0;eu<ee.fieldsArray.length;++eu)"uninterpretedOption"!==(en=(et=ee._fieldsArray[eu]).name)&&$.hasOwnProperty(en)&&(ei=$[en],et.resolvedType instanceof es&&"number"==typeof ei&&void 0!==et.resolvedType.valuesById[ei]&&(ei=et.resolvedType.valuesById[ei]),eo.push(underScore(en),ei));return eo.length?er.util.toObject(eo):void 0}}function toDescriptorOptions($,ee){if($){for(var et,en,ei=[],es=0,eo=Object.keys($);es<eo.length;++es)if(en=$[et=eo[es]],"default"!==et){var eu=ee.fields[et];(eu||(eu=ee.fields[et=er.util.camelCase(et)]))&&ei.push(et,en)}return ei.length?ee.fromObject(er.util.toObject(ei)):void 0}}function shortname($,ee){var et=$.fullName.split("."),er=ee.fullName.split("."),es=0,eo=0,eu=er.length-1;if(!($ instanceof ei)&&ee instanceof en)for(;es<et.length&&eo<eu&&et[es]===er[eo];){var eh=ee.lookup(et[es++],!0);if(null!==eh&&eh!==ee)break;++eo}else for(;es<et.length&&eo<eu&&et[es]===er[eo];++es,++eo);return er.slice(eo).join(".")}function underScore($){return $.substring(0,1)+$.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function($,ee){return"_"+ee.toLowerCase()})}em.fromDescriptor=function($){return"number"==typeof $.length&&($=ee.MethodDescriptorProto.decode($)),new em($.name&&$.name.length?$.name:"Method"+eT++,"rpc",$.inputType,$.outputType,!!$.clientStreaming,!!$.serverStreaming,fromDescriptorOptions($.options,ee.MethodOptions))},em.prototype.toDescriptor=function(){return ee.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:toDescriptorOptions(this.options,ee.MethodOptions)})}},75962:($,ee,et)=>{"use strict";$.exports=et(23517)},79760:$=>{"use strict";$.exports=common;var ee,et=/\/|\./;function common($,ee){et.test($)||($="google/protobuf/"+$+".proto",ee={nested:{google:{nested:{protobuf:{nested:ee}}}}}),common[$]=ee}common("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),common("duration",{Duration:ee={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),common("timestamp",{Timestamp:ee}),common("empty",{Empty:{fields:{}}}),common("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),common("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),common("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),common.get=function($){return common[$]||null}},84144:($,ee,et)=>{"use strict";var er=ee,en=et(59246),ei=et(66738);function genValuePartial_fromObject($,ee,et,er){var ei=!1;if(ee.resolvedType){if(ee.resolvedType instanceof en){$("switch(d%s){",er);for(var es=ee.resolvedType.values,eo=Object.keys(es),eu=0;eu<eo.length;++eu)es[eo[eu]]!==ee.typeDefault||ei||($("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',er,er,er),ee.repeated||$("break"),ei=!0),$("case%j:",eo[eu])("case %i:",es[eo[eu]])("m%s=%j",er,es[eo[eu]])("break");$("}")}else $('if(typeof d%s!=="object")',er)("throw TypeError(%j)",ee.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",er,et,er)}else{var eh=!1;switch(ee.type){case"double":case"float":$("m%s=Number(d%s)",er,er);break;case"uint32":case"fixed32":$("m%s=d%s>>>0",er,er);break;case"int32":case"sint32":case"sfixed32":$("m%s=d%s|0",er,er);break;case"uint64":eh=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":$("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",er,er,eh)('else if(typeof d%s==="string")',er)("m%s=parseInt(d%s,10)",er,er)('else if(typeof d%s==="number")',er)("m%s=d%s",er,er)('else if(typeof d%s==="object")',er)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",er,er,er,eh?"true":"");break;case"bytes":$('if(typeof d%s==="string")',er)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",er,er,er)("else if(d%s.length >= 0)",er)("m%s=d%s",er,er);break;case"string":$("m%s=String(d%s)",er,er);break;case"bool":$("m%s=Boolean(d%s)",er,er)}}return $}function genValuePartial_toObject($,ee,et,er){if(ee.resolvedType)ee.resolvedType instanceof en?$("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",er,et,er,er,et,er,er):$("d%s=types[%i].toObject(m%s,o)",er,et,er);else{var ei=!1;switch(ee.type){case"double":case"float":$("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",er,er,er,er);break;case"uint64":ei=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":$('if(typeof m%s==="number")',er)("d%s=o.longs===String?String(m%s):m%s",er,er,er)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",er,er,er,er,ei?"true":"",er);break;case"bytes":$("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",er,er,er,er,er);break;default:$("d%s=m%s",er,er)}}return $}er.fromObject=function($){var ee=$.fieldsArray,et=ei.codegen(["d"],$.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!ee.length)return et("return new this.ctor");et("var m=new this.ctor");for(var er=0;er<ee.length;++er){var es=ee[er].resolve(),eo=ei.safeProp(es.name);es.map?(et("if(d%s){",eo)('if(typeof d%s!=="object")',eo)("throw TypeError(%j)",es.fullName+": object expected")("m%s={}",eo)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",eo),genValuePartial_fromObject(et,es,er,eo+"[ks[i]]")("}")("}")):es.repeated?(et("if(d%s){",eo)("if(!Array.isArray(d%s))",eo)("throw TypeError(%j)",es.fullName+": array expected")("m%s=[]",eo)("for(var i=0;i<d%s.length;++i){",eo),genValuePartial_fromObject(et,es,er,eo+"[i]")("}")("}")):(es.resolvedType instanceof en||et("if(d%s!=null){",eo),genValuePartial_fromObject(et,es,er,eo),es.resolvedType instanceof en||et("}"))}return et("return m")},er.toObject=function($){var ee=$.fieldsArray.slice().sort(ei.compareFieldsById);if(!ee.length)return ei.codegen()("return {}");for(var et=ei.codegen(["m","o"],$.name+"$toObject")("if(!o)")("o={}")("var d={}"),er=[],es=[],eo=[],eu=0;eu<ee.length;++eu)ee[eu].partOf||(ee[eu].resolve().repeated?er:ee[eu].map?es:eo).push(ee[eu]);if(er.length){for(et("if(o.arrays||o.defaults){"),eu=0;eu<er.length;++eu)et("d%s=[]",ei.safeProp(er[eu].name));et("}")}if(es.length){for(et("if(o.objects||o.defaults){"),eu=0;eu<es.length;++eu)et("d%s={}",ei.safeProp(es[eu].name));et("}")}if(eo.length){for(et("if(o.defaults){"),eu=0;eu<eo.length;++eu){var eh=eo[eu],ep=ei.safeProp(eh.name);if(eh.resolvedType instanceof en)et("d%s=o.enums===String?%j:%j",ep,eh.resolvedType.valuesById[eh.typeDefault],eh.typeDefault);else if(eh.long)et("if(util.Long){")("var n=new util.Long(%i,%i,%j)",eh.typeDefault.low,eh.typeDefault.high,eh.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",ep)("}else")("d%s=o.longs===String?%j:%i",ep,eh.typeDefault.toString(),eh.typeDefault.toNumber());else if(eh.bytes){var ef="["+Array.prototype.slice.call(eh.typeDefault).join(",")+"]";et("if(o.bytes===String)d%s=%j",ep,String.fromCharCode.apply(String,eh.typeDefault))("else{")("d%s=%s",ep,ef)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",ep,ep)("}")}else et("d%s=%j",ep,eh.typeDefault)}et("}")}var em=!1;for(eu=0;eu<ee.length;++eu){var eh=ee[eu],eg=$._fieldsArray.indexOf(eh),ep=ei.safeProp(eh.name);eh.map?(em||(em=!0,et("var ks2")),et("if(m%s&&(ks2=Object.keys(m%s)).length){",ep,ep)("d%s={}",ep)("for(var j=0;j<ks2.length;++j){"),genValuePartial_toObject(et,eh,eg,ep+"[ks2[j]]")("}")):eh.repeated?(et("if(m%s&&m%s.length){",ep,ep)("d%s=[]",ep)("for(var j=0;j<m%s.length;++j){",ep),genValuePartial_toObject(et,eh,eg,ep+"[j]")("}")):(et("if(m%s!=null&&m.hasOwnProperty(%j)){",ep,eh.name),genValuePartial_toObject(et,eh,eg,ep),eh.partOf&&et("if(o.oneofs)")("d%s=%j",ei.safeProp(eh.partOf.name),eh.name)),et("}")}return et("return d")}},87317:($,ee,et)=>{"use strict";$.exports=decoder;var er=et(59246),en=et(91708),ei=et(66738);function missing($){return"missing required '"+$.name+"'"}function decoder($){var ee=ei.codegen(["r","l"],$.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+($.fieldsArray.filter(function($){return $.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");$.group&&ee("if((t&7)===4)")("break"),ee("switch(t>>>3){");for(var et=0;et<$.fieldsArray.length;++et){var es=$._fieldsArray[et].resolve(),eo=es.resolvedType instanceof er?"int32":es.type,eu="m"+ei.safeProp(es.name);ee("case %i: {",es.id),es.map?(ee("if(%s===util.emptyObject)",eu)("%s={}",eu)("var c2 = r.uint32()+r.pos"),void 0!==en.defaults[es.keyType]?ee("k=%j",en.defaults[es.keyType]):ee("k=null"),void 0!==en.defaults[eo]?ee("value=%j",en.defaults[eo]):ee("value=null"),ee("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",es.keyType)("case 2:"),void 0===en.basic[eo]?ee("value=types[%i].decode(r,r.uint32())",et):ee("value=r.%s()",eo),ee("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),ee(void 0!==en.long[es.keyType]?'%s[typeof k==="object"?util.longToHash(k):k]=value':"%s[k]=value",eu)):es.repeated?(ee("if(!(%s&&%s.length))",eu,eu)("%s=[]",eu),void 0!==en.packed[eo]&&ee("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",eu,eo)("}else"),void 0===en.basic[eo]?ee(es.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",eu,et):ee("%s.push(r.%s())",eu,eo)):void 0===en.basic[eo]?ee(es.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",eu,et):ee("%s=r.%s()",eu,eo),ee("break")("}")}for(ee("default:")("r.skipType(t&7)")("break")("}")("}"),et=0;et<$._fieldsArray.length;++et){var eh=$._fieldsArray[et];eh.required&&ee("if(!m.hasOwnProperty(%j))",eh.name)("throw util.ProtocolError(%j,{instance:m})",missing(eh))}return ee("return m")}},49561:($,ee,et)=>{"use strict";$.exports=encoder;var er=et(59246),en=et(91708),ei=et(66738);function genTypePartial($,ee,et,er){return ee.resolvedType.group?$("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",et,er,(ee.id<<3|3)>>>0,(ee.id<<3|4)>>>0):$("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",et,er,(ee.id<<3|2)>>>0)}function encoder($){for(var ee,et,es=ei.codegen(["m","w"],$.name+"$encode")("if(!w)")("w=Writer.create()"),eo=$.fieldsArray.slice().sort(ei.compareFieldsById),ee=0;ee<eo.length;++ee){var eu=eo[ee].resolve(),eh=$._fieldsArray.indexOf(eu),ep=eu.resolvedType instanceof er?"int32":eu.type,ef=en.basic[ep];et="m"+ei.safeProp(eu.name),eu.map?(es("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",et,eu.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",et)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(eu.id<<3|2)>>>0,8|en.mapKey[eu.keyType],eu.keyType),void 0===ef?es("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",eh,et):es(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|ef,ep,et),es("}")("}")):eu.repeated?(es("if(%s!=null&&%s.length){",et,et),eu.packed&&void 0!==en.packed[ep]?es("w.uint32(%i).fork()",(eu.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",et)("w.%s(%s[i])",ep,et)("w.ldelim()"):(es("for(var i=0;i<%s.length;++i)",et),void 0===ef?genTypePartial(es,eu,eh,et+"[i]"):es("w.uint32(%i).%s(%s[i])",(eu.id<<3|ef)>>>0,ep,et)),es("}")):(eu.optional&&es("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",et,eu.name),void 0===ef?genTypePartial(es,eu,eh,et):es("w.uint32(%i).%s(%s)",(eu.id<<3|ef)>>>0,ep,et))}return es("return w")}},59246:($,ee,et)=>{"use strict";$.exports=Enum;var er=et(61862);((Enum.prototype=Object.create(er.prototype)).constructor=Enum).className="Enum";var en=et(97540),ei=et(66738);function Enum($,ee,et,en,ei,es){if(er.call(this,$,et),ee&&"object"!=typeof ee)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=en,this.comments=ei||{},this.valuesOptions=es,this.reserved=void 0,ee)for(var eo=Object.keys(ee),eu=0;eu<eo.length;++eu)"number"==typeof ee[eo[eu]]&&(this.valuesById[this.values[eo[eu]]=ee[eo[eu]]]=eo[eu])}Enum.fromJSON=function($,ee){var et=new Enum($,ee.values,ee.options,ee.comment,ee.comments);return et.reserved=ee.reserved,et},Enum.prototype.toJSON=function($){var ee=!!$&&!!$.keepComments;return ei.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",ee?this.comment:void 0,"comments",ee?this.comments:void 0])},Enum.prototype.add=function($,ee,et,er){if(!ei.isString($))throw TypeError("name must be a string");if(!ei.isInteger(ee))throw TypeError("id must be an integer");if(void 0!==this.values[$])throw Error("duplicate name '"+$+"' in "+this);if(this.isReservedId(ee))throw Error("id "+ee+" is reserved in "+this);if(this.isReservedName($))throw Error("name '"+$+"' is reserved in "+this);if(void 0!==this.valuesById[ee]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+ee+" in "+this);this.values[$]=ee}else this.valuesById[this.values[$]=ee]=$;return er&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[$]=er||null),this.comments[$]=et||null,this},Enum.prototype.remove=function($){if(!ei.isString($))throw TypeError("name must be a string");var ee=this.values[$];if(null==ee)throw Error("name '"+$+"' does not exist in "+this);return delete this.valuesById[ee],delete this.values[$],delete this.comments[$],this.valuesOptions&&delete this.valuesOptions[$],this},Enum.prototype.isReservedId=function($){return en.isReservedId(this.reserved,$)},Enum.prototype.isReservedName=function($){return en.isReservedName(this.reserved,$)}},23980:($,ee,et)=>{"use strict";$.exports=Field;var er,en=et(61862);((Field.prototype=Object.create(en.prototype)).constructor=Field).className="Field";var ei=et(59246),es=et(91708),eo=et(66738),eu=/^required|optional|repeated$/;function Field($,ee,et,er,ei,eh,ep){if(eo.isObject(er)?(ep=ei,eh=er,er=ei=void 0):eo.isObject(ei)&&(ep=eh,eh=ei,ei=void 0),en.call(this,$,eh),!eo.isInteger(ee)||ee<0)throw TypeError("id must be a non-negative integer");if(!eo.isString(et))throw TypeError("type must be a string");if(void 0!==er&&!eu.test(er=er.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==ei&&!eo.isString(ei))throw TypeError("extend must be a string");"proto3_optional"===er&&(er="optional"),this.rule=er&&"optional"!==er?er:void 0,this.type=et,this.id=ee,this.extend=ei||void 0,this.required="required"===er,this.optional=!this.required,this.repeated="repeated"===er,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!eo.Long&&void 0!==es.long[et],this.bytes="bytes"===et,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=ep}Field.fromJSON=function($,ee){return new Field($,ee.id,ee.type,ee.rule,ee.extend,ee.options,ee.comment)},Object.defineProperty(Field.prototype,"packed",{get:function(){return null===this._packed&&(this._packed=!1!==this.getOption("packed")),this._packed}}),Field.prototype.setOption=function($,ee,et){return"packed"===$&&(this._packed=null),en.prototype.setOption.call(this,$,ee,et)},Field.prototype.toJSON=function($){var ee=!!$&&!!$.keepComments;return eo.toObject(["rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",ee?this.comment:void 0])},Field.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=es.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof er?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof ei&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(!0!==this.options.packed&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof ei)||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=eo.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var $;eo.base64.test(this.typeDefault)?eo.base64.decode(this.typeDefault,$=eo.newBuffer(eo.base64.length(this.typeDefault)),0):eo.utf8.write(this.typeDefault,$=eo.newBuffer(eo.utf8.length(this.typeDefault)),0),this.typeDefault=$}return this.map?this.defaultValue=eo.emptyObject:this.repeated?this.defaultValue=eo.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof er&&(this.parent.ctor.prototype[this.name]=this.defaultValue),en.prototype.resolve.call(this)},Field.d=function($,ee,et,er){return"function"==typeof ee?ee=eo.decorateType(ee).name:ee&&"object"==typeof ee&&(ee=eo.decorateEnum(ee).name),function(en,ei){eo.decorateType(en.constructor).add(new Field(ei,$,ee,et,{default:er}))}},Field._configure=function($){er=$}},88226:($,ee,et)=>{"use strict";var er=$.exports=et(82985);function load($,ee,et){return"function"==typeof ee?(et=ee,ee=new er.Root):ee||(ee=new er.Root),ee.load($,et)}function loadSync($,ee){return ee||(ee=new er.Root),ee.loadSync($)}er.build="light",er.load=load,er.loadSync=loadSync,er.encoder=et(49561),er.decoder=et(87317),er.verifier=et(17585),er.converter=et(84144),er.ReflectionObject=et(61862),er.Namespace=et(97540),er.Root=et(98373),er.Enum=et(59246),er.Type=et(59340),er.Field=et(23980),er.OneOf=et(32866),er.MapField=et(67597),er.Service=et(82791),er.Method=et(28909),er.Message=et(34294),er.wrappers=et(34038),er.types=et(91708),er.util=et(66738),er.ReflectionObject._configure(er.Root),er.Namespace._configure(er.Type,er.Service,er.Enum),er.Root._configure(er.Type),er.Field._configure(er.Type)},82985:($,ee,et)=>{"use strict";var er=ee;function configure(){er.util._configure(),er.Writer._configure(er.BufferWriter),er.Reader._configure(er.BufferReader)}er.build="minimal",er.Writer=et(84353),er.BufferWriter=et(81978),er.Reader=et(95199),er.BufferReader=et(15213),er.util=et(18932),er.rpc=et(69226),er.roots=et(10182),er.configure=configure,configure()},23517:($,ee,et)=>{"use strict";var er=$.exports=et(88226);er.build="full",er.tokenize=et(86116),er.parse=et(87897),er.common=et(79760),er.Root._configure(er.Type,er.parse,er.common)},67597:($,ee,et)=>{"use strict";$.exports=MapField;var er=et(23980);((MapField.prototype=Object.create(er.prototype)).constructor=MapField).className="MapField";var en=et(91708),ei=et(66738);function MapField($,ee,et,en,es,eo){if(er.call(this,$,ee,en,void 0,void 0,es,eo),!ei.isString(et))throw TypeError("keyType must be a string");this.keyType=et,this.resolvedKeyType=null,this.map=!0}MapField.fromJSON=function($,ee){return new MapField($,ee.id,ee.keyType,ee.type,ee.options,ee.comment)},MapField.prototype.toJSON=function($){var ee=!!$&&!!$.keepComments;return ei.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",ee?this.comment:void 0])},MapField.prototype.resolve=function(){if(this.resolved)return this;if(void 0===en.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return er.prototype.resolve.call(this)},MapField.d=function($,ee,et){return"function"==typeof et?et=ei.decorateType(et).name:et&&"object"==typeof et&&(et=ei.decorateEnum(et).name),function(er,en){ei.decorateType(er.constructor).add(new MapField(en,$,ee,et))}}},34294:($,ee,et)=>{"use strict";$.exports=Message;var er=et(18932);function Message($){if($)for(var ee=Object.keys($),et=0;et<ee.length;++et)this[ee[et]]=$[ee[et]]}Message.create=function($){return this.$type.create($)},Message.encode=function($,ee){return this.$type.encode($,ee)},Message.encodeDelimited=function($,ee){return this.$type.encodeDelimited($,ee)},Message.decode=function($){return this.$type.decode($)},Message.decodeDelimited=function($){return this.$type.decodeDelimited($)},Message.verify=function($){return this.$type.verify($)},Message.fromObject=function($){return this.$type.fromObject($)},Message.toObject=function($,ee){return this.$type.toObject($,ee)},Message.prototype.toJSON=function(){return this.$type.toObject(this,er.toJSONOptions)}},28909:($,ee,et)=>{"use strict";$.exports=Method;var er=et(61862);((Method.prototype=Object.create(er.prototype)).constructor=Method).className="Method";var en=et(66738);function Method($,ee,et,ei,es,eo,eu,eh,ep){if(en.isObject(es)?(eu=es,es=eo=void 0):en.isObject(eo)&&(eu=eo,eo=void 0),!(void 0===ee||en.isString(ee)))throw TypeError("type must be a string");if(!en.isString(et))throw TypeError("requestType must be a string");if(!en.isString(ei))throw TypeError("responseType must be a string");er.call(this,$,eu),this.type=ee||"rpc",this.requestType=et,this.requestStream=!!es||void 0,this.responseType=ei,this.responseStream=!!eo||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=eh,this.parsedOptions=ep}Method.fromJSON=function($,ee){return new Method($,ee.type,ee.requestType,ee.responseType,ee.requestStream,ee.responseStream,ee.options,ee.comment,ee.parsedOptions)},Method.prototype.toJSON=function($){var ee=!!$&&!!$.keepComments;return en.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",ee?this.comment:void 0,"parsedOptions",this.parsedOptions])},Method.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),er.prototype.resolve.call(this))}},97540:($,ee,et)=>{"use strict";$.exports=Namespace;var er,en,ei,es=et(61862);((Namespace.prototype=Object.create(es.prototype)).constructor=Namespace).className="Namespace";var eo=et(23980),eu=et(66738),eh=et(32866);function arrayToJSON($,ee){if($&&$.length){for(var et={},er=0;er<$.length;++er)et[$[er].name]=$[er].toJSON(ee);return et}}function Namespace($,ee){es.call(this,$,ee),this.nested=void 0,this._nestedArray=null}function clearCache($){return $._nestedArray=null,$}Namespace.fromJSON=function($,ee){return new Namespace($,ee.options).addJSON(ee.nested)},Namespace.arrayToJSON=arrayToJSON,Namespace.isReservedId=function($,ee){if($){for(var et=0;et<$.length;++et)if("string"!=typeof $[et]&&$[et][0]<=ee&&$[et][1]>ee)return!0}return!1},Namespace.isReservedName=function($,ee){if($){for(var et=0;et<$.length;++et)if($[et]===ee)return!0}return!1},Object.defineProperty(Namespace.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=eu.toArray(this.nested))}}),Namespace.prototype.toJSON=function($){return eu.toObject(["options",this.options,"nested",arrayToJSON(this.nestedArray,$)])},Namespace.prototype.addJSON=function($){var ee=this;if($)for(var et,es=Object.keys($),eu=0;eu<es.length;++eu)et=$[es[eu]],ee.add((void 0!==et.fields?er.fromJSON:void 0!==et.values?ei.fromJSON:void 0!==et.methods?en.fromJSON:void 0!==et.id?eo.fromJSON:Namespace.fromJSON)(es[eu],et));return this},Namespace.prototype.get=function($){return this.nested&&this.nested[$]||null},Namespace.prototype.getEnum=function($){if(this.nested&&this.nested[$]instanceof ei)return this.nested[$].values;throw Error("no such enum: "+$)},Namespace.prototype.add=function($){if(!($ instanceof eo&&void 0!==$.extend||$ instanceof er||$ instanceof eh||$ instanceof ei||$ instanceof en||$ instanceof Namespace))throw TypeError("object must be a valid nested object");if(this.nested){var ee=this.get($.name);if(ee){if(ee instanceof Namespace&&$ instanceof Namespace&&!(ee instanceof er||ee instanceof en)){for(var et=ee.nestedArray,es=0;es<et.length;++es)$.add(et[es]);this.remove(ee),this.nested||(this.nested={}),$.setOptions(ee.options,!0)}else throw Error("duplicate name '"+$.name+"' in "+this)}}else this.nested={};return this.nested[$.name]=$,$.onAdd(this),clearCache(this)},Namespace.prototype.remove=function($){if(!($ instanceof es))throw TypeError("object must be a ReflectionObject");if($.parent!==this)throw Error($+" is not a member of "+this);return delete this.nested[$.name],Object.keys(this.nested).length||(this.nested=void 0),$.onRemove(this),clearCache(this)},Namespace.prototype.define=function($,ee){if(eu.isString($))$=$.split(".");else if(!Array.isArray($))throw TypeError("illegal path");if($&&$.length&&""===$[0])throw Error("path must be relative");for(var et=this;$.length>0;){var er=$.shift();if(et.nested&&et.nested[er]){if(!((et=et.nested[er])instanceof Namespace))throw Error("path conflicts with non-namespace objects")}else et.add(et=new Namespace(er))}return ee&&et.addJSON(ee),et},Namespace.prototype.resolveAll=function(){for(var $=this.nestedArray,ee=0;ee<$.length;)$[ee]instanceof Namespace?$[ee++].resolveAll():$[ee++].resolve();return this.resolve()},Namespace.prototype.lookup=function($,ee,et){if("boolean"==typeof ee?(et=ee,ee=void 0):ee&&!Array.isArray(ee)&&(ee=[ee]),eu.isString($)&&$.length){if("."===$)return this.root;$=$.split(".")}else if(!$.length)return this;if(""===$[0])return this.root.lookup($.slice(1),ee);var er=this.get($[0]);if(er){if(1===$.length){if(!ee||ee.indexOf(er.constructor)>-1)return er}else if(er instanceof Namespace&&(er=er.lookup($.slice(1),ee,!0)))return er}else for(var en=0;en<this.nestedArray.length;++en)if(this._nestedArray[en]instanceof Namespace&&(er=this._nestedArray[en].lookup($,ee,!0)))return er;return null===this.parent||et?null:this.parent.lookup($,ee)},Namespace.prototype.lookupType=function($){var ee=this.lookup($,[er]);if(!ee)throw Error("no such type: "+$);return ee},Namespace.prototype.lookupEnum=function($){var ee=this.lookup($,[ei]);if(!ee)throw Error("no such Enum '"+$+"' in "+this);return ee},Namespace.prototype.lookupTypeOrEnum=function($){var ee=this.lookup($,[er,ei]);if(!ee)throw Error("no such Type or Enum '"+$+"' in "+this);return ee},Namespace.prototype.lookupService=function($){var ee=this.lookup($,[en]);if(!ee)throw Error("no such Service '"+$+"' in "+this);return ee},Namespace._configure=function($,ee,et){er=$,en=ee,ei=et}},61862:($,ee,et)=>{"use strict";$.exports=ReflectionObject,ReflectionObject.className="ReflectionObject";var er,en=et(66738);function ReflectionObject($,ee){if(!en.isString($))throw TypeError("name must be a string");if(ee&&!en.isObject(ee))throw TypeError("options must be an object");this.options=ee,this.parsedOptions=null,this.name=$,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(ReflectionObject.prototype,{root:{get:function(){for(var $=this;null!==$.parent;)$=$.parent;return $}},fullName:{get:function(){for(var $=[this.name],ee=this.parent;ee;)$.unshift(ee.name),ee=ee.parent;return $.join(".")}}}),ReflectionObject.prototype.toJSON=function(){throw Error()},ReflectionObject.prototype.onAdd=function($){this.parent&&this.parent!==$&&this.parent.remove(this),this.parent=$,this.resolved=!1;var ee=$.root;ee instanceof er&&ee._handleAdd(this)},ReflectionObject.prototype.onRemove=function($){var ee=$.root;ee instanceof er&&ee._handleRemove(this),this.parent=null,this.resolved=!1},ReflectionObject.prototype.resolve=function(){return this.resolved||this.root instanceof er&&(this.resolved=!0),this},ReflectionObject.prototype.getOption=function($){if(this.options)return this.options[$]},ReflectionObject.prototype.setOption=function($,ee,et){return et&&this.options&&void 0!==this.options[$]||((this.options||(this.options={}))[$]=ee),this},ReflectionObject.prototype.setParsedOption=function($,ee,et){this.parsedOptions||(this.parsedOptions=[]);var er=this.parsedOptions;if(et){var ei=er.find(function(ee){return Object.prototype.hasOwnProperty.call(ee,$)});if(ei){var es=ei[$];en.setProperty(es,et,ee)}else(ei={})[$]=en.setProperty({},et,ee),er.push(ei)}else{var eo={};eo[$]=ee,er.push(eo)}return this},ReflectionObject.prototype.setOptions=function($,ee){if($)for(var et=Object.keys($),er=0;er<et.length;++er)this.setOption(et[er],$[et[er]],ee);return this},ReflectionObject.prototype.toString=function(){var $=this.constructor.className,ee=this.fullName;return ee.length?$+" "+ee:$},ReflectionObject._configure=function($){er=$}},32866:($,ee,et)=>{"use strict";$.exports=OneOf;var er=et(61862);((OneOf.prototype=Object.create(er.prototype)).constructor=OneOf).className="OneOf";var en=et(23980),ei=et(66738);function OneOf($,ee,et,en){if(Array.isArray(ee)||(et=ee,ee=void 0),er.call(this,$,et),!(void 0===ee||Array.isArray(ee)))throw TypeError("fieldNames must be an Array");this.oneof=ee||[],this.fieldsArray=[],this.comment=en}function addFieldsToParent($){if($.parent)for(var ee=0;ee<$.fieldsArray.length;++ee)$.fieldsArray[ee].parent||$.parent.add($.fieldsArray[ee])}OneOf.fromJSON=function($,ee){return new OneOf($,ee.oneof,ee.options,ee.comment)},OneOf.prototype.toJSON=function($){var ee=!!$&&!!$.keepComments;return ei.toObject(["options",this.options,"oneof",this.oneof,"comment",ee?this.comment:void 0])},OneOf.prototype.add=function($){if(!($ instanceof en))throw TypeError("field must be a Field");return $.parent&&$.parent!==this.parent&&$.parent.remove($),this.oneof.push($.name),this.fieldsArray.push($),$.partOf=this,addFieldsToParent(this),this},OneOf.prototype.remove=function($){if(!($ instanceof en))throw TypeError("field must be a Field");var ee=this.fieldsArray.indexOf($);if(ee<0)throw Error($+" is not a member of "+this);return this.fieldsArray.splice(ee,1),(ee=this.oneof.indexOf($.name))>-1&&this.oneof.splice(ee,1),$.partOf=null,this},OneOf.prototype.onAdd=function($){er.prototype.onAdd.call(this,$);for(var ee=this,et=0;et<this.oneof.length;++et){var en=$.get(this.oneof[et]);en&&!en.partOf&&(en.partOf=ee,ee.fieldsArray.push(en))}addFieldsToParent(this)},OneOf.prototype.onRemove=function($){for(var ee,et=0;et<this.fieldsArray.length;++et)(ee=this.fieldsArray[et]).parent&&ee.parent.remove(ee);er.prototype.onRemove.call(this,$)},OneOf.d=function(){for(var $=Array(arguments.length),ee=0;ee<arguments.length;)$[ee]=arguments[ee++];return function(ee,et){ei.decorateType(ee.constructor).add(new OneOf(et,$)),Object.defineProperty(ee,et,{get:ei.oneOfGetter($),set:ei.oneOfSetter($)})}}},87897:($,ee,et)=>{"use strict";$.exports=parse,parse.filename=null,parse.defaults={keepCase:!1};var er=et(86116),en=et(98373),ei=et(59340),es=et(23980),eo=et(67597),eu=et(32866),eh=et(59246),ep=et(82791),ef=et(28909),em=et(91708),eg=et(66738),ey=/^[1-9][0-9]*$/,ev=/^-?[1-9][0-9]*$/,eS=/^0[x][0-9a-fA-F]+$/,eC=/^-?0[x][0-9a-fA-F]+$/,eT=/^0[0-7]+$/,eE=/^-?0[0-7]+$/,ew=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,eD=/^[a-zA-Z_][a-zA-Z_0-9]*$/,eI=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,eR=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function parse($,ee,et){ee instanceof en||(et=ee,ee=new en),et||(et=parse.defaults);var e_,eP,eA,ex,eO,ek=et.preferTrailingComment||!1,eN=er($,et.alternateCommentMode||!1),eM=eN.next,eF=eN.push,eL=eN.peek,eB=eN.skip,eV=eN.cmnt,ej=!0,eU=!1,eq=ee,ez=et.keepCase?function($){return $}:eg.camelCase;function illegal($,ee,et){var er=parse.filename;return et||(parse.filename=null),Error("illegal "+(ee||"token")+" '"+$+"' ("+(er?er+", ":"")+"line "+eN.line+")")}function readString(){var $,ee=[];do{if('"'!==($=eM())&&"'"!==$)throw illegal($);ee.push(eM()),eB($),$=eL()}while('"'===$||"'"===$);return ee.join("")}function readValue($){var ee=eM();switch(ee){case"'":case'"':return eF(ee),readString();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return parseNumber(ee,!0)}catch(et){if($&&eI.test(ee))return ee;throw illegal(ee,"value")}}function readRanges($,ee){var et,er;do ee&&('"'===(et=eL())||"'"===et)?$.push(readString()):$.push([er=parseId(eM()),eB("to",!0)?parseId(eM()):er]);while(eB(",",!0));eB(";")}function parseNumber($,ee){var et=1;switch("-"===$.charAt(0)&&(et=-1,$=$.substring(1)),$){case"inf":case"INF":case"Inf":return et*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(ey.test($))return et*parseInt($,10);if(eS.test($))return et*parseInt($,16);if(eT.test($))return et*parseInt($,8);if(ew.test($))return et*parseFloat($);throw illegal($,"number",ee)}function parseId($,ee){switch($){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!ee&&"-"===$.charAt(0))throw illegal($,"id");if(ev.test($))return parseInt($,10);if(eC.test($))return parseInt($,16);if(eE.test($))return parseInt($,8);throw illegal($,"id")}function parsePackage(){if(void 0!==eP)throw illegal("package");if(eP=eM(),!eI.test(eP))throw illegal(eP,"name");eq=eq.define(eP),eB(";")}function parseImport(){var $,ee=eL();switch(ee){case"weak":$=ex||(ex=[]),eM();break;case"public":eM();default:$=eA||(eA=[])}ee=readString(),eB(";"),$.push(ee)}function parseSyntax(){if(eB("="),!(eU="proto3"===(eO=readString()))&&"proto2"!==eO)throw illegal(eO,"syntax");eB(";")}function parseCommon($,ee){switch(ee){case"option":return parseOption($,ee),eB(";"),!0;case"message":return parseType($,ee),!0;case"enum":return parseEnum($,ee),!0;case"service":return parseService($,ee),!0;case"extend":return parseExtension($,ee),!0}return!1}function ifBlock($,ee,et){var er,en=eN.line;if($&&("string"!=typeof $.comment&&($.comment=eV()),$.filename=parse.filename),eB("{",!0)){for(;"}"!==(er=eM());)ee(er);eB(";",!0)}else et&&et(),eB(";"),$&&("string"!=typeof $.comment||ek)&&($.comment=eV(en)||$.comment)}function parseType($,ee){if(!eD.test(ee=eM()))throw illegal(ee,"type name");var et=new ei(ee);ifBlock(et,function($){if(!parseCommon(et,$))switch($){case"map":parseMapField(et,$);break;case"required":case"repeated":parseField(et,$);break;case"optional":eU?parseField(et,"proto3_optional"):parseField(et,"optional");break;case"oneof":parseOneOf(et,$);break;case"extensions":readRanges(et.extensions||(et.extensions=[]));break;case"reserved":readRanges(et.reserved||(et.reserved=[]),!0);break;default:if(!eU||!eI.test($))throw illegal($);eF($),parseField(et,"optional")}}),$.add(et)}function parseField($,ee,et){var er=eM();if("group"===er){parseGroup($,ee);return}for(;er.endsWith(".")||eL().startsWith(".");)er+=eM();if(!eI.test(er))throw illegal(er,"type");var en=eM();if(!eD.test(en))throw illegal(en,"name");en=ez(en),eB("=");var ei=new es(en,parseId(eM()),er,ee,et);if(ifBlock(ei,function($){if("option"===$)parseOption(ei,$),eB(";");else throw illegal($)},function(){parseInlineOptions(ei)}),"proto3_optional"===ee){var eo=new eu("_"+en);ei.setOption("proto3_optional",!0),eo.add(ei),$.add(eo)}else $.add(ei);!eU&&ei.repeated&&(void 0!==em.packed[er]||void 0===em.basic[er])&&ei.setOption("packed",!1,!0)}function parseGroup($,ee){var et=eM();if(!eD.test(et))throw illegal(et,"name");var er=eg.lcFirst(et);et===er&&(et=eg.ucFirst(et)),eB("=");var en=parseId(eM()),eo=new ei(et);eo.group=!0;var eu=new es(er,en,et,ee);eu.filename=parse.filename,ifBlock(eo,function($){switch($){case"option":parseOption(eo,$),eB(";");break;case"required":case"repeated":parseField(eo,$);break;case"optional":eU?parseField(eo,"proto3_optional"):parseField(eo,"optional");break;case"message":parseType(eo,$);break;case"enum":parseEnum(eo,$);break;default:throw illegal($)}}),$.add(eo).add(eu)}function parseMapField($){eB("<");var ee=eM();if(void 0===em.mapKey[ee])throw illegal(ee,"type");eB(",");var et=eM();if(!eI.test(et))throw illegal(et,"type");eB(">");var er=eM();if(!eD.test(er))throw illegal(er,"name");eB("=");var en=new eo(ez(er),parseId(eM()),ee,et);ifBlock(en,function($){if("option"===$)parseOption(en,$),eB(";");else throw illegal($)},function(){parseInlineOptions(en)}),$.add(en)}function parseOneOf($,ee){if(!eD.test(ee=eM()))throw illegal(ee,"name");var et=new eu(ez(ee));ifBlock(et,function($){"option"===$?(parseOption(et,$),eB(";")):(eF($),parseField(et,"optional"))}),$.add(et)}function parseEnum($,ee){if(!eD.test(ee=eM()))throw illegal(ee,"name");var et=new eh(ee);ifBlock(et,function($){switch($){case"option":parseOption(et,$),eB(";");break;case"reserved":readRanges(et.reserved||(et.reserved=[]),!0);break;default:parseEnumValue(et,$)}}),$.add(et)}function parseEnumValue($,ee){if(!eD.test(ee))throw illegal(ee,"name");eB("=");var et=parseId(eM(),!0),er={options:void 0};er.setOption=function($,ee){void 0===this.options&&(this.options={}),this.options[$]=ee},ifBlock(er,function($){if("option"===$)parseOption(er,$),eB(";");else throw illegal($)},function(){parseInlineOptions(er)}),$.add(ee,et,er.comment,er.options)}function parseOption($,ee){var et,er=eB("(",!0);if(!eI.test(ee=eM()))throw illegal(ee,"name");var en=ee,ei=en;er&&(eB(")"),ei=en="("+en+")",ee=eL(),eR.test(ee)&&(et=ee.slice(1),en+=ee,eM())),eB("=");var es=parseOptionValue($,en);setParsedOption($,ei,es,et)}function parseOptionValue($,ee){if(eB("{",!0)){for(var et={};!eB("}",!0);){if(!eD.test(e_=eM()))throw illegal(e_,"name");if(null===e_)throw illegal(e_,"end of input");var er,en,ei=e_;if(eB(":",!0),"{"===eL())er=parseOptionValue($,ee+"."+e_);else if("["===eL()){if(er=[],eB("[",!0)){do en=readValue(!0),er.push(en);while(eB(",",!0));eB("]"),void 0!==en&&setOption($,ee+"."+e_,en)}}else er=readValue(!0),setOption($,ee+"."+e_,er);var es=et[ei];es&&(er=[].concat(es).concat(er)),et[ei]=er,eB(",",!0),eB(";",!0)}return et}var eo=readValue(!0);return setOption($,ee,eo),eo}function setOption($,ee,et){$.setOption&&$.setOption(ee,et)}function setParsedOption($,ee,et,er){$.setParsedOption&&$.setParsedOption(ee,et,er)}function parseInlineOptions($){if(eB("[",!0)){do parseOption($,"option");while(eB(",",!0));eB("]")}return $}function parseService($,ee){if(!eD.test(ee=eM()))throw illegal(ee,"service name");var et=new ep(ee);ifBlock(et,function($){if(!parseCommon(et,$)){if("rpc"===$)parseMethod(et,$);else throw illegal($)}}),$.add(et)}function parseMethod($,ee){var et=eV(),er=ee;if(!eD.test(ee=eM()))throw illegal(ee,"name");var en,ei,es,eo,eu=ee;if(eB("("),eB("stream",!0)&&(ei=!0),!eI.test(ee=eM())||(en=ee,eB(")"),eB("returns"),eB("("),eB("stream",!0)&&(eo=!0),!eI.test(ee=eM())))throw illegal(ee);es=ee,eB(")");var eh=new ef(eu,er,en,es,ei,eo);eh.comment=et,ifBlock(eh,function($){if("option"===$)parseOption(eh,$),eB(";");else throw illegal($)}),$.add(eh)}function parseExtension($,ee){if(!eI.test(ee=eM()))throw illegal(ee,"reference");var et=ee;ifBlock(null,function(ee){switch(ee){case"required":case"repeated":parseField($,ee,et);break;case"optional":eU?parseField($,"proto3_optional",et):parseField($,"optional",et);break;default:if(!eU||!eI.test(ee))throw illegal(ee);eF(ee),parseField($,"optional",et)}})}for(;null!==(e_=eM());)switch(e_){case"package":if(!ej)throw illegal(e_);parsePackage();break;case"import":if(!ej)throw illegal(e_);parseImport();break;case"syntax":if(!ej)throw illegal(e_);parseSyntax();break;case"option":parseOption(eq,e_),eB(";");break;default:if(parseCommon(eq,e_)){ej=!1;continue}throw illegal(e_)}return parse.filename=null,{package:eP,imports:eA,weakImports:ex,syntax:eO,root:ee}}},95199:($,ee,et)=>{"use strict";$.exports=Reader;var er,en=et(18932),ei=en.LongBits,es=en.utf8;function indexOutOfRange($,ee){return RangeError("index out of range: "+$.pos+" + "+(ee||1)+" > "+$.len)}function Reader($){this.buf=$,this.pos=0,this.len=$.length}var eo="undefined"!=typeof Uint8Array?function($){if($ instanceof Uint8Array||Array.isArray($))return new Reader($);throw Error("illegal buffer")}:function($){if(Array.isArray($))return new Reader($);throw Error("illegal buffer")},create=function(){return en.Buffer?function($){return(Reader.create=function($){return en.Buffer.isBuffer($)?new er($):eo($)})($)}:eo};function readLongVarint(){var $=new ei(0,0),ee=0;if(this.len-this.pos>4){for(;ee<4;++ee)if($.lo=($.lo|(127&this.buf[this.pos])<<7*ee)>>>0,this.buf[this.pos++]<128)return $;if($.lo=($.lo|(127&this.buf[this.pos])<<28)>>>0,$.hi=($.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return $;ee=0}else{for(;ee<3;++ee){if(this.pos>=this.len)throw indexOutOfRange(this);if($.lo=($.lo|(127&this.buf[this.pos])<<7*ee)>>>0,this.buf[this.pos++]<128)return $}return $.lo=($.lo|(127&this.buf[this.pos++])<<7*ee)>>>0,$}if(this.len-this.pos>4){for(;ee<5;++ee)if($.hi=($.hi|(127&this.buf[this.pos])<<7*ee+3)>>>0,this.buf[this.pos++]<128)return $}else for(;ee<5;++ee){if(this.pos>=this.len)throw indexOutOfRange(this);if($.hi=($.hi|(127&this.buf[this.pos])<<7*ee+3)>>>0,this.buf[this.pos++]<128)return $}throw Error("invalid varint encoding")}function readFixed32_end($,ee){return($[ee-4]|$[ee-3]<<8|$[ee-2]<<16|$[ee-1]<<24)>>>0}function readFixed64(){if(this.pos+8>this.len)throw indexOutOfRange(this,8);return new ei(readFixed32_end(this.buf,this.pos+=4),readFixed32_end(this.buf,this.pos+=4))}Reader.create=create(),Reader.prototype._slice=en.Array.prototype.subarray||en.Array.prototype.slice,Reader.prototype.uint32=function(){var $=4294967295;return function(){if($=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||($=($|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||($=($|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||($=($|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||($=($|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return $;if((this.pos+=5)>this.len)throw this.pos=this.len,indexOutOfRange(this,10);return $}}(),Reader.prototype.int32=function(){return 0|this.uint32()},Reader.prototype.sint32=function(){var $=this.uint32();return $>>>1^-(1&$)|0},Reader.prototype.bool=function(){return 0!==this.uint32()},Reader.prototype.fixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return readFixed32_end(this.buf,this.pos+=4)},Reader.prototype.sfixed32=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);return 0|readFixed32_end(this.buf,this.pos+=4)},Reader.prototype.float=function(){if(this.pos+4>this.len)throw indexOutOfRange(this,4);var $=en.float.readFloatLE(this.buf,this.pos);return this.pos+=4,$},Reader.prototype.double=function(){if(this.pos+8>this.len)throw indexOutOfRange(this,4);var $=en.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,$},Reader.prototype.bytes=function(){var $=this.uint32(),ee=this.pos,et=this.pos+$;if(et>this.len)throw indexOutOfRange(this,$);if(this.pos+=$,Array.isArray(this.buf))return this.buf.slice(ee,et);if(ee===et){var er=en.Buffer;return er?er.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,ee,et)},Reader.prototype.string=function(){var $=this.bytes();return es.read($,0,$.length)},Reader.prototype.skip=function($){if("number"==typeof $){if(this.pos+$>this.len)throw indexOutOfRange(this,$);this.pos+=$}else do if(this.pos>=this.len)throw indexOutOfRange(this);while(128&this.buf[this.pos++]);return this},Reader.prototype.skipType=function($){switch($){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=($=7&this.uint32());)this.skipType($);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+$+" at offset "+this.pos)}return this},Reader._configure=function($){er=$,Reader.create=create(),er._configure();var ee=en.Long?"toLong":"toNumber";en.merge(Reader.prototype,{int64:function(){return readLongVarint.call(this)[ee](!1)},uint64:function(){return readLongVarint.call(this)[ee](!0)},sint64:function(){return readLongVarint.call(this).zzDecode()[ee](!1)},fixed64:function(){return readFixed64.call(this)[ee](!0)},sfixed64:function(){return readFixed64.call(this)[ee](!1)}})}},15213:($,ee,et)=>{"use strict";$.exports=BufferReader;var er=et(95199);(BufferReader.prototype=Object.create(er.prototype)).constructor=BufferReader;var en=et(18932);function BufferReader($){er.call(this,$)}BufferReader._configure=function(){en.Buffer&&(BufferReader.prototype._slice=en.Buffer.prototype.slice)},BufferReader.prototype.string=function(){var $=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+$,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+$,this.len))},BufferReader._configure()},98373:($,ee,et)=>{"use strict";$.exports=Root;var er,en,ei,es=et(97540);((Root.prototype=Object.create(es.prototype)).constructor=Root).className="Root";var eo=et(23980),eu=et(59246),eh=et(32866),ep=et(66738);function Root($){es.call(this,"",$),this.deferred=[],this.files=[]}function SYNC(){}Root.fromJSON=function($,ee){return ee||(ee=new Root),$.options&&ee.setOptions($.options),ee.addJSON($.nested)},Root.prototype.resolvePath=ep.path.resolve,Root.prototype.fetch=ep.fetch,Root.prototype.load=function load($,ee,et){"function"==typeof ee&&(et=ee,ee=void 0);var er=this;if(!et)return ep.asPromise(load,er,$,ee);var es=et===SYNC;function finish($,ee){if(et){var er=et;if(et=null,es)throw $;er($,ee)}}function getBundledFileName($){var ee=$.lastIndexOf("google/protobuf/");if(ee>-1){var et=$.substring(ee);if(et in ei)return et}return null}function process($,et){try{if(ep.isString(et)&&"{"===et.charAt(0)&&(et=JSON.parse(et)),ep.isString(et)){en.filename=$;var ei,eu=en(et,er,ee),eh=0;if(eu.imports)for(;eh<eu.imports.length;++eh)(ei=getBundledFileName(eu.imports[eh])||er.resolvePath($,eu.imports[eh]))&&fetch(ei);if(eu.weakImports)for(eh=0;eh<eu.weakImports.length;++eh)(ei=getBundledFileName(eu.weakImports[eh])||er.resolvePath($,eu.weakImports[eh]))&&fetch(ei,!0)}else er.setOptions(et.options).addJSON(et.nested)}catch($){finish($)}es||eo||finish(null,er)}function fetch($,ee){if($=getBundledFileName($)||$,!(er.files.indexOf($)>-1)){if(er.files.push($),$ in ei){es?process($,ei[$]):(++eo,setTimeout(function(){--eo,process($,ei[$])}));return}if(es){var en;try{en=ep.fs.readFileSync($).toString("utf8")}catch($){ee||finish($);return}process($,en)}else++eo,er.fetch($,function(en,ei){if(--eo,et){if(en){ee?eo||finish(null,er):finish(en);return}process($,ei)}})}}var eo=0;ep.isString($)&&($=[$]);for(var eu,eh=0;eh<$.length;++eh)(eu=er.resolvePath("",$[eh]))&&fetch(eu);if(es)return er;eo||finish(null,er)},Root.prototype.loadSync=function($,ee){if(!ep.isNode)throw Error("not supported");return this.load($,ee,SYNC)},Root.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function($){return"'extend "+$.extend+"' in "+$.parent.fullName}).join(", "));return es.prototype.resolveAll.call(this)};var ef=/^[A-Z]/;function tryHandleExtension($,ee){var et=ee.parent.lookup(ee.extend);if(et){var er=new eo(ee.fullName,ee.id,ee.type,ee.rule,void 0,ee.options);return!!et.get(er.name)||(er.declaringField=ee,ee.extensionField=er,et.add(er),!0)}return!1}Root.prototype._handleAdd=function($){if($ instanceof eo)void 0===$.extend||$.extensionField||tryHandleExtension(this,$)||this.deferred.push($);else if($ instanceof eu)ef.test($.name)&&($.parent[$.name]=$.values);else if(!($ instanceof eh)){if($ instanceof er)for(var ee=0;ee<this.deferred.length;)tryHandleExtension(this,this.deferred[ee])?this.deferred.splice(ee,1):++ee;for(var et=0;et<$.nestedArray.length;++et)this._handleAdd($._nestedArray[et]);ef.test($.name)&&($.parent[$.name]=$)}},Root.prototype._handleRemove=function($){if($ instanceof eo){if(void 0!==$.extend){if($.extensionField)$.extensionField.parent.remove($.extensionField),$.extensionField=null;else{var ee=this.deferred.indexOf($);ee>-1&&this.deferred.splice(ee,1)}}}else if($ instanceof eu)ef.test($.name)&&delete $.parent[$.name];else if($ instanceof es){for(var et=0;et<$.nestedArray.length;++et)this._handleRemove($._nestedArray[et]);ef.test($.name)&&delete $.parent[$.name]}},Root._configure=function($,ee,et){er=$,en=ee,ei=et}},10182:$=>{"use strict";$.exports={}},69226:($,ee,et)=>{"use strict";ee.Service=et(12741)},12741:($,ee,et)=>{"use strict";$.exports=Service;var er=et(18932);function Service($,ee,et){if("function"!=typeof $)throw TypeError("rpcImpl must be a function");er.EventEmitter.call(this),this.rpcImpl=$,this.requestDelimited=!!ee,this.responseDelimited=!!et}(Service.prototype=Object.create(er.EventEmitter.prototype)).constructor=Service,Service.prototype.rpcCall=function rpcCall($,ee,et,en,ei){if(!en)throw TypeError("request must be specified");var es=this;if(!ei)return er.asPromise(rpcCall,es,$,ee,et,en);if(!es.rpcImpl){setTimeout(function(){ei(Error("already ended"))},0);return}try{return es.rpcImpl($,ee[es.requestDelimited?"encodeDelimited":"encode"](en).finish(),function(ee,er){if(ee)return es.emit("error",ee,$),ei(ee);if(null===er){es.end(!0);return}if(!(er instanceof et))try{er=et[es.responseDelimited?"decodeDelimited":"decode"](er)}catch(ee){return es.emit("error",ee,$),ei(ee)}return es.emit("data",er,$),ei(null,er)})}catch(ee){es.emit("error",ee,$),setTimeout(function(){ei(ee)},0);return}},Service.prototype.end=function($){return this.rpcImpl&&($||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},82791:($,ee,et)=>{"use strict";$.exports=Service;var er=et(97540);((Service.prototype=Object.create(er.prototype)).constructor=Service).className="Service";var en=et(28909),ei=et(66738),es=et(69226);function Service($,ee){er.call(this,$,ee),this.methods={},this._methodsArray=null}function clearCache($){return $._methodsArray=null,$}Service.fromJSON=function($,ee){var et=new Service($,ee.options);if(ee.methods)for(var er=Object.keys(ee.methods),ei=0;ei<er.length;++ei)et.add(en.fromJSON(er[ei],ee.methods[er[ei]]));return ee.nested&&et.addJSON(ee.nested),et.comment=ee.comment,et},Service.prototype.toJSON=function($){var ee=er.prototype.toJSON.call(this,$),et=!!$&&!!$.keepComments;return ei.toObject(["options",ee&&ee.options||void 0,"methods",er.arrayToJSON(this.methodsArray,$)||{},"nested",ee&&ee.nested||void 0,"comment",et?this.comment:void 0])},Object.defineProperty(Service.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=ei.toArray(this.methods))}}),Service.prototype.get=function($){return this.methods[$]||er.prototype.get.call(this,$)},Service.prototype.resolveAll=function(){for(var $=this.methodsArray,ee=0;ee<$.length;++ee)$[ee].resolve();return er.prototype.resolve.call(this)},Service.prototype.add=function($){if(this.get($.name))throw Error("duplicate name '"+$.name+"' in "+this);return $ instanceof en?(this.methods[$.name]=$,$.parent=this,clearCache(this)):er.prototype.add.call(this,$)},Service.prototype.remove=function($){if($ instanceof en){if(this.methods[$.name]!==$)throw Error($+" is not a member of "+this);return delete this.methods[$.name],$.parent=null,clearCache(this)}return er.prototype.remove.call(this,$)},Service.prototype.create=function($,ee,et){for(var er,en=new es.Service($,ee,et),eo=0;eo<this.methodsArray.length;++eo){var eu=ei.lcFirst((er=this._methodsArray[eo]).resolve().name).replace(/[^$\w_]/g,"");en[eu]=ei.codegen(["r","c"],ei.isReserved(eu)?eu+"_":eu)("return this.rpcCall(m,q,s,r,c)")({m:er,q:er.resolvedRequestType.ctor,s:er.resolvedResponseType.ctor})}return en}},86116:$=>{"use strict";$.exports=tokenize;var ee=/[\s{}=;:[\],'"()<>]/g,et=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,er=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,en=/^ *[*/]+ */,ei=/^\s*\*?\/*/,es=/\n/g,eo=/\s/,eu=/\\(.?)/g,eh={0:"\x00",r:"\r",n:"\n",t:"	"};function unescape($){return $.replace(eu,function($,ee){switch(ee){case"\\":case"":return ee;default:return eh[ee]||""}})}function tokenize($,eu){$=$.toString();var eh=0,ep=$.length,ef=1,em=0,eg={},ey=[],ev=null;function illegal($){return Error("illegal "+$+" (line "+ef+")")}function readString(){var ee="'"===ev?er:et;ee.lastIndex=eh-1;var en=ee.exec($);if(!en)throw illegal("string");return eh=ee.lastIndex,push(ev),ev=null,unescape(en[1])}function charAt(ee){return $.charAt(ee)}function setComment(ee,et,er){var eo,eh,ep={type:$.charAt(ee++),lineEmpty:!1,leading:er},ey=ee-(eo=eu?2:3);do if(--ey<0||"\n"===(eh=$.charAt(ey))){ep.lineEmpty=!0;break}while(" "===eh||"	"===eh);for(var ev=$.substring(ee,et).split(es),eS=0;eS<ev.length;++eS)ev[eS]=ev[eS].replace(eu?ei:en,"").trim();ep.text=ev.join("\n").trim(),eg[ef]=ep,em=ef}function isDoubleSlashCommentLine(ee){var et=findEndOfLine(ee),er=$.substring(ee,et);return/^\s*\/\//.test(er)}function findEndOfLine($){for(var ee=$;ee<ep&&"\n"!==charAt(ee);)ee++;return ee}function next(){if(ey.length>0)return ey.shift();if(ev)return readString();var et,er,en,ei,es,em=0===eh;do{if(eh===ep)return null;for(et=!1;eo.test(en=charAt(eh));)if("\n"===en&&(em=!0,++ef),++eh===ep)return null;if("/"===charAt(eh)){if(++eh===ep)throw illegal("comment");if("/"===charAt(eh)){if(eu){if(ei=eh,es=!1,isDoubleSlashCommentLine(eh-1)){es=!0;do if((eh=findEndOfLine(eh))===ep||(eh++,!em))break;while(isDoubleSlashCommentLine(eh))}else eh=Math.min(ep,findEndOfLine(eh)+1);es&&(setComment(ei,eh,em),em=!0),ef++,et=!0}else{for(es="/"===charAt(ei=eh+1);"\n"!==charAt(++eh);)if(eh===ep)return null;++eh,es&&(setComment(ei,eh-1,em),em=!0),++ef,et=!0}}else{if("*"!==(en=charAt(eh)))return"/";ei=eh+1,es=eu||"*"===charAt(ei);do{if("\n"===en&&++ef,++eh===ep)throw illegal("comment");er=en,en=charAt(eh)}while("*"!==er||"/"!==en);++eh,es&&(setComment(ei,eh-2,em),em=!0),et=!0}}}while(et);var eg=eh;if(ee.lastIndex=0,!ee.test(charAt(eg++)))for(;eg<ep&&!ee.test(charAt(eg));)++eg;var eS=$.substring(eh,eh=eg);return('"'===eS||"'"===eS)&&(ev=eS),eS}function push($){ey.push($)}function peek(){if(!ey.length){var $=next();if(null===$)return null;push($)}return ey[0]}function skip($,ee){var et=peek();if(et===$)return next(),!0;if(!ee)throw illegal("token '"+et+"', '"+$+"' expected");return!1}function cmnt($){var ee,et=null;return void 0===$?(ee=eg[ef-1],delete eg[ef-1],ee&&(eu||"*"===ee.type||ee.lineEmpty)&&(et=ee.leading?ee.text:null)):(em<$&&peek(),ee=eg[$],delete eg[$],ee&&!ee.lineEmpty&&(eu||"/"===ee.type)&&(et=ee.leading?null:ee.text)),et}return Object.defineProperty({next:next,peek:peek,push:push,skip:skip,cmnt:cmnt},"line",{get:function(){return ef}})}tokenize.unescape=unescape},59340:($,ee,et)=>{"use strict";$.exports=Type;var er=et(97540);((Type.prototype=Object.create(er.prototype)).constructor=Type).className="Type";var en=et(59246),ei=et(32866),es=et(23980),eo=et(67597),eu=et(82791),eh=et(34294),ep=et(95199),ef=et(84353),em=et(66738),eg=et(49561),ey=et(87317),ev=et(17585),eS=et(84144),eC=et(34038);function Type($,ee){er.call(this,$,ee),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function clearCache($){return $._fieldsById=$._fieldsArray=$._oneofsArray=null,delete $.encode,delete $.decode,delete $.verify,$}Object.defineProperties(Type.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var $=Object.keys(this.fields),ee=0;ee<$.length;++ee){var et=this.fields[$[ee]],er=et.id;if(this._fieldsById[er])throw Error("duplicate id "+er+" in "+this);this._fieldsById[er]=et}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=em.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=em.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=Type.generateConstructor(this)())},set:function($){var ee=$.prototype;ee instanceof eh||(($.prototype=new eh).constructor=$,em.merge($.prototype,ee)),$.$type=$.prototype.$type=this,em.merge($,eh,!0),this._ctor=$;for(var et=0;et<this.fieldsArray.length;++et)this._fieldsArray[et].resolve();var er={};for(et=0;et<this.oneofsArray.length;++et)er[this._oneofsArray[et].resolve().name]={get:em.oneOfGetter(this._oneofsArray[et].oneof),set:em.oneOfSetter(this._oneofsArray[et].oneof)};et&&Object.defineProperties($.prototype,er)}}}),Type.generateConstructor=function($){for(var ee,et=em.codegen(["p"],$.name),er=0;er<$.fieldsArray.length;++er)(ee=$._fieldsArray[er]).map?et("this%s={}",em.safeProp(ee.name)):ee.repeated&&et("this%s=[]",em.safeProp(ee.name));return et("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},Type.fromJSON=function($,ee){var et=new Type($,ee.options);et.extensions=ee.extensions,et.reserved=ee.reserved;for(var eh=Object.keys(ee.fields),ep=0;ep<eh.length;++ep)et.add((void 0!==ee.fields[eh[ep]].keyType?eo.fromJSON:es.fromJSON)(eh[ep],ee.fields[eh[ep]]));if(ee.oneofs)for(eh=Object.keys(ee.oneofs),ep=0;ep<eh.length;++ep)et.add(ei.fromJSON(eh[ep],ee.oneofs[eh[ep]]));if(ee.nested)for(eh=Object.keys(ee.nested),ep=0;ep<eh.length;++ep){var ef=ee.nested[eh[ep]];et.add((void 0!==ef.id?es.fromJSON:void 0!==ef.fields?Type.fromJSON:void 0!==ef.values?en.fromJSON:void 0!==ef.methods?eu.fromJSON:er.fromJSON)(eh[ep],ef))}return ee.extensions&&ee.extensions.length&&(et.extensions=ee.extensions),ee.reserved&&ee.reserved.length&&(et.reserved=ee.reserved),ee.group&&(et.group=!0),ee.comment&&(et.comment=ee.comment),et},Type.prototype.toJSON=function($){var ee=er.prototype.toJSON.call(this,$),et=!!$&&!!$.keepComments;return em.toObject(["options",ee&&ee.options||void 0,"oneofs",er.arrayToJSON(this.oneofsArray,$),"fields",er.arrayToJSON(this.fieldsArray.filter(function($){return!$.declaringField}),$)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",ee&&ee.nested||void 0,"comment",et?this.comment:void 0])},Type.prototype.resolveAll=function(){for(var $=this.fieldsArray,ee=0;ee<$.length;)$[ee++].resolve();var et=this.oneofsArray;for(ee=0;ee<et.length;)et[ee++].resolve();return er.prototype.resolveAll.call(this)},Type.prototype.get=function($){return this.fields[$]||this.oneofs&&this.oneofs[$]||this.nested&&this.nested[$]||null},Type.prototype.add=function($){if(this.get($.name))throw Error("duplicate name '"+$.name+"' in "+this);if($ instanceof es&&void 0===$.extend){if(this._fieldsById?this._fieldsById[$.id]:this.fieldsById[$.id])throw Error("duplicate id "+$.id+" in "+this);if(this.isReservedId($.id))throw Error("id "+$.id+" is reserved in "+this);if(this.isReservedName($.name))throw Error("name '"+$.name+"' is reserved in "+this);return $.parent&&$.parent.remove($),this.fields[$.name]=$,$.message=this,$.onAdd(this),clearCache(this)}return $ instanceof ei?(this.oneofs||(this.oneofs={}),this.oneofs[$.name]=$,$.onAdd(this),clearCache(this)):er.prototype.add.call(this,$)},Type.prototype.remove=function($){if($ instanceof es&&void 0===$.extend){if(!this.fields||this.fields[$.name]!==$)throw Error($+" is not a member of "+this);return delete this.fields[$.name],$.parent=null,$.onRemove(this),clearCache(this)}if($ instanceof ei){if(!this.oneofs||this.oneofs[$.name]!==$)throw Error($+" is not a member of "+this);return delete this.oneofs[$.name],$.parent=null,$.onRemove(this),clearCache(this)}return er.prototype.remove.call(this,$)},Type.prototype.isReservedId=function($){return er.isReservedId(this.reserved,$)},Type.prototype.isReservedName=function($){return er.isReservedName(this.reserved,$)},Type.prototype.create=function($){return new this.ctor($)},Type.prototype.setup=function(){for(var $=this.fullName,ee=[],et=0;et<this.fieldsArray.length;++et)ee.push(this._fieldsArray[et].resolve().resolvedType);this.encode=eg(this)({Writer:ef,types:ee,util:em}),this.decode=ey(this)({Reader:ep,types:ee,util:em}),this.verify=ev(this)({types:ee,util:em}),this.fromObject=eS.fromObject(this)({types:ee,util:em}),this.toObject=eS.toObject(this)({types:ee,util:em});var er=eC[$];if(er){var en=Object.create(this);en.fromObject=this.fromObject,this.fromObject=er.fromObject.bind(en),en.toObject=this.toObject,this.toObject=er.toObject.bind(en)}return this},Type.prototype.encode=function($,ee){return this.setup().encode($,ee)},Type.prototype.encodeDelimited=function($,ee){return this.encode($,ee&&ee.len?ee.fork():ee).ldelim()},Type.prototype.decode=function($,ee){return this.setup().decode($,ee)},Type.prototype.decodeDelimited=function($){return $ instanceof ep||($=ep.create($)),this.decode($,$.uint32())},Type.prototype.verify=function($){return this.setup().verify($)},Type.prototype.fromObject=function($){return this.setup().fromObject($)},Type.prototype.toObject=function($,ee){return this.setup().toObject($,ee)},Type.d=function($){return function(ee){em.decorateType(ee,$)}}},91708:($,ee,et)=>{"use strict";var er=ee,en=et(66738),ei=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function bake($,ee){var et=0,er={};for(ee|=0;et<$.length;)er[ei[et+ee]]=$[et++];return er}er.basic=bake([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),er.defaults=bake([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",en.emptyArray,null]),er.long=bake([0,0,0,1,1],7),er.mapKey=bake([0,0,0,5,5,0,0,0,1,1,0,2],2),er.packed=bake([1,5,0,0,0,5,5,0,0,0,1,1,0])},66738:($,ee,et)=>{"use strict";var er,en,ei=$.exports=et(18932),es=et(10182);ei.codegen=et(57311),ei.fetch=et(82651),ei.path=et(52768),ei.fs=ei.inquire("fs"),ei.toArray=function($){if($){for(var ee=Object.keys($),et=Array(ee.length),er=0;er<ee.length;)et[er]=$[ee[er++]];return et}return[]},ei.toObject=function($){for(var ee={},et=0;et<$.length;){var er=$[et++],en=$[et++];void 0!==en&&(ee[er]=en)}return ee};var eo=/\\/g,eu=/"/g;ei.isReserved=function($){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test($)},ei.safeProp=function($){return!/^[$\w_]+$/.test($)||ei.isReserved($)?'["'+$.replace(eo,"\\\\").replace(eu,'\\"')+'"]':"."+$},ei.ucFirst=function($){return $.charAt(0).toUpperCase()+$.substring(1)};var eh=/_([a-z])/g;ei.camelCase=function($){return $.substring(0,1)+$.substring(1).replace(eh,function($,ee){return ee.toUpperCase()})},ei.compareFieldsById=function($,ee){return $.id-ee.id},ei.decorateType=function($,ee){if($.$type)return ee&&$.$type.name!==ee&&(ei.decorateRoot.remove($.$type),$.$type.name=ee,ei.decorateRoot.add($.$type)),$.$type;er||(er=et(59340));var en=new er(ee||$.name);return ei.decorateRoot.add(en),en.ctor=$,Object.defineProperty($,"$type",{value:en,enumerable:!1}),Object.defineProperty($.prototype,"$type",{value:en,enumerable:!1}),en};var ep=0;ei.decorateEnum=function($){if($.$type)return $.$type;en||(en=et(59246));var ee=new en("Enum"+ep++,$);return ei.decorateRoot.add(ee),Object.defineProperty($,"$type",{value:ee,enumerable:!1}),ee},ei.setProperty=function($,ee,et){function setProp($,ee,et){var er=ee.shift();if("__proto__"===er||"prototype"===er)return $;if(ee.length>0)$[er]=setProp($[er]||{},ee,et);else{var en=$[er];en&&(et=[].concat(en).concat(et)),$[er]=et}return $}if("object"!=typeof $)throw TypeError("dst must be an object");if(!ee)throw TypeError("path must be specified");return setProp($,ee=ee.split("."),et)},Object.defineProperty(ei,"decorateRoot",{get:function(){return es.decorated||(es.decorated=new(et(98373)))}})},41168:($,ee,et)=>{"use strict";$.exports=LongBits;var er=et(18932);function LongBits($,ee){this.lo=$>>>0,this.hi=ee>>>0}var en=LongBits.zero=new LongBits(0,0);en.toNumber=function(){return 0},en.zzEncode=en.zzDecode=function(){return this},en.length=function(){return 1};var ei=LongBits.zeroHash="\x00\x00\x00\x00\x00\x00\x00\x00";LongBits.fromNumber=function($){if(0===$)return en;var ee=$<0;ee&&($=-$);var et=$>>>0,er=($-et)/4294967296>>>0;return ee&&(er=~er>>>0,et=~et>>>0,++et>4294967295&&(et=0,++er>4294967295&&(er=0))),new LongBits(et,er)},LongBits.from=function($){if("number"==typeof $)return LongBits.fromNumber($);if(er.isString($)){if(!er.Long)return LongBits.fromNumber(parseInt($,10));$=er.Long.fromString($)}return $.low||$.high?new LongBits($.low>>>0,$.high>>>0):en},LongBits.prototype.toNumber=function($){if(!$&&this.hi>>>31){var ee=~this.lo+1>>>0,et=~this.hi>>>0;return ee||(et=et+1>>>0),-(ee+4294967296*et)}return this.lo+4294967296*this.hi},LongBits.prototype.toLong=function($){return er.Long?new er.Long(0|this.lo,0|this.hi,!!$):{low:0|this.lo,high:0|this.hi,unsigned:!!$}};var es=String.prototype.charCodeAt;LongBits.fromHash=function($){return $===ei?en:new LongBits((es.call($,0)|es.call($,1)<<8|es.call($,2)<<16|es.call($,3)<<24)>>>0,(es.call($,4)|es.call($,5)<<8|es.call($,6)<<16|es.call($,7)<<24)>>>0)},LongBits.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},LongBits.prototype.zzEncode=function(){var $=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^$)>>>0,this.lo=(this.lo<<1^$)>>>0,this},LongBits.prototype.zzDecode=function(){var $=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^$)>>>0,this.hi=(this.hi>>>1^$)>>>0,this},LongBits.prototype.length=function(){var $=this.lo,ee=(this.lo>>>28|this.hi<<4)>>>0,et=this.hi>>>24;return 0===et?0===ee?$<16384?$<128?1:2:$<2097152?3:4:ee<16384?ee<128?5:6:ee<2097152?7:8:et<128?9:10}},18932:function($,ee,et){"use strict";var er=ee;function merge($,ee,et){for(var er=Object.keys(ee),en=0;en<er.length;++en)void 0!==$[er[en]]&&et||($[er[en]]=ee[er[en]]);return $}function newError($){function CustomError($,ee){if(!(this instanceof CustomError))return new CustomError($,ee);Object.defineProperty(this,"message",{get:function(){return $}}),Error.captureStackTrace?Error.captureStackTrace(this,CustomError):Object.defineProperty(this,"stack",{value:Error().stack||""}),ee&&merge(this,ee)}return CustomError.prototype=Object.create(Error.prototype,{constructor:{value:CustomError,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return $},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),CustomError}er.asPromise=et(18670),er.base64=et(36009),er.EventEmitter=et(50107),er.float=et(71188),er.inquire=et(28031),er.utf8=et(67148),er.pool=et(14314),er.LongBits=et(41168),er.isNode=!!("undefined"!=typeof global&&global&&global.process&&global.process.versions&&global.process.versions.node),er.global=er.isNode&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,er.emptyArray=Object.freeze?Object.freeze([]):[],er.emptyObject=Object.freeze?Object.freeze({}):{},er.isInteger=Number.isInteger||function($){return"number"==typeof $&&isFinite($)&&Math.floor($)===$},er.isString=function($){return"string"==typeof $||$ instanceof String},er.isObject=function($){return $&&"object"==typeof $},er.isset=er.isSet=function($,ee){var et=$[ee];return!!(null!=et&&$.hasOwnProperty(ee))&&("object"!=typeof et||(Array.isArray(et)?et.length:Object.keys(et).length)>0)},er.Buffer=function(){try{var $=er.inquire("buffer").Buffer;return $.prototype.utf8Write?$:null}catch($){return null}}(),er._Buffer_from=null,er._Buffer_allocUnsafe=null,er.newBuffer=function($){return"number"==typeof $?er.Buffer?er._Buffer_allocUnsafe($):new er.Array($):er.Buffer?er._Buffer_from($):"undefined"==typeof Uint8Array?$:new Uint8Array($)},er.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,er.Long=er.global.dcodeIO&&er.global.dcodeIO.Long||er.global.Long||er.inquire("long"),er.key2Re=/^true|false|0|1$/,er.key32Re=/^-?(?:0|[1-9][0-9]*)$/,er.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,er.longToHash=function($){return $?er.LongBits.from($).toHash():er.LongBits.zeroHash},er.longFromHash=function($,ee){var et=er.LongBits.fromHash($);return er.Long?er.Long.fromBits(et.lo,et.hi,ee):et.toNumber(!!ee)},er.merge=merge,er.lcFirst=function($){return $.charAt(0).toLowerCase()+$.substring(1)},er.newError=newError,er.ProtocolError=newError("ProtocolError"),er.oneOfGetter=function($){for(var ee={},et=0;et<$.length;++et)ee[$[et]]=1;return function(){for(var $=Object.keys(this),et=$.length-1;et>-1;--et)if(1===ee[$[et]]&&void 0!==this[$[et]]&&null!==this[$[et]])return $[et]}},er.oneOfSetter=function($){return function(ee){for(var et=0;et<$.length;++et)$[et]!==ee&&delete this[$[et]]}},er.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},er._configure=function(){var $=er.Buffer;if(!$){er._Buffer_from=er._Buffer_allocUnsafe=null;return}er._Buffer_from=$.from!==Uint8Array.from&&$.from||function(ee,et){return new $(ee,et)},er._Buffer_allocUnsafe=$.allocUnsafe||function(ee){return new $(ee)}}},17585:($,ee,et)=>{"use strict";$.exports=verifier;var er=et(59246),en=et(66738);function invalid($,ee){return $.name+": "+ee+($.repeated&&"array"!==ee?"[]":$.map&&"object"!==ee?"{k:"+$.keyType+"}":"")+" expected"}function genVerifyValue($,ee,et,en){if(ee.resolvedType){if(ee.resolvedType instanceof er){$("switch(%s){",en)("default:")("return%j",invalid(ee,"enum value"));for(var ei=Object.keys(ee.resolvedType.values),es=0;es<ei.length;++es)$("case %i:",ee.resolvedType.values[ei[es]]);$("break")("}")}else $("{")("var e=types[%i].verify(%s);",et,en)("if(e)")("return%j+e",ee.name+".")("}")}else switch(ee.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":$("if(!util.isInteger(%s))",en)("return%j",invalid(ee,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":$("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",en,en,en,en)("return%j",invalid(ee,"integer|Long"));break;case"float":case"double":$('if(typeof %s!=="number")',en)("return%j",invalid(ee,"number"));break;case"bool":$('if(typeof %s!=="boolean")',en)("return%j",invalid(ee,"boolean"));break;case"string":$("if(!util.isString(%s))",en)("return%j",invalid(ee,"string"));break;case"bytes":$('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',en,en,en)("return%j",invalid(ee,"buffer"))}return $}function genVerifyKey($,ee,et){switch(ee.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":$("if(!util.key32Re.test(%s))",et)("return%j",invalid(ee,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":$("if(!util.key64Re.test(%s))",et)("return%j",invalid(ee,"integer|Long key"));break;case"bool":$("if(!util.key2Re.test(%s))",et)("return%j",invalid(ee,"boolean key"))}return $}function verifier($){var ee=en.codegen(["m"],$.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),et=$.oneofsArray,er={};et.length&&ee("var p={}");for(var ei=0;ei<$.fieldsArray.length;++ei){var es=$._fieldsArray[ei].resolve(),eo="m"+en.safeProp(es.name);if(es.optional&&ee("if(%s!=null&&m.hasOwnProperty(%j)){",eo,es.name),es.map)ee("if(!util.isObject(%s))",eo)("return%j",invalid(es,"object"))("var k=Object.keys(%s)",eo)("for(var i=0;i<k.length;++i){"),genVerifyKey(ee,es,"k[i]"),genVerifyValue(ee,es,ei,eo+"[k[i]]")("}");else if(es.repeated)ee("if(!Array.isArray(%s))",eo)("return%j",invalid(es,"array"))("for(var i=0;i<%s.length;++i){",eo),genVerifyValue(ee,es,ei,eo+"[i]")("}");else{if(es.partOf){var eu=en.safeProp(es.partOf.name);1===er[es.partOf.name]&&ee("if(p%s===1)",eu)("return%j",es.partOf.name+": multiple values"),er[es.partOf.name]=1,ee("p%s=1",eu)}genVerifyValue(ee,es,ei,eo)}es.optional&&ee("}")}return ee("return null")}},34038:($,ee,et)=>{"use strict";var er=ee,en=et(34294);er[".google.protobuf.Any"]={fromObject:function($){if($&&$["@type"]){var ee=$["@type"].substring($["@type"].lastIndexOf("/")+1),et=this.lookup(ee);if(et){var er="."===$["@type"].charAt(0)?$["@type"].slice(1):$["@type"];return -1===er.indexOf("/")&&(er="/"+er),this.create({type_url:er,value:et.encode(et.fromObject($)).finish()})}}return this.fromObject($)},toObject:function($,ee){var et="type.googleapis.com/",er="",ei="";if(ee&&ee.json&&$.type_url&&$.value){ei=$.type_url.substring($.type_url.lastIndexOf("/")+1),er=$.type_url.substring(0,$.type_url.lastIndexOf("/")+1);var es=this.lookup(ei);es&&($=es.decode($.value))}if(!($ instanceof this.ctor)&&$ instanceof en){var eo=$.$type.toObject($,ee),eu="."===$.$type.fullName[0]?$.$type.fullName.slice(1):$.$type.fullName;return""===er&&(er=et),ei=er+eu,eo["@type"]=ei,eo}return this.toObject($,ee)}}},84353:($,ee,et)=>{"use strict";$.exports=Writer;var er,en=et(18932),ei=en.LongBits,es=en.base64,eo=en.utf8;function Op($,ee,et){this.fn=$,this.len=ee,this.next=void 0,this.val=et}function noop(){}function State($){this.head=$.head,this.tail=$.tail,this.len=$.len,this.next=$.states}function Writer(){this.len=0,this.head=new Op(noop,0,0),this.tail=this.head,this.states=null}var create=function(){return en.Buffer?function(){return(Writer.create=function(){return new er})()}:function(){return new Writer}};function writeByte($,ee,et){ee[et]=255&$}function writeVarint32($,ee,et){for(;$>127;)ee[et++]=127&$|128,$>>>=7;ee[et]=$}function VarintOp($,ee){this.len=$,this.next=void 0,this.val=ee}function writeVarint64($,ee,et){for(;$.hi;)ee[et++]=127&$.lo|128,$.lo=($.lo>>>7|$.hi<<25)>>>0,$.hi>>>=7;for(;$.lo>127;)ee[et++]=127&$.lo|128,$.lo=$.lo>>>7;ee[et++]=$.lo}function writeFixed32($,ee,et){ee[et]=255&$,ee[et+1]=$>>>8&255,ee[et+2]=$>>>16&255,ee[et+3]=$>>>24}Writer.create=create(),Writer.alloc=function($){return new en.Array($)},en.Array!==Array&&(Writer.alloc=en.pool(Writer.alloc,en.Array.prototype.subarray)),Writer.prototype._push=function($,ee,et){return this.tail=this.tail.next=new Op($,ee,et),this.len+=ee,this},VarintOp.prototype=Object.create(Op.prototype),VarintOp.prototype.fn=writeVarint32,Writer.prototype.uint32=function($){return this.len+=(this.tail=this.tail.next=new VarintOp(($>>>=0)<128?1:$<16384?2:$<2097152?3:$<268435456?4:5,$)).len,this},Writer.prototype.int32=function($){return $<0?this._push(writeVarint64,10,ei.fromNumber($)):this.uint32($)},Writer.prototype.sint32=function($){return this.uint32(($<<1^$>>31)>>>0)},Writer.prototype.uint64=function($){var ee=ei.from($);return this._push(writeVarint64,ee.length(),ee)},Writer.prototype.int64=Writer.prototype.uint64,Writer.prototype.sint64=function($){var ee=ei.from($).zzEncode();return this._push(writeVarint64,ee.length(),ee)},Writer.prototype.bool=function($){return this._push(writeByte,1,$?1:0)},Writer.prototype.fixed32=function($){return this._push(writeFixed32,4,$>>>0)},Writer.prototype.sfixed32=Writer.prototype.fixed32,Writer.prototype.fixed64=function($){var ee=ei.from($);return this._push(writeFixed32,4,ee.lo)._push(writeFixed32,4,ee.hi)},Writer.prototype.sfixed64=Writer.prototype.fixed64,Writer.prototype.float=function($){return this._push(en.float.writeFloatLE,4,$)},Writer.prototype.double=function($){return this._push(en.float.writeDoubleLE,8,$)};var eu=en.Array.prototype.set?function($,ee,et){ee.set($,et)}:function($,ee,et){for(var er=0;er<$.length;++er)ee[et+er]=$[er]};Writer.prototype.bytes=function($){var ee=$.length>>>0;if(!ee)return this._push(writeByte,1,0);if(en.isString($)){var et=Writer.alloc(ee=es.length($));es.decode($,et,0),$=et}return this.uint32(ee)._push(eu,ee,$)},Writer.prototype.string=function($){var ee=eo.length($);return ee?this.uint32(ee)._push(eo.write,ee,$):this._push(writeByte,1,0)},Writer.prototype.fork=function(){return this.states=new State(this),this.head=this.tail=new Op(noop,0,0),this.len=0,this},Writer.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Op(noop,0,0),this.len=0),this},Writer.prototype.ldelim=function(){var $=this.head,ee=this.tail,et=this.len;return this.reset().uint32(et),et&&(this.tail.next=$.next,this.tail=ee,this.len+=et),this},Writer.prototype.finish=function(){for(var $=this.head.next,ee=this.constructor.alloc(this.len),et=0;$;)$.fn($.val,ee,et),et+=$.len,$=$.next;return ee},Writer._configure=function($){er=$,Writer.create=create(),er._configure()}},81978:($,ee,et)=>{"use strict";$.exports=BufferWriter;var er=et(84353);(BufferWriter.prototype=Object.create(er.prototype)).constructor=BufferWriter;var en=et(18932);function BufferWriter(){er.call(this)}function writeStringBuffer($,ee,et){$.length<40?en.utf8.write($,ee,et):ee.utf8Write?ee.utf8Write($,et):ee.write($,et)}BufferWriter._configure=function(){BufferWriter.alloc=en._Buffer_allocUnsafe,BufferWriter.writeBytesBuffer=en.Buffer&&en.Buffer.prototype instanceof Uint8Array&&"set"===en.Buffer.prototype.set.name?function($,ee,et){ee.set($,et)}:function($,ee,et){if($.copy)$.copy(ee,et,0,$.length);else for(var er=0;er<$.length;)ee[et++]=$[er++]}},BufferWriter.prototype.bytes=function($){en.isString($)&&($=en._Buffer_from($,"base64"));var ee=$.length>>>0;return this.uint32(ee),ee&&this._push(BufferWriter.writeBytesBuffer,ee,$),this},BufferWriter.prototype.string=function($){var ee=en.Buffer.byteLength($);return this.uint32(ee),ee&&this._push(writeStringBuffer,ee,$),this},BufferWriter._configure()},16933:($,ee)=>{var et,er=function($){"use strict";Object.defineProperty($,"__esModule",{value:!0}),$.default=void 0;/**
   * @license
   * Copyright 2009 The Closure Library Authors
   * Copyright 2020 Daniel Wirtz / The long.js Authors.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *     http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   *
   * SPDX-License-Identifier: Apache-2.0
   */var ee=null;try{ee=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch($){}function Long($,ee,et){this.low=0|$,this.high=0|ee,this.unsigned=!!et}function isLong($){return!0===($&&$.__isLong__)}function ctz32($){var ee=Math.clz32($&-$);return $?31-ee:ee}Long.prototype.__isLong__,Object.defineProperty(Long.prototype,"__isLong__",{value:!0}),Long.isLong=isLong;var et={},er={};function fromInt($,ee){var en,ei,es;return ee?($>>>=0,(es=0<=$&&$<256)&&(ei=er[$]))?ei:(en=fromBits($,0,!0),es&&(er[$]=en),en):($|=0,(es=-128<=$&&$<128)&&(ei=et[$]))?ei:(en=fromBits($,$<0?-1:0,!1),es&&(et[$]=en),en)}function fromNumber($,ee){if(isNaN($))return ee?ep:eh;if(ee){if($<0)return ep;if($>=es)return ev}else{if($<=-eo)return eS;if($+1>=eo)return ey}return $<0?fromNumber(-$,ee).neg():fromBits($%ei|0,$/ei|0,ee)}function fromBits($,ee,et){return new Long($,ee,et)}Long.fromInt=fromInt,Long.fromNumber=fromNumber,Long.fromBits=fromBits;var en=Math.pow;function fromString($,ee,et){if(0===$.length)throw Error("empty string");if("number"==typeof ee?(et=ee,ee=!1):ee=!!ee,"NaN"===$||"Infinity"===$||"+Infinity"===$||"-Infinity"===$)return ee?ep:eh;if((et=et||10)<2||36<et)throw RangeError("radix");if((er=$.indexOf("-"))>0)throw Error("interior hyphen");if(0===er)return fromString($.substring(1),ee,et).neg();for(var er,ei=fromNumber(en(et,8)),es=eh,eo=0;eo<$.length;eo+=8){var eu=Math.min(8,$.length-eo),ef=parseInt($.substring(eo,eo+eu),et);if(eu<8){var em=fromNumber(en(et,eu));es=es.mul(em).add(fromNumber(ef))}else es=(es=es.mul(ei)).add(fromNumber(ef))}return es.unsigned=ee,es}function fromValue($,ee){return"number"==typeof $?fromNumber($,ee):"string"==typeof $?fromString($,ee):fromBits($.low,$.high,"boolean"==typeof ee?ee:$.unsigned)}Long.fromString=fromString,Long.fromValue=fromValue;var ei=4294967296,es=18446744073709552e3,eo=0x7fffffffffffffff,eu=fromInt(16777216),eh=fromInt(0);Long.ZERO=eh;var ep=fromInt(0,!0);Long.UZERO=ep;var ef=fromInt(1);Long.ONE=ef;var em=fromInt(1,!0);Long.UONE=em;var eg=fromInt(-1);Long.NEG_ONE=eg;var ey=fromBits(-1,2147483647,!1);Long.MAX_VALUE=ey;var ev=fromBits(-1,-1,!0);Long.MAX_UNSIGNED_VALUE=ev;var eS=fromBits(0,-2147483648,!1);Long.MIN_VALUE=eS;var eC=Long.prototype;eC.toInt=function(){return this.unsigned?this.low>>>0:this.low},eC.toNumber=function(){return this.unsigned?(this.high>>>0)*ei+(this.low>>>0):this.high*ei+(this.low>>>0)},eC.toString=function($){if(($=$||10)<2||36<$)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(!this.eq(eS))return"-"+this.neg().toString($);var ee=fromNumber($),et=this.div(ee),er=et.mul(ee).sub(this);return et.toString($)+er.toInt().toString($)}for(var ei=fromNumber(en($,6),this.unsigned),es=this,eo="";;){var eu=es.div(ei),eh=(es.sub(eu.mul(ei)).toInt()>>>0).toString($);if((es=eu).isZero())return eh+eo;for(;eh.length<6;)eh="0"+eh;eo=""+eh+eo}},eC.getHighBits=function(){return this.high},eC.getHighBitsUnsigned=function(){return this.high>>>0},eC.getLowBits=function(){return this.low},eC.getLowBitsUnsigned=function(){return this.low>>>0},eC.getNumBitsAbs=function(){if(this.isNegative())return this.eq(eS)?64:this.neg().getNumBitsAbs();for(var $=0!=this.high?this.high:this.low,ee=31;ee>0&&($&1<<ee)==0;ee--);return 0!=this.high?ee+33:ee+1},eC.isZero=function(){return 0===this.high&&0===this.low},eC.eqz=eC.isZero,eC.isNegative=function(){return!this.unsigned&&this.high<0},eC.isPositive=function(){return this.unsigned||this.high>=0},eC.isOdd=function(){return(1&this.low)==1},eC.isEven=function(){return(1&this.low)==0},eC.equals=function($){return isLong($)||($=fromValue($)),(this.unsigned===$.unsigned||this.high>>>31!=1||$.high>>>31!=1)&&this.high===$.high&&this.low===$.low},eC.eq=eC.equals,eC.notEquals=function($){return!this.eq($)},eC.neq=eC.notEquals,eC.ne=eC.notEquals,eC.lessThan=function($){return 0>this.comp($)},eC.lt=eC.lessThan,eC.lessThanOrEqual=function($){return 0>=this.comp($)},eC.lte=eC.lessThanOrEqual,eC.le=eC.lessThanOrEqual,eC.greaterThan=function($){return this.comp($)>0},eC.gt=eC.greaterThan,eC.greaterThanOrEqual=function($){return this.comp($)>=0},eC.gte=eC.greaterThanOrEqual,eC.ge=eC.greaterThanOrEqual,eC.compare=function($){if(isLong($)||($=fromValue($)),this.eq($))return 0;var ee=this.isNegative(),et=$.isNegative();return ee&&!et?-1:!ee&&et?1:this.unsigned?$.high>>>0>this.high>>>0||$.high===this.high&&$.low>>>0>this.low>>>0?-1:1:this.sub($).isNegative()?-1:1},eC.comp=eC.compare,eC.negate=function(){return!this.unsigned&&this.eq(eS)?eS:this.not().add(ef)},eC.neg=eC.negate,eC.add=function($){isLong($)||($=fromValue($));var ee,et,er=this.high>>>16,en=65535&this.high,ei=this.low>>>16,es=65535&this.low,eo=$.high>>>16,eu=65535&$.high,eh=$.low>>>16,ep=65535&$.low,ef=0,em=0;return ee=0+((et=0+(es+ep))>>>16),et&=65535,ee+=ei+eh,em+=ee>>>16,ee&=65535,em+=en+eu,ef+=em>>>16,em&=65535,ef+=er+eo,fromBits(ee<<16|et,(ef&=65535)<<16|em,this.unsigned)},eC.subtract=function($){return isLong($)||($=fromValue($)),this.add($.neg())},eC.sub=eC.subtract,eC.multiply=function($){if(this.isZero())return this;if(isLong($)||($=fromValue($)),ee)return fromBits(ee.mul(this.low,this.high,$.low,$.high),ee.get_high(),this.unsigned);if($.isZero())return this.unsigned?ep:eh;if(this.eq(eS))return $.isOdd()?eS:eh;if($.eq(eS))return this.isOdd()?eS:eh;if(this.isNegative())return $.isNegative()?this.neg().mul($.neg()):this.neg().mul($).neg();if($.isNegative())return this.mul($.neg()).neg();if(this.lt(eu)&&$.lt(eu))return fromNumber(this.toNumber()*$.toNumber(),this.unsigned);var et,er,en=this.high>>>16,ei=65535&this.high,es=this.low>>>16,eo=65535&this.low,ef=$.high>>>16,em=65535&$.high,eg=$.low>>>16,ey=65535&$.low,ev=0,eC=0;return et=0+((er=0+eo*ey)>>>16),er&=65535,et+=es*ey,eC+=et>>>16,et&=65535,et+=eo*eg,eC+=et>>>16,et&=65535,eC+=ei*ey,ev+=eC>>>16,eC&=65535,eC+=es*eg,ev+=eC>>>16,eC&=65535,eC+=eo*em,ev+=eC>>>16,eC&=65535,ev+=en*ey+ei*eg+es*em+eo*ef,fromBits(et<<16|er,(ev&=65535)<<16|eC,this.unsigned)},eC.mul=eC.multiply,eC.divide=function($){if(isLong($)||($=fromValue($)),$.isZero())throw Error("division by zero");if(ee){var et,er,ei;return this.unsigned||-2147483648!==this.high||-1!==$.low||-1!==$.high?fromBits((this.unsigned?ee.div_u:ee.div_s)(this.low,this.high,$.low,$.high),ee.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?ep:eh;if(this.unsigned){if($.unsigned||($=$.toUnsigned()),$.gt(this))return ep;if($.gt(this.shru(1)))return em;ei=ep}else{if(this.eq(eS))return $.eq(ef)||$.eq(eg)?eS:$.eq(eS)?ef:(et=this.shr(1).div($).shl(1)).eq(eh)?$.isNegative()?ef:eg:(er=this.sub($.mul(et)),ei=et.add(er.div($)));if($.eq(eS))return this.unsigned?ep:eh;if(this.isNegative())return $.isNegative()?this.neg().div($.neg()):this.neg().div($).neg();if($.isNegative())return this.div($.neg()).neg();ei=eh}for(er=this;er.gte($);){for(var es=Math.ceil(Math.log(et=Math.max(1,Math.floor(er.toNumber()/$.toNumber())))/Math.LN2),eo=es<=48?1:en(2,es-48),eu=fromNumber(et),ey=eu.mul($);ey.isNegative()||ey.gt(er);)et-=eo,ey=(eu=fromNumber(et,this.unsigned)).mul($);eu.isZero()&&(eu=ef),ei=ei.add(eu),er=er.sub(ey)}return ei},eC.div=eC.divide,eC.modulo=function($){return(isLong($)||($=fromValue($)),ee)?fromBits((this.unsigned?ee.rem_u:ee.rem_s)(this.low,this.high,$.low,$.high),ee.get_high(),this.unsigned):this.sub(this.div($).mul($))},eC.mod=eC.modulo,eC.rem=eC.modulo,eC.not=function(){return fromBits(~this.low,~this.high,this.unsigned)},eC.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},eC.clz=eC.countLeadingZeros,eC.countTrailingZeros=function(){return this.low?ctz32(this.low):ctz32(this.high)+32},eC.ctz=eC.countTrailingZeros,eC.and=function($){return isLong($)||($=fromValue($)),fromBits(this.low&$.low,this.high&$.high,this.unsigned)},eC.or=function($){return isLong($)||($=fromValue($)),fromBits(this.low|$.low,this.high|$.high,this.unsigned)},eC.xor=function($){return isLong($)||($=fromValue($)),fromBits(this.low^$.low,this.high^$.high,this.unsigned)},eC.shiftLeft=function($){return(isLong($)&&($=$.toInt()),0==($&=63))?this:$<32?fromBits(this.low<<$,this.high<<$|this.low>>>32-$,this.unsigned):fromBits(0,this.low<<$-32,this.unsigned)},eC.shl=eC.shiftLeft,eC.shiftRight=function($){return(isLong($)&&($=$.toInt()),0==($&=63))?this:$<32?fromBits(this.low>>>$|this.high<<32-$,this.high>>$,this.unsigned):fromBits(this.high>>$-32,this.high>=0?0:-1,this.unsigned)},eC.shr=eC.shiftRight,eC.shiftRightUnsigned=function($){return(isLong($)&&($=$.toInt()),0==($&=63))?this:$<32?fromBits(this.low>>>$|this.high<<32-$,this.high>>>$,this.unsigned):32===$?fromBits(this.high,0,this.unsigned):fromBits(this.high>>>$-32,0,this.unsigned)},eC.shru=eC.shiftRightUnsigned,eC.shr_u=eC.shiftRightUnsigned,eC.rotateLeft=function($){var ee;return(isLong($)&&($=$.toInt()),0==($&=63))?this:32===$?fromBits(this.high,this.low,this.unsigned):$<32?(ee=32-$,fromBits(this.low<<$|this.high>>>ee,this.high<<$|this.low>>>ee,this.unsigned)):($-=32,ee=32-$,fromBits(this.high<<$|this.low>>>ee,this.low<<$|this.high>>>ee,this.unsigned))},eC.rotl=eC.rotateLeft,eC.rotateRight=function($){var ee;return(isLong($)&&($=$.toInt()),0==($&=63))?this:32===$?fromBits(this.high,this.low,this.unsigned):$<32?(ee=32-$,fromBits(this.high<<ee|this.low>>>$,this.low<<ee|this.high>>>$,this.unsigned)):($-=32,ee=32-$,fromBits(this.low<<ee|this.high>>>$,this.high<<ee|this.low>>>$,this.unsigned))},eC.rotr=eC.rotateRight,eC.toSigned=function(){return this.unsigned?fromBits(this.low,this.high,!1):this},eC.toUnsigned=function(){return this.unsigned?this:fromBits(this.low,this.high,!0)},eC.toBytes=function($){return $?this.toBytesLE():this.toBytesBE()},eC.toBytesLE=function(){var $=this.high,ee=this.low;return[255&ee,ee>>>8&255,ee>>>16&255,ee>>>24,255&$,$>>>8&255,$>>>16&255,$>>>24]},eC.toBytesBE=function(){var $=this.high,ee=this.low;return[$>>>24,$>>>16&255,$>>>8&255,255&$,ee>>>24,ee>>>16&255,ee>>>8&255,255&ee]},Long.fromBytes=function($,ee,et){return et?Long.fromBytesLE($,ee):Long.fromBytesBE($,ee)},Long.fromBytesLE=function($,ee){return new Long($[0]|$[1]<<8|$[2]<<16|$[3]<<24,$[4]|$[5]<<8|$[6]<<16|$[7]<<24,ee)},Long.fromBytesBE=function($,ee){return new Long($[4]<<24|$[5]<<16|$[6]<<8|$[7],$[0]<<24|$[1]<<16|$[2]<<8|$[3],ee)};var eT=Long;return $.default=eT,"default"in $?$.default:$}({});void 0!==(et=(function(){return er}).apply(ee,[]))&&($.exports=et)},55087:($,ee,et)=>{"use strict";let er,en;et.d(ee,{Jn:()=>e1,qX:()=>_getProvider,Xd:()=>_registerComponent,Mq:()=>getApp,ZF:()=>initializeApp,KN:()=>registerVersion});var ei=et(77345),es=et(9292),eo=et(51780);let instanceOfAny=($,ee)=>ee.some(ee=>$ instanceof ee);function getIdbProxyableTypes(){return er||(er=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return en||(en=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let eu=new WeakMap,eh=new WeakMap,ep=new WeakMap,ef=new WeakMap,em=new WeakMap;function promisifyRequest($){let ee=new Promise((ee,et)=>{let unlisten=()=>{$.removeEventListener("success",success),$.removeEventListener("error",error)},success=()=>{ee(wrap_idb_value_wrap($.result)),unlisten()},error=()=>{et($.error),unlisten()};$.addEventListener("success",success),$.addEventListener("error",error)});return ee.then(ee=>{ee instanceof IDBCursor&&eu.set(ee,$)}).catch(()=>{}),em.set(ee,$),ee}function cacheDonePromiseForTransaction($){if(eh.has($))return;let ee=new Promise((ee,et)=>{let unlisten=()=>{$.removeEventListener("complete",complete),$.removeEventListener("error",error),$.removeEventListener("abort",error)},complete=()=>{ee(),unlisten()},error=()=>{et($.error||new DOMException("AbortError","AbortError")),unlisten()};$.addEventListener("complete",complete),$.addEventListener("error",error),$.addEventListener("abort",error)});eh.set($,ee)}let eg={get($,ee,et){if($ instanceof IDBTransaction){if("done"===ee)return eh.get($);if("objectStoreNames"===ee)return $.objectStoreNames||ep.get($);if("store"===ee)return et.objectStoreNames[1]?void 0:et.objectStore(et.objectStoreNames[0])}return wrap_idb_value_wrap($[ee])},set:($,ee,et)=>($[ee]=et,!0),has:($,ee)=>$ instanceof IDBTransaction&&("done"===ee||"store"===ee)||ee in $};function replaceTraps($){eg=$(eg)}function wrapFunction($){return $!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?getCursorAdvanceMethods().includes($)?function(...ee){return $.apply(unwrap(this),ee),wrap_idb_value_wrap(eu.get(this))}:function(...ee){return wrap_idb_value_wrap($.apply(unwrap(this),ee))}:function(ee,...et){let er=$.call(unwrap(this),ee,...et);return ep.set(er,ee.sort?ee.sort():[ee]),wrap_idb_value_wrap(er)}}function transformCachableValue($){return"function"==typeof $?wrapFunction($):($ instanceof IDBTransaction&&cacheDonePromiseForTransaction($),instanceOfAny($,getIdbProxyableTypes()))?new Proxy($,eg):$}function wrap_idb_value_wrap($){if($ instanceof IDBRequest)return promisifyRequest($);if(ef.has($))return ef.get($);let ee=transformCachableValue($);return ee!==$&&(ef.set($,ee),em.set(ee,$)),ee}let unwrap=$=>em.get($);function openDB($,ee,{blocked:et,upgrade:er,blocking:en,terminated:ei}={}){let es=indexedDB.open($,ee),eo=wrap_idb_value_wrap(es);return er&&es.addEventListener("upgradeneeded",$=>{er(wrap_idb_value_wrap(es.result),$.oldVersion,$.newVersion,wrap_idb_value_wrap(es.transaction),$)}),et&&es.addEventListener("blocked",$=>et($.oldVersion,$.newVersion,$)),eo.then($=>{ei&&$.addEventListener("close",()=>ei()),en&&$.addEventListener("versionchange",$=>en($.oldVersion,$.newVersion,$))}).catch(()=>{}),eo}let ey=["get","getKey","getAll","getAllKeys","count"],ev=["put","add","delete","clear"],eS=new Map;function getMethod($,ee){if(!($ instanceof IDBDatabase&&!(ee in $)&&"string"==typeof ee))return;if(eS.get(ee))return eS.get(ee);let et=ee.replace(/FromIndex$/,""),er=ee!==et,en=ev.includes(et);if(!(et in(er?IDBIndex:IDBObjectStore).prototype)||!(en||ey.includes(et)))return;let method=async function($,...ee){let ei=this.transaction($,en?"readwrite":"readonly"),es=ei.store;return er&&(es=es.index(ee.shift())),(await Promise.all([es[et](...ee),en&&ei.done]))[0]};return eS.set(ee,method),method}replaceTraps($=>({...$,get:(ee,et,er)=>getMethod(ee,et)||$.get(ee,et,er),has:(ee,et)=>!!getMethod(ee,et)||$.has(ee,et)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let PlatformLoggerServiceImpl=class PlatformLoggerServiceImpl{constructor($){this.container=$}getPlatformInfoString(){let $=this.container.getProviders();return $.map($=>{if(!isVersionServiceProvider($))return null;{let ee=$.getImmediate();return`${ee.library}/${ee.version}`}}).filter($=>$).join(" ")}};function isVersionServiceProvider($){let ee=$.getComponent();return(null==ee?void 0:ee.type)==="VERSION"}let eC="@firebase/app",eT="0.9.19",eE=new es.Yd("@firebase/app"),ew="@firebase/app-compat",eD="@firebase/analytics-compat",eI="@firebase/analytics",eR="@firebase/app-check-compat",e_="@firebase/app-check",eP="@firebase/auth",eA="@firebase/auth-compat",ex="@firebase/database",eO="@firebase/database-compat",ek="@firebase/functions",eN="@firebase/functions-compat",eM="@firebase/installations",eF="@firebase/installations-compat",eL="@firebase/messaging",eB="@firebase/messaging-compat",eV="@firebase/performance",ej="@firebase/performance-compat",eU="@firebase/remote-config",eq="@firebase/remote-config-compat",ez="@firebase/storage",eK="@firebase/storage-compat",eW="@firebase/firestore",eG="@firebase/firestore-compat",e$="firebase",eH="10.4.0",eQ="[DEFAULT]",eY={[eC]:"fire-core",[ew]:"fire-core-compat",[eI]:"fire-analytics",[eD]:"fire-analytics-compat",[e_]:"fire-app-check",[eR]:"fire-app-check-compat",[eP]:"fire-auth",[eA]:"fire-auth-compat",[ex]:"fire-rtdb",[eO]:"fire-rtdb-compat",[ek]:"fire-fn",[eN]:"fire-fn-compat",[eM]:"fire-iid",[eF]:"fire-iid-compat",[eL]:"fire-fcm",[eB]:"fire-fcm-compat",[eV]:"fire-perf",[ej]:"fire-perf-compat",[eU]:"fire-rc",[eq]:"fire-rc-compat",[ez]:"fire-gcs",[eK]:"fire-gcs-compat",[eW]:"fire-fst",[eG]:"fire-fst-compat","fire-js":"fire-js",[e$]:"fire-js-all"},eJ=new Map,eX=new Map;function _addComponent($,ee){try{$.container.addComponent(ee)}catch(et){eE.debug(`Component ${ee.name} failed to register with FirebaseApp ${$.name}`,et)}}function _registerComponent($){let ee=$.name;if(eX.has(ee))return eE.debug(`There were multiple attempts to register component ${ee}.`),!1;for(let et of(eX.set(ee,$),eJ.values()))_addComponent(et,$);return!0}function _getProvider($,ee){let et=$.container.getProvider("heartbeat").getImmediate({optional:!0});return et&&et.triggerHeartbeat(),$.container.getProvider(ee)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eZ={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},e0=new eo.LL("app","Firebase",eZ);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let FirebaseAppImpl=class FirebaseAppImpl{constructor($,ee,et){this._isDeleted=!1,this._options=Object.assign({},$),this._config=Object.assign({},ee),this._name=ee.name,this._automaticDataCollectionEnabled=ee.automaticDataCollectionEnabled,this._container=et,this.container.addComponent(new ei.wA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled($){this.checkDestroyed(),this._automaticDataCollectionEnabled=$}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted($){this._isDeleted=$}checkDestroyed(){if(this.isDeleted)throw e0.create("app-deleted",{appName:this._name})}};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let e1=eH;function initializeApp($,ee={}){let et=$;if("object"!=typeof ee){let $=ee;ee={name:$}}let er=Object.assign({name:eQ,automaticDataCollectionEnabled:!1},ee),en=er.name;if("string"!=typeof en||!en)throw e0.create("bad-app-name",{appName:String(en)});if(et||(et=(0,eo.aH)()),!et)throw e0.create("no-options");let es=eJ.get(en);if(es){if((0,eo.vZ)(et,es.options)&&(0,eo.vZ)(er,es.config))return es;throw e0.create("duplicate-app",{appName:en})}let eu=new ei.H0(en);for(let $ of eX.values())eu.addComponent($);let eh=new FirebaseAppImpl(et,er,eu);return eJ.set(en,eh),eh}function getApp($=eQ){let ee=eJ.get($);if(!ee&&$===eQ&&(0,eo.aH)())return initializeApp();if(!ee)throw e0.create("no-app",{appName:$});return ee}function registerVersion($,ee,et){var er;let en=null!==(er=eY[$])&&void 0!==er?er:$;et&&(en+=`-${et}`);let es=en.match(/\s|\//),eo=ee.match(/\s|\//);if(es||eo){let $=[`Unable to register library "${en}" with version "${ee}":`];es&&$.push(`library name "${en}" contains illegal characters (whitespace or "/")`),es&&eo&&$.push("and"),eo&&$.push(`version name "${ee}" contains illegal characters (whitespace or "/")`),eE.warn($.join(" "));return}_registerComponent(new ei.wA(`${en}-version`,()=>({library:en,version:ee}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let e2="firebase-heartbeat-database",e3=1,e6="firebase-heartbeat-store",e4=null;function getDbPromise(){return e4||(e4=openDB(e2,e3,{upgrade:($,ee)=>{0===ee&&$.createObjectStore(e6)}}).catch($=>{throw e0.create("idb-open",{originalErrorMessage:$.message})})),e4}async function readHeartbeatsFromIndexedDB($){try{let ee=await getDbPromise(),et=await ee.transaction(e6).objectStore(e6).get(computeKey($));return et}catch($){if($ instanceof eo.ZR)eE.warn($.message);else{let ee=e0.create("idb-get",{originalErrorMessage:null==$?void 0:$.message});eE.warn(ee.message)}}}async function writeHeartbeatsToIndexedDB($,ee){try{let et=await getDbPromise(),er=et.transaction(e6,"readwrite"),en=er.objectStore(e6);await en.put(ee,computeKey($)),await er.done}catch($){if($ instanceof eo.ZR)eE.warn($.message);else{let ee=e0.create("idb-set",{originalErrorMessage:null==$?void 0:$.message});eE.warn(ee.message)}}}function computeKey($){return`${$.name}!${$.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let e9=1024,e5=2592e6;let HeartbeatServiceImpl=class HeartbeatServiceImpl{constructor($){this.container=$,this._heartbeatsCache=null;let ee=this.container.getProvider("app").getImmediate();this._storage=new HeartbeatStorageImpl(ee),this._heartbeatsCachePromise=this._storage.read().then($=>(this._heartbeatsCache=$,$))}async triggerHeartbeat(){let $=this.container.getProvider("platform-logger").getImmediate(),ee=$.getPlatformInfoString(),et=getUTCDateString();return(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate===et||this._heartbeatsCache.heartbeats.some($=>$.date===et))?void 0:(this._heartbeatsCache.heartbeats.push({date:et,agent:ee}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter($=>{let ee=new Date($.date).valueOf(),et=Date.now();return et-ee<=e5}),this._storage.overwrite(this._heartbeatsCache))}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";let $=getUTCDateString(),{heartbeatsToSend:ee,unsentEntries:et}=extractHeartbeatsForHeader(this._heartbeatsCache.heartbeats),er=(0,eo.L)(JSON.stringify({version:2,heartbeats:ee}));return this._heartbeatsCache.lastSentHeartbeatDate=$,et.length>0?(this._heartbeatsCache.heartbeats=et,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),er}};function getUTCDateString(){let $=new Date;return $.toISOString().substring(0,10)}function extractHeartbeatsForHeader($,ee=e9){let et=[],er=$.slice();for(let en of $){let $=et.find($=>$.agent===en.agent);if($){if($.dates.push(en.date),countBytes(et)>ee){$.dates.pop();break}}else if(et.push({agent:en.agent,dates:[en.date]}),countBytes(et)>ee){et.pop();break}er=er.slice(1)}return{heartbeatsToSend:et,unsentEntries:er}}let HeartbeatStorageImpl=class HeartbeatStorageImpl{constructor($){this.app=$,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,eo.hl)()&&(0,eo.eu)().then(()=>!0).catch(()=>!1)}async read(){let $=await this._canUseIndexedDBPromise;if(!$)return{heartbeats:[]};{let $=await readHeartbeatsFromIndexedDB(this.app);return $||{heartbeats:[]}}}async overwrite($){var ee;let et=await this._canUseIndexedDBPromise;if(et){let et=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:null!==(ee=$.lastSentHeartbeatDate)&&void 0!==ee?ee:et.lastSentHeartbeatDate,heartbeats:$.heartbeats})}}async add($){var ee;let et=await this._canUseIndexedDBPromise;if(et){let et=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:null!==(ee=$.lastSentHeartbeatDate)&&void 0!==ee?ee:et.lastSentHeartbeatDate,heartbeats:[...et.heartbeats,...$.heartbeats]})}}};function countBytes($){return(0,eo.L)(JSON.stringify({version:2,heartbeats:$})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(function($){_registerComponent(new ei.wA("platform-logger",$=>new PlatformLoggerServiceImpl($),"PRIVATE")),_registerComponent(new ei.wA("heartbeat",$=>new HeartbeatServiceImpl($),"PRIVATE")),registerVersion(eC,eT,""),registerVersion(eC,eT,"esm2017"),registerVersion("fire-js","")})(0)},77345:($,ee,et)=>{"use strict";et.d(ee,{H0:()=>ComponentContainer,wA:()=>Component});var er=et(51780);let Component=class Component{constructor($,ee,et){this.name=$,this.instanceFactory=ee,this.type=et,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode($){return this.instantiationMode=$,this}setMultipleInstances($){return this.multipleInstances=$,this}setServiceProps($){return this.serviceProps=$,this}setInstanceCreatedCallback($){return this.onInstanceCreated=$,this}};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let en="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Provider=class Provider{constructor($,ee){this.name=$,this.container=ee,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get($){let ee=this.normalizeInstanceIdentifier($);if(!this.instancesDeferred.has(ee)){let $=new er.BH;if(this.instancesDeferred.set(ee,$),this.isInitialized(ee)||this.shouldAutoInitialize())try{let et=this.getOrInitializeService({instanceIdentifier:ee});et&&$.resolve(et)}catch($){}}return this.instancesDeferred.get(ee).promise}getImmediate($){var ee;let et=this.normalizeInstanceIdentifier(null==$?void 0:$.identifier),er=null!==(ee=null==$?void 0:$.optional)&&void 0!==ee&&ee;if(this.isInitialized(et)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:et})}catch($){if(er)return null;throw $}else{if(er)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent($){if($.name!==this.name)throw Error(`Mismatching Component ${$.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=$,this.shouldAutoInitialize()){if(isComponentEager($))try{this.getOrInitializeService({instanceIdentifier:en})}catch($){}for(let[$,ee]of this.instancesDeferred.entries()){let et=this.normalizeInstanceIdentifier($);try{let $=this.getOrInitializeService({instanceIdentifier:et});ee.resolve($)}catch($){}}}}clearInstance($=en){this.instancesDeferred.delete($),this.instancesOptions.delete($),this.instances.delete($)}async delete(){let $=Array.from(this.instances.values());await Promise.all([...$.filter($=>"INTERNAL"in $).map($=>$.INTERNAL.delete()),...$.filter($=>"_delete"in $).map($=>$._delete())])}isComponentSet(){return null!=this.component}isInitialized($=en){return this.instances.has($)}getOptions($=en){return this.instancesOptions.get($)||{}}initialize($={}){let{options:ee={}}=$,et=this.normalizeInstanceIdentifier($.instanceIdentifier);if(this.isInitialized(et))throw Error(`${this.name}(${et}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let er=this.getOrInitializeService({instanceIdentifier:et,options:ee});for(let[$,ee]of this.instancesDeferred.entries()){let en=this.normalizeInstanceIdentifier($);et===en&&ee.resolve(er)}return er}onInit($,ee){var et;let er=this.normalizeInstanceIdentifier(ee),en=null!==(et=this.onInitCallbacks.get(er))&&void 0!==et?et:new Set;en.add($),this.onInitCallbacks.set(er,en);let ei=this.instances.get(er);return ei&&$(ei,er),()=>{en.delete($)}}invokeOnInitCallbacks($,ee){let et=this.onInitCallbacks.get(ee);if(et)for(let er of et)try{er($,ee)}catch($){}}getOrInitializeService({instanceIdentifier:$,options:ee={}}){let et=this.instances.get($);if(!et&&this.component&&(et=this.component.instanceFactory(this.container,{instanceIdentifier:normalizeIdentifierForFactory($),options:ee}),this.instances.set($,et),this.instancesOptions.set($,ee),this.invokeOnInitCallbacks(et,$),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,$,et)}catch($){}return et||null}normalizeInstanceIdentifier($=en){return this.component?this.component.multipleInstances?$:en:$}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}};function normalizeIdentifierForFactory($){return $===en?void 0:$}function isComponentEager($){return"EAGER"===$.instantiationMode}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ComponentContainer=class ComponentContainer{constructor($){this.name=$,this.providers=new Map}addComponent($){let ee=this.getProvider($.name);if(ee.isComponentSet())throw Error(`Component ${$.name} has already been registered with ${this.name}`);ee.setComponent($)}addOrOverwriteComponent($){let ee=this.getProvider($.name);ee.isComponentSet()&&this.providers.delete($.name),this.addComponent($)}getProvider($){if(this.providers.has($))return this.providers.get($);let ee=new Provider($,this);return this.providers.set($,ee),ee}getProviders(){return Array.from(this.providers.values())}}},9292:($,ee,et)=>{"use strict";var er;et.d(ee,{Yd:()=>Logger,in:()=>er});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let en=[];!function($){$[$.DEBUG=0]="DEBUG",$[$.VERBOSE=1]="VERBOSE",$[$.INFO=2]="INFO",$[$.WARN=3]="WARN",$[$.ERROR=4]="ERROR",$[$.SILENT=5]="SILENT"}(er||(er={}));let ei={debug:er.DEBUG,verbose:er.VERBOSE,info:er.INFO,warn:er.WARN,error:er.ERROR,silent:er.SILENT},es=er.INFO,eo={[er.DEBUG]:"log",[er.VERBOSE]:"log",[er.INFO]:"info",[er.WARN]:"warn",[er.ERROR]:"error"},defaultLogHandler=($,ee,...et)=>{if(ee<$.logLevel)return;let er=new Date().toISOString(),en=eo[ee];if(en)console[en](`[${er}]  ${$.name}:`,...et);else throw Error(`Attempted to log a message with an invalid logType (value: ${ee})`)};let Logger=class Logger{constructor($){this.name=$,this._logLevel=es,this._logHandler=defaultLogHandler,this._userLogHandler=null,en.push(this)}get logLevel(){return this._logLevel}set logLevel($){if(!($ in er))throw TypeError(`Invalid value "${$}" assigned to \`logLevel\``);this._logLevel=$}setLogLevel($){this._logLevel="string"==typeof $?ei[$]:$}get logHandler(){return this._logHandler}set logHandler($){if("function"!=typeof $)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=$}get userLogHandler(){return this._userLogHandler}set userLogHandler($){this._userLogHandler=$}debug(...$){this._userLogHandler&&this._userLogHandler(this,er.DEBUG,...$),this._logHandler(this,er.DEBUG,...$)}log(...$){this._userLogHandler&&this._userLogHandler(this,er.VERBOSE,...$),this._logHandler(this,er.VERBOSE,...$)}info(...$){this._userLogHandler&&this._userLogHandler(this,er.INFO,...$),this._logHandler(this,er.INFO,...$)}warn(...$){this._userLogHandler&&this._userLogHandler(this,er.WARN,...$),this._logHandler(this,er.WARN,...$)}error(...$){this._userLogHandler&&this._userLogHandler(this,er.ERROR,...$),this._logHandler(this,er.ERROR,...$)}}},51780:($,ee,et)=>{"use strict";et.d(ee,{BH:()=>Deferred,L:()=>base64urlEncodeWithoutPadding,LL:()=>ErrorFactory,P0:()=>getDefaultEmulatorHostnameAndPort,Sg:()=>createMockUserToken,ZR:()=>FirebaseError,aH:()=>getDefaultAppConfig,eu:()=>validateIndexedDBOpenable,hl:()=>isIndexedDBAvailable,m9:()=>getModularInstance,vZ:()=>deepEqual});/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let er={NODE_CLIENT:!1},stringToByteArray$1=function($){let ee=[],et=0;for(let er=0;er<$.length;er++){let en=$.charCodeAt(er);en<128?ee[et++]=en:(en<2048?ee[et++]=en>>6|192:((64512&en)==55296&&er+1<$.length&&(64512&$.charCodeAt(er+1))==56320?(en=65536+((1023&en)<<10)+(1023&$.charCodeAt(++er)),ee[et++]=en>>18|240,ee[et++]=en>>12&63|128):ee[et++]=en>>12|224,ee[et++]=en>>6&63|128),ee[et++]=63&en|128)}return ee},byteArrayToString=function($){let ee=[],et=0,er=0;for(;et<$.length;){let en=$[et++];if(en<128)ee[er++]=String.fromCharCode(en);else if(en>191&&en<224){let ei=$[et++];ee[er++]=String.fromCharCode((31&en)<<6|63&ei)}else if(en>239&&en<365){let ei=$[et++],es=$[et++],eo=$[et++],eu=((7&en)<<18|(63&ei)<<12|(63&es)<<6|63&eo)-65536;ee[er++]=String.fromCharCode(55296+(eu>>10)),ee[er++]=String.fromCharCode(56320+(1023&eu))}else{let ei=$[et++],es=$[et++];ee[er++]=String.fromCharCode((15&en)<<12|(63&ei)<<6|63&es)}}return ee.join("")},en={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray($,ee){if(!Array.isArray($))throw Error("encodeByteArray takes an array as a parameter");this.init_();let et=ee?this.byteToCharMapWebSafe_:this.byteToCharMap_,er=[];for(let ee=0;ee<$.length;ee+=3){let en=$[ee],ei=ee+1<$.length,es=ei?$[ee+1]:0,eo=ee+2<$.length,eu=eo?$[ee+2]:0,eh=en>>2,ep=(3&en)<<4|es>>4,ef=(15&es)<<2|eu>>6,em=63&eu;eo||(em=64,ei||(ef=64)),er.push(et[eh],et[ep],et[ef],et[em])}return er.join("")},encodeString($,ee){return this.HAS_NATIVE_SUPPORT&&!ee?btoa($):this.encodeByteArray(stringToByteArray$1($),ee)},decodeString($,ee){return this.HAS_NATIVE_SUPPORT&&!ee?atob($):byteArrayToString(this.decodeStringToByteArray($,ee))},decodeStringToByteArray($,ee){this.init_();let et=ee?this.charToByteMapWebSafe_:this.charToByteMap_,er=[];for(let ee=0;ee<$.length;){let en=et[$.charAt(ee++)],ei=ee<$.length,es=ei?et[$.charAt(ee)]:0;++ee;let eo=ee<$.length,eu=eo?et[$.charAt(ee)]:64;++ee;let eh=ee<$.length,ep=eh?et[$.charAt(ee)]:64;if(++ee,null==en||null==es||null==eu||null==ep)throw new DecodeBase64StringError;let ef=en<<2|es>>4;if(er.push(ef),64!==eu){let $=es<<4&240|eu>>2;if(er.push($),64!==ep){let $=eu<<6&192|ep;er.push($)}}}return er},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let $=0;$<this.ENCODED_VALS.length;$++)this.byteToCharMap_[$]=this.ENCODED_VALS.charAt($),this.charToByteMap_[this.byteToCharMap_[$]]=$,this.byteToCharMapWebSafe_[$]=this.ENCODED_VALS_WEBSAFE.charAt($),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[$]]=$,$>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt($)]=$,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt($)]=$)}}};let DecodeBase64StringError=class DecodeBase64StringError extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}};let base64Encode=function($){let ee=stringToByteArray$1($);return en.encodeByteArray(ee,!0)},base64urlEncodeWithoutPadding=function($){return base64Encode($).replace(/\./g,"")},base64Decode=function($){try{return en.decodeString($,!0)}catch($){console.error("base64Decode failed: ",$)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getGlobal(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let getDefaultsFromGlobal=()=>getGlobal().__FIREBASE_DEFAULTS__,getDefaultsFromEnvVariable=()=>{if("undefined"==typeof process||void 0===process.env)return;let $=process.env.__FIREBASE_DEFAULTS__;if($)return JSON.parse($)},getDefaultsFromCookie=()=>{let $;if("undefined"==typeof document)return;try{$=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch($){return}let ee=$&&base64Decode($[1]);return ee&&JSON.parse(ee)},getDefaults=()=>{try{return getDefaultsFromGlobal()||getDefaultsFromEnvVariable()||getDefaultsFromCookie()}catch($){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${$}`);return}},getDefaultEmulatorHost=$=>{var ee,et;return null===(et=null===(ee=getDefaults())||void 0===ee?void 0:ee.emulatorHosts)||void 0===et?void 0:et[$]},getDefaultEmulatorHostnameAndPort=$=>{let ee=getDefaultEmulatorHost($);if(!ee)return;let et=ee.lastIndexOf(":");if(et<=0||et+1===ee.length)throw Error(`Invalid host ${ee} with no separate hostname and port!`);let er=parseInt(ee.substring(et+1),10);return"["===ee[0]?[ee.substring(1,et-1),er]:[ee.substring(0,et),er]},getDefaultAppConfig=()=>{var $;return null===($=getDefaults())||void 0===$?void 0:$.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Deferred=class Deferred{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(($,ee)=>{this.resolve=$,this.reject=ee})}wrapCallback($){return(ee,et)=>{ee?this.reject(ee):this.resolve(et),"function"==typeof $&&(this.promise.catch(()=>{}),1===$.length?$(ee):$(ee,et))}}};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function createMockUserToken($,ee){if($.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let et={alg:"none",type:"JWT"},er=ee||"demo-project",en=$.iat||0,ei=$.sub||$.user_id;if(!ei)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let es=Object.assign({iss:`https://securetoken.google.com/${er}`,aud:er,iat:en,exp:en+3600,auth_time:en,sub:ei,user_id:ei,firebase:{sign_in_provider:"custom",identities:{}}},$),eo="";return[base64urlEncodeWithoutPadding(JSON.stringify(et)),base64urlEncodeWithoutPadding(JSON.stringify(es)),eo].join(".")}function isIndexedDBAvailable(){try{return"object"==typeof indexedDB}catch($){return!1}}function validateIndexedDBOpenable(){return new Promise(($,ee)=>{try{let et=!0,er="validate-browser-context-for-indexeddb-analytics-module",en=self.indexedDB.open(er);en.onsuccess=()=>{en.result.close(),et||self.indexedDB.deleteDatabase(er),$(!0)},en.onupgradeneeded=()=>{et=!1},en.onerror=()=>{var $;ee((null===($=en.error)||void 0===$?void 0:$.message)||"")}}catch($){ee($)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ei="FirebaseError";let FirebaseError=class FirebaseError extends Error{constructor($,ee,et){super(ee),this.code=$,this.customData=et,this.name=ei,Object.setPrototypeOf(this,FirebaseError.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ErrorFactory.prototype.create)}};let ErrorFactory=class ErrorFactory{constructor($,ee,et){this.service=$,this.serviceName=ee,this.errors=et}create($,...ee){let et=ee[0]||{},er=`${this.service}/${$}`,en=this.errors[$],ei=en?replaceTemplate(en,et):"Error",es=`${this.serviceName}: ${ei} (${er}).`,eo=new FirebaseError(er,es,et);return eo}};function replaceTemplate($,ee){return $.replace(es,($,et)=>{let er=ee[et];return null!=er?String(er):`<${et}?>`})}let es=/\{\$([^}]+)}/g;function deepEqual($,ee){if($===ee)return!0;let et=Object.keys($),er=Object.keys(ee);for(let en of et){if(!er.includes(en))return!1;let et=$[en],ei=ee[en];if(isObject(et)&&isObject(ei)){if(!deepEqual(et,ei))return!1}else if(et!==ei)return!1}for(let $ of er)if(!et.includes($))return!1;return!0}function isObject($){return null!==$&&"object"==typeof $}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getModularInstance($){return $&&$._delegate?$._delegate:$}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */er.NODE_CLIENT=!0},72856:($,ee,et)=>{"use strict";et.d(ee,{ZF:()=>er.ZF});var er=et(55087),en="firebase",ei="10.4.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(0,er.KN)(en,ei,"app")},61522:($,ee,et)=>{"use strict";et.d(ee,{ET:()=>addDoc,hJ:()=>collection,oe:()=>deleteDoc,JU:()=>doc,QT:()=>getDoc,PL:()=>getDocs,ad:()=>getFirestore,Xo:()=>orderBy,IO:()=>query,pl:()=>setDoc,r7:()=>updateDoc});var er,en,ei,es,eo,eu=et(55087),eh=et(77345),ep=et(9292),ef=et(73837),em=et(51780),eg=et(6113),ey="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ev={},eS=eS||{},eC=ey||self;function aa($){var ee=typeof $;return"array"==(ee="object"!=ee?ee:$?Array.isArray($)?"array":ee:"null")||"object"==ee&&"number"==typeof $.length}function p($){var ee=typeof $;return"object"==ee&&null!=$||"function"==ee}function ba($){return Object.prototype.hasOwnProperty.call($,eT)&&$[eT]||($[eT]=++eE)}var eT="closure_uid_"+(1e9*Math.random()>>>0),eE=0;function ea($,ee,et){return $.call.apply($.bind,arguments)}function fa($,ee,et){if(!$)throw Error();if(2<arguments.length){var er=Array.prototype.slice.call(arguments,2);return function(){var et=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(et,er),$.apply(ee,et)}}return function(){return $.apply(ee,arguments)}}function q($,ee,et){return(q=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ea:fa).apply(null,arguments)}function ha($,ee){var et=Array.prototype.slice.call(arguments,1);return function(){var ee=et.slice();return ee.push.apply(ee,arguments),$.apply(this,ee)}}function r($,ee){function c(){}c.prototype=ee.prototype,$.$=ee.prototype,$.prototype=new c,$.prototype.constructor=$,$.ac=function($,et,er){for(var en=Array(arguments.length-2),ei=2;ei<arguments.length;ei++)en[ei-2]=arguments[ei];return ee.prototype[et].apply($,en)}}function v(){this.s=this.s,this.o=this.o}var ew=0;v.prototype.s=!1,v.prototype.sa=function(){this.s||(this.s=!0,this.N(),0==ew)||ba(this)},v.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};let eD=Array.prototype.indexOf?function($,ee){return Array.prototype.indexOf.call($,ee,void 0)}:function($,ee){if("string"==typeof $)return"string"!=typeof ee||1!=ee.length?-1:$.indexOf(ee,0);for(let et=0;et<$.length;et++)if(et in $&&$[et]===ee)return et;return -1};function ma($){let ee=$.length;if(0<ee){let et=Array(ee);for(let er=0;er<ee;er++)et[er]=$[er];return et}return[]}function na($,ee){for(let ee=1;ee<arguments.length;ee++){let et=arguments[ee];if(aa(et)){let ee=$.length||0,er=et.length||0;$.length=ee+er;for(let en=0;en<er;en++)$[ee+en]=et[en]}else $.push(et)}}function w($,ee){this.type=$,this.g=this.target=ee,this.defaultPrevented=!1}w.prototype.h=function(){this.defaultPrevented=!0};var eI=function(){if(!eC.addEventListener||!Object.defineProperty)return!1;var $=!1,ee=Object.defineProperty({},"passive",{get:function(){$=!0}});try{eC.addEventListener("test",()=>{},ee),eC.removeEventListener("test",()=>{},ee)}catch($){}return $}();function x($){return/^[\s\xa0]*$/.test($)}function pa(){var $=eC.navigator;return $&&($=$.userAgent)?$:""}function y($){return -1!=pa().indexOf($)}function qa($){return qa[" "]($),$}function ra($,ee){var et=tp;return Object.prototype.hasOwnProperty.call(et,$)?et[$]:et[$]=ee($)}qa[" "]=function(){};var eR=y("Opera"),e_=y("Trident")||y("MSIE"),eP=y("Edge"),eA=eP||e_,ex=y("Gecko")&&!(-1!=pa().toLowerCase().indexOf("webkit")&&!y("Edge"))&&!(y("Trident")||y("MSIE"))&&!y("Edge"),eO=-1!=pa().toLowerCase().indexOf("webkit")&&!y("Edge");function ya(){var $=eC.document;return $?$.documentMode:void 0}e:{var ek="",eN=function(){var $=pa();return ex?/rv:([^\);]+)(\)|;)/.exec($):eP?/Edge\/([\d\.]+)/.exec($):e_?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec($):eO?/WebKit\/(\S+)/.exec($):eR?/(?:Version)[ \/]?(\S+)/.exec($):void 0}();if(eN&&(ek=eN?eN[1]:""),e_){var eM=ya();if(null!=eM&&eM>parseFloat(ek)){er=String(eM);break e}}er=ek}var eF=en=eC.document&&e_&&(ya()||parseInt(er,10))||void 0;function A($,ee){if(w.call(this,$?$.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,$){var et=this.type=$.type,er=$.changedTouches&&$.changedTouches.length?$.changedTouches[0]:null;if(this.target=$.target||$.srcElement,this.g=ee,ee=$.relatedTarget){if(ex){e:{try{qa(ee.nodeName);var en=!0;break e}catch($){}en=!1}en||(ee=null)}}else"mouseover"==et?ee=$.fromElement:"mouseout"==et&&(ee=$.toElement);this.relatedTarget=ee,er?(this.clientX=void 0!==er.clientX?er.clientX:er.pageX,this.clientY=void 0!==er.clientY?er.clientY:er.pageY,this.screenX=er.screenX||0,this.screenY=er.screenY||0):(this.clientX=void 0!==$.clientX?$.clientX:$.pageX,this.clientY=void 0!==$.clientY?$.clientY:$.pageY,this.screenX=$.screenX||0,this.screenY=$.screenY||0),this.button=$.button,this.key=$.key||"",this.ctrlKey=$.ctrlKey,this.altKey=$.altKey,this.shiftKey=$.shiftKey,this.metaKey=$.metaKey,this.pointerId=$.pointerId||0,this.pointerType="string"==typeof $.pointerType?$.pointerType:eL[$.pointerType]||"",this.state=$.state,this.i=$,$.defaultPrevented&&A.$.h.call(this)}}r(A,w);var eL={2:"touch",3:"pen",4:"mouse"};A.prototype.h=function(){A.$.h.call(this);var $=this.i;$.preventDefault?$.preventDefault():$.returnValue=!1};var eB="closure_listenable_"+(1e6*Math.random()|0),eV=0;function Ja($,ee,et,er,en){this.listener=$,this.proxy=null,this.src=ee,this.type=et,this.capture=!!er,this.la=en,this.key=++eV,this.fa=this.ia=!1}function Ka($){$.fa=!0,$.listener=null,$.proxy=null,$.src=null,$.la=null}function Na($,ee,et){for(let er in $)ee.call(et,$[er],er,$)}function Oa($,ee){for(let et in $)ee.call(void 0,$[et],et,$)}function Pa($){let ee={};for(let et in $)ee[et]=$[et];return ee}let ej="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ra($,ee){let et,er;for(let ee=1;ee<arguments.length;ee++){for(et in er=arguments[ee])$[et]=er[et];for(let ee=0;ee<ej.length;ee++)et=ej[ee],Object.prototype.hasOwnProperty.call(er,et)&&($[et]=er[et])}}function Sa($){this.src=$,this.g={},this.h=0}function Ua($,ee){var et=ee.type;if(et in $.g){var er,en=$.g[et],ei=eD(en,ee);(er=0<=ei)&&Array.prototype.splice.call(en,ei,1),er&&(Ka(ee),0==$.g[et].length&&(delete $.g[et],$.h--))}}function Ta($,ee,et,er){for(var en=0;en<$.length;++en){var ei=$[en];if(!ei.fa&&ei.listener==ee&&!!et==ei.capture&&ei.la==er)return en}return -1}Sa.prototype.add=function($,ee,et,er,en){var ei=$.toString();($=this.g[ei])||($=this.g[ei]=[],this.h++);var es=Ta($,ee,er,en);return -1<es?(ee=$[es],et||(ee.ia=!1)):((ee=new Ja(ee,this.src,ei,!!er,en)).ia=et,$.push(ee)),ee};var eU="closure_lm_"+(1e6*Math.random()|0),eq={};function Ya($,ee,et,er,en){if(er&&er.once)return Za($,ee,et,er,en);if(Array.isArray(ee)){for(var ei=0;ei<ee.length;ei++)Ya($,ee[ei],et,er,en);return null}return et=$a(et),$&&$[eB]?$.O(ee,et,p(er)?!!er.capture:!!er,en):ab($,ee,et,!1,er,en)}function ab($,ee,et,er,en,ei){if(!ee)throw Error("Invalid event type");var es=p(en)?!!en.capture:!!en,eo=bb($);if(eo||($[eU]=eo=new Sa($)),(et=eo.add(ee,et,er,es,ei)).proxy)return et;if(er=cb(),et.proxy=er,er.src=$,er.listener=et,$.addEventListener)eI||(en=es),void 0===en&&(en=!1),$.addEventListener(ee.toString(),er,en);else if($.attachEvent)$.attachEvent(db(ee.toString()),er);else if($.addListener&&$.removeListener)$.addListener(er);else throw Error("addEventListener and attachEvent are unavailable.");return et}function cb(){function a(ee){return $.call(a.src,a.listener,ee)}let $=eb;return a}function Za($,ee,et,er,en){if(Array.isArray(ee)){for(var ei=0;ei<ee.length;ei++)Za($,ee[ei],et,er,en);return null}return et=$a(et),$&&$[eB]?$.P(ee,et,p(er)?!!er.capture:!!er,en):ab($,ee,et,!0,er,en)}function fb($,ee,et,er,en){if(Array.isArray(ee))for(var ei=0;ei<ee.length;ei++)fb($,ee[ei],et,er,en);else(er=p(er)?!!er.capture:!!er,et=$a(et),$&&$[eB])?($=$.i,(ee=String(ee).toString())in $.g&&-1<(et=Ta(ei=$.g[ee],et,er,en))&&(Ka(ei[et]),Array.prototype.splice.call(ei,et,1),0==ei.length&&(delete $.g[ee],$.h--))):$&&($=bb($))&&(ee=$.g[ee.toString()],$=-1,ee&&($=Ta(ee,et,er,en)),(et=-1<$?ee[$]:null)&&gb(et))}function gb($){if("number"!=typeof $&&$&&!$.fa){var ee=$.src;if(ee&&ee[eB])Ua(ee.i,$);else{var et=$.type,er=$.proxy;ee.removeEventListener?ee.removeEventListener(et,er,$.capture):ee.detachEvent?ee.detachEvent(db(et),er):ee.addListener&&ee.removeListener&&ee.removeListener(er),(et=bb(ee))?(Ua(et,$),0==et.h&&(et.src=null,ee[eU]=null)):Ka($)}}}function db($){return $ in eq?eq[$]:eq[$]="on"+$}function eb($,ee){if($.fa)$=!0;else{ee=new A(ee,this);var et=$.listener,er=$.la||$.src;$.ia&&gb($),$=et.call(er,ee)}return $}function bb($){return($=$[eU])instanceof Sa?$:null}var ez="__closure_events_fn_"+(1e9*Math.random()>>>0);function $a($){return"function"==typeof $?$:($[ez]||($[ez]=function(ee){return $.handleEvent(ee)}),$[ez])}function B(){v.call(this),this.i=new Sa(this),this.S=this,this.J=null}function C($,ee){var et,er=$.J;if(er)for(et=[];er;er=er.J)et.push(er);if($=$.S,er=ee.type||ee,"string"==typeof ee)ee=new w(ee,$);else if(ee instanceof w)ee.target=ee.target||$;else{var en=ee;Ra(ee=new w(er,$),en)}if(en=!0,et)for(var ei=et.length-1;0<=ei;ei--){var es=ee.g=et[ei];en=ib(es,er,!0,ee)&&en}if(en=ib(es=ee.g=$,er,!0,ee)&&en,en=ib(es,er,!1,ee)&&en,et)for(ei=0;ei<et.length;ei++)en=ib(es=ee.g=et[ei],er,!1,ee)&&en}function ib($,ee,et,er){if(!(ee=$.i.g[String(ee)]))return!0;ee=ee.concat();for(var en=!0,ei=0;ei<ee.length;++ei){var es=ee[ei];if(es&&!es.fa&&es.capture==et){var eo=es.listener,eu=es.la||es.src;es.ia&&Ua($.i,es),en=!1!==eo.call(eu,er)&&en}}return en&&!er.defaultPrevented}r(B,v),B.prototype[eB]=!0,B.prototype.removeEventListener=function($,ee,et,er){fb(this,$,ee,et,er)},B.prototype.N=function(){if(B.$.N.call(this),this.i){var $,ee=this.i;for($ in ee.g){for(var et=ee.g[$],er=0;er<et.length;er++)Ka(et[er]);delete ee.g[$],ee.h--}}this.J=null},B.prototype.O=function($,ee,et,er){return this.i.add(String($),ee,!1,et,er)},B.prototype.P=function($,ee,et,er){return this.i.add(String($),ee,!0,et,er)};var eK=eC.JSON.stringify;let kb=class kb{constructor($,ee){this.i=$,this.j=ee,this.h=0,this.g=null}get(){let $;return 0<this.h?(this.h--,$=this.g,this.g=$.next,$.next=null):$=this.i(),$}};function lb(){var $=eH;let ee=null;return $.g&&(ee=$.g,$.g=$.g.next,$.g||($.h=null),ee.next=null),ee}let nb=class nb{constructor(){this.h=this.g=null}add($,ee){let et=eW.get();et.set($,ee),this.h?this.h.next=et:this.g=et,this.h=et}};var eW=new kb(()=>new pb,$=>$.reset());let pb=class pb{constructor(){this.next=this.g=this.h=null}set($,ee){this.h=$,this.g=ee,this.next=null}reset(){this.next=this.g=this.h=null}};function qb($){var ee=1;$=$.split(":");let et=[];for(;0<ee&&$.length;)et.push($.shift()),ee--;return $.length&&et.push($.join(":")),et}function rb($){eC.setTimeout(()=>{throw $},0)}let eG,e$=!1,eH=new nb,vb=()=>{let $=eC.Promise.resolve(void 0);eG=()=>{$.then(ub)}};var ub=()=>{for(var $;$=lb();){try{$.h.call($.g)}catch($){rb($)}var ee=eW;ee.j($),100>ee.h&&(ee.h++,$.next=ee.g,ee.g=$)}e$=!1};function wb($,ee){B.call(this),this.h=$||1,this.g=ee||eC,this.j=q(this.qb,this),this.l=Date.now()}function xb($){$.ga=!1,$.T&&($.g.clearTimeout($.T),$.T=null)}function yb($,ee,et){if("function"==typeof $)et&&($=q($,et));else if($&&"function"==typeof $.handleEvent)$=q($.handleEvent,$);else throw Error("Invalid listener argument");return 2147483647<Number(ee)?-1:eC.setTimeout($,ee||0)}function zb($){$.g=yb(()=>{$.g=null,$.i&&($.i=!1,zb($))},$.j);let ee=$.h;$.h=null,$.m.apply(null,ee)}r(wb,B),(eo=wb.prototype).ga=!1,eo.T=null,eo.qb=function(){if(this.ga){var $=Date.now()-this.l;0<$&&$<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-$):(this.T&&(this.g.clearTimeout(this.T),this.T=null),C(this,"tick"),this.ga&&(xb(this),this.start()))}},eo.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},eo.N=function(){wb.$.N.call(this),xb(this),delete this.g};let Ab=class Ab extends v{constructor($,ee){super(),this.m=$,this.j=ee,this.h=null,this.i=!1,this.g=null}l($){this.h=arguments,this.g?this.i=!0:zb(this)}N(){super.N(),this.g&&(eC.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function Bb($){v.call(this),this.h=$,this.g={}}r(Bb,v);var eQ=[];function Db($,ee,et,er){Array.isArray(et)||(et&&(eQ[0]=et.toString()),et=eQ);for(var en=0;en<et.length;en++){var ei=Ya(ee,et[en],er||$.handleEvent,!1,$.h||$);if(!ei)break;$.g[ei.key]=ei}}function Fb($){Na($.g,function($,ee){this.g.hasOwnProperty(ee)&&gb($)},$),$.g={}}function Gb(){this.g=!0}function Hb($,ee,et,er,en,ei){$.info(function(){if($.g){if(ei)for(var es="",eo=ei.split("&"),eu=0;eu<eo.length;eu++){var eh=eo[eu].split("=");if(1<eh.length){var ep=eh[0];eh=eh[1];var ef=ep.split("_");es=2<=ef.length&&"type"==ef[1]?es+(ep+"=")+eh+"&":es+(ep+"=redacted&")}}else es=null}else es=ei;return"XMLHTTP REQ ("+er+") [attempt "+en+"]: "+ee+"\n"+et+"\n"+es})}function Ib($,ee,et,er,en,ei,es){$.info(function(){return"XMLHTTP RESP ("+er+") [ attempt "+en+"]: "+ee+"\n"+et+"\n"+ei+" "+es})}function D($,ee,et,er){$.info(function(){return"XMLHTTP TEXT ("+ee+"): "+Jb($,et)+(er?" "+er:"")})}function Kb($,ee){$.info(function(){return"TIMEOUT: "+ee})}function Jb($,ee){if(!$.g)return ee;if(!ee)return null;try{var et=JSON.parse(ee);if(et){for($=0;$<et.length;$++)if(Array.isArray(et[$])){var er=et[$];if(!(2>er.length)){var en=er[1];if(Array.isArray(en)&&!(1>en.length)){var ei=en[0];if("noop"!=ei&&"stop"!=ei&&"close"!=ei)for(var es=1;es<en.length;es++)en[es]=""}}}}return eK(et)}catch($){return ee}}Bb.prototype.N=function(){Bb.$.N.call(this),Fb(this)},Bb.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Gb.prototype.Ea=function(){this.g=!1},Gb.prototype.info=function(){};var eY={},eJ=null;function Mb(){return eJ=eJ||new B}function Nb($){w.call(this,eY.Ta,$)}function Ob($){let ee=Mb();C(ee,new Nb(ee))}function Pb($,ee){w.call(this,eY.STAT_EVENT,$),this.stat=ee}function F($){let ee=Mb();C(ee,new Pb(ee,$))}function Qb($,ee){w.call(this,eY.Ua,$),this.size=ee}function Rb($,ee){if("function"!=typeof $)throw Error("Fn must not be null and must be a function");return eC.setTimeout(function(){$()},ee)}eY.Ta="serverreachability",r(Nb,w),eY.STAT_EVENT="statevent",r(Pb,w),eY.Ua="timingevent",r(Qb,w);var eX={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},eZ={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Ub(){}function Vb($){return $.h||($.h=$.i())}function Wb(){}Ub.prototype.h=null;var e0={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Yb(){w.call(this,"d")}function Zb(){w.call(this,"c")}function ac(){}function bc($,ee,et,er){this.l=$,this.j=ee,this.m=et,this.W=er||1,this.U=new Bb(this),this.P=e1,$=eA?125:void 0,this.V=new wb($),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new dc}function dc(){this.i=null,this.g="",this.h=!1}r(Yb,w),r(Zb,w),r(ac,Ub),ac.prototype.g=function(){return new XMLHttpRequest},ac.prototype.i=function(){return{}},ei=new ac;var e1=45e3,e2={},e3={};function gc($,ee,et){$.L=1,$.v=hc(G(ee)),$.s=et,$.S=!0,ic($,null)}function ic($,ee){$.G=Date.now(),jc($),$.A=G($.v);var et=$.A,er=$.W;Array.isArray(er)||(er=[String(er)]),kc(et.i,"t",er),$.C=0,et=$.l.J,$.h=new dc,$.g=lc($.l,et?ee:null,!$.s),0<$.O&&($.M=new Ab(q($.Pa,$,$.g),$.O)),Db($.U,$.g,"readystatechange",$.nb),ee=$.I?Pa($.I):{},$.s?($.u||($.u="POST"),ee["Content-Type"]="application/x-www-form-urlencoded",$.g.ha($.A,$.u,$.s,ee)):($.u="GET",$.g.ha($.A,$.u,null,ee)),Ob(),Hb($.j,$.u,$.A,$.m,$.W,$.s)}function oc($){return!!$.g&&"GET"==$.u&&2!=$.L&&$.l.Ha}function rc($,ee,et){let er=!0,en;for(;!$.J&&$.C<et.length;)if((en=uc($,et))==e3){4==ee&&($.o=4,F(14),er=!1),D($.j,$.m,null,"[Incomplete Response]");break}else if(en==e2){$.o=4,F(15),D($.j,$.m,et,"[Invalid Chunk]"),er=!1;break}else D($.j,$.m,en,null),qc($,en);oc($)&&en!=e3&&en!=e2&&($.h.g="",$.C=0),4!=ee||0!=et.length||$.h.h||($.o=1,F(16),er=!1),$.i=$.i&&er,er?0<et.length&&!$.ba&&($.ba=!0,(ee=$.l).g==$&&ee.ca&&!ee.M&&(ee.l.info("Great, no buffering proxy detected. Bytes received: "+et.length),vc(ee),ee.M=!0,F(11))):(D($.j,$.m,et,"[Invalid Chunked Response]"),I($),pc($))}function uc($,ee){var et=$.C,er=ee.indexOf("\n",et);return -1==er?e3:isNaN(et=Number(ee.substring(et,er)))?e2:(er+=1)+et>ee.length?e3:(ee=ee.slice(er,er+et),$.C=er+et,ee)}function jc($){$.Y=Date.now()+$.P,wc($,$.P)}function wc($,ee){if(null!=$.B)throw Error("WatchDog timer not null");$.B=Rb(q($.lb,$),ee)}function nc($){$.B&&(eC.clearTimeout($.B),$.B=null)}function pc($){0==$.l.H||$.J||sc($.l,$)}function I($){nc($);var ee=$.M;ee&&"function"==typeof ee.sa&&ee.sa(),$.M=null,xb($.V),Fb($.U),$.g&&(ee=$.g,$.g=null,ee.abort(),ee.sa())}function qc($,ee){try{var et=$.l;if(0!=et.H&&(et.g==$||xc(et.i,$))){if(!$.K&&xc(et.i,$)&&3==et.H){try{var er=et.Ja.g.parse(ee)}catch($){er=null}if(Array.isArray(er)&&3==er.length){var en=er;if(0==en[0]){e:if(!et.u){if(et.g){if(et.g.G+3e3<$.G)yc(et),zc(et);else break e}Ac(et),F(18)}}else et.Fa=en[1],0<et.Fa-et.V&&37500>en[2]&&et.G&&0==et.A&&!et.v&&(et.v=Rb(q(et.ib,et),6e3));if(1>=Bc(et.i)&&et.oa){try{et.oa()}catch($){}et.oa=void 0}}else J(et,11)}else if(($.K||et.g==$)&&yc(et),!x(ee))for(en=et.Ja.g.parse(ee),ee=0;ee<en.length;ee++){let eh=en[ee];if(et.V=eh[0],eh=eh[1],2==et.H){if("c"==eh[0]){et.K=eh[1],et.pa=eh[2];let ee=eh[3];null!=ee&&(et.ra=ee,et.l.info("VER="+et.ra));let en=eh[4];null!=en&&(et.Ga=en,et.l.info("SVER="+et.Ga));let ep=eh[5];null!=ep&&"number"==typeof ep&&0<ep&&(er=1.5*ep,et.L=er,et.l.info("backChannelRequestTimeoutMs_="+er)),er=et;let ef=$.g;if(ef){let $=ef.g?ef.g.getResponseHeader("X-Client-Wire-Protocol"):null;if($){var ei=er.i;ei.g||-1==$.indexOf("spdy")&&-1==$.indexOf("quic")&&-1==$.indexOf("h2")||(ei.j=ei.l,ei.g=new Set,ei.h&&(Cc(ei,ei.h),ei.h=null))}if(er.F){let $=ef.g?ef.g.getResponseHeader("X-HTTP-Session-Id"):null;$&&(er.Da=$,K(er.I,er.F,$))}}et.H=3,et.h&&et.h.Ba(),et.ca&&(et.S=Date.now()-$.G,et.l.info("Handshake RTT: "+et.S+"ms")),er=et;var es=$;if(er.wa=Dc(er,er.J?er.pa:null,er.Y),es.K){Ec(er.i,es);var eo=es,eu=er.L;eu&&eo.setTimeout(eu),eo.B&&(nc(eo),jc(eo)),er.g=es}else Fc(er);0<et.j.length&&Gc(et)}else"stop"!=eh[0]&&"close"!=eh[0]||J(et,7)}else 3==et.H&&("stop"==eh[0]||"close"==eh[0]?"stop"==eh[0]?J(et,7):Hc(et):"noop"!=eh[0]&&et.h&&et.h.Aa(eh),et.A=0)}}Ob(4)}catch($){}}function Ic($){if($.Z&&"function"==typeof $.Z)return $.Z();if("undefined"!=typeof Map&&$ instanceof Map||"undefined"!=typeof Set&&$ instanceof Set)return Array.from($.values());if("string"==typeof $)return $.split("");if(aa($)){for(var ee=[],et=$.length,er=0;er<et;er++)ee.push($[er]);return ee}for(er in ee=[],et=0,$)ee[et++]=$[er];return ee}function Jc($){if($.ta&&"function"==typeof $.ta)return $.ta();if(!$.Z||"function"!=typeof $.Z){if("undefined"!=typeof Map&&$ instanceof Map)return Array.from($.keys());if(!("undefined"!=typeof Set&&$ instanceof Set)){if(aa($)||"string"==typeof $){var ee=[];$=$.length;for(var et=0;et<$;et++)ee.push(et);return ee}for(let er in ee=[],et=0,$)ee[et++]=er;return ee}}}function Kc($,ee){if($.forEach&&"function"==typeof $.forEach)$.forEach(ee,void 0);else if(aa($)||"string"==typeof $)Array.prototype.forEach.call($,ee,void 0);else for(var et=Jc($),er=Ic($),en=er.length,ei=0;ei<en;ei++)ee.call(void 0,er[ei],et&&et[ei],$)}(eo=bc.prototype).setTimeout=function($){this.P=$},eo.nb=function($){$=$.target;let ee=this.M;ee&&3==H($)?ee.l():this.Pa($)},eo.Pa=function($){try{if($==this.g)e:{let ep=H(this.g);var ee=this.g.Ia();let ef=this.g.da();if(!(3>ep)&&(3!=ep||eA||this.g&&(this.h.h||this.g.ja()||mc(this.g)))){this.J||4!=ep||7==ee||(8==ee||0>=ef?Ob(3):Ob(2)),nc(this);var et=this.g.da();this.ca=et;t:if(oc(this)){var er=mc(this.g);$="";var en=er.length,ei=4==H(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){I(this),pc(this);var es="";break t}this.h.i=new eC.TextDecoder}for(ee=0;ee<en;ee++)this.h.h=!0,$+=this.h.i.decode(er[ee],{stream:ei&&ee==en-1});er.splice(0,en),this.h.g+=$,this.C=0,es=this.h.g}else es=this.g.ja();if(this.i=200==et,Ib(this.j,this.u,this.A,this.m,this.W,ep,et),this.i){if(this.aa&&!this.K){t:{if(this.g){var eo,eu=this.g;if((eo=eu.g?eu.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!x(eo)){var eh=eo;break t}}eh=null}if(et=eh)D(this.j,this.m,et,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,qc(this,et);else{this.i=!1,this.o=3,F(12),I(this),pc(this);break e}}this.S?(rc(this,ep,es),eA&&this.i&&3==ep&&(Db(this.U,this.V,"tick",this.mb),this.V.start())):(D(this.j,this.m,es,null),qc(this,es)),4==ep&&I(this),this.i&&!this.J&&(4==ep?sc(this.l,this):(this.i=!1,jc(this)))}else tc(this.g),400==et&&0<es.indexOf("Unknown SID")?(this.o=3,F(12)):(this.o=0,F(13)),I(this),pc(this)}}}catch($){}finally{}},eo.mb=function(){if(this.g){var $=H(this.g),ee=this.g.ja();this.C<ee.length&&(nc(this),rc(this,$,ee),this.i&&4!=$&&jc(this))}},eo.cancel=function(){this.J=!0,I(this)},eo.lb=function(){this.B=null;let $=Date.now();0<=$-this.Y?(Kb(this.j,this.A),2!=this.L&&(Ob(),F(17)),I(this),this.o=2,pc(this)):wc(this,this.Y-$)};var e6=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Mc($,ee){if($){$=$.split("&");for(var et=0;et<$.length;et++){var er=$[et].indexOf("="),en=null;if(0<=er){var ei=$[et].substring(0,er);en=$[et].substring(er+1)}else ei=$[et];ee(ei,en?decodeURIComponent(en.replace(/\+/g," ")):"")}}}function M($){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,$ instanceof M){this.h=$.h,Nc(this,$.j),this.s=$.s,this.g=$.g,Oc(this,$.m),this.l=$.l;var ee=$.i,et=new Pc;et.i=ee.i,ee.g&&(et.g=new Map(ee.g),et.h=ee.h),Qc(this,et),this.o=$.o}else $&&(ee=String($).match(e6))?(this.h=!1,Nc(this,ee[1]||"",!0),this.s=Rc(ee[2]||""),this.g=Rc(ee[3]||"",!0),Oc(this,ee[4]),this.l=Rc(ee[5]||"",!0),Qc(this,ee[6]||"",!0),this.o=Rc(ee[7]||"")):(this.h=!1,this.i=new Pc(null,this.h))}function G($){return new M($)}function Nc($,ee,et){$.j=et?Rc(ee,!0):ee,$.j&&($.j=$.j.replace(/:$/,""))}function Oc($,ee){if(ee){if(isNaN(ee=Number(ee))||0>ee)throw Error("Bad port number "+ee);$.m=ee}else $.m=null}function Qc($,ee,et){ee instanceof Pc?($.i=ee,Xc($.i,$.h)):(et||(ee=Sc(ee,e8)),$.i=new Pc(ee,$.h))}function K($,ee,et){$.i.set(ee,et)}function hc($){return K($,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),$}function Rc($,ee){return $?ee?decodeURI($.replace(/%25/g,"%2525")):decodeURIComponent($):""}function Sc($,ee,et){return"string"==typeof $?($=encodeURI($).replace(ee,Zc),et&&($=$.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),$):null}function Zc($){return"%"+(($=$.charCodeAt(0))>>4&15).toString(16)+(15&$).toString(16)}M.prototype.toString=function(){var $=[],ee=this.j;ee&&$.push(Sc(ee,e4,!0),":");var et=this.g;return(et||"file"==ee)&&($.push("//"),(ee=this.s)&&$.push(Sc(ee,e4,!0),"@"),$.push(encodeURIComponent(String(et)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(et=this.m)&&$.push(":",String(et))),(et=this.l)&&(this.g&&"/"!=et.charAt(0)&&$.push("/"),$.push(Sc(et,"/"==et.charAt(0)?e5:e9,!0))),(et=this.i.toString())&&$.push("?",et),(et=this.o)&&$.push("#",Sc(et,e7)),$.join("")};var e4=/[#\/\?@]/g,e9=/[#\?:]/g,e5=/[#\?]/g,e8=/[#\?@]/g,e7=/#/g;function Pc($,ee){this.h=this.g=null,this.i=$||null,this.j=!!ee}function N($){$.g||($.g=new Map,$.h=0,$.i&&Mc($.i,function(ee,et){$.add(decodeURIComponent(ee.replace(/\+/g," ")),et)}))}function $c($,ee){N($),ee=O($,ee),$.g.has(ee)&&($.i=null,$.h-=$.g.get(ee).length,$.g.delete(ee))}function ad($,ee){return N($),ee=O($,ee),$.g.has(ee)}function kc($,ee,et){$c($,ee),0<et.length&&($.i=null,$.g.set(O($,ee),ma(et)),$.h+=et.length)}function O($,ee){return ee=String(ee),$.j&&(ee=ee.toLowerCase()),ee}function Xc($,ee){ee&&!$.j&&(N($),$.i=null,$.g.forEach(function($,ee){var et=ee.toLowerCase();ee!=et&&($c(this,ee),kc(this,et,$))},$)),$.j=ee}(eo=Pc.prototype).add=function($,ee){N(this),this.i=null,$=O(this,$);var et=this.g.get($);return et||this.g.set($,et=[]),et.push(ee),this.h+=1,this},eo.forEach=function($,ee){N(this),this.g.forEach(function(et,er){et.forEach(function(et){$.call(ee,et,er,this)},this)},this)},eo.ta=function(){N(this);let $=Array.from(this.g.values()),ee=Array.from(this.g.keys()),et=[];for(let er=0;er<ee.length;er++){let en=$[er];for(let $=0;$<en.length;$++)et.push(ee[er])}return et},eo.Z=function($){N(this);let ee=[];if("string"==typeof $)ad(this,$)&&(ee=ee.concat(this.g.get(O(this,$))));else{$=Array.from(this.g.values());for(let et=0;et<$.length;et++)ee=ee.concat($[et])}return ee},eo.set=function($,ee){return N(this),this.i=null,ad(this,$=O(this,$))&&(this.h-=this.g.get($).length),this.g.set($,[ee]),this.h+=1,this},eo.get=function($,ee){return $&&0<($=this.Z($)).length?String($[0]):ee},eo.toString=function(){if(this.i)return this.i;if(!this.g)return"";let $=[],ee=Array.from(this.g.keys());for(var et=0;et<ee.length;et++){var er=ee[et];let ei=encodeURIComponent(String(er)),es=this.Z(er);for(er=0;er<es.length;er++){var en=ei;""!==es[er]&&(en+="="+encodeURIComponent(String(es[er]))),$.push(en)}}return this.i=$.join("&")};var te=class{constructor($,ee){this.g=$,this.map=ee}};function cd($){this.l=$||tt,$=eC.PerformanceNavigationTiming?0<($=eC.performance.getEntriesByType("navigation")).length&&("hq"==$[0].nextHopProtocol||"h2"==$[0].nextHopProtocol):!!(eC.g&&eC.g.Ka&&eC.g.Ka()&&eC.g.Ka().dc),this.j=$?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var tt=10;function ed($){return!!$.h||!!$.g&&$.g.size>=$.j}function Bc($){return $.h?1:$.g?$.g.size:0}function xc($,ee){return $.h?$.h==ee:!!$.g&&$.g.has(ee)}function Cc($,ee){$.g?$.g.add(ee):$.h=ee}function Ec($,ee){$.h&&$.h==ee?$.h=null:$.g&&$.g.has(ee)&&$.g.delete(ee)}function fd($){if(null!=$.h)return $.i.concat($.h.F);if(null!=$.g&&0!==$.g.size){let ee=$.i;for(let et of $.g.values())ee=ee.concat(et.F);return ee}return ma($.i)}cd.prototype.cancel=function(){if(this.i=fd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let $ of this.g.values())$.cancel();this.g.clear()}};var tr=class{stringify($){return eC.JSON.stringify($,void 0)}parse($){return eC.JSON.parse($,void 0)}};function hd(){this.g=new tr}function id($,ee,et){let er=et||"";try{Kc($,function($,et){let en=$;p($)&&(en=eK($)),ee.push(er+et+"="+encodeURIComponent(en))})}catch($){throw ee.push(er+"type="+encodeURIComponent("_badmap")),$}}function jd($,ee){let et=new Gb;if(eC.Image){let er=new Image;er.onload=ha(kd,et,er,"TestLoadImage: loaded",!0,ee),er.onerror=ha(kd,et,er,"TestLoadImage: error",!1,ee),er.onabort=ha(kd,et,er,"TestLoadImage: abort",!1,ee),er.ontimeout=ha(kd,et,er,"TestLoadImage: timeout",!1,ee),eC.setTimeout(function(){er.ontimeout&&er.ontimeout()},1e4),er.src=$}else ee(!1)}function kd($,ee,et,er,en){try{ee.onload=null,ee.onerror=null,ee.onabort=null,ee.ontimeout=null,en(er)}catch($){}}function ld($){this.l=$.ec||null,this.j=$.ob||!1}function md($,ee){B.call(this),this.F=$,this.u=ee,this.m=void 0,this.readyState=ti,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}r(ld,Ub),ld.prototype.g=function(){return new md(this.l,this.j)},ld.prototype.i=function($){return function(){return $}}({}),r(md,B);var ti=0;function qd($){$.j.read().then($.Xa.bind($)).catch($.ka.bind($))}function pd($){$.readyState=4,$.l=null,$.j=null,$.A=null,od($)}function od($){$.onreadystatechange&&$.onreadystatechange.call($)}(eo=md.prototype).open=function($,ee){if(this.readyState!=ti)throw this.abort(),Error("Error reopening a connection");this.C=$,this.B=ee,this.readyState=1,od(this)},eo.send=function($){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;let ee={headers:this.v,method:this.C,credentials:this.m,cache:void 0};$&&(ee.body=$),(this.F||eC).fetch(new Request(this.B,ee)).then(this.$a.bind(this),this.ka.bind(this))},eo.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,pd(this)),this.readyState=ti},eo.$a=function($){if(this.g&&(this.l=$,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=$.headers,this.readyState=2,od(this)),this.g&&(this.readyState=3,od(this),this.g))){if("arraybuffer"===this.responseType)$.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==eC.ReadableStream&&"body"in $){if(this.j=$.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;qd(this)}else $.text().then(this.Za.bind(this),this.ka.bind(this))}},eo.Xa=function($){if(this.g){if(this.u&&$.value)this.response.push($.value);else if(!this.u){var ee=$.value?$.value:new Uint8Array(0);(ee=this.A.decode(ee,{stream:!$.done}))&&(this.response=this.responseText+=ee)}$.done?pd(this):od(this),3==this.readyState&&qd(this)}},eo.Za=function($){this.g&&(this.response=this.responseText=$,pd(this))},eo.Ya=function($){this.g&&(this.response=$,pd(this))},eo.ka=function(){this.g&&pd(this)},eo.setRequestHeader=function($,ee){this.v.append($,ee)},eo.getResponseHeader=function($){return this.h&&this.h.get($.toLowerCase())||""},eo.getAllResponseHeaders=function(){if(!this.h)return"";let $=[],ee=this.h.entries();for(var et=ee.next();!et.done;)$.push((et=et.value)[0]+": "+et[1]),et=ee.next();return $.join("\r\n")},Object.defineProperty(md.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function($){this.m=$?"include":"same-origin"}});var ts=eC.JSON.parse;function P($){B.call(this),this.headers=new Map,this.u=$||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=tl,this.L=this.M=!1}r(P,B);var tl="",tu=/^https?$/i,th=["POST","PUT"];function xd($){return e_&&"number"==typeof $.timeout&&void 0!==$.ontimeout}function vd($,ee){$.h=!1,$.g&&($.l=!0,$.g.abort(),$.l=!1),$.j=ee,$.m=5,yd($),zd($)}function yd($){$.F||($.F=!0,C($,"complete"),C($,"error"))}function Ad($){if($.h&&void 0!==eS&&(!$.C[1]||4!=H($)||2!=$.da())){if($.v&&4==H($))yb($.La,0,$);else if(C($,"readystatechange"),4==H($)){$.h=!1;try{let es=$.da();switch(es){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var ee,et,er=!0;break;default:er=!1}if(!(ee=er)){if(et=0===es){var en=String($.I).match(e6)[1]||null;!en&&eC.self&&eC.self.location&&(en=eC.self.location.protocol.slice(0,-1)),et=!tu.test(en?en.toLowerCase():"")}ee=et}if(ee)C($,"complete"),C($,"success");else{$.m=6;try{var ei=2<H($)?$.g.statusText:""}catch($){ei=""}$.j=ei+" ["+$.da()+"]",yd($)}}finally{zd($)}}}}function zd($,ee){if($.g){wd($);let et=$.g,er=$.C[0]?()=>{}:null;$.g=null,$.C=null,ee||C($,"ready");try{et.onreadystatechange=er}catch($){}}}function wd($){$.g&&$.L&&($.g.ontimeout=null),$.A&&(eC.clearTimeout($.A),$.A=null)}function H($){return $.g?$.g.readyState:0}function mc($){try{if(!$.g)return null;if("response"in $.g)return $.g.response;switch($.K){case tl:case"text":return $.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in $.g)return $.g.mozResponseArrayBuffer}return null}catch($){return null}}function tc($){let ee={};$=($.g&&2<=H($)&&$.g.getAllResponseHeaders()||"").split("\r\n");for(let er=0;er<$.length;er++){if(x($[er]))continue;var et=qb($[er]);let en=et[0];if("string"!=typeof(et=et[1]))continue;et=et.trim();let ei=ee[en]||[];ee[en]=ei,ei.push(et)}Oa(ee,function($){return $.join(", ")})}function Bd($){let ee="";return Na($,function($,et){ee+=et+":"+$+"\r\n"}),ee}function Cd($,ee,et){e:{for(er in et){var er=!1;break e}er=!0}er||(et=Bd(et),"string"==typeof $?null!=et&&encodeURIComponent(String(et)):K($,ee,et))}function Dd($,ee,et){return et&&et.internalChannelParams&&et.internalChannelParams[$]||ee}function Ed($){this.Ga=0,this.j=[],this.l=new Gb,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Dd("failFast",!1,$),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Dd("baseRetryDelayMs",5e3,$),this.hb=Dd("retryDelaySeedMs",1e4,$),this.eb=Dd("forwardChannelMaxRetries",2,$),this.xa=Dd("forwardChannelRequestTimeoutMs",2e4,$),this.va=$&&$.xmlHttpFactory||void 0,this.Ha=$&&$.useFetchStreams||!1,this.L=void 0,this.J=$&&$.supportsCrossDomainXhr||!1,this.K="",this.i=new cd($&&$.concurrentRequestLimit),this.Ja=new hd,this.P=$&&$.fastHandshake||!1,this.O=$&&$.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=$&&$.bc||!1,$&&$.Ea&&this.l.Ea(),$&&$.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&$&&$.detectBufferingProxy||!1,this.qa=void 0,$&&$.longPollingTimeout&&0<$.longPollingTimeout&&(this.qa=$.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Hc($){if(Fd($),3==$.H){var ee=$.W++,et=G($.I);if(K(et,"SID",$.K),K(et,"RID",ee),K(et,"TYPE","terminate"),Gd($,et),(ee=new bc($,$.l,ee)).L=2,ee.v=hc(G(et)),et=!1,eC.navigator&&eC.navigator.sendBeacon)try{et=eC.navigator.sendBeacon(ee.v.toString(),"")}catch($){}!et&&eC.Image&&((new Image).src=ee.v,et=!0),et||(ee.g=lc(ee.l,null),ee.g.ha(ee.v)),ee.G=Date.now(),jc(ee)}Hd($)}function zc($){$.g&&(vc($),$.g.cancel(),$.g=null)}function Fd($){zc($),$.u&&(eC.clearTimeout($.u),$.u=null),yc($),$.i.cancel(),$.m&&("number"==typeof $.m&&eC.clearTimeout($.m),$.m=null)}function Gc($){if(!ed($.i)&&!$.m){$.m=!0;var ee=$.Na;eG||vb(),e$||(eG(),e$=!0),eH.add(ee,$),$.C=0}}function Id($,ee){return!(Bc($.i)>=$.i.j-($.m?1:0))&&($.m?($.j=ee.F.concat($.j),!0):1!=$.H&&2!=$.H&&!($.C>=($.cb?0:$.eb))&&($.m=Rb(q($.Na,$,ee),Jd($,$.C)),$.C++,!0))}function Ld($,ee){var et;et=ee?ee.m:$.W++;let er=G($.I);K(er,"SID",$.K),K(er,"RID",et),K(er,"AID",$.V),Gd($,er),$.o&&$.s&&Cd(er,$.o,$.s),et=new bc($,$.l,et,$.C+1),null===$.o&&(et.I=$.s),ee&&($.j=ee.F.concat($.j)),ee=Kd($,et,1e3),et.setTimeout(Math.round(.5*$.xa)+Math.round(.5*$.xa*Math.random())),Cc($.i,et),gc(et,er,ee)}function Gd($,ee){$.na&&Na($.na,function($,et){K(ee,et,$)}),$.h&&Kc({},function($,et){K(ee,et,$)})}function Kd($,ee,et){et=Math.min($.j.length,et);var er=$.h?q($.h.Va,$.h,$):null;e:{var en=$.j;let ee=-1;for(;;){let $=["count="+et];-1==ee?0<et?(ee=en[0].g,$.push("ofs="+ee)):ee=0:$.push("ofs="+ee);let ei=!0;for(let es=0;es<et;es++){let et=en[es].g,eo=en[es].map;if(0>(et-=ee))ee=Math.max(0,en[es].g-100),ei=!1;else try{id(eo,$,"req"+et+"_")}catch($){er&&er(eo)}}if(ei){er=$.join("&");break e}}}return $=$.j.splice(0,et),ee.F=$,er}function Fc($){if(!$.g&&!$.u){$.ba=1;var ee=$.Ma;eG||vb(),e$||(eG(),e$=!0),eH.add(ee,$),$.A=0}}function Ac($){return!$.g&&!$.u&&!(3<=$.A)&&($.ba++,$.u=Rb(q($.Ma,$),Jd($,$.A)),$.A++,!0)}function vc($){null!=$.B&&(eC.clearTimeout($.B),$.B=null)}function Md($){$.g=new bc($,$.l,"rpc",$.ba),null===$.o&&($.g.I=$.s),$.g.O=0;var ee=G($.wa);K(ee,"RID","rpc"),K(ee,"SID",$.K),K(ee,"AID",$.V),K(ee,"CI",$.G?"0":"1"),!$.G&&$.qa&&K(ee,"TO",$.qa),K(ee,"TYPE","xmlhttp"),Gd($,ee),$.o&&$.s&&Cd(ee,$.o,$.s),$.L&&$.g.setTimeout($.L);var et=$.g;$=$.pa,et.L=1,et.v=hc(G(ee)),et.s=null,et.S=!0,ic(et,$)}function yc($){null!=$.v&&(eC.clearTimeout($.v),$.v=null)}function sc($,ee){var et=null;if($.g==ee){yc($),vc($),$.g=null;var er=2}else{if(!xc($.i,ee))return;et=ee.F,Ec($.i,ee),er=1}if(0!=$.H){if(ee.i){if(1==er){et=ee.s?ee.s.length:0,ee=Date.now()-ee.G;var en=$.C;C(er=Mb(),new Qb(er,et)),Gc($)}else Fc($)}else if(3==(en=ee.o)||0==en&&0<ee.ca||!(1==er&&Id($,ee)||2==er&&Ac($)))switch(et&&0<et.length&&((ee=$.i).i=ee.i.concat(et)),en){case 1:J($,5);break;case 4:J($,10);break;case 3:J($,6);break;default:J($,2)}}}function Jd($,ee){let et=$.ab+Math.floor(Math.random()*$.hb);return $.isActive()||(et*=2),et*ee}function J($,ee){if($.l.info("Error code "+ee),2==ee){var et=null;$.h&&(et=null);var er=q($.pb,$);et||(et=new M("//www.google.com/images/cleardot.gif"),eC.location&&"http"==eC.location.protocol||Nc(et,"https"),hc(et)),jd(et.toString(),er)}else F(2);$.H=0,$.h&&$.h.za(ee),Hd($),Fd($)}function Hd($){if($.H=0,$.ma=[],$.h){let ee=fd($.i);(0!=ee.length||0!=$.j.length)&&(na($.ma,ee),na($.ma,$.j),$.i.i.length=0,ma($.j),$.j.length=0),$.h.ya()}}function Dc($,ee,et){var er=et instanceof M?G(et):new M(et);if(""!=er.g)ee&&(er.g=ee+"."+er.g),Oc(er,er.m);else{var en=eC.location;er=en.protocol,ee=ee?ee+"."+en.hostname:en.hostname,en=+en.port;var ei=new M(null);er&&Nc(ei,er),ee&&(ei.g=ee),en&&Oc(ei,en),et&&(ei.l=et),er=ei}return et=$.F,ee=$.Da,et&&ee&&K(er,et,ee),K(er,"VER",$.ra),Gd($,er),er}function lc($,ee,et){if(ee&&!$.J)throw Error("Can't create secondary domain capable XhrIo object.");return(ee=new P(et&&$.Ha&&!$.va?new ld({ob:!0}):$.va)).Oa($.J),ee}function Nd(){}function Od(){if(e_&&!(10<=Number(eF)))throw Error("Environmental error: no available transport.")}function Q($,ee){B.call(this),this.g=new Ed(ee),this.l=$,this.h=ee&&ee.messageUrlParams||null,$=ee&&ee.messageHeaders||null,ee&&ee.clientProtocolHeaderRequired&&($?$["X-Client-Protocol"]="webchannel":$={"X-Client-Protocol":"webchannel"}),this.g.s=$,$=ee&&ee.initMessageHeaders||null,ee&&ee.messageContentType&&($?$["X-WebChannel-Content-Type"]=ee.messageContentType:$={"X-WebChannel-Content-Type":ee.messageContentType}),ee&&ee.Ca&&($?$["X-WebChannel-Client-Profile"]=ee.Ca:$={"X-WebChannel-Client-Profile":ee.Ca}),this.g.U=$,($=ee&&ee.cc)&&!x($)&&(this.g.o=$),this.A=ee&&ee.supportsCrossDomainXhr||!1,this.v=ee&&ee.sendRawJson||!1,(ee=ee&&ee.httpSessionIdParam)&&!x(ee)&&(this.g.F=ee,null!==($=this.h)&&ee in $&&ee in($=this.h)&&delete $[ee]),this.j=new R(this)}function Pd($){Yb.call(this),$.__headers__&&(this.headers=$.__headers__,this.statusCode=$.__status__,delete $.__headers__,delete $.__status__);var ee=$.__sm__;if(ee){e:{for(let et in ee){$=et;break e}$=void 0}(this.i=$)&&($=this.i,ee=null!==ee&&$ in ee?ee[$]:void 0),this.data=ee}else this.data=$}function Qd(){Zb.call(this),this.status=1}function R($){this.g=$}function S(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Sd($,ee,et){et||(et=0);var er=Array(16);if("string"==typeof ee)for(var en=0;16>en;++en)er[en]=ee.charCodeAt(et++)|ee.charCodeAt(et++)<<8|ee.charCodeAt(et++)<<16|ee.charCodeAt(et++)<<24;else for(en=0;16>en;++en)er[en]=ee[et++]|ee[et++]<<8|ee[et++]<<16|ee[et++]<<24;ee=$.g[0],et=$.g[1],en=$.g[2];var ei=$.g[3],es=ee+(ei^et&(en^ei))+er[0]+3614090360&4294967295;es=ei+(en^(ee=et+(es<<7&4294967295|es>>>25))&(et^en))+er[1]+3905402710&4294967295,es=en+(et^(ei=ee+(es<<12&4294967295|es>>>20))&(ee^et))+er[2]+606105819&4294967295,es=et+(ee^(en=ei+(es<<17&4294967295|es>>>15))&(ei^ee))+er[3]+3250441966&4294967295,es=ee+(ei^(et=en+(es<<22&4294967295|es>>>10))&(en^ei))+er[4]+4118548399&4294967295,es=ei+(en^(ee=et+(es<<7&4294967295|es>>>25))&(et^en))+er[5]+1200080426&4294967295,es=en+(et^(ei=ee+(es<<12&4294967295|es>>>20))&(ee^et))+er[6]+2821735955&4294967295,es=et+(ee^(en=ei+(es<<17&4294967295|es>>>15))&(ei^ee))+er[7]+4249261313&4294967295,es=ee+(ei^(et=en+(es<<22&4294967295|es>>>10))&(en^ei))+er[8]+1770035416&4294967295,es=ei+(en^(ee=et+(es<<7&4294967295|es>>>25))&(et^en))+er[9]+2336552879&4294967295,es=en+(et^(ei=ee+(es<<12&4294967295|es>>>20))&(ee^et))+er[10]+4294925233&4294967295,es=et+(ee^(en=ei+(es<<17&4294967295|es>>>15))&(ei^ee))+er[11]+2304563134&4294967295,es=ee+(ei^(et=en+(es<<22&4294967295|es>>>10))&(en^ei))+er[12]+1804603682&4294967295,es=ei+(en^(ee=et+(es<<7&4294967295|es>>>25))&(et^en))+er[13]+4254626195&4294967295,es=en+(et^(ei=ee+(es<<12&4294967295|es>>>20))&(ee^et))+er[14]+2792965006&4294967295,es=et+(ee^(en=ei+(es<<17&4294967295|es>>>15))&(ei^ee))+er[15]+1236535329&4294967295,et=en+(es<<22&4294967295|es>>>10),es=ee+(en^ei&(et^en))+er[1]+4129170786&4294967295,ee=et+(es<<5&4294967295|es>>>27),es=ei+(et^en&(ee^et))+er[6]+3225465664&4294967295,ei=ee+(es<<9&4294967295|es>>>23),es=en+(ee^et&(ei^ee))+er[11]+643717713&4294967295,en=ei+(es<<14&4294967295|es>>>18),es=et+(ei^ee&(en^ei))+er[0]+3921069994&4294967295,et=en+(es<<20&4294967295|es>>>12),es=ee+(en^ei&(et^en))+er[5]+3593408605&4294967295,ee=et+(es<<5&4294967295|es>>>27),es=ei+(et^en&(ee^et))+er[10]+38016083&4294967295,ei=ee+(es<<9&4294967295|es>>>23),es=en+(ee^et&(ei^ee))+er[15]+3634488961&4294967295,en=ei+(es<<14&4294967295|es>>>18),es=et+(ei^ee&(en^ei))+er[4]+3889429448&4294967295,et=en+(es<<20&4294967295|es>>>12),es=ee+(en^ei&(et^en))+er[9]+568446438&4294967295,ee=et+(es<<5&4294967295|es>>>27),es=ei+(et^en&(ee^et))+er[14]+3275163606&4294967295,ei=ee+(es<<9&4294967295|es>>>23),es=en+(ee^et&(ei^ee))+er[3]+4107603335&4294967295,en=ei+(es<<14&4294967295|es>>>18),es=et+(ei^ee&(en^ei))+er[8]+1163531501&4294967295,et=en+(es<<20&4294967295|es>>>12),es=ee+(en^ei&(et^en))+er[13]+2850285829&4294967295,ee=et+(es<<5&4294967295|es>>>27),es=ei+(et^en&(ee^et))+er[2]+4243563512&4294967295,ei=ee+(es<<9&4294967295|es>>>23),es=en+(ee^et&(ei^ee))+er[7]+1735328473&4294967295,en=ei+(es<<14&4294967295|es>>>18),es=et+(ei^ee&(en^ei))+er[12]+2368359562&4294967295,es=ee+((et=en+(es<<20&4294967295|es>>>12))^en^ei)+er[5]+4294588738&4294967295,es=ei+((ee=et+(es<<4&4294967295|es>>>28))^et^en)+er[8]+2272392833&4294967295,es=en+((ei=ee+(es<<11&4294967295|es>>>21))^ee^et)+er[11]+1839030562&4294967295,es=et+((en=ei+(es<<16&4294967295|es>>>16))^ei^ee)+er[14]+4259657740&4294967295,es=ee+((et=en+(es<<23&4294967295|es>>>9))^en^ei)+er[1]+2763975236&4294967295,es=ei+((ee=et+(es<<4&4294967295|es>>>28))^et^en)+er[4]+1272893353&4294967295,es=en+((ei=ee+(es<<11&4294967295|es>>>21))^ee^et)+er[7]+4139469664&4294967295,es=et+((en=ei+(es<<16&4294967295|es>>>16))^ei^ee)+er[10]+3200236656&4294967295,es=ee+((et=en+(es<<23&4294967295|es>>>9))^en^ei)+er[13]+681279174&4294967295,es=ei+((ee=et+(es<<4&4294967295|es>>>28))^et^en)+er[0]+3936430074&4294967295,es=en+((ei=ee+(es<<11&4294967295|es>>>21))^ee^et)+er[3]+3572445317&4294967295,es=et+((en=ei+(es<<16&4294967295|es>>>16))^ei^ee)+er[6]+76029189&4294967295,es=ee+((et=en+(es<<23&4294967295|es>>>9))^en^ei)+er[9]+3654602809&4294967295,es=ei+((ee=et+(es<<4&4294967295|es>>>28))^et^en)+er[12]+3873151461&4294967295,es=en+((ei=ee+(es<<11&4294967295|es>>>21))^ee^et)+er[15]+530742520&4294967295,es=et+((en=ei+(es<<16&4294967295|es>>>16))^ei^ee)+er[2]+3299628645&4294967295,et=en+(es<<23&4294967295|es>>>9),es=ee+(en^(et|~ei))+er[0]+4096336452&4294967295,ee=et+(es<<6&4294967295|es>>>26),es=ei+(et^(ee|~en))+er[7]+1126891415&4294967295,ei=ee+(es<<10&4294967295|es>>>22),es=en+(ee^(ei|~et))+er[14]+2878612391&4294967295,en=ei+(es<<15&4294967295|es>>>17),es=et+(ei^(en|~ee))+er[5]+4237533241&4294967295,et=en+(es<<21&4294967295|es>>>11),es=ee+(en^(et|~ei))+er[12]+1700485571&4294967295,ee=et+(es<<6&4294967295|es>>>26),es=ei+(et^(ee|~en))+er[3]+2399980690&4294967295,ei=ee+(es<<10&4294967295|es>>>22),es=en+(ee^(ei|~et))+er[10]+4293915773&4294967295,en=ei+(es<<15&4294967295|es>>>17),es=et+(ei^(en|~ee))+er[1]+2240044497&4294967295,et=en+(es<<21&4294967295|es>>>11),es=ee+(en^(et|~ei))+er[8]+1873313359&4294967295,ee=et+(es<<6&4294967295|es>>>26),es=ei+(et^(ee|~en))+er[15]+4264355552&4294967295,ei=ee+(es<<10&4294967295|es>>>22),es=en+(ee^(ei|~et))+er[6]+2734768916&4294967295,en=ei+(es<<15&4294967295|es>>>17),es=et+(ei^(en|~ee))+er[13]+1309151649&4294967295,et=en+(es<<21&4294967295|es>>>11),es=ee+(en^(et|~ei))+er[4]+4149444226&4294967295,ee=et+(es<<6&4294967295|es>>>26),es=ei+(et^(ee|~en))+er[11]+3174756917&4294967295,ei=ee+(es<<10&4294967295|es>>>22),es=en+(ee^(ei|~et))+er[2]+718787259&4294967295,en=ei+(es<<15&4294967295|es>>>17),es=et+(ei^(en|~ee))+er[9]+3951481745&4294967295,$.g[0]=$.g[0]+ee&4294967295,$.g[1]=$.g[1]+(en+(es<<21&4294967295|es>>>11))&4294967295,$.g[2]=$.g[2]+en&4294967295,$.g[3]=$.g[3]+ei&4294967295}function T($,ee){this.h=ee;for(var et=[],er=!0,en=$.length-1;0<=en;en--){var ei=0|$[en];er&&ei==ee||(et[en]=ei,er=!1)}this.g=et}(eo=P.prototype).Oa=function($){this.M=$},eo.ha=function($,ee,et,er){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+$);ee=ee?ee.toUpperCase():"GET",this.I=$,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():ei.g(),this.C=this.u?Vb(this.u):Vb(ei),this.g.onreadystatechange=q(this.La,this);try{this.G=!0,this.g.open(ee,String($),!0),this.G=!1}catch($){vd(this,$);return}if($=et||"",et=new Map(this.headers),er){if(Object.getPrototypeOf(er)===Object.prototype)for(var en in er)et.set(en,er[en]);else if("function"==typeof er.keys&&"function"==typeof er.get)for(let $ of er.keys())et.set($,er.get($));else throw Error("Unknown input type for opt_headers: "+String(er))}for(let[ei,es]of(er=Array.from(et.keys()).find($=>"content-type"==$.toLowerCase()),en=eC.FormData&&$ instanceof eC.FormData,!(0<=eD(th,ee))||er||en||et.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),et))this.g.setRequestHeader(ei,es);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{wd(this),0<this.B&&((this.L=xd(this.g))?(this.g.timeout=this.B,this.g.ontimeout=q(this.ua,this)):this.A=yb(this.ua,this.B,this)),this.v=!0,this.g.send($),this.v=!1}catch($){vd(this,$)}},eo.ua=function(){void 0!==eS&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,C(this,"timeout"),this.abort(8))},eo.abort=function($){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=$||7,C(this,"complete"),C(this,"abort"),zd(this))},eo.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),zd(this,!0)),P.$.N.call(this)},eo.La=function(){this.s||(this.G||this.v||this.l?Ad(this):this.kb())},eo.kb=function(){Ad(this)},eo.isActive=function(){return!!this.g},eo.da=function(){try{return 2<H(this)?this.g.status:-1}catch($){return -1}},eo.ja=function(){try{return this.g?this.g.responseText:""}catch($){return""}},eo.Wa=function($){if(this.g){var ee=this.g.responseText;return $&&0==ee.indexOf($)&&(ee=ee.substring($.length)),ts(ee)}},eo.Ia=function(){return this.m},eo.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(eo=Ed.prototype).ra=8,eo.H=1,eo.Na=function($){if(this.m){if(this.m=null,1==this.H){if(!$){this.W=Math.floor(1e5*Math.random()),$=this.W++;let en=new bc(this,this.l,$),ei=this.s;if(this.U&&(ei?Ra(ei=Pa(ei),this.U):ei=this.U),null!==this.o||this.O||(en.I=ei,ei=null),this.P)e:{for(var ee=0,et=0;et<this.j.length;et++){t:{var er=this.j[et];if("__data__"in er.map&&"string"==typeof(er=er.map.__data__)){er=er.length;break t}er=void 0}if(void 0===er)break;if(4096<(ee+=er)){ee=et;break e}if(4096===ee||et===this.j.length-1){ee=et+1;break e}}ee=1e3}else ee=1e3;ee=Kd(this,en,ee),K(et=G(this.I),"RID",$),K(et,"CVER",22),this.F&&K(et,"X-HTTP-Session-Id",this.F),Gd(this,et),ei&&(this.O?ee="headers="+encodeURIComponent(String(Bd(ei)))+"&"+ee:this.o&&Cd(et,this.o,ei)),Cc(this.i,en),this.bb&&K(et,"TYPE","init"),this.P?(K(et,"$req",ee),K(et,"SID","null"),en.aa=!0,gc(en,et,null)):gc(en,et,ee),this.H=2}}else 3==this.H&&($?Ld(this,$):0==this.j.length||ed(this.i)||Ld(this))}},eo.Ma=function(){if(this.u=null,Md(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var $=2*this.S;this.l.info("BP detection timer enabled: "+$),this.B=Rb(q(this.jb,this),$)}},eo.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,F(10),zc(this),Md(this))},eo.ib=function(){null!=this.v&&(this.v=null,zc(this),Ac(this),F(19))},eo.pb=function($){$?(this.l.info("Successfully pinged google.com"),F(2)):(this.l.info("Failed to ping google.com"),F(1))},eo.isActive=function(){return!!this.h&&this.h.isActive(this)},(eo=Nd.prototype).Ba=function(){},eo.Aa=function(){},eo.za=function(){},eo.ya=function(){},eo.isActive=function(){return!0},eo.Va=function(){},Od.prototype.g=function($,ee){return new Q($,ee)},r(Q,B),Q.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var $=this.g,ee=this.l,et=this.h||void 0;F(0),$.Y=ee,$.na=et||{},$.G=$.aa,$.I=Dc($,null,$.Y),Gc($)},Q.prototype.close=function(){Hc(this.g)},Q.prototype.u=function($){var ee=this.g;if("string"==typeof $){var et={};et.__data__=$,$=et}else this.v&&((et={}).__data__=eK($),$=et);ee.j.push(new te(ee.fb++,$)),3==ee.H&&Gc(ee)},Q.prototype.N=function(){this.g.h=null,delete this.j,Hc(this.g),delete this.g,Q.$.N.call(this)},r(Pd,Yb),r(Qd,Zb),r(R,Nd),R.prototype.Ba=function(){C(this.g,"a")},R.prototype.Aa=function($){C(this.g,new Pd($))},R.prototype.za=function($){C(this.g,new Qd)},R.prototype.ya=function(){C(this.g,"b")},r(S,function(){this.blockSize=-1}),S.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},S.prototype.j=function($,ee){void 0===ee&&(ee=$.length);for(var et=ee-this.blockSize,er=this.m,en=this.h,ei=0;ei<ee;){if(0==en)for(;ei<=et;)Sd(this,$,ei),ei+=this.blockSize;if("string"==typeof $){for(;ei<ee;)if(er[en++]=$.charCodeAt(ei++),en==this.blockSize){Sd(this,er),en=0;break}}else for(;ei<ee;)if(er[en++]=$[ei++],en==this.blockSize){Sd(this,er),en=0;break}}this.h=en,this.i+=ee},S.prototype.l=function(){var $=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);$[0]=128;for(var ee=1;ee<$.length-8;++ee)$[ee]=0;var et=8*this.i;for(ee=$.length-8;ee<$.length;++ee)$[ee]=255&et,et/=256;for(this.j($),$=Array(16),ee=et=0;4>ee;++ee)for(var er=0;32>er;er+=8)$[et++]=this.g[ee]>>>er&255;return $};var tp={};function Td($){return -128<=$&&128>$?ra($,function($){return new T([0|$],0>$?-1:0)}):new T([0|$],0>$?-1:0)}function U($){if(isNaN($)||!isFinite($))return tm;if(0>$)return W(U(-$));for(var ee=[],et=1,er=0;$>=et;er++)ee[er]=$/et|0,et*=tf;return new T(ee,0)}function Vd($,ee){if(0==$.length)throw Error("number format error: empty string");if(2>(ee=ee||10)||36<ee)throw Error("radix out of range: "+ee);if("-"==$.charAt(0))return W(Vd($.substring(1),ee));if(0<=$.indexOf("-"))throw Error('number format error: interior "-" character');for(var et=U(Math.pow(ee,8)),er=tm,en=0;en<$.length;en+=8){var ei=Math.min(8,$.length-en),es=parseInt($.substring(en,en+ei),ee);8>ei?(ei=U(Math.pow(ee,ei)),er=er.R(ei).add(U(es))):er=(er=er.R(et)).add(U(es))}return er}var tf=4294967296,tm=Td(0),tg=Td(1),ty=Td(16777216);function Y($){if(0!=$.h)return!1;for(var ee=0;ee<$.g.length;ee++)if(0!=$.g[ee])return!1;return!0}function X($){return -1==$.h}function W($){for(var ee=$.g.length,et=[],er=0;er<ee;er++)et[er]=~$.g[er];return new T(et,~$.h).add(tg)}function Zd($,ee){return $.add(W(ee))}function $d($,ee){for(;(65535&$[ee])!=$[ee];)$[ee+1]+=$[ee]>>>16,$[ee]&=65535,ee++}function ae($,ee){this.g=$,this.h=ee}function Yd($,ee){if(Y(ee))throw Error("division by zero");if(Y($))return new ae(tm,tm);if(X($))return ee=Yd(W($),ee),new ae(W(ee.g),W(ee.h));if(X(ee))return ee=Yd($,W(ee)),new ae(W(ee.g),ee.h);if(30<$.g.length){if(X($)||X(ee))throw Error("slowDivide_ only works with positive integers.");for(var et=tg,er=ee;0>=er.X($);)et=be(et),er=be(er);var en=Z(et,1),ei=Z(er,1);for(er=Z(er,2),et=Z(et,2);!Y(er);){var es=ei.add(er);0>=es.X($)&&(en=en.add(et),ei=es),er=Z(er,1),et=Z(et,1)}return ee=Zd($,en.R(ee)),new ae(en,ee)}for(en=tm;0<=$.X(ee);){for(er=48>=(er=Math.ceil(Math.log(et=Math.max(1,Math.floor($.ea()/ee.ea())))/Math.LN2))?1:Math.pow(2,er-48),es=(ei=U(et)).R(ee);X(es)||0<es.X($);)et-=er,es=(ei=U(et)).R(ee);Y(ei)&&(ei=tg),en=en.add(ei),$=Zd($,es)}return new ae(en,$)}function be($){for(var ee=$.g.length+1,et=[],er=0;er<ee;er++)et[er]=$.D(er)<<1|$.D(er-1)>>>31;return new T(et,$.h)}function Z($,ee){var et=ee>>5;ee%=32;for(var er=$.g.length-et,en=[],ei=0;ei<er;ei++)en[ei]=0<ee?$.D(ei+et)>>>ee|$.D(ei+et+1)<<32-ee:$.D(ei+et);return new T(en,$.h)}(eo=T.prototype).ea=function(){if(X(this))return-W(this).ea();for(var $=0,ee=1,et=0;et<this.g.length;et++){var er=this.D(et);$+=(0<=er?er:tf+er)*ee,ee*=tf}return $},eo.toString=function($){if(2>($=$||10)||36<$)throw Error("radix out of range: "+$);if(Y(this))return"0";if(X(this))return"-"+W(this).toString($);for(var ee=U(Math.pow($,6)),et=this,er="";;){var en=Yd(et,ee).g,ei=((0<(et=Zd(et,en.R(ee))).g.length?et.g[0]:et.h)>>>0).toString($);if(Y(et=en))return ei+er;for(;6>ei.length;)ei="0"+ei;er=ei+er}},eo.D=function($){return 0>$?0:$<this.g.length?this.g[$]:this.h},eo.X=function($){return X($=Zd(this,$))?-1:Y($)?0:1},eo.abs=function(){return X(this)?W(this):this},eo.add=function($){for(var ee=Math.max(this.g.length,$.g.length),et=[],er=0,en=0;en<=ee;en++){var ei=er+(65535&this.D(en))+(65535&$.D(en)),es=(ei>>>16)+(this.D(en)>>>16)+($.D(en)>>>16);er=es>>>16,ei&=65535,es&=65535,et[en]=es<<16|ei}return new T(et,-2147483648&et[et.length-1]?-1:0)},eo.R=function($){if(Y(this)||Y($))return tm;if(X(this))return X($)?W(this).R(W($)):W(W(this).R($));if(X($))return W(this.R(W($)));if(0>this.X(ty)&&0>$.X(ty))return U(this.ea()*$.ea());for(var ee=this.g.length+$.g.length,et=[],er=0;er<2*ee;er++)et[er]=0;for(er=0;er<this.g.length;er++)for(var en=0;en<$.g.length;en++){var ei=this.D(er)>>>16,es=65535&this.D(er),eo=$.D(en)>>>16,eu=65535&$.D(en);et[2*er+2*en]+=es*eu,$d(et,2*er+2*en),et[2*er+2*en+1]+=ei*eu,$d(et,2*er+2*en+1),et[2*er+2*en+1]+=es*eo,$d(et,2*er+2*en+1),et[2*er+2*en+2]+=ei*eo,$d(et,2*er+2*en+2)}for(er=0;er<ee;er++)et[er]=et[2*er+1]<<16|et[2*er];for(er=ee;er<2*ee;er++)et[er]=0;return new T(et,0)},eo.gb=function($){return Yd(this,$).h},eo.and=function($){for(var ee=Math.max(this.g.length,$.g.length),et=[],er=0;er<ee;er++)et[er]=this.D(er)&$.D(er);return new T(et,this.h&$.h)},eo.or=function($){for(var ee=Math.max(this.g.length,$.g.length),et=[],er=0;er<ee;er++)et[er]=this.D(er)|$.D(er);return new T(et,this.h|$.h)},eo.xor=function($){for(var ee=Math.max(this.g.length,$.g.length),et=[],er=0;er<ee;er++)et[er]=this.D(er)^$.D(er);return new T(et,this.h^$.h)},Od.prototype.createWebChannel=Od.prototype.g,Q.prototype.send=Q.prototype.u,Q.prototype.open=Q.prototype.m,Q.prototype.close=Q.prototype.close,eX.NO_ERROR=0,eX.TIMEOUT=8,eX.HTTP_ERROR=6,eZ.COMPLETE="complete",Wb.EventType=e0,e0.OPEN="a",e0.CLOSE="b",e0.ERROR="c",e0.MESSAGE="d",B.prototype.listen=B.prototype.O,P.prototype.listenOnce=P.prototype.P,P.prototype.getLastError=P.prototype.Sa,P.prototype.getLastErrorCode=P.prototype.Ia,P.prototype.getStatus=P.prototype.da,P.prototype.getResponseJson=P.prototype.Wa,P.prototype.getResponseText=P.prototype.ja,P.prototype.send=P.prototype.ha,P.prototype.setWithCredentials=P.prototype.Oa,S.prototype.digest=S.prototype.l,S.prototype.reset=S.prototype.reset,S.prototype.update=S.prototype.j,T.prototype.add=T.prototype.add,T.prototype.multiply=T.prototype.R,T.prototype.modulo=T.prototype.gb,T.prototype.compare=T.prototype.X,T.prototype.toNumber=T.prototype.ea,T.prototype.toString=T.prototype.toString,T.prototype.getBits=T.prototype.D,T.fromNumber=U,T.fromString=Vd,ev.createWebChannelTransport=function(){return new Od},ev.getStatEventTarget=function(){return Mb()},ev.ErrorCode=eX,ev.EventType=eZ,ev.Event=eY,ev.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},ev.FetchXmlHttpFactory=ld,ev.WebChannel=Wb,ev.XhrIo=P;var tv=ev.Md5=S,tS=ev.Integer=T,tC=et(16063),tT=et(18196);let tE="@firebase/firestore",tw="4.2.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let User=class User{constructor($){this.uid=$}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual($){return $.uid===this.uid}};User.UNAUTHENTICATED=new User(null),User.GOOGLE_CREDENTIALS=new User("google-credentials-uid"),User.FIRST_PARTY=new User("first-party-uid"),User.MOCK_USER=new User("mock-user");let tD="10.4.0",tI=tD;function setSDKVersion($){tI=$}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function formatJSON($){return(0,ef.inspect)($,{depth:100})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tR=new ep.Yd("@firebase/firestore");function getLogLevel(){return tR.logLevel}function logDebug($,...ee){if(tR.logLevel<=ep.in.DEBUG){let et=ee.map(argToString);tR.debug(`Firestore (${tI}): ${$}`,...et)}}function logError($,...ee){if(tR.logLevel<=ep.in.ERROR){let et=ee.map(argToString);tR.error(`Firestore (${tI}): ${$}`,...et)}}function logWarn($,...ee){if(tR.logLevel<=ep.in.WARN){let et=ee.map(argToString);tR.warn(`Firestore (${tI}): ${$}`,...et)}}function argToString($){if("string"==typeof $)return $;try{return formatJSON($)}catch(ee){return $}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fail($="Unexpected state"){let ee=`FIRESTORE (${tI}) INTERNAL ASSERTION FAILED: `+$;throw logError(ee),Error(ee)}function hardAssert($,ee){$||fail()}function debugCast($,ee){return $}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let t_={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};let FirestoreError=class FirestoreError extends em.ZR{constructor($,ee){super($,ee),this.code=$,this.message=ee,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Deferred=class Deferred{constructor(){this.promise=new Promise(($,ee)=>{this.resolve=$,this.reject=ee})}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let OAuthToken=class OAuthToken{constructor($,ee){this.user=ee,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${$}`)}};let EmptyAuthCredentialsProvider=class EmptyAuthCredentialsProvider{getToken(){return Promise.resolve(null)}invalidateToken(){}start($,ee){$.enqueueRetryable(()=>ee(User.UNAUTHENTICATED))}shutdown(){}};let EmulatorAuthCredentialsProvider=class EmulatorAuthCredentialsProvider{constructor($){this.token=$,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start($,ee){this.changeListener=ee,$.enqueueRetryable(()=>ee(this.token.user))}shutdown(){this.changeListener=null}};let FirebaseAuthCredentialsProvider=class FirebaseAuthCredentialsProvider{constructor($){this.authProvider=$,this.currentUser=User.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start($,ee){let et=this.tokenCounter,guardedChangeListener=$=>this.tokenCounter!==et?(et=this.tokenCounter,ee($)):Promise.resolve(),er=new Deferred;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),er.resolve(),er=new Deferred,$.enqueueRetryable(()=>guardedChangeListener(this.currentUser))};let awaitNextToken=()=>{let ee=er;$.enqueueRetryable(async()=>{await ee.promise,await guardedChangeListener(this.currentUser)})},registerAuth=$=>{logDebug("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=$,this.auth.addAuthTokenListener(this.tokenListener),awaitNextToken()};this.authProvider.onInit($=>registerAuth($)),setTimeout(()=>{if(!this.auth){let $=this.authProvider.getImmediate({optional:!0});$?registerAuth($):(logDebug("FirebaseAuthCredentialsProvider","Auth not yet detected"),er.resolve(),er=new Deferred)}},0),awaitNextToken()}getToken(){let $=this.tokenCounter,ee=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(ee).then(ee=>this.tokenCounter!==$?(logDebug("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):ee?(hardAssert("string"==typeof ee.accessToken),new OAuthToken(ee.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.tokenListener)}getUser(){let $=this.auth&&this.auth.getUid();return hardAssert(null===$||"string"==typeof $),new User($)}};let FirstPartyToken=class FirstPartyToken{constructor($,ee,et){this.sessionIndex=$,this.iamToken=ee,this.authTokenFactory=et,this.type="FirstParty",this.user=User.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let $=this.getAuthToken();return $&&this._headers.set("Authorization",$),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}};let FirstPartyAuthCredentialsProvider=class FirstPartyAuthCredentialsProvider{constructor($,ee,et){this.sessionIndex=$,this.iamToken=ee,this.authTokenFactory=et}getToken(){return Promise.resolve(new FirstPartyToken(this.sessionIndex,this.iamToken,this.authTokenFactory))}start($,ee){$.enqueueRetryable(()=>ee(User.FIRST_PARTY))}shutdown(){}invalidateToken(){}};let AppCheckToken=class AppCheckToken{constructor($){this.value=$,this.type="AppCheck",this.headers=new Map,$&&$.length>0&&this.headers.set("x-firebase-appcheck",this.value)}};let FirebaseAppCheckTokenProvider=class FirebaseAppCheckTokenProvider{constructor($){this.appCheckProvider=$,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start($,ee){let onTokenChanged=$=>{null!=$.error&&logDebug("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${$.error.message}`);let et=$.token!==this.latestAppCheckToken;return this.latestAppCheckToken=$.token,logDebug("FirebaseAppCheckTokenProvider",`Received ${et?"new":"existing"} token.`),et?ee($.token):Promise.resolve()};this.tokenListener=ee=>{$.enqueueRetryable(()=>onTokenChanged(ee))};let registerAppCheck=$=>{logDebug("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=$,this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit($=>registerAppCheck($)),setTimeout(()=>{if(!this.appCheck){let $=this.appCheckProvider.getImmediate({optional:!0});$?registerAppCheck($):logDebug("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let $=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken($).then($=>$?(hardAssert("string"==typeof $.token),this.latestAppCheckToken=$.token,new AppCheckToken($.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.tokenListener)}};function makeAuthCredentialsProvider($){if(!$)return new EmptyAuthCredentialsProvider;switch($.type){case"firstParty":return new FirstPartyAuthCredentialsProvider($.sessionIndex||"0",$.iamToken||null,$.authTokenFactory||null);case"provider":return $.client;default:throw new FirestoreError(t_.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function randomBytes($){return(0,eg.randomBytes)($)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let AutoId=class AutoId{static newId(){let $="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",ee=Math.floor(256/$.length)*$.length,et="",er=20;for(;et.length<er;){let en=randomBytes(40);for(let ei=0;ei<en.length;++ei)et.length<er&&en[ei]<ee&&(et+=$.charAt(en[ei]%$.length))}return et}};function primitiveComparator($,ee){return $<ee?-1:$>ee?1:0}function arrayEquals($,ee,et){return $.length===ee.length&&$.every(($,er)=>et($,ee[er]))}function immediateSuccessor($){return $+"\x00"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tP=-62135596800,tA=1e6;let Timestamp=class Timestamp{constructor($,ee){if(this.seconds=$,this.nanoseconds=ee,ee<0||ee>=1e9)throw new FirestoreError(t_.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+ee);if($<tP||$>=253402300800)throw new FirestoreError(t_.INVALID_ARGUMENT,"Timestamp seconds out of range: "+$)}static now(){return Timestamp.fromMillis(Date.now())}static fromDate($){return Timestamp.fromMillis($.getTime())}static fromMillis($){let ee=Math.floor($/1e3),et=Math.floor(($-1e3*ee)*tA);return new Timestamp(ee,et)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/tA}_compareTo($){return this.seconds===$.seconds?primitiveComparator(this.nanoseconds,$.nanoseconds):primitiveComparator(this.seconds,$.seconds)}isEqual($){return $.seconds===this.seconds&&$.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let $=this.seconds-tP,ee=String($).padStart(12,"0"),et=String(this.nanoseconds).padStart(9,"0");return ee+"."+et}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let SnapshotVersion=class SnapshotVersion{constructor($){this.timestamp=$}static fromTimestamp($){return new SnapshotVersion($)}static min(){return new SnapshotVersion(new Timestamp(0,0))}static max(){return new SnapshotVersion(new Timestamp(253402300799,1e9-1))}compareTo($){return this.timestamp._compareTo($.timestamp)}isEqual($){return this.timestamp.isEqual($.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tO="__name__";let BasePath=class BasePath{constructor($,ee,et){void 0===ee?ee=0:ee>$.length&&fail(),void 0===et?et=$.length-ee:et>$.length-ee&&fail(),this.segments=$,this.offset=ee,this.len=et}get length(){return this.len}isEqual($){return 0===BasePath.comparator(this,$)}child($){let ee=this.segments.slice(this.offset,this.limit());return $ instanceof BasePath?$.forEach($=>{ee.push($)}):ee.push($),this.construct(ee)}limit(){return this.offset+this.length}popFirst($){return $=void 0===$?1:$,this.construct(this.segments,this.offset+$,this.length-$)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get($){return this.segments[this.offset+$]}isEmpty(){return 0===this.length}isPrefixOf($){if($.length<this.length)return!1;for(let ee=0;ee<this.length;ee++)if(this.get(ee)!==$.get(ee))return!1;return!0}isImmediateParentOf($){if(this.length+1!==$.length)return!1;for(let ee=0;ee<this.length;ee++)if(this.get(ee)!==$.get(ee))return!1;return!0}forEach($){for(let ee=this.offset,et=this.limit();ee<et;ee++)$(this.segments[ee])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator($,ee){let et=Math.min($.length,ee.length);for(let er=0;er<et;er++){let et=$.get(er),en=ee.get(er);if(et<en)return -1;if(et>en)return 1}return $.length<ee.length?-1:$.length>ee.length?1:0}};let ResourcePath=class ResourcePath extends BasePath{construct($,ee,et){return new ResourcePath($,ee,et)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...$){let ee=[];for(let et of $){if(et.indexOf("//")>=0)throw new FirestoreError(t_.INVALID_ARGUMENT,`Invalid segment (${et}). Paths must not contain // in them.`);ee.push(...et.split("/").filter($=>$.length>0))}return new ResourcePath(ee)}static emptyPath(){return new ResourcePath([])}};let tk=/^[_a-zA-Z][_a-zA-Z0-9]*$/;let FieldPath$1=class FieldPath$1 extends BasePath{construct($,ee,et){return new FieldPath$1($,ee,et)}static isValidIdentifier($){return tk.test($)}canonicalString(){return this.toArray().map($=>($=$.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),FieldPath$1.isValidIdentifier($)||($="`"+$+"`"),$)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===tO}static keyField(){return new FieldPath$1([tO])}static fromServerFormat($){let ee=[],et="",er=0,addCurrentSegment=()=>{if(0===et.length)throw new FirestoreError(t_.INVALID_ARGUMENT,`Invalid field path (${$}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);ee.push(et),et=""},en=!1;for(;er<$.length;){let ee=$[er];if("\\"===ee){if(er+1===$.length)throw new FirestoreError(t_.INVALID_ARGUMENT,"Path has trailing escape character: "+$);let ee=$[er+1];if(!("\\"===ee||"."===ee||"`"===ee))throw new FirestoreError(t_.INVALID_ARGUMENT,"Path has invalid escape sequence: "+$);et+=ee,er+=2}else"`"===ee?en=!en:"."!==ee||en?et+=ee:addCurrentSegment(),er++}if(addCurrentSegment(),en)throw new FirestoreError(t_.INVALID_ARGUMENT,"Unterminated ` in path: "+$);return new FieldPath$1(ee)}static emptyPath(){return new FieldPath$1([])}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let DocumentKey=class DocumentKey{constructor($){this.path=$}static fromPath($){return new DocumentKey(ResourcePath.fromString($))}static fromName($){return new DocumentKey(ResourcePath.fromString($).popFirst(5))}static empty(){return new DocumentKey(ResourcePath.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId($){return this.path.length>=2&&this.path.get(this.path.length-2)===$}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual($){return null!==$&&0===ResourcePath.comparator(this.path,$.path)}toString(){return this.path.toString()}static comparator($,ee){return ResourcePath.comparator($.path,ee.path)}static isDocumentKey($){return $.length%2==0}static fromSegments($){return new DocumentKey(new ResourcePath($.slice()))}};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tN=-1,tM=0;let FieldIndex=class FieldIndex{constructor($,ee,et,er){this.indexId=$,this.collectionGroup=ee,this.fields=et,this.indexState=er}};function fieldIndexGetArraySegment($){return $.fields.find($=>2===$.kind)}function fieldIndexGetDirectionalSegments($){return $.fields.filter($=>2!==$.kind)}function fieldIndexGetKeyOrder($){let ee=fieldIndexGetDirectionalSegments($);return 0===ee.length?0:ee[ee.length-1].kind}function fieldIndexSemanticComparator($,ee){let et=primitiveComparator($.collectionGroup,ee.collectionGroup);if(0!==et)return et;for(let er=0;er<Math.min($.fields.length,ee.fields.length);++er)if(0!==(et=indexSegmentComparator($.fields[er],ee.fields[er])))return et;return primitiveComparator($.fields.length,ee.fields.length)}function fieldIndexToString($){return`id=${$.indexId}|cg=${$.collectionGroup}|f=${$.fields.map($=>`${$.fieldPath}:${$.kind}`).join(",")}`}FieldIndex.UNKNOWN_ID=-1;let IndexSegment=class IndexSegment{constructor($,ee){this.fieldPath=$,this.kind=ee}};function indexSegmentComparator($,ee){let et=FieldPath$1.comparator($.fieldPath,ee.fieldPath);return 0!==et?et:primitiveComparator($.kind,ee.kind)}let IndexState=class IndexState{constructor($,ee){this.sequenceNumber=$,this.offset=ee}static empty(){return new IndexState(tM,IndexOffset.min())}};function newIndexOffsetSuccessorFromReadTime($,ee){let et=$.toTimestamp().seconds,er=$.toTimestamp().nanoseconds+1,en=SnapshotVersion.fromTimestamp(1e9===er?new Timestamp(et+1,0):new Timestamp(et,er));return new IndexOffset(en,DocumentKey.empty(),ee)}function newIndexOffsetFromDocument($){return new IndexOffset($.readTime,$.key,tN)}let IndexOffset=class IndexOffset{constructor($,ee,et){this.readTime=$,this.documentKey=ee,this.largestBatchId=et}static min(){return new IndexOffset(SnapshotVersion.min(),DocumentKey.empty(),tN)}static max(){return new IndexOffset(SnapshotVersion.max(),DocumentKey.empty(),tN)}};function indexOffsetComparator($,ee){let et=$.readTime.compareTo(ee.readTime);return 0!==et||0!==(et=DocumentKey.comparator($.documentKey,ee.documentKey))?et:primitiveComparator($.largestBatchId,ee.largestBatchId)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tF="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";let PersistenceTransaction=class PersistenceTransaction{constructor(){this.onCommittedListeners=[]}addOnCommittedListener($){this.onCommittedListeners.push($)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach($=>$())}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ignoreIfPrimaryLeaseLoss($){if($.code===t_.FAILED_PRECONDITION&&$.message===tF)logDebug("LocalStore","Unexpectedly lost primary lease");else throw $}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let PersistencePromise=class PersistencePromise{constructor($){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,$($=>{this.isDone=!0,this.result=$,this.nextCallback&&this.nextCallback($)},$=>{this.isDone=!0,this.error=$,this.catchCallback&&this.catchCallback($)})}catch($){return this.next(void 0,$)}next($,ee){return(this.callbackAttached&&fail(),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(ee,this.error):this.wrapSuccess($,this.result):new PersistencePromise((et,er)=>{this.nextCallback=ee=>{this.wrapSuccess($,ee).next(et,er)},this.catchCallback=$=>{this.wrapFailure(ee,$).next(et,er)}})}toPromise(){return new Promise(($,ee)=>{this.next($,ee)})}wrapUserFunction($){try{let ee=$();if(ee instanceof PersistencePromise)return ee;return PersistencePromise.resolve(ee)}catch($){return PersistencePromise.reject($)}}wrapSuccess($,ee){return $?this.wrapUserFunction(()=>$(ee)):PersistencePromise.resolve(ee)}wrapFailure($,ee){return $?this.wrapUserFunction(()=>$(ee)):PersistencePromise.reject(ee)}static resolve($){return new PersistencePromise((ee,et)=>{ee($)})}static reject($){return new PersistencePromise((ee,et)=>{et($)})}static waitFor($){return new PersistencePromise((ee,et)=>{let er=0,en=0,ei=!1;$.forEach($=>{++er,$.next(()=>{++en,ei&&en===er&&ee()},$=>et($))}),ei=!0,en===er&&ee()})}static or($){let ee=PersistencePromise.resolve(!1);for(let et of $)ee=ee.next($=>$?PersistencePromise.resolve($):et());return ee}static forEach($,ee){let et=[];return $.forEach(($,er)=>{et.push(ee.call(this,$,er))}),this.waitFor(et)}static mapArray($,ee){return new PersistencePromise((et,er)=>{let en=$.length,ei=Array(en),es=0;for(let eo=0;eo<en;eo++){let eu=eo;ee($[eu]).next($=>{ei[eu]=$,++es===en&&et(ei)},$=>er($))}})}static doWhile($,ee){return new PersistencePromise((et,er)=>{let process=()=>{!0===$()?ee().next(()=>{process()},er):et()};process()})}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tL="SimpleDb",tB=3;let SimpleDbTransaction=class SimpleDbTransaction{constructor($,ee){this.action=$,this.transaction=ee,this.aborted=!1,this.completionDeferred=new Deferred,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{ee.error?this.completionDeferred.reject(new IndexedDbTransactionError($,ee.error)):this.completionDeferred.resolve()},this.transaction.onerror=ee=>{let et=checkForAndReportiOSError(ee.target.error);this.completionDeferred.reject(new IndexedDbTransactionError($,et))}}static open($,ee,et,er){try{return new SimpleDbTransaction(ee,$.transaction(er,et))}catch($){throw new IndexedDbTransactionError(ee,$)}}get completionPromise(){return this.completionDeferred.promise}abort($){$&&this.completionDeferred.reject($),this.aborted||(logDebug(tL,"Aborting transaction:",$?$.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let $=this.transaction;this.aborted||"function"!=typeof $.commit||$.commit()}store($){let ee=this.transaction.objectStore($);return new SimpleDbStore(ee)}};let SimpleDb=class SimpleDb{constructor($,ee,et){this.name=$,this.version=ee,this.schemaConverter=et;let er=SimpleDb.getIOSVersion(getUA());12.2===er&&logError("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete($){return logDebug(tL,"Removing database:",$),wrapRequest(window.indexedDB.deleteDatabase($)).toPromise()}static isAvailable(){if(!isIndexedDBAvailable())return!1;if(SimpleDb.isMockPersistence())return!0;let $=getUA(),ee=SimpleDb.getIOSVersion($),et=0<ee&&ee<10,er=SimpleDb.getAndroidVersion($),en=0<er&&er<4.5;return!($.indexOf("MSIE ")>0||$.indexOf("Trident/")>0||$.indexOf("Edge/")>0)&&!et&&!en}static isMockPersistence(){var $;return"undefined"!=typeof process&&(null===($=process.env)||void 0===$?void 0:$.USE_MOCK_PERSISTENCE)==="YES"}static getStore($,ee){return $.store(ee)}static getIOSVersion($){let ee=$.match(/i(?:phone|pad|pod) os ([\d_]+)/i),et=ee?ee[1].split("_").slice(0,2).join("."):"-1";return Number(et)}static getAndroidVersion($){let ee=$.match(/Android ([\d.]+)/i),et=ee?ee[1].split(".").slice(0,2).join("."):"-1";return Number(et)}async ensureDb($){return this.db||(logDebug(tL,"Opening database:",this.name),this.db=await new Promise((ee,et)=>{let er=indexedDB.open(this.name,this.version);er.onsuccess=$=>{let et=$.target.result;ee(et)},er.onblocked=()=>{et(new IndexedDbTransactionError($,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},er.onerror=ee=>{let er=ee.target.error;"VersionError"===er.name?et(new FirestoreError(t_.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===er.name?et(new FirestoreError(t_.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+er)):et(new IndexedDbTransactionError($,er))},er.onupgradeneeded=$=>{logDebug(tL,'Database "'+this.name+'" requires upgrade from version:',$.oldVersion);let ee=$.target.result;this.schemaConverter.createOrUpgrade(ee,er.transaction,$.oldVersion,this.version).next(()=>{logDebug(tL,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=$=>this.versionchangelistener($)),this.db}setVersionChangeListener($){this.versionchangelistener=$,this.db&&(this.db.onversionchange=ee=>$(ee))}async runTransaction($,ee,et,er){let en="readonly"===ee,ei=0;for(;;){++ei;try{this.db=await this.ensureDb($);let ee=SimpleDbTransaction.open(this.db,$,en?"readonly":"readwrite",et),ei=er(ee).next($=>(ee.maybeCommit(),$)).catch($=>(ee.abort($),PersistencePromise.reject($))).toPromise();return ei.catch(()=>{}),await ee.completionPromise,ei}catch(et){let $=et,ee="FirebaseError"!==$.name&&ei<tB;if(logDebug(tL,"Transaction failed with error:",$.message,"Retrying:",ee),this.close(),!ee)return Promise.reject($)}}}close(){this.db&&this.db.close(),this.db=void 0}};let IterationController=class IterationController{constructor($){this.dbCursor=$,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor($){this.dbCursor=$}done(){this.shouldStop=!0}skip($){this.nextKey=$}delete(){return wrapRequest(this.dbCursor.delete())}};let IndexedDbTransactionError=class IndexedDbTransactionError extends null{constructor($,ee){super(t_.UNAVAILABLE,`IndexedDB transaction '${$}' failed: ${ee}`),this.name="IndexedDbTransactionError"}};function isIndexedDbTransactionError($){return"IndexedDbTransactionError"===$.name}let SimpleDbStore=class SimpleDbStore{constructor($){this.store=$}put($,ee){let et;return void 0!==ee?(logDebug(tL,"PUT",this.store.name,$,ee),et=this.store.put(ee,$)):(logDebug(tL,"PUT",this.store.name,"<auto-key>",$),et=this.store.put($)),wrapRequest(et)}add($){logDebug(tL,"ADD",this.store.name,$,$);let ee=this.store.add($);return wrapRequest(ee)}get($){let ee=this.store.get($);return wrapRequest(ee).next(ee=>(void 0===ee&&(ee=null),logDebug(tL,"GET",this.store.name,$,ee),ee))}delete($){logDebug(tL,"DELETE",this.store.name,$);let ee=this.store.delete($);return wrapRequest(ee)}count(){logDebug(tL,"COUNT",this.store.name);let $=this.store.count();return wrapRequest($)}loadAll($,ee){let et=this.options($,ee);if(et.index||"function"!=typeof this.store.getAll){let $=this.cursor(et),ee=[];return this.iterateCursor($,($,et)=>{ee.push(et)}).next(()=>ee)}{let $=this.store.getAll(et.range);return new PersistencePromise((ee,et)=>{$.onerror=$=>{et($.target.error)},$.onsuccess=$=>{ee($.target.result)}})}}loadFirst($,ee){let et=this.store.getAll($,null===ee?void 0:ee);return new PersistencePromise(($,ee)=>{et.onerror=$=>{ee($.target.error)},et.onsuccess=ee=>{$(ee.target.result)}})}deleteAll($,ee){logDebug(tL,"DELETE ALL",this.store.name);let et=this.options($,ee);et.keysOnly=!1;let er=this.cursor(et);return this.iterateCursor(er,($,ee,et)=>et.delete())}iterate($,ee){let et;ee?et=$:(et={},ee=$);let er=this.cursor(et);return this.iterateCursor(er,ee)}iterateSerial($){let ee=this.cursor({});return new PersistencePromise((et,er)=>{ee.onerror=$=>{let ee=checkForAndReportiOSError($.target.error);er(ee)},ee.onsuccess=ee=>{let er=ee.target.result;if(!er){et();return}$(er.primaryKey,er.value).next($=>{$?er.continue():et()})}})}iterateCursor($,ee){let et=[];return new PersistencePromise((er,en)=>{$.onerror=$=>{en($.target.error)},$.onsuccess=$=>{let en=$.target.result;if(!en){er();return}let ei=new IterationController(en),es=ee(en.primaryKey,en.value,ei);if(es instanceof PersistencePromise){let $=es.catch($=>(ei.done(),PersistencePromise.reject($)));et.push($)}ei.isDone?er():null===ei.skipToKey?en.continue():en.continue(ei.skipToKey)}}).next(()=>PersistencePromise.waitFor(et))}options($,ee){let et;return void 0!==$&&("string"==typeof $?et=$:ee=$),{index:et,range:ee}}cursor($){let ee="next";if($.reverse&&(ee="prev"),!$.index)return this.store.openCursor($.range,ee);{let et=this.store.index($.index);return $.keysOnly?et.openKeyCursor($.range,ee):et.openCursor($.range,ee)}}};function wrapRequest($){return new PersistencePromise((ee,et)=>{$.onsuccess=$=>{let et=$.target.result;ee(et)},$.onerror=$=>{let ee=checkForAndReportiOSError($.target.error);et(ee)}})}let tV=!1;function checkForAndReportiOSError($){let ee=SimpleDb.getIOSVersion(getUA());if(ee>=12.2&&ee<13){let ee="An internal error was encountered in the Indexed Database server";if($.message.indexOf(ee)>=0){let $=new FirestoreError("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${ee}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return tV||(tV=!0,setTimeout(()=>{throw $},0)),$}}return $}let tj="IndexBackiller",tU=null,tq=null,tz=50;let IndexBackfillerScheduler=class IndexBackfillerScheduler{constructor($,ee){this.asyncQueue=$,this.backfiller=ee,this.task=null}start(){this.schedule(tU)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule($){logDebug(tj,`Scheduled in ${$}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",$,async()=>{this.task=null;try{let $=await this.backfiller.backfill();logDebug(tj,`Documents written: ${$}`)}catch($){isIndexedDbTransactionError($)?logDebug(tj,"Ignoring IndexedDB error during index backfill: ",$):await ignoreIfPrimaryLeaseLoss($)}await this.schedule(tq)})}};let IndexBackfiller=class IndexBackfiller{constructor($,ee){this.localStore=$,this.persistence=ee}async backfill($=tz){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",ee=>this.writeIndexEntries(ee,$))}writeIndexEntries($,ee){let et=new Set,er=ee,en=!0;return PersistencePromise.doWhile(()=>!0===en&&er>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate($).next(ee=>{if(!(null===ee||et.has(ee)))return logDebug(tj,`Processing collection: ${ee}`),this.writeEntriesForCollectionGroup($,ee,er).next($=>{er-=$,et.add(ee)});en=!1})).next(()=>ee-er)}writeEntriesForCollectionGroup($,ee,et){return this.localStore.indexManager.getMinOffsetFromCollectionGroup($,ee).next(er=>this.localStore.localDocuments.getNextDocuments($,ee,er,et).next(et=>{let en=et.changes;return this.localStore.indexManager.updateIndexEntries($,en).next(()=>this.getNewOffset(er,et)).next(et=>(logDebug(tj,`Updating offset: ${et}`),this.localStore.indexManager.updateCollectionGroup($,ee,et))).next(()=>en.size)}))}getNewOffset($,ee){let et=$;return ee.changes.forEach(($,ee)=>{let er=newIndexOffsetFromDocument(ee);indexOffsetComparator(er,et)>0&&(et=er)}),new IndexOffset(et.readTime,et.documentKey,Math.max(ee.batchId,$.largestBatchId))}};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ListenSequence=class ListenSequence{constructor($,ee){this.previousValue=$,ee&&(ee.sequenceNumberHandler=$=>this.setPreviousValue($),this.writeNewSequenceNumber=$=>ee.writeSequenceNumber($))}setPreviousValue($){return this.previousValue=Math.max($,this.previousValue),this.previousValue}next(){let $=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber($),$}};ListenSequence.INVALID=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tK="\x01",tW="\x01",tG="\x10",t$="\x11";function encodeResourcePath($){let ee="";for(let et=0;et<$.length;et++)ee.length>0&&(ee=encodeSeparator(ee)),ee=encodeSegment($.get(et),ee);return encodeSeparator(ee)}function encodeSegment($,ee){let et=ee,er=$.length;for(let ee=0;ee<er;ee++){let er=$.charAt(ee);switch(er){case"\x00":et+=tK+tG;break;case tK:et+=tK+t$;break;default:et+=er}}return et}function encodeSeparator($){return $+tK+tW}function decodeResourcePath($){let ee=$.length;if(hardAssert(ee>=2),2===ee)return hardAssert($.charAt(0)===tK&&$.charAt(1)===tW),ResourcePath.emptyPath();let et=ee-2,er=[],en="";for(let ei=0;ei<ee;){let ee=$.indexOf(tK,ei);(ee<0||ee>et)&&fail();let es=$.charAt(ee+1);switch(es){case tW:let eo;let eu=$.substring(ei,ee);0===en.length?eo=eu:(en+=eu,eo=en,en=""),er.push(eo);break;case tG:en+=$.substring(ei,ee)+"\x00";break;case t$:en+=$.substring(ei,ee+1);break;default:fail()}ei=ee+2}return new ResourcePath(er)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tH="remoteDocuments",tQ="owner",tY="owner",tJ="mutationQueues",tX="userId",tZ="mutations",t0="batchId",t1="userMutationsIndex",t2=null;function newDbDocumentMutationPrefixForUser($){return[$]}function newDbDocumentMutationPrefixForPath($,ee){return[$,encodeResourcePath(ee)]}function newDbDocumentMutationKey($,ee,et){return[$,encodeResourcePath(ee),et]}let t3={},t6="documentMutations",t4="remoteDocumentsV14",t9=null,t5="documentKeyIndex",t8=null,t7="collectionGroupIndex",rt=null,rr="remoteDocumentGlobal",rn="remoteDocumentGlobalKey",ri="targets",rs="targetId",ro="queryTargetsIndex",rl=null,ru="targetDocuments",rh=null,rp="documentTargetsIndex",rf=null,rm="targetGlobalKey",rg="targetGlobal",ry="collectionParents",rv=null,rS="clientMetadata",rC="clientId",rT="bundles",rE="bundleId",rw="namedQueries",rD="name",rI="indexConfiguration",rR="indexId",r_="collectionGroupIndex",rP="collectionGroup",rA="indexState",rx=null,rO="sequenceNumberIndex",rk=null,rN="indexEntries",rM=null,rF="documentKeyIndex",rL=null,rB="documentOverlays",rV=null,rj="collectionPathOverlayIndex",rU=null,rq="collectionGroupOverlayIndex",rz=null,rK=[tJ,tZ,t6,tH,ri,tQ,rg,ru],rW=rK,rG=[...rW,rS],r$=[...rG,rr],rH=[...r$,ry],rQ=[...rH,rT,rw],rY=[...rQ,rB],rJ=[tJ,tZ,t6,t4,ri,tQ,rg,ru,rS,rr,ry,rT,rw,rB],rX=rJ,rZ=[...rX,rI,rA,rN];function getObjectStores($){return 15===$?rZ:14===$?rX:13===$?rJ:12===$?rY:11===$?rQ:void fail()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let IndexedDbTransaction=class IndexedDbTransaction extends null{constructor($,ee){super(),this.simpleDbTransaction=$,this.currentSequenceNumber=ee}};function getStore($,ee){let et=debugCast($);return SimpleDb.getStore(et.simpleDbTransaction,ee)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function objectSize($){let ee=0;for(let et in $)Object.prototype.hasOwnProperty.call($,et)&&ee++;return ee}function forEach($,ee){for(let et in $)Object.prototype.hasOwnProperty.call($,et)&&ee(et,$[et])}function isEmpty($){for(let ee in $)if(Object.prototype.hasOwnProperty.call($,ee))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let SortedMap=class SortedMap{constructor($,ee){this.comparator=$,this.root=ee||LLRBNode.EMPTY}insert($,ee){return new SortedMap(this.comparator,this.root.insert($,ee,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))}remove($){return new SortedMap(this.comparator,this.root.remove($,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))}get($){let ee=this.root;for(;!ee.isEmpty();){let et=this.comparator($,ee.key);if(0===et)return ee.value;et<0?ee=ee.left:et>0&&(ee=ee.right)}return null}indexOf($){let ee=0,et=this.root;for(;!et.isEmpty();){let er=this.comparator($,et.key);if(0===er)return ee+et.left.size;er<0?et=et.left:(ee+=et.left.size+1,et=et.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal($){return this.root.inorderTraversal($)}forEach($){this.inorderTraversal((ee,et)=>($(ee,et),!1))}toString(){let $=[];return this.inorderTraversal((ee,et)=>($.push(`${ee}:${et}`),!1)),`{${$.join(", ")}}`}reverseTraversal($){return this.root.reverseTraversal($)}getIterator(){return new SortedMapIterator(this.root,null,this.comparator,!1)}getIteratorFrom($){return new SortedMapIterator(this.root,$,this.comparator,!1)}getReverseIterator(){return new SortedMapIterator(this.root,null,this.comparator,!0)}getReverseIteratorFrom($){return new SortedMapIterator(this.root,$,this.comparator,!0)}};let SortedMapIterator=class SortedMapIterator{constructor($,ee,et,er){this.isReverse=er,this.nodeStack=[];let en=1;for(;!$.isEmpty();)if(en=ee?et($.key,ee):1,ee&&er&&(en*=-1),en<0)$=this.isReverse?$.left:$.right;else if(0===en){this.nodeStack.push($);break}else this.nodeStack.push($),$=this.isReverse?$.right:$.left}getNext(){let $=this.nodeStack.pop(),ee={key:$.key,value:$.value};if(this.isReverse)for($=$.left;!$.isEmpty();)this.nodeStack.push($),$=$.right;else for($=$.right;!$.isEmpty();)this.nodeStack.push($),$=$.left;return ee}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let $=this.nodeStack[this.nodeStack.length-1];return{key:$.key,value:$.value}}};let LLRBNode=class LLRBNode{constructor($,ee,et,er,en){this.key=$,this.value=ee,this.color=null!=et?et:LLRBNode.RED,this.left=null!=er?er:LLRBNode.EMPTY,this.right=null!=en?en:LLRBNode.EMPTY,this.size=this.left.size+1+this.right.size}copy($,ee,et,er,en){return new LLRBNode(null!=$?$:this.key,null!=ee?ee:this.value,null!=et?et:this.color,null!=er?er:this.left,null!=en?en:this.right)}isEmpty(){return!1}inorderTraversal($){return this.left.inorderTraversal($)||$(this.key,this.value)||this.right.inorderTraversal($)}reverseTraversal($){return this.right.reverseTraversal($)||$(this.key,this.value)||this.left.reverseTraversal($)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert($,ee,et){let er=this,en=et($,er.key);return(er=en<0?er.copy(null,null,null,er.left.insert($,ee,et),null):0===en?er.copy(null,ee,null,null,null):er.copy(null,null,null,null,er.right.insert($,ee,et))).fixUp()}removeMin(){if(this.left.isEmpty())return LLRBNode.EMPTY;let $=this;return $.left.isRed()||$.left.left.isRed()||($=$.moveRedLeft()),($=$.copy(null,null,null,$.left.removeMin(),null)).fixUp()}remove($,ee){let et;let er=this;if(0>ee($,er.key))er.left.isEmpty()||er.left.isRed()||er.left.left.isRed()||(er=er.moveRedLeft()),er=er.copy(null,null,null,er.left.remove($,ee),null);else{if(er.left.isRed()&&(er=er.rotateRight()),er.right.isEmpty()||er.right.isRed()||er.right.left.isRed()||(er=er.moveRedRight()),0===ee($,er.key)){if(er.right.isEmpty())return LLRBNode.EMPTY;et=er.right.min(),er=er.copy(et.key,et.value,null,null,er.right.removeMin())}er=er.copy(null,null,null,null,er.right.remove($,ee))}return er.fixUp()}isRed(){return this.color}fixUp(){let $=this;return $.right.isRed()&&!$.left.isRed()&&($=$.rotateLeft()),$.left.isRed()&&$.left.left.isRed()&&($=$.rotateRight()),$.left.isRed()&&$.right.isRed()&&($=$.colorFlip()),$}moveRedLeft(){let $=this.colorFlip();return $.right.left.isRed()&&($=($=($=$.copy(null,null,null,null,$.right.rotateRight())).rotateLeft()).colorFlip()),$}moveRedRight(){let $=this.colorFlip();return $.left.left.isRed()&&($=($=$.rotateRight()).colorFlip()),$}rotateLeft(){let $=this.copy(null,null,LLRBNode.RED,null,this.right.left);return this.right.copy(null,null,this.color,$,null)}rotateRight(){let $=this.copy(null,null,LLRBNode.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,$)}colorFlip(){let $=this.left.copy(null,null,!this.left.color,null,null),ee=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,$,ee)}checkMaxDepth(){let $=this.check();return Math.pow(2,$)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw fail();let $=this.left.check();if($===this.right.check())return $+(this.isRed()?0:1);throw fail()}};LLRBNode.EMPTY=null,LLRBNode.RED=!0,LLRBNode.BLACK=!1;let LLRBEmptyNode=class LLRBEmptyNode{constructor(){this.size=0}get key(){throw fail()}get value(){throw fail()}get color(){throw fail()}get left(){throw fail()}get right(){throw fail()}copy($,ee,et,er,en){return this}insert($,ee,et){return new LLRBNode($,ee)}remove($,ee){return this}isEmpty(){return!0}inorderTraversal($){return!1}reverseTraversal($){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};LLRBNode.EMPTY=new LLRBEmptyNode;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let SortedSet=class SortedSet{constructor($){this.comparator=$,this.data=new SortedMap(this.comparator)}has($){return null!==this.data.get($)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf($){return this.data.indexOf($)}forEach($){this.data.inorderTraversal((ee,et)=>($(ee),!1))}forEachInRange($,ee){let et=this.data.getIteratorFrom($[0]);for(;et.hasNext();){let er=et.getNext();if(this.comparator(er.key,$[1])>=0)return;ee(er.key)}}forEachWhile($,ee){let et;for(et=void 0!==ee?this.data.getIteratorFrom(ee):this.data.getIterator();et.hasNext();){let ee=et.getNext(),er=$(ee.key);if(!er)return}}firstAfterOrEqual($){let ee=this.data.getIteratorFrom($);return ee.hasNext()?ee.getNext().key:null}getIterator(){return new SortedSetIterator(this.data.getIterator())}getIteratorFrom($){return new SortedSetIterator(this.data.getIteratorFrom($))}add($){return this.copy(this.data.remove($).insert($,!0))}delete($){return this.has($)?this.copy(this.data.remove($)):this}isEmpty(){return this.data.isEmpty()}unionWith($){let ee=this;return ee.size<$.size&&(ee=$,$=this),$.forEach($=>{ee=ee.add($)}),ee}isEqual($){if(!($ instanceof SortedSet)||this.size!==$.size)return!1;let ee=this.data.getIterator(),et=$.data.getIterator();for(;ee.hasNext();){let $=ee.getNext().key,er=et.getNext().key;if(0!==this.comparator($,er))return!1}return!0}toArray(){let $=[];return this.forEach(ee=>{$.push(ee)}),$}toString(){let $=[];return this.forEach(ee=>$.push(ee)),"SortedSet("+$.toString()+")"}copy($){let ee=new SortedSet(this.comparator);return ee.data=$,ee}};let SortedSetIterator=class SortedSetIterator{constructor($){this.iter=$}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function diffSortedSets($,ee,et,er,en){let ei=$.getIterator(),es=ee.getIterator(),eo=advanceIterator(ei),eu=advanceIterator(es);for(;eo||eu;){let $=!1,ee=!1;if(eo&&eu){let er=et(eo,eu);er<0?ee=!0:er>0&&($=!0)}else null!=eo?ee=!0:$=!0;$?(er(eu),eu=advanceIterator(es)):ee?(en(eo),eo=advanceIterator(ei)):(eo=advanceIterator(ei),eu=advanceIterator(es))}}function advanceIterator($){return $.hasNext()?$.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let FieldMask=class FieldMask{constructor($){this.fields=$,$.sort(FieldPath$1.comparator)}static empty(){return new FieldMask([])}unionWith($){let ee=new SortedSet(FieldPath$1.comparator);for(let $ of this.fields)ee=ee.add($);for(let et of $)ee=ee.add(et);return new FieldMask(ee.toArray())}covers($){for(let ee of this.fields)if(ee.isPrefixOf($))return!0;return!1}isEqual($){return arrayEquals(this.fields,$.fields,($,ee)=>$.isEqual(ee))}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function decodeBase64($){return Buffer.from($,"base64").toString("binary")}function encodeBase64($){return Buffer.from($,"binary").toString("base64")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ByteString=class ByteString{constructor($){this.binaryString=$}static fromBase64String($){let ee=decodeBase64($);return new ByteString(ee)}static fromUint8Array($){let ee=binaryStringFromUint8Array($);return new ByteString(ee)}[Symbol.iterator](){let $=0;return{next:()=>$<this.binaryString.length?{value:this.binaryString.charCodeAt($++),done:!1}:{value:void 0,done:!0}}}toBase64(){return encodeBase64(this.binaryString)}toUint8Array(){return uint8ArrayFromBinaryString(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo($){return primitiveComparator(this.binaryString,$.binaryString)}isEqual($){return this.binaryString===$.binaryString}};function binaryStringFromUint8Array($){let ee="";for(let et=0;et<$.length;++et)ee+=String.fromCharCode($[et]);return ee}function uint8ArrayFromBinaryString($){let ee=new Uint8Array($.length);for(let et=0;et<$.length;et++)ee[et]=$.charCodeAt(et);return ee}ByteString.EMPTY_BYTE_STRING=new ByteString("");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let r0=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function normalizeTimestamp($){if(hardAssert(!!$),"string"==typeof $){let ee=0,et=r0.exec($);if(hardAssert(!!et),et[1]){let $=et[1];ee=Number($=($+"000000000").substr(0,9))}let er=new Date($),en=Math.floor(er.getTime()/1e3);return{seconds:en,nanos:ee}}{let ee=normalizeNumber($.seconds),et=normalizeNumber($.nanos);return{seconds:ee,nanos:et}}}function normalizeNumber($){return"number"==typeof $?$:"string"==typeof $?Number($):0}function normalizeByteString($){return"string"==typeof $?ByteString.fromBase64String($):ByteString.fromUint8Array($)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let r1="server_timestamp",r2="__type__",r3="__previous_value__",r6="__local_write_time__";function isServerTimestamp($){var ee,et;let er=null===(et=((null===(ee=null==$?void 0:$.mapValue)||void 0===ee?void 0:ee.fields)||{})[r2])||void 0===et?void 0:et.stringValue;return er===r1}function serverTimestamp$1($,ee){let et={fields:{[r2]:{stringValue:r1},[r6]:{timestampValue:{seconds:$.seconds,nanos:$.nanoseconds}}}};return ee&&isServerTimestamp(ee)&&(ee=getPreviousValue(ee)),ee&&(et.fields[r3]=ee),{mapValue:et}}function getPreviousValue($){let ee=$.mapValue.fields[r3];return isServerTimestamp(ee)?getPreviousValue(ee):ee}function getLocalWriteTime($){let ee=normalizeTimestamp($.mapValue.fields[r6].timestampValue);return new Timestamp(ee.seconds,ee.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let DatabaseInfo=class DatabaseInfo{constructor($,ee,et,er,en,ei,es,eo,eu){this.databaseId=$,this.appId=ee,this.persistenceKey=et,this.host=er,this.ssl=en,this.forceLongPolling=ei,this.autoDetectLongPolling=es,this.longPollingOptions=eo,this.useFetchStreams=eu}};let r4="(default)";let DatabaseId=class DatabaseId{constructor($,ee){this.projectId=$,this.database=ee||r4}static empty(){return new DatabaseId("","")}get isDefaultDatabase(){return this.database===r4}isEqual($){return $ instanceof DatabaseId&&$.projectId===this.projectId&&$.database===this.database}};function databaseIdFromApp($,ee){if(!Object.prototype.hasOwnProperty.apply($.options,["projectId"]))throw new FirestoreError(t_.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new DatabaseId($.options.projectId,ee)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let r9=-1;function isNullOrUndefined($){return null==$}function isNegativeZero($){return 0===$&&1/$==-1/0}function isSafeInteger($){return"number"==typeof $&&Number.isInteger($)&&!isNegativeZero($)&&$<=Number.MAX_SAFE_INTEGER&&$>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let r5="__max__",r8={mapValue:{fields:{__type__:{stringValue:r5}}}},r7={nullValue:"NULL_VALUE"};function typeOrder($){if("nullValue"in $)return 0;if("booleanValue"in $)return 1;if("integerValue"in $||"doubleValue"in $)return 2;if("timestampValue"in $)return 3;if("stringValue"in $)return 5;if("bytesValue"in $)return 6;if("referenceValue"in $)return 7;else if("geoPointValue"in $)return 8;else if("arrayValue"in $)return 9;else if(!("mapValue"in $))return fail();else return isServerTimestamp($)?4:isMaxValue($)?9007199254740991:10}function valueEquals($,ee){if($===ee)return!0;let et=typeOrder($),er=typeOrder(ee);if(et!==er)return!1;switch(et){case 0:case 9007199254740991:return!0;case 1:return $.booleanValue===ee.booleanValue;case 4:return getLocalWriteTime($).isEqual(getLocalWriteTime(ee));case 3:return timestampEquals($,ee);case 5:return $.stringValue===ee.stringValue;case 6:return blobEquals($,ee);case 7:return $.referenceValue===ee.referenceValue;case 8:return geoPointEquals($,ee);case 2:return numberEquals($,ee);case 9:return arrayEquals($.arrayValue.values||[],ee.arrayValue.values||[],valueEquals);case 10:return objectEquals($,ee);default:return fail()}}function timestampEquals($,ee){if("string"==typeof $.timestampValue&&"string"==typeof ee.timestampValue&&$.timestampValue.length===ee.timestampValue.length)return $.timestampValue===ee.timestampValue;let et=normalizeTimestamp($.timestampValue),er=normalizeTimestamp(ee.timestampValue);return et.seconds===er.seconds&&et.nanos===er.nanos}function geoPointEquals($,ee){return normalizeNumber($.geoPointValue.latitude)===normalizeNumber(ee.geoPointValue.latitude)&&normalizeNumber($.geoPointValue.longitude)===normalizeNumber(ee.geoPointValue.longitude)}function blobEquals($,ee){return normalizeByteString($.bytesValue).isEqual(normalizeByteString(ee.bytesValue))}function numberEquals($,ee){if("integerValue"in $&&"integerValue"in ee)return normalizeNumber($.integerValue)===normalizeNumber(ee.integerValue);if("doubleValue"in $&&"doubleValue"in ee){let et=normalizeNumber($.doubleValue),er=normalizeNumber(ee.doubleValue);return et===er?isNegativeZero(et)===isNegativeZero(er):isNaN(et)&&isNaN(er)}return!1}function objectEquals($,ee){let et=$.mapValue.fields||{},er=ee.mapValue.fields||{};if(objectSize(et)!==objectSize(er))return!1;for(let $ in et)if(et.hasOwnProperty($)&&(void 0===er[$]||!valueEquals(et[$],er[$])))return!1;return!0}function arrayValueContains($,ee){return void 0!==($.values||[]).find($=>valueEquals($,ee))}function valueCompare($,ee){if($===ee)return 0;let et=typeOrder($),er=typeOrder(ee);if(et!==er)return primitiveComparator(et,er);switch(et){case 0:case 9007199254740991:return 0;case 1:return primitiveComparator($.booleanValue,ee.booleanValue);case 2:return compareNumbers($,ee);case 3:return compareTimestamps($.timestampValue,ee.timestampValue);case 4:return compareTimestamps(getLocalWriteTime($),getLocalWriteTime(ee));case 5:return primitiveComparator($.stringValue,ee.stringValue);case 6:return compareBlobs($.bytesValue,ee.bytesValue);case 7:return compareReferences($.referenceValue,ee.referenceValue);case 8:return compareGeoPoints($.geoPointValue,ee.geoPointValue);case 9:return compareArrays($.arrayValue,ee.arrayValue);case 10:return compareMaps($.mapValue,ee.mapValue);default:throw fail()}}function compareNumbers($,ee){let et=normalizeNumber($.integerValue||$.doubleValue),er=normalizeNumber(ee.integerValue||ee.doubleValue);return et<er?-1:et>er?1:et===er?0:isNaN(et)?isNaN(er)?0:-1:1}function compareTimestamps($,ee){if("string"==typeof $&&"string"==typeof ee&&$.length===ee.length)return primitiveComparator($,ee);let et=normalizeTimestamp($),er=normalizeTimestamp(ee),en=primitiveComparator(et.seconds,er.seconds);return 0!==en?en:primitiveComparator(et.nanos,er.nanos)}function compareReferences($,ee){let et=$.split("/"),er=ee.split("/");for(let $=0;$<et.length&&$<er.length;$++){let ee=primitiveComparator(et[$],er[$]);if(0!==ee)return ee}return primitiveComparator(et.length,er.length)}function compareGeoPoints($,ee){let et=primitiveComparator(normalizeNumber($.latitude),normalizeNumber(ee.latitude));return 0!==et?et:primitiveComparator(normalizeNumber($.longitude),normalizeNumber(ee.longitude))}function compareBlobs($,ee){let et=normalizeByteString($),er=normalizeByteString(ee);return et.compareTo(er)}function compareArrays($,ee){let et=$.values||[],er=ee.values||[];for(let $=0;$<et.length&&$<er.length;++$){let ee=valueCompare(et[$],er[$]);if(ee)return ee}return primitiveComparator(et.length,er.length)}function compareMaps($,ee){if($===r8.mapValue&&ee===r8.mapValue)return 0;if($===r8.mapValue)return 1;if(ee===r8.mapValue)return -1;let et=$.fields||{},er=Object.keys(et),en=ee.fields||{},ei=Object.keys(en);er.sort(),ei.sort();for(let $=0;$<er.length&&$<ei.length;++$){let ee=primitiveComparator(er[$],ei[$]);if(0!==ee)return ee;let es=valueCompare(et[er[$]],en[ei[$]]);if(0!==es)return es}return primitiveComparator(er.length,ei.length)}function canonicalId($){return canonifyValue($)}function canonifyValue($){if("nullValue"in $)return"null";if("booleanValue"in $)return""+$.booleanValue;if("integerValue"in $)return""+$.integerValue;if("doubleValue"in $)return""+$.doubleValue;if("timestampValue"in $)return canonifyTimestamp($.timestampValue);if("stringValue"in $)return $.stringValue;if("bytesValue"in $)return canonifyByteString($.bytesValue);else if("referenceValue"in $)return canonifyReference($.referenceValue);else if("geoPointValue"in $)return canonifyGeoPoint($.geoPointValue);else if("arrayValue"in $)return canonifyArray($.arrayValue);else if("mapValue"in $)return canonifyMap($.mapValue);else return fail()}function canonifyByteString($){return normalizeByteString($).toBase64()}function canonifyTimestamp($){let ee=normalizeTimestamp($);return`time(${ee.seconds},${ee.nanos})`}function canonifyGeoPoint($){return`geo(${$.latitude},${$.longitude})`}function canonifyReference($){return DocumentKey.fromName($).toString()}function canonifyMap($){let ee=Object.keys($.fields||{}).sort(),et="{",er=!0;for(let en of ee)er?er=!1:et+=",",et+=`${en}:${canonifyValue($.fields[en])}`;return et+"}"}function canonifyArray($){let ee="[",et=!0;for(let er of $.values||[])et?et=!1:ee+=",",ee+=canonifyValue(er);return ee+"]"}function estimateByteSize($){switch(typeOrder($)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let ee=getPreviousValue($);return ee?16+estimateByteSize(ee):16;case 5:return 2*$.stringValue.length;case 6:return normalizeByteString($.bytesValue).approximateByteSize();case 7:return $.referenceValue.length;case 9:return estimateArrayByteSize($.arrayValue);case 10:return estimateMapByteSize($.mapValue);default:throw fail()}}function estimateMapByteSize($){let ee=0;return forEach($.fields,($,et)=>{ee+=$.length+estimateByteSize(et)}),ee}function estimateArrayByteSize($){return($.values||[]).reduce(($,ee)=>$+estimateByteSize(ee),0)}function refValue($,ee){return{referenceValue:`projects/${$.projectId}/databases/${$.database}/documents/${ee.path.canonicalString()}`}}function isInteger($){return!!$&&"integerValue"in $}function isDouble($){return!!$&&"doubleValue"in $}function isNumber($){return isInteger($)||isDouble($)}function isArray($){return!!$&&"arrayValue"in $}function isNullValue($){return!!$&&"nullValue"in $}function isNanValue($){return!!$&&"doubleValue"in $&&isNaN(Number($.doubleValue))}function isMapValue($){return!!$&&"mapValue"in $}function deepClone($){if($.geoPointValue)return{geoPointValue:Object.assign({},$.geoPointValue)};if($.timestampValue&&"object"==typeof $.timestampValue)return{timestampValue:Object.assign({},$.timestampValue)};if($.mapValue){let ee={mapValue:{fields:{}}};return forEach($.mapValue.fields,($,et)=>ee.mapValue.fields[$]=deepClone(et)),ee}{if(!$.arrayValue)return Object.assign({},$);let ee={arrayValue:{values:[]}};for(let et=0;et<($.arrayValue.values||[]).length;++et)ee.arrayValue.values[et]=deepClone($.arrayValue.values[et]);return ee}}function isMaxValue($){return((($.mapValue||{}).fields||{}).__type__||{}).stringValue===r5}function valuesGetLowerBound($){if("nullValue"in $)return r7;if("booleanValue"in $)return{booleanValue:!1};if("integerValue"in $||"doubleValue"in $)return{doubleValue:NaN};if("timestampValue"in $)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in $)return{stringValue:""};if("bytesValue"in $)return{bytesValue:""};if("referenceValue"in $)return refValue(DatabaseId.empty(),DocumentKey.empty());else if("geoPointValue"in $)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in $)return{arrayValue:{}};else if("mapValue"in $)return{mapValue:{}};else return fail()}function valuesGetUpperBound($){if("nullValue"in $)return{booleanValue:!1};if("booleanValue"in $)return{doubleValue:NaN};if("integerValue"in $||"doubleValue"in $)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in $)return{stringValue:""};if("stringValue"in $)return{bytesValue:""};if("bytesValue"in $)return refValue(DatabaseId.empty(),DocumentKey.empty());if("referenceValue"in $)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in $)return{arrayValue:{}};else if("arrayValue"in $)return{mapValue:{}};else if("mapValue"in $)return r8;else return fail()}function lowerBoundCompare($,ee){let et=valueCompare($.value,ee.value);return 0!==et?et:$.inclusive&&!ee.inclusive?-1:!$.inclusive&&ee.inclusive?1:0}function upperBoundCompare($,ee){let et=valueCompare($.value,ee.value);return 0!==et?et:$.inclusive&&!ee.inclusive?1:!$.inclusive&&ee.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ObjectValue=class ObjectValue{constructor($){this.value=$}static empty(){return new ObjectValue({mapValue:{}})}field($){if($.isEmpty())return this.value;{let ee=this.value;for(let et=0;et<$.length-1;++et)if(!isMapValue(ee=(ee.mapValue.fields||{})[$.get(et)]))return null;return(ee=(ee.mapValue.fields||{})[$.lastSegment()])||null}}set($,ee){let et=this.getFieldsMap($.popLast());et[$.lastSegment()]=deepClone(ee)}setAll($){let ee=FieldPath$1.emptyPath(),et={},er=[];$.forEach(($,en)=>{if(!ee.isImmediateParentOf(en)){let $=this.getFieldsMap(ee);this.applyChanges($,et,er),et={},er=[],ee=en.popLast()}$?et[en.lastSegment()]=deepClone($):er.push(en.lastSegment())});let en=this.getFieldsMap(ee);this.applyChanges(en,et,er)}delete($){let ee=this.field($.popLast());isMapValue(ee)&&ee.mapValue.fields&&delete ee.mapValue.fields[$.lastSegment()]}isEqual($){return valueEquals(this.value,$.value)}getFieldsMap($){let ee=this.value;ee.mapValue.fields||(ee.mapValue={fields:{}});for(let et=0;et<$.length;++et){let er=ee.mapValue.fields[$.get(et)];isMapValue(er)&&er.mapValue.fields||(er={mapValue:{fields:{}}},ee.mapValue.fields[$.get(et)]=er),ee=er}return ee.mapValue.fields}applyChanges($,ee,et){for(let er of(forEach(ee,(ee,et)=>$[ee]=et),et))delete $[er]}clone(){return new ObjectValue(deepClone(this.value))}};function extractFieldMask($){let ee=[];return forEach($.fields,($,et)=>{let er=new FieldPath$1([$]);if(isMapValue(et)){let $=extractFieldMask(et.mapValue),en=$.fields;if(0===en.length)ee.push(er);else for(let $ of en)ee.push(er.child($))}else ee.push(er)}),new FieldMask(ee)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let MutableDocument=class MutableDocument{constructor($,ee,et,er,en,ei,es){this.key=$,this.documentType=ee,this.version=et,this.readTime=er,this.createTime=en,this.data=ei,this.documentState=es}static newInvalidDocument($){return new MutableDocument($,0,SnapshotVersion.min(),SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),0)}static newFoundDocument($,ee,et,er){return new MutableDocument($,1,ee,SnapshotVersion.min(),et,er,0)}static newNoDocument($,ee){return new MutableDocument($,2,ee,SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),0)}static newUnknownDocument($,ee){return new MutableDocument($,3,ee,SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),2)}convertToFoundDocument($,ee){return this.createTime.isEqual(SnapshotVersion.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=$),this.version=$,this.documentType=1,this.data=ee,this.documentState=0,this}convertToNoDocument($){return this.version=$,this.documentType=2,this.data=ObjectValue.empty(),this.documentState=0,this}convertToUnknownDocument($){return this.version=$,this.documentType=3,this.data=ObjectValue.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=SnapshotVersion.min(),this}setReadTime($){return this.readTime=$,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual($){return $ instanceof MutableDocument&&this.key.isEqual($.key)&&this.version.isEqual($.version)&&this.documentType===$.documentType&&this.documentState===$.documentState&&this.data.isEqual($.data)}mutableCopy(){return new MutableDocument(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function compareDocumentsByField($,ee,et){let er=ee.data.field($),en=et.data.field($);return null!==er&&null!==en?valueCompare(er,en):fail()}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bound=class Bound{constructor($,ee){this.position=$,this.inclusive=ee}};function boundCompareToDocument($,ee,et){let er=0;for(let en=0;en<$.position.length;en++){let ei=ee[en],es=$.position[en];if(ei.field.isKeyField())er=DocumentKey.comparator(DocumentKey.fromName(es.referenceValue),et.key);else{let $=et.data.field(ei.field);er=valueCompare(es,$)}if("desc"===ei.dir&&(er*=-1),0!==er)break}return er}function boundSortsAfterDocument($,ee,et){let er=boundCompareToDocument($,ee,et);return $.inclusive?er>=0:er>0}function boundSortsBeforeDocument($,ee,et){let er=boundCompareToDocument($,ee,et);return $.inclusive?er<=0:er<0}function boundEquals($,ee){if(null===$)return null===ee;if(null===ee||$.inclusive!==ee.inclusive||$.position.length!==ee.position.length)return!1;for(let et=0;et<$.position.length;et++){let er=$.position[et],en=ee.position[et];if(!valueEquals(er,en))return!1}return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let OrderBy=class OrderBy{constructor($,ee="asc"){this.field=$,this.dir=ee}};function canonifyOrderBy($){return $.field.canonicalString()+$.dir}function stringifyOrderBy($){return`${$.field.canonicalString()} (${$.dir})`}function orderByEquals($,ee){return $.dir===ee.dir&&$.field.isEqual(ee.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Filter=class Filter{};let FieldFilter=class FieldFilter extends Filter{constructor($,ee,et){super(),this.field=$,this.op=ee,this.value=et}static create($,ee,et){return $.isKeyField()?"in"===ee||"not-in"===ee?this.createKeyFieldInFilter($,ee,et):new KeyFieldFilter($,ee,et):"array-contains"===ee?new ArrayContainsFilter($,et):"in"===ee?new InFilter($,et):"not-in"===ee?new NotInFilter($,et):"array-contains-any"===ee?new ArrayContainsAnyFilter($,et):new FieldFilter($,ee,et)}static createKeyFieldInFilter($,ee,et){return"in"===ee?new KeyFieldInFilter($,et):new KeyFieldNotInFilter($,et)}matches($){let ee=$.data.field(this.field);return"!="===this.op?null!==ee&&this.matchesComparison(valueCompare(ee,this.value)):null!==ee&&typeOrder(this.value)===typeOrder(ee)&&this.matchesComparison(valueCompare(ee,this.value))}matchesComparison($){switch(this.op){case"<":return $<0;case"<=":return $<=0;case"==":return 0===$;case"!=":return 0!==$;case">":return $>0;case">=":return $>=0;default:return fail()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}};let CompositeFilter=class CompositeFilter extends Filter{constructor($,ee){super(),this.filters=$,this.op=ee,this.memoizedFlattenedFilters=null}static create($,ee){return new CompositeFilter($,ee)}matches($){return compositeFilterIsConjunction(this)?void 0===this.filters.find(ee=>!ee.matches($)):void 0!==this.filters.find(ee=>ee.matches($))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce(($,ee)=>$.concat(ee.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){let $=this.findFirstMatchingFilter($=>$.isInequality());return null!==$?$.field:null}findFirstMatchingFilter($){for(let ee of this.getFlattenedFilters())if($(ee))return ee;return null}};function compositeFilterIsConjunction($){return"and"===$.op}function compositeFilterIsDisjunction($){return"or"===$.op}function compositeFilterIsFlatConjunction($){return compositeFilterIsFlat($)&&compositeFilterIsConjunction($)}function compositeFilterIsFlat($){for(let ee of $.filters)if(ee instanceof CompositeFilter)return!1;return!0}function canonifyFilter($){if($ instanceof FieldFilter)return $.field.canonicalString()+$.op.toString()+canonicalId($.value);if(compositeFilterIsFlatConjunction($))return $.filters.map($=>canonifyFilter($)).join(",");{let ee=$.filters.map($=>canonifyFilter($)).join(",");return`${$.op}(${ee})`}}function filterEquals($,ee){return $ instanceof FieldFilter?fieldFilterEquals($,ee):$ instanceof CompositeFilter?compositeFilterEquals($,ee):void fail()}function fieldFilterEquals($,ee){return ee instanceof FieldFilter&&$.op===ee.op&&$.field.isEqual(ee.field)&&valueEquals($.value,ee.value)}function compositeFilterEquals($,ee){if(ee instanceof CompositeFilter&&$.op===ee.op&&$.filters.length===ee.filters.length){let et=$.filters.reduce(($,et,er)=>$&&filterEquals(et,ee.filters[er]),!0);return et}return!1}function compositeFilterWithAddedFilters($,ee){let et=$.filters.concat(ee);return CompositeFilter.create(et,$.op)}function stringifyFilter($){return $ instanceof FieldFilter?stringifyFieldFilter($):$ instanceof CompositeFilter?stringifyCompositeFilter($):"Filter"}function stringifyCompositeFilter($){return $.op.toString()+" {"+$.getFilters().map(stringifyFilter).join(" ,")+"}"}function stringifyFieldFilter($){return`${$.field.canonicalString()} ${$.op} ${canonicalId($.value)}`}let KeyFieldFilter=class KeyFieldFilter extends FieldFilter{constructor($,ee,et){super($,ee,et),this.key=DocumentKey.fromName(et.referenceValue)}matches($){let ee=DocumentKey.comparator($.key,this.key);return this.matchesComparison(ee)}};let KeyFieldInFilter=class KeyFieldInFilter extends FieldFilter{constructor($,ee){super($,"in",ee),this.keys=extractDocumentKeysFromArrayValue("in",ee)}matches($){return this.keys.some(ee=>ee.isEqual($.key))}};let KeyFieldNotInFilter=class KeyFieldNotInFilter extends FieldFilter{constructor($,ee){super($,"not-in",ee),this.keys=extractDocumentKeysFromArrayValue("not-in",ee)}matches($){return!this.keys.some(ee=>ee.isEqual($.key))}};function extractDocumentKeysFromArrayValue($,ee){var et;return((null===(et=ee.arrayValue)||void 0===et?void 0:et.values)||[]).map($=>DocumentKey.fromName($.referenceValue))}let ArrayContainsFilter=class ArrayContainsFilter extends FieldFilter{constructor($,ee){super($,"array-contains",ee)}matches($){let ee=$.data.field(this.field);return isArray(ee)&&arrayValueContains(ee.arrayValue,this.value)}};let InFilter=class InFilter extends FieldFilter{constructor($,ee){super($,"in",ee)}matches($){let ee=$.data.field(this.field);return null!==ee&&arrayValueContains(this.value.arrayValue,ee)}};let NotInFilter=class NotInFilter extends FieldFilter{constructor($,ee){super($,"not-in",ee)}matches($){if(arrayValueContains(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let ee=$.data.field(this.field);return null!==ee&&!arrayValueContains(this.value.arrayValue,ee)}};let ArrayContainsAnyFilter=class ArrayContainsAnyFilter extends FieldFilter{constructor($,ee){super($,"array-contains-any",ee)}matches($){let ee=$.data.field(this.field);return!!isArray(ee)&&!!ee.arrayValue.values&&ee.arrayValue.values.some($=>arrayValueContains(this.value.arrayValue,$))}};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let TargetImpl=class TargetImpl{constructor($,ee=null,et=[],er=[],en=null,ei=null,es=null){this.path=$,this.collectionGroup=ee,this.orderBy=et,this.filters=er,this.limit=en,this.startAt=ei,this.endAt=es,this.memoizedCanonicalId=null}};function newTarget($,ee=null,et=[],er=[],en=null,ei=null,es=null){return new TargetImpl($,ee,et,er,en,ei,es)}function canonifyTarget($){let ee=debugCast($);if(null===ee.memoizedCanonicalId){let $=ee.path.canonicalString();null!==ee.collectionGroup&&($+="|cg:"+ee.collectionGroup),$+="|f:"+ee.filters.map($=>canonifyFilter($)).join(",")+"|ob:"+ee.orderBy.map($=>canonifyOrderBy($)).join(","),isNullOrUndefined(ee.limit)||($+="|l:"+ee.limit),ee.startAt&&($+="|lb:"+(ee.startAt.inclusive?"b:":"a:")+ee.startAt.position.map($=>canonicalId($)).join(",")),ee.endAt&&($+="|ub:"+(ee.endAt.inclusive?"a:":"b:")+ee.endAt.position.map($=>canonicalId($)).join(",")),ee.memoizedCanonicalId=$}return ee.memoizedCanonicalId}function stringifyTarget($){let ee=$.path.canonicalString();return null!==$.collectionGroup&&(ee+=" collectionGroup="+$.collectionGroup),$.filters.length>0&&(ee+=`, filters: [${$.filters.map($=>stringifyFilter($)).join(", ")}]`),isNullOrUndefined($.limit)||(ee+=", limit: "+$.limit),$.orderBy.length>0&&(ee+=`, orderBy: [${$.orderBy.map($=>stringifyOrderBy($)).join(", ")}]`),$.startAt&&(ee+=", startAt: "+($.startAt.inclusive?"b:":"a:")+$.startAt.position.map($=>canonicalId($)).join(",")),$.endAt&&(ee+=", endAt: "+($.endAt.inclusive?"a:":"b:")+$.endAt.position.map($=>canonicalId($)).join(",")),`Target(${ee})`}function targetEquals($,ee){if($.limit!==ee.limit||$.orderBy.length!==ee.orderBy.length)return!1;for(let et=0;et<$.orderBy.length;et++)if(!orderByEquals($.orderBy[et],ee.orderBy[et]))return!1;if($.filters.length!==ee.filters.length)return!1;for(let et=0;et<$.filters.length;et++)if(!filterEquals($.filters[et],ee.filters[et]))return!1;return!!($.collectionGroup===ee.collectionGroup&&$.path.isEqual(ee.path)&&boundEquals($.startAt,ee.startAt))&&boundEquals($.endAt,ee.endAt)}function targetIsDocumentTarget($){return DocumentKey.isDocumentKey($.path)&&null===$.collectionGroup&&0===$.filters.length}function targetGetFieldFiltersForPath($,ee){return $.filters.filter($=>$ instanceof FieldFilter&&$.field.isEqual(ee))}function targetGetArrayValues($,ee){let et=fieldIndexGetArraySegment(ee);if(void 0===et)return null;for(let ee of targetGetFieldFiltersForPath($,et.fieldPath))switch(ee.op){case"array-contains-any":return ee.value.arrayValue.values||[];case"array-contains":return[ee.value]}return null}function targetGetNotInValues($,ee){let et=new Map;for(let er of fieldIndexGetDirectionalSegments(ee))for(let ee of targetGetFieldFiltersForPath($,er.fieldPath))switch(ee.op){case"==":case"in":et.set(er.fieldPath.canonicalString(),ee.value);break;case"not-in":case"!=":return et.set(er.fieldPath.canonicalString(),ee.value),Array.from(et.values())}return null}function targetGetLowerBound($,ee){let et=[],er=!0;for(let en of fieldIndexGetDirectionalSegments(ee)){let ee=0===en.kind?targetGetAscendingBound($,en.fieldPath,$.startAt):targetGetDescendingBound($,en.fieldPath,$.startAt);et.push(ee.value),er&&(er=ee.inclusive)}return new Bound(et,er)}function targetGetUpperBound($,ee){let et=[],er=!0;for(let en of fieldIndexGetDirectionalSegments(ee)){let ee=0===en.kind?targetGetDescendingBound($,en.fieldPath,$.endAt):targetGetAscendingBound($,en.fieldPath,$.endAt);et.push(ee.value),er&&(er=ee.inclusive)}return new Bound(et,er)}function targetGetAscendingBound($,ee,et){let er=r7,en=!0;for(let et of targetGetFieldFiltersForPath($,ee)){let $=r7,ee=!0;switch(et.op){case"<":case"<=":$=valuesGetLowerBound(et.value);break;case"==":case"in":case">=":$=et.value;break;case">":$=et.value,ee=!1;break;case"!=":case"not-in":$=r7}0>lowerBoundCompare({value:er,inclusive:en},{value:$,inclusive:ee})&&(er=$,en=ee)}if(null!==et)for(let ei=0;ei<$.orderBy.length;++ei){let es=$.orderBy[ei];if(es.field.isEqual(ee)){let $=et.position[ei];0>lowerBoundCompare({value:er,inclusive:en},{value:$,inclusive:et.inclusive})&&(er=$,en=et.inclusive);break}}return{value:er,inclusive:en}}function targetGetDescendingBound($,ee,et){let er=r8,en=!0;for(let et of targetGetFieldFiltersForPath($,ee)){let $=r8,ee=!0;switch(et.op){case">=":case">":$=valuesGetUpperBound(et.value),ee=!1;break;case"==":case"in":case"<=":$=et.value;break;case"<":$=et.value,ee=!1;break;case"!=":case"not-in":$=r8}upperBoundCompare({value:er,inclusive:en},{value:$,inclusive:ee})>0&&(er=$,en=ee)}if(null!==et)for(let ei=0;ei<$.orderBy.length;++ei){let es=$.orderBy[ei];if(es.field.isEqual(ee)){let $=et.position[ei];upperBoundCompare({value:er,inclusive:en},{value:$,inclusive:et.inclusive})>0&&(er=$,en=et.inclusive);break}}return{value:er,inclusive:en}}function targetGetSegmentCount($){let ee=new SortedSet(FieldPath$1.comparator),et=!1;for(let er of $.filters)for(let $ of er.getFlattenedFilters())$.field.isKeyField()||("array-contains"===$.op||"array-contains-any"===$.op?et=!0:ee=ee.add($.field));for(let et of $.orderBy)et.field.isKeyField()||(ee=ee.add(et.field));return ee.size+(et?1:0)}function targetHasLimit($){return null!==$.limit}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let QueryImpl=class QueryImpl{constructor($,ee=null,et=[],er=[],en=null,ei="F",es=null,eo=null){this.path=$,this.collectionGroup=ee,this.explicitOrderBy=et,this.filters=er,this.limit=en,this.limitType=ei,this.startAt=es,this.endAt=eo,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function newQuery($,ee,et,er,en,ei,es,eo){return new QueryImpl($,ee,et,er,en,ei,es,eo)}function newQueryForPath($){return new QueryImpl($)}function asCollectionQueryAtPath($,ee){return new QueryImpl(ee,null,$.explicitOrderBy.slice(),$.filters.slice(),$.limit,$.limitType,$.startAt,$.endAt)}function queryMatchesAllDocuments($){return 0===$.filters.length&&null===$.limit&&null==$.startAt&&null==$.endAt&&(0===$.explicitOrderBy.length||1===$.explicitOrderBy.length&&$.explicitOrderBy[0].field.isKeyField())}function getFirstOrderByField($){return $.explicitOrderBy.length>0?$.explicitOrderBy[0].field:null}function getInequalityFilterField($){for(let ee of $.filters){let $=ee.getFirstInequalityField();if(null!==$)return $}return null}function isDocumentQuery$1($){return DocumentKey.isDocumentKey($.path)&&null===$.collectionGroup&&0===$.filters.length}function isCollectionGroupQuery($){return null!==$.collectionGroup}function queryNormalizedOrderBy($){let ee=debugCast($);if(null===ee.memoizedNormalizedOrderBy){ee.memoizedNormalizedOrderBy=[];let $=getInequalityFilterField(ee),et=getFirstOrderByField(ee);if(null!==$&&null===et)$.isKeyField()||ee.memoizedNormalizedOrderBy.push(new OrderBy($)),ee.memoizedNormalizedOrderBy.push(new OrderBy(FieldPath$1.keyField(),"asc"));else{let $=!1;for(let et of ee.explicitOrderBy)ee.memoizedNormalizedOrderBy.push(et),et.field.isKeyField()&&($=!0);if(!$){let $=ee.explicitOrderBy.length>0?ee.explicitOrderBy[ee.explicitOrderBy.length-1].dir:"asc";ee.memoizedNormalizedOrderBy.push(new OrderBy(FieldPath$1.keyField(),$))}}}return ee.memoizedNormalizedOrderBy}function queryToTarget($){let ee=debugCast($);return ee.memoizedTarget||(ee.memoizedTarget=_queryToTarget(ee,queryNormalizedOrderBy($))),ee.memoizedTarget}function queryToAggregateTarget($){let ee=debugCast($);return ee.memoizedAggregateTarget||(ee.memoizedAggregateTarget=_queryToTarget(ee,$.explicitOrderBy)),ee.memoizedAggregateTarget}function _queryToTarget($,ee){if("F"===$.limitType)return newTarget($.path,$.collectionGroup,ee,$.filters,$.limit,$.startAt,$.endAt);{ee=ee.map($=>{let ee="desc"===$.dir?"asc":"desc";return new OrderBy($.field,ee)});let et=$.endAt?new Bound($.endAt.position,$.endAt.inclusive):null,er=$.startAt?new Bound($.startAt.position,$.startAt.inclusive):null;return newTarget($.path,$.collectionGroup,ee,$.filters,$.limit,et,er)}}function queryWithAddedFilter($,ee){ee.getFirstInequalityField(),getInequalityFilterField($);let et=$.filters.concat([ee]);return new QueryImpl($.path,$.collectionGroup,$.explicitOrderBy.slice(),et,$.limit,$.limitType,$.startAt,$.endAt)}function queryWithAddedOrderBy($,ee){let et=$.explicitOrderBy.concat([ee]);return new QueryImpl($.path,$.collectionGroup,et,$.filters.slice(),$.limit,$.limitType,$.startAt,$.endAt)}function queryWithLimit($,ee,et){return new QueryImpl($.path,$.collectionGroup,$.explicitOrderBy.slice(),$.filters.slice(),ee,et,$.startAt,$.endAt)}function queryWithStartAt($,ee){return new QueryImpl($.path,$.collectionGroup,$.explicitOrderBy.slice(),$.filters.slice(),$.limit,$.limitType,ee,$.endAt)}function queryWithEndAt($,ee){return new QueryImpl($.path,$.collectionGroup,$.explicitOrderBy.slice(),$.filters.slice(),$.limit,$.limitType,$.startAt,ee)}function queryEquals($,ee){return targetEquals(queryToTarget($),queryToTarget(ee))&&$.limitType===ee.limitType}function canonifyQuery($){return`${canonifyTarget(queryToTarget($))}|lt:${$.limitType}`}function stringifyQuery($){return`Query(target=${stringifyTarget(queryToTarget($))}; limitType=${$.limitType})`}function queryMatches($,ee){return ee.isFoundDocument()&&queryMatchesPathAndCollectionGroup($,ee)&&queryMatchesOrderBy($,ee)&&queryMatchesFilters($,ee)&&queryMatchesBounds($,ee)}function queryMatchesPathAndCollectionGroup($,ee){let et=ee.key.path;return null!==$.collectionGroup?ee.key.hasCollectionId($.collectionGroup)&&$.path.isPrefixOf(et):DocumentKey.isDocumentKey($.path)?$.path.isEqual(et):$.path.isImmediateParentOf(et)}function queryMatchesOrderBy($,ee){for(let et of queryNormalizedOrderBy($))if(!et.field.isKeyField()&&null===ee.data.field(et.field))return!1;return!0}function queryMatchesFilters($,ee){for(let et of $.filters)if(!et.matches(ee))return!1;return!0}function queryMatchesBounds($,ee){return(!$.startAt||!!boundSortsBeforeDocument($.startAt,queryNormalizedOrderBy($),ee))&&(!$.endAt||!!boundSortsAfterDocument($.endAt,queryNormalizedOrderBy($),ee))}function queryCollectionGroup($){return $.collectionGroup||($.path.length%2==1?$.path.lastSegment():$.path.get($.path.length-2))}function newQueryComparator($){return(ee,et)=>{let er=!1;for(let en of queryNormalizedOrderBy($)){let $=compareDocs(en,ee,et);if(0!==$)return $;er=er||en.field.isKeyField()}return 0}}function compareDocs($,ee,et){let er=$.field.isKeyField()?DocumentKey.comparator(ee.key,et.key):compareDocumentsByField($.field,ee,et);switch($.dir){case"asc":return er;case"desc":return -1*er;default:return fail()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ObjectMap=class ObjectMap{constructor($,ee){this.mapKeyFn=$,this.equalsFn=ee,this.inner={},this.innerSize=0}get($){let ee=this.mapKeyFn($),et=this.inner[ee];if(void 0!==et){for(let[ee,er]of et)if(this.equalsFn(ee,$))return er}}has($){return void 0!==this.get($)}set($,ee){let et=this.mapKeyFn($),er=this.inner[et];if(void 0===er){this.inner[et]=[[$,ee]],this.innerSize++;return}for(let et=0;et<er.length;et++)if(this.equalsFn(er[et][0],$)){er[et]=[$,ee];return}er.push([$,ee]),this.innerSize++}delete($){let ee=this.mapKeyFn($),et=this.inner[ee];if(void 0===et)return!1;for(let er=0;er<et.length;er++)if(this.equalsFn(et[er][0],$))return 1===et.length?delete this.inner[ee]:et.splice(er,1),this.innerSize--,!0;return!1}forEach($){forEach(this.inner,(ee,et)=>{for(let[ee,er]of et)$(ee,er)})}isEmpty(){return isEmpty(this.inner)}size(){return this.innerSize}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ne=new SortedMap(DocumentKey.comparator);function mutableDocumentMap(){return ne}let nt=new SortedMap(DocumentKey.comparator);function documentMap(...$){let ee=nt;for(let et of $)ee=ee.insert(et.key,et);return ee}function newOverlayedDocumentMap(){return newDocumentKeyMap()}function convertOverlayedDocumentMapToDocumentMap($){let ee=nt;return $.forEach(($,et)=>ee=ee.insert($,et.overlayedDocument)),ee}function newOverlayMap(){return newDocumentKeyMap()}function newMutationMap(){return newDocumentKeyMap()}function newDocumentKeyMap(){return new ObjectMap($=>$.toString(),($,ee)=>$.isEqual(ee))}let nn=new SortedMap(DocumentKey.comparator);function documentVersionMap(){return nn}let ni=new SortedSet(DocumentKey.comparator);function documentKeySet(...$){let ee=ni;for(let et of $)ee=ee.add(et);return ee}let no=new SortedSet(primitiveComparator);function targetIdSet(){return no}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function toDouble($,ee){if($.useProto3Json){if(isNaN(ee))return{doubleValue:"NaN"};if(ee===1/0)return{doubleValue:"Infinity"};if(ee===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:isNegativeZero(ee)?"-0":ee}}function toInteger($){return{integerValue:""+$}}function toNumber($,ee){return isSafeInteger(ee)?toInteger(ee):toDouble($,ee)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let TransformOperation=class TransformOperation{constructor(){this._=void 0}};function applyTransformOperationToLocalView($,ee,et){return $ instanceof ServerTimestampTransform?serverTimestamp$1(et,ee):$ instanceof ArrayUnionTransformOperation?applyArrayUnionTransformOperation($,ee):$ instanceof ArrayRemoveTransformOperation?applyArrayRemoveTransformOperation($,ee):applyNumericIncrementTransformOperationToLocalView($,ee)}function applyTransformOperationToRemoteDocument($,ee,et){return $ instanceof ArrayUnionTransformOperation?applyArrayUnionTransformOperation($,ee):$ instanceof ArrayRemoveTransformOperation?applyArrayRemoveTransformOperation($,ee):et}function computeTransformOperationBaseValue($,ee){return $ instanceof NumericIncrementTransformOperation?isNumber(ee)?ee:{integerValue:0}:null}function transformOperationEquals($,ee){return $ instanceof ArrayUnionTransformOperation&&ee instanceof ArrayUnionTransformOperation||$ instanceof ArrayRemoveTransformOperation&&ee instanceof ArrayRemoveTransformOperation?arrayEquals($.elements,ee.elements,valueEquals):$ instanceof NumericIncrementTransformOperation&&ee instanceof NumericIncrementTransformOperation?valueEquals($.operand,ee.operand):$ instanceof ServerTimestampTransform&&ee instanceof ServerTimestampTransform}let ServerTimestampTransform=class ServerTimestampTransform extends TransformOperation{};let ArrayUnionTransformOperation=class ArrayUnionTransformOperation extends TransformOperation{constructor($){super(),this.elements=$}};function applyArrayUnionTransformOperation($,ee){let et=coercedFieldValuesArray(ee);for(let ee of $.elements)et.some($=>valueEquals($,ee))||et.push(ee);return{arrayValue:{values:et}}}let ArrayRemoveTransformOperation=class ArrayRemoveTransformOperation extends TransformOperation{constructor($){super(),this.elements=$}};function applyArrayRemoveTransformOperation($,ee){let et=coercedFieldValuesArray(ee);for(let ee of $.elements)et=et.filter($=>!valueEquals($,ee));return{arrayValue:{values:et}}}let NumericIncrementTransformOperation=class NumericIncrementTransformOperation extends TransformOperation{constructor($,ee){super(),this.serializer=$,this.operand=ee}};function applyNumericIncrementTransformOperationToLocalView($,ee){let et=computeTransformOperationBaseValue($,ee),er=asNumber(et)+asNumber($.operand);return isInteger(et)&&isInteger($.operand)?toInteger(er):toDouble($.serializer,er)}function asNumber($){return normalizeNumber($.integerValue||$.doubleValue)}function coercedFieldValuesArray($){return isArray($)&&$.arrayValue.values?$.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let FieldTransform=class FieldTransform{constructor($,ee){this.field=$,this.transform=ee}};function fieldTransformEquals($,ee){return $.field.isEqual(ee.field)&&transformOperationEquals($.transform,ee.transform)}function fieldTransformsAreEqual($,ee){return void 0===$&&void 0===ee||!!$&&!!ee&&arrayEquals($,ee,($,ee)=>fieldTransformEquals($,ee))}let MutationResult=class MutationResult{constructor($,ee){this.version=$,this.transformResults=ee}};let Precondition=class Precondition{constructor($,ee){this.updateTime=$,this.exists=ee}static none(){return new Precondition}static exists($){return new Precondition(void 0,$)}static updateTime($){return new Precondition($)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual($){return this.exists===$.exists&&(this.updateTime?!!$.updateTime&&this.updateTime.isEqual($.updateTime):!$.updateTime)}};function preconditionIsValidForDocument($,ee){return void 0!==$.updateTime?ee.isFoundDocument()&&ee.version.isEqual($.updateTime):void 0===$.exists||$.exists===ee.isFoundDocument()}let Mutation=class Mutation{};function calculateOverlayMutation($,ee){if(!$.hasLocalMutations||ee&&0===ee.fields.length)return null;if(null===ee)return $.isNoDocument()?new DeleteMutation($.key,Precondition.none()):new SetMutation($.key,$.data,Precondition.none());{let et=$.data,er=ObjectValue.empty(),en=new SortedSet(FieldPath$1.comparator);for(let $ of ee.fields)if(!en.has($)){let ee=et.field($);null===ee&&$.length>1&&($=$.popLast(),ee=et.field($)),null===ee?er.delete($):er.set($,ee),en=en.add($)}return new PatchMutation($.key,er,new FieldMask(en.toArray()),Precondition.none())}}function mutationApplyToRemoteDocument($,ee,et){$ instanceof SetMutation?setMutationApplyToRemoteDocument($,ee,et):$ instanceof PatchMutation?patchMutationApplyToRemoteDocument($,ee,et):deleteMutationApplyToRemoteDocument($,ee,et)}function mutationApplyToLocalView($,ee,et,er){return $ instanceof SetMutation?setMutationApplyToLocalView($,ee,et,er):$ instanceof PatchMutation?patchMutationApplyToLocalView($,ee,et,er):deleteMutationApplyToLocalView($,ee,et)}function mutationExtractBaseValue($,ee){let et=null;for(let er of $.fieldTransforms){let $=ee.data.field(er.field),en=computeTransformOperationBaseValue(er.transform,$||null);null!=en&&(null===et&&(et=ObjectValue.empty()),et.set(er.field,en))}return et||null}function mutationEquals($,ee){return!!($.type===ee.type&&$.key.isEqual(ee.key)&&$.precondition.isEqual(ee.precondition)&&fieldTransformsAreEqual($.fieldTransforms,ee.fieldTransforms))&&(0===$.type?$.value.isEqual(ee.value):1!==$.type||$.data.isEqual(ee.data)&&$.fieldMask.isEqual(ee.fieldMask))}let SetMutation=class SetMutation extends Mutation{constructor($,ee,et,er=[]){super(),this.key=$,this.value=ee,this.precondition=et,this.fieldTransforms=er,this.type=0}getFieldMask(){return null}};function setMutationApplyToRemoteDocument($,ee,et){let er=$.value.clone(),en=serverTransformResults($.fieldTransforms,ee,et.transformResults);er.setAll(en),ee.convertToFoundDocument(et.version,er).setHasCommittedMutations()}function setMutationApplyToLocalView($,ee,et,er){if(!preconditionIsValidForDocument($.precondition,ee))return et;let en=$.value.clone(),ei=localTransformResults($.fieldTransforms,er,ee);return en.setAll(ei),ee.convertToFoundDocument(ee.version,en).setHasLocalMutations(),null}let PatchMutation=class PatchMutation extends Mutation{constructor($,ee,et,er,en=[]){super(),this.key=$,this.data=ee,this.fieldMask=et,this.precondition=er,this.fieldTransforms=en,this.type=1}getFieldMask(){return this.fieldMask}};function patchMutationApplyToRemoteDocument($,ee,et){if(!preconditionIsValidForDocument($.precondition,ee)){ee.convertToUnknownDocument(et.version);return}let er=serverTransformResults($.fieldTransforms,ee,et.transformResults),en=ee.data;en.setAll(getPatch($)),en.setAll(er),ee.convertToFoundDocument(et.version,en).setHasCommittedMutations()}function patchMutationApplyToLocalView($,ee,et,er){if(!preconditionIsValidForDocument($.precondition,ee))return et;let en=localTransformResults($.fieldTransforms,er,ee),ei=ee.data;return(ei.setAll(getPatch($)),ei.setAll(en),ee.convertToFoundDocument(ee.version,ei).setHasLocalMutations(),null===et)?null:et.unionWith($.fieldMask.fields).unionWith($.fieldTransforms.map($=>$.field))}function getPatch($){let ee=new Map;return $.fieldMask.fields.forEach(et=>{if(!et.isEmpty()){let er=$.data.field(et);ee.set(et,er)}}),ee}function serverTransformResults($,ee,et){let er=new Map;hardAssert($.length===et.length);for(let en=0;en<et.length;en++){let ei=$[en],es=ei.transform,eo=ee.data.field(ei.field);er.set(ei.field,applyTransformOperationToRemoteDocument(es,eo,et[en]))}return er}function localTransformResults($,ee,et){let er=new Map;for(let en of $){let $=en.transform,ei=et.data.field(en.field);er.set(en.field,applyTransformOperationToLocalView($,ei,ee))}return er}let DeleteMutation=class DeleteMutation extends Mutation{constructor($,ee){super(),this.key=$,this.precondition=ee,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function deleteMutationApplyToRemoteDocument($,ee,et){ee.convertToNoDocument(et.version).setHasCommittedMutations()}function deleteMutationApplyToLocalView($,ee,et){return preconditionIsValidForDocument($.precondition,ee)?(ee.convertToNoDocument(ee.version).setHasLocalMutations(),null):et}let VerifyMutation=class VerifyMutation extends Mutation{constructor($,ee){super(),this.key=$,this.precondition=ee,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let MutationBatch=class MutationBatch{constructor($,ee,et,er){this.batchId=$,this.localWriteTime=ee,this.baseMutations=et,this.mutations=er}applyToRemoteDocument($,ee){let et=ee.mutationResults;for(let ee=0;ee<this.mutations.length;ee++){let er=this.mutations[ee];if(er.key.isEqual($.key)){let en=et[ee];mutationApplyToRemoteDocument(er,$,en)}}}applyToLocalView($,ee){for(let et of this.baseMutations)et.key.isEqual($.key)&&(ee=mutationApplyToLocalView(et,$,ee,this.localWriteTime));for(let et of this.mutations)et.key.isEqual($.key)&&(ee=mutationApplyToLocalView(et,$,ee,this.localWriteTime));return ee}applyToLocalDocumentSet($,ee){let et=newMutationMap();return this.mutations.forEach(er=>{let en=$.get(er.key),ei=en.overlayedDocument,es=this.applyToLocalView(ei,en.mutatedFields);es=ee.has(er.key)?null:es;let eo=calculateOverlayMutation(ei,es);null!==eo&&et.set(er.key,eo),ei.isValidDocument()||ei.convertToNoDocument(SnapshotVersion.min())}),et}keys(){return this.mutations.reduce(($,ee)=>$.add(ee.key),documentKeySet())}isEqual($){return this.batchId===$.batchId&&arrayEquals(this.mutations,$.mutations,($,ee)=>mutationEquals($,ee))&&arrayEquals(this.baseMutations,$.baseMutations,($,ee)=>mutationEquals($,ee))}};let MutationBatchResult=class MutationBatchResult{constructor($,ee,et,er){this.batch=$,this.commitVersion=ee,this.mutationResults=et,this.docVersions=er}static from($,ee,et){hardAssert($.mutations.length===et.length);let er=documentVersionMap(),en=$.mutations;for(let $=0;$<en.length;$++)er=er.insert(en[$].key,et[$].version);return new MutationBatchResult($,ee,et,er)}};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Overlay=class Overlay{constructor($,ee){this.largestBatchId=$,this.mutation=ee}getKey(){return this.mutation.key}isEqual($){return null!==$&&this.mutation===$.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ExistenceFilter=class ExistenceFilter{constructor($,ee){this.count=$,this.unchangedNames=ee}};function isPermanentError($){switch($){case t_.OK:return fail();case t_.CANCELLED:case t_.UNKNOWN:case t_.DEADLINE_EXCEEDED:case t_.RESOURCE_EXHAUSTED:case t_.INTERNAL:case t_.UNAVAILABLE:case t_.UNAUTHENTICATED:return!1;case t_.INVALID_ARGUMENT:case t_.NOT_FOUND:case t_.ALREADY_EXISTS:case t_.PERMISSION_DENIED:case t_.FAILED_PRECONDITION:case t_.ABORTED:case t_.OUT_OF_RANGE:case t_.UNIMPLEMENTED:case t_.DATA_LOSS:return!0;default:return fail()}}function isPermanentWriteError($){return isPermanentError($)&&$!==t_.ABORTED}function mapCodeFromRpcCode($){if(void 0===$)return logError("GRPC error has no .code"),t_.UNKNOWN;switch($){case es.OK:return t_.OK;case es.CANCELLED:return t_.CANCELLED;case es.UNKNOWN:return t_.UNKNOWN;case es.DEADLINE_EXCEEDED:return t_.DEADLINE_EXCEEDED;case es.RESOURCE_EXHAUSTED:return t_.RESOURCE_EXHAUSTED;case es.INTERNAL:return t_.INTERNAL;case es.UNAVAILABLE:return t_.UNAVAILABLE;case es.UNAUTHENTICATED:return t_.UNAUTHENTICATED;case es.INVALID_ARGUMENT:return t_.INVALID_ARGUMENT;case es.NOT_FOUND:return t_.NOT_FOUND;case es.ALREADY_EXISTS:return t_.ALREADY_EXISTS;case es.PERMISSION_DENIED:return t_.PERMISSION_DENIED;case es.FAILED_PRECONDITION:return t_.FAILED_PRECONDITION;case es.ABORTED:return t_.ABORTED;case es.OUT_OF_RANGE:return t_.OUT_OF_RANGE;case es.UNIMPLEMENTED:return t_.UNIMPLEMENTED;case es.DATA_LOSS:return t_.DATA_LOSS;default:return fail()}}!function($){$[$.OK=0]="OK",$[$.CANCELLED=1]="CANCELLED",$[$.UNKNOWN=2]="UNKNOWN",$[$.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",$[$.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",$[$.NOT_FOUND=5]="NOT_FOUND",$[$.ALREADY_EXISTS=6]="ALREADY_EXISTS",$[$.PERMISSION_DENIED=7]="PERMISSION_DENIED",$[$.UNAUTHENTICATED=16]="UNAUTHENTICATED",$[$.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",$[$.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",$[$.ABORTED=10]="ABORTED",$[$.OUT_OF_RANGE=11]="OUT_OF_RANGE",$[$.UNIMPLEMENTED=12]="UNIMPLEMENTED",$[$.INTERNAL=13]="INTERNAL",$[$.UNAVAILABLE=14]="UNAVAILABLE",$[$.DATA_LOSS=15]="DATA_LOSS"}(es||(es={}));/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Base64DecodeError=class Base64DecodeError extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nu=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function newTextEncoder(){return new ef.TextEncoder}function newTextDecoder(){return new TextDecoder("utf-8")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nh=new tS([4294967295,4294967295],0);function getMd5HashValue($){let ee=newTextEncoder().encode($),et=new tv;return et.update(ee),new Uint8Array(et.digest())}function get64BitUints($){let ee=new DataView($.buffer),et=ee.getUint32(0,!0),er=ee.getUint32(4,!0),en=ee.getUint32(8,!0),ei=ee.getUint32(12,!0),es=new tS([et,er],0),eo=new tS([en,ei],0);return[es,eo]}let BloomFilter=class BloomFilter{constructor($,ee,et){if(this.bitmap=$,this.padding=ee,this.hashCount=et,ee<0||ee>=8)throw new BloomFilterError(`Invalid padding: ${ee}`);if(et<0||$.length>0&&0===this.hashCount)throw new BloomFilterError(`Invalid hash count: ${et}`);if(0===$.length&&0!==ee)throw new BloomFilterError(`Invalid padding when bitmap length is 0: ${ee}`);this.bitCount=8*$.length-ee,this.bitCountInInteger=tS.fromNumber(this.bitCount)}getBitIndex($,ee,et){let er=$.add(ee.multiply(tS.fromNumber(et)));return 1===er.compare(nh)&&(er=new tS([er.getBits(0),er.getBits(1)],0)),er.modulo(this.bitCountInInteger).toNumber()}isBitSet($){let ee=this.bitmap[Math.floor($/8)],et=$%8;return(ee&1<<et)!=0}mightContain($){if(0===this.bitCount)return!1;let ee=getMd5HashValue($),[et,er]=get64BitUints(ee);for(let $=0;$<this.hashCount;$++){let ee=this.getBitIndex(et,er,$);if(!this.isBitSet(ee))return!1}return!0}static create($,ee,et){let er=$%8==0?0:8-$%8,en=new Uint8Array(Math.ceil($/8)),ei=new BloomFilter(en,er,ee);return et.forEach($=>ei.insert($)),ei}insert($){if(0===this.bitCount)return;let ee=getMd5HashValue($),[et,er]=get64BitUints(ee);for(let $=0;$<this.hashCount;$++){let ee=this.getBitIndex(et,er,$);this.setBit(ee)}}setBit($){let ee=Math.floor($/8),et=$%8;this.bitmap[ee]|=1<<et}};let BloomFilterError=class BloomFilterError extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let RemoteEvent=class RemoteEvent{constructor($,ee,et,er,en){this.snapshotVersion=$,this.targetChanges=ee,this.targetMismatches=et,this.documentUpdates=er,this.resolvedLimboDocuments=en}static createSynthesizedRemoteEventForCurrentChange($,ee,et){let er=new Map;return er.set($,TargetChange.createSynthesizedTargetChangeForCurrentChange($,ee,et)),new RemoteEvent(SnapshotVersion.min(),er,new SortedMap(primitiveComparator),mutableDocumentMap(),documentKeySet())}};let TargetChange=class TargetChange{constructor($,ee,et,er,en){this.resumeToken=$,this.current=ee,this.addedDocuments=et,this.modifiedDocuments=er,this.removedDocuments=en}static createSynthesizedTargetChangeForCurrentChange($,ee,et){return new TargetChange(et,ee,documentKeySet(),documentKeySet(),documentKeySet())}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let DocumentWatchChange=class DocumentWatchChange{constructor($,ee,et,er){this.updatedTargetIds=$,this.removedTargetIds=ee,this.key=et,this.newDoc=er}};let ExistenceFilterChange=class ExistenceFilterChange{constructor($,ee){this.targetId=$,this.existenceFilter=ee}};let WatchTargetChange=class WatchTargetChange{constructor($,ee,et=ByteString.EMPTY_BYTE_STRING,er=null){this.state=$,this.targetIds=ee,this.resumeToken=et,this.cause=er}};let TargetState=class TargetState{constructor(){this.pendingResponses=0,this.documentChanges=snapshotChangesMap(),this._resumeToken=ByteString.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken($){$.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=$)}toTargetChange(){let $=documentKeySet(),ee=documentKeySet(),et=documentKeySet();return this.documentChanges.forEach((er,en)=>{switch(en){case 0:$=$.add(er);break;case 2:ee=ee.add(er);break;case 1:et=et.add(er);break;default:fail()}}),new TargetChange(this._resumeToken,this._current,$,ee,et)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=snapshotChangesMap()}addDocumentChange($,ee){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert($,ee)}removeDocumentChange($){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove($)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1}markCurrent(){this._hasPendingChanges=!0,this._current=!0}};let np="WatchChangeAggregator";let WatchChangeAggregator=class WatchChangeAggregator{constructor($){this.metadataProvider=$,this.targetStates=new Map,this.pendingDocumentUpdates=mutableDocumentMap(),this.pendingDocumentTargetMapping=documentTargetMap(),this.pendingTargetResets=new SortedMap(primitiveComparator)}handleDocumentChange($){for(let ee of $.updatedTargetIds)$.newDoc&&$.newDoc.isFoundDocument()?this.addDocumentToTarget(ee,$.newDoc):this.removeDocumentFromTarget(ee,$.key,$.newDoc);for(let ee of $.removedTargetIds)this.removeDocumentFromTarget(ee,$.key,$.newDoc)}handleTargetChange($){this.forEachTarget($,ee=>{let et=this.ensureTargetState(ee);switch($.state){case 0:this.isActiveTarget(ee)&&et.updateResumeToken($.resumeToken);break;case 1:et.recordTargetResponse(),et.isPending||et.clearPendingChanges(),et.updateResumeToken($.resumeToken);break;case 2:et.recordTargetResponse(),et.isPending||this.removeTarget(ee);break;case 3:this.isActiveTarget(ee)&&(et.markCurrent(),et.updateResumeToken($.resumeToken));break;case 4:this.isActiveTarget(ee)&&(this.resetTarget(ee),et.updateResumeToken($.resumeToken));break;default:fail()}})}forEachTarget($,ee){$.targetIds.length>0?$.targetIds.forEach(ee):this.targetStates.forEach(($,et)=>{this.isActiveTarget(et)&&ee(et)})}handleExistenceFilter($){let ee=$.targetId,et=$.existenceFilter.count,er=this.targetDataForActiveTarget(ee);if(er){let en=er.target;if(targetIsDocumentTarget(en)){if(0===et){let $=new DocumentKey(en.path);this.removeDocumentFromTarget(ee,$,MutableDocument.newNoDocument($,SnapshotVersion.min()))}else hardAssert(1===et)}else{let er=this.getCurrentDocumentCountForTarget(ee);if(er!==et){let et=this.parseBloomFilter($),en=et?this.applyBloomFilter(et,$,er):1;if(0!==en){this.resetTarget(ee);let $=2===en?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(ee,$)}null==nu||nu.notifyOnExistenceFilterMismatch(createExistenceFilterMismatchInfoForTestingHooks(er,$.existenceFilter,this.metadataProvider.getDatabaseId(),et,en))}}}}parseBloomFilter($){let ee,et;let er=$.existenceFilter.unchangedNames;if(!er||!er.bits)return null;let{bits:{bitmap:en="",padding:ei=0},hashCount:es=0}=er;try{ee=normalizeByteString(en).toUint8Array()}catch($){if($ instanceof Base64DecodeError)return logWarn("Decoding the base64 bloom filter in existence filter failed ("+$.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw $}try{et=new BloomFilter(ee,ei,es)}catch($){return $ instanceof BloomFilterError?logWarn("BloomFilter error: ",$):logWarn("Applying bloom filter failed: ",$),null}return 0===et.bitCount?null:et}applyBloomFilter($,ee,et){let er=ee.existenceFilter.count,en=this.filterRemovedDocuments($,ee.targetId);return er===et-en?0:2}filterRemovedDocuments($,ee){let et=this.metadataProvider.getRemoteKeysForTarget(ee),er=0;return et.forEach(et=>{let en=this.metadataProvider.getDatabaseId(),ei=`projects/${en.projectId}/databases/${en.database}/documents/${et.path.canonicalString()}`;!$.mightContain(ei)&&(this.removeDocumentFromTarget(ee,et,null),er++)}),er}createRemoteEvent($){let ee=new Map;this.targetStates.forEach((et,er)=>{let en=this.targetDataForActiveTarget(er);if(en){if(et.current&&targetIsDocumentTarget(en.target)){let ee=new DocumentKey(en.target.path);null!==this.pendingDocumentUpdates.get(ee)||this.targetContainsDocument(er,ee)||this.removeDocumentFromTarget(er,ee,MutableDocument.newNoDocument(ee,$))}et.hasPendingChanges&&(ee.set(er,et.toTargetChange()),et.clearPendingChanges())}});let et=documentKeySet();this.pendingDocumentTargetMapping.forEach(($,ee)=>{let er=!0;ee.forEachWhile($=>{let ee=this.targetDataForActiveTarget($);return!ee||"TargetPurposeLimboResolution"===ee.purpose||(er=!1,!1)}),er&&(et=et.add($))}),this.pendingDocumentUpdates.forEach((ee,et)=>et.setReadTime($));let er=new RemoteEvent($,ee,this.pendingTargetResets,this.pendingDocumentUpdates,et);return this.pendingDocumentUpdates=mutableDocumentMap(),this.pendingDocumentTargetMapping=documentTargetMap(),this.pendingTargetResets=new SortedMap(primitiveComparator),er}addDocumentToTarget($,ee){if(!this.isActiveTarget($))return;let et=this.targetContainsDocument($,ee.key)?2:0,er=this.ensureTargetState($);er.addDocumentChange(ee.key,et),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(ee.key,ee),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(ee.key,this.ensureDocumentTargetMapping(ee.key).add($))}removeDocumentFromTarget($,ee,et){if(!this.isActiveTarget($))return;let er=this.ensureTargetState($);this.targetContainsDocument($,ee)?er.addDocumentChange(ee,1):er.removeDocumentChange(ee),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(ee,this.ensureDocumentTargetMapping(ee).delete($)),et&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(ee,et))}removeTarget($){this.targetStates.delete($)}getCurrentDocumentCountForTarget($){let ee=this.ensureTargetState($),et=ee.toTargetChange();return this.metadataProvider.getRemoteKeysForTarget($).size+et.addedDocuments.size-et.removedDocuments.size}recordPendingTargetRequest($){let ee=this.ensureTargetState($);ee.recordPendingTargetRequest()}ensureTargetState($){let ee=this.targetStates.get($);return ee||(ee=new TargetState,this.targetStates.set($,ee)),ee}ensureDocumentTargetMapping($){let ee=this.pendingDocumentTargetMapping.get($);return ee||(ee=new SortedSet(primitiveComparator),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert($,ee)),ee}isActiveTarget($){let ee=null!==this.targetDataForActiveTarget($);return ee||logDebug(np,"Detected inactive target",$),ee}targetDataForActiveTarget($){let ee=this.targetStates.get($);return ee&&ee.isPending?null:this.metadataProvider.getTargetDataForTarget($)}resetTarget($){this.targetStates.set($,new TargetState);let ee=this.metadataProvider.getRemoteKeysForTarget($);ee.forEach(ee=>{this.removeDocumentFromTarget($,ee,null)})}targetContainsDocument($,ee){let et=this.metadataProvider.getRemoteKeysForTarget($);return et.has(ee)}};function documentTargetMap(){return new SortedMap(DocumentKey.comparator)}function snapshotChangesMap(){return new SortedMap(DocumentKey.comparator)}function createExistenceFilterMismatchInfoForTestingHooks($,ee,et,er,en){var ei,es,eo,eu,eh,ep;let ef={localCacheCount:$,existenceFilterCount:ee.count,databaseId:et.database,projectId:et.projectId},em=ee.unchangedNames;return em&&(ef.bloomFilter={applied:0===en,hashCount:null!==(ei=null==em?void 0:em.hashCount)&&void 0!==ei?ei:0,bitmapLength:null!==(eu=null===(eo=null===(es=null==em?void 0:em.bits)||void 0===es?void 0:es.bitmap)||void 0===eo?void 0:eo.length)&&void 0!==eu?eu:0,padding:null!==(ep=null===(eh=null==em?void 0:em.bits)||void 0===eh?void 0:eh.padding)&&void 0!==ep?ep:0,mightContain:$=>{var ee;return null!==(ee=null==er?void 0:er.mightContain($))&&void 0!==ee&&ee}}),ef}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nf=(()=>{let $={};return $.asc="ASCENDING",$.desc="DESCENDING",$})(),nm=(()=>{let $={};return $["<"]="LESS_THAN",$["<="]="LESS_THAN_OR_EQUAL",$[">"]="GREATER_THAN",$[">="]="GREATER_THAN_OR_EQUAL",$["=="]="EQUAL",$["!="]="NOT_EQUAL",$["array-contains"]="ARRAY_CONTAINS",$.in="IN",$["not-in"]="NOT_IN",$["array-contains-any"]="ARRAY_CONTAINS_ANY",$})(),ng=(()=>{let $={};return $.and="AND",$.or="OR",$})();let JsonProtoSerializer=class JsonProtoSerializer{constructor($,ee){this.databaseId=$,this.useProto3Json=ee}};function fromRpcStatus($){let ee=void 0===$.code?t_.UNKNOWN:mapCodeFromRpcCode($.code);return new FirestoreError(ee,$.message||"")}function toInt32Proto($,ee){return $.useProto3Json||isNullOrUndefined(ee)?ee:{value:ee}}function fromInt32Proto($){let ee;return isNullOrUndefined(ee="object"==typeof $?$.value:$)?null:ee}function toTimestamp($,ee){if(!$.useProto3Json)return{seconds:""+ee.seconds,nanos:ee.nanoseconds};{let $=new Date(1e3*ee.seconds).toISOString(),et=$.replace(/\.\d*/,"").replace("Z",""),er=("000000000"+ee.nanoseconds).slice(-9);return`${et}.${er}Z`}}function fromTimestamp($){let ee=normalizeTimestamp($);return new Timestamp(ee.seconds,ee.nanos)}function toBytes($,ee){return $.useProto3Json?ee.toBase64():ee.toUint8Array()}function fromBytes($,ee){return $.useProto3Json?(hardAssert(void 0===ee||"string"==typeof ee),ByteString.fromBase64String(ee||"")):(hardAssert(void 0===ee||ee instanceof Uint8Array),ByteString.fromUint8Array(ee||new Uint8Array))}function toVersion($,ee){return toTimestamp($,ee.toTimestamp())}function fromVersion($){return hardAssert(!!$),SnapshotVersion.fromTimestamp(fromTimestamp($))}function toResourceName($,ee){return fullyQualifiedPrefixPath($).child("documents").child(ee).canonicalString()}function fromResourceName($){let ee=ResourcePath.fromString($);return hardAssert(isValidResourceName(ee)),ee}function toName($,ee){return toResourceName($.databaseId,ee.path)}function fromName($,ee){let et=fromResourceName(ee);if(et.get(1)!==$.databaseId.projectId)throw new FirestoreError(t_.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+et.get(1)+" vs "+$.databaseId.projectId);if(et.get(3)!==$.databaseId.database)throw new FirestoreError(t_.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+et.get(3)+" vs "+$.databaseId.database);return new DocumentKey(extractLocalPathFromResourceName(et))}function toQueryPath($,ee){return toResourceName($.databaseId,ee)}function fromQueryPath($){let ee=fromResourceName($);return 4===ee.length?ResourcePath.emptyPath():extractLocalPathFromResourceName(ee)}function getEncodedDatabaseId($){let ee=new ResourcePath(["projects",$.databaseId.projectId,"databases",$.databaseId.database]);return ee.canonicalString()}function fullyQualifiedPrefixPath($){return new ResourcePath(["projects",$.projectId,"databases",$.database])}function extractLocalPathFromResourceName($){return hardAssert($.length>4&&"documents"===$.get(4)),$.popFirst(5)}function toMutationDocument($,ee,et){return{name:toName($,ee),fields:et.value.mapValue.fields}}function toDocument($,ee){return{name:toName($,ee.key),fields:ee.data.value.mapValue.fields,updateTime:toTimestamp($,ee.version.toTimestamp()),createTime:toTimestamp($,ee.createTime.toTimestamp())}}function fromDocument($,ee,et){let er=fromName($,ee.name),en=fromVersion(ee.updateTime),ei=ee.createTime?fromVersion(ee.createTime):SnapshotVersion.min(),es=new ObjectValue({mapValue:{fields:ee.fields}}),eo=MutableDocument.newFoundDocument(er,en,ei,es);return et&&eo.setHasCommittedMutations(),et?eo.setHasCommittedMutations():eo}function fromFound($,ee){hardAssert(!!ee.found),ee.found.name,ee.found.updateTime;let et=fromName($,ee.found.name),er=fromVersion(ee.found.updateTime),en=ee.found.createTime?fromVersion(ee.found.createTime):SnapshotVersion.min(),ei=new ObjectValue({mapValue:{fields:ee.found.fields}});return MutableDocument.newFoundDocument(et,er,en,ei)}function fromMissing($,ee){hardAssert(!!ee.missing),hardAssert(!!ee.readTime);let et=fromName($,ee.missing),er=fromVersion(ee.readTime);return MutableDocument.newNoDocument(et,er)}function fromBatchGetDocumentsResponse($,ee){return"found"in ee?fromFound($,ee):"missing"in ee?fromMissing($,ee):fail()}function fromWatchChange($,ee){let et;if("targetChange"in ee){ee.targetChange;let er=fromWatchTargetChangeState(ee.targetChange.targetChangeType||"NO_CHANGE"),en=ee.targetChange.targetIds||[],ei=fromBytes($,ee.targetChange.resumeToken),es=ee.targetChange.cause,eo=es&&fromRpcStatus(es);et=new WatchTargetChange(er,en,ei,eo||null)}else if("documentChange"in ee){ee.documentChange;let er=ee.documentChange;er.document,er.document.name,er.document.updateTime;let en=fromName($,er.document.name),ei=fromVersion(er.document.updateTime),es=er.document.createTime?fromVersion(er.document.createTime):SnapshotVersion.min(),eo=new ObjectValue({mapValue:{fields:er.document.fields}}),eu=MutableDocument.newFoundDocument(en,ei,es,eo),eh=er.targetIds||[],ep=er.removedTargetIds||[];et=new DocumentWatchChange(eh,ep,eu.key,eu)}else if("documentDelete"in ee){ee.documentDelete;let er=ee.documentDelete;er.document;let en=fromName($,er.document),ei=er.readTime?fromVersion(er.readTime):SnapshotVersion.min(),es=MutableDocument.newNoDocument(en,ei),eo=er.removedTargetIds||[];et=new DocumentWatchChange([],eo,es.key,es)}else if("documentRemove"in ee){ee.documentRemove;let er=ee.documentRemove;er.document;let en=fromName($,er.document),ei=er.removedTargetIds||[];et=new DocumentWatchChange([],ei,en,null)}else{if(!("filter"in ee))return fail();ee.filter;let $=ee.filter;$.targetId;let{count:er=0,unchangedNames:en}=$,ei=new ExistenceFilter(er,en),es=$.targetId;et=new ExistenceFilterChange(es,ei)}return et}function fromWatchTargetChangeState($){return"NO_CHANGE"===$?0:"ADD"===$?1:"REMOVE"===$?2:"CURRENT"===$?3:"RESET"===$?4:fail()}function versionFromListenResponse($){if(!("targetChange"in $))return SnapshotVersion.min();let ee=$.targetChange;return ee.targetIds&&ee.targetIds.length||!ee.readTime?SnapshotVersion.min():fromVersion(ee.readTime)}function toMutation($,ee){let et;if(ee instanceof SetMutation)et={update:toMutationDocument($,ee.key,ee.value)};else if(ee instanceof DeleteMutation)et={delete:toName($,ee.key)};else if(ee instanceof PatchMutation)et={update:toMutationDocument($,ee.key,ee.data),updateMask:toDocumentMask(ee.fieldMask)};else{if(!(ee instanceof VerifyMutation))return fail();et={verify:toName($,ee.key)}}return ee.fieldTransforms.length>0&&(et.updateTransforms=ee.fieldTransforms.map(ee=>toFieldTransform($,ee))),ee.precondition.isNone||(et.currentDocument=toPrecondition($,ee.precondition)),et}function fromMutation($,ee){let et=ee.currentDocument?fromPrecondition(ee.currentDocument):Precondition.none(),er=ee.updateTransforms?ee.updateTransforms.map(ee=>fromFieldTransform($,ee)):[];if(ee.update){ee.update.name;let en=fromName($,ee.update.name),ei=new ObjectValue({mapValue:{fields:ee.update.fields}});if(!ee.updateMask)return new SetMutation(en,ei,et,er);{let $=fromDocumentMask(ee.updateMask);return new PatchMutation(en,ei,$,et,er)}}if(ee.delete){let er=fromName($,ee.delete);return new DeleteMutation(er,et)}if(!ee.verify)return fail();{let er=fromName($,ee.verify);return new VerifyMutation(er,et)}}function toPrecondition($,ee){return void 0!==ee.updateTime?{updateTime:toVersion($,ee.updateTime)}:void 0!==ee.exists?{exists:ee.exists}:fail()}function fromPrecondition($){return void 0!==$.updateTime?Precondition.updateTime(fromVersion($.updateTime)):void 0!==$.exists?Precondition.exists($.exists):Precondition.none()}function fromWriteResult($,ee){let et=$.updateTime?fromVersion($.updateTime):fromVersion(ee);return et.isEqual(SnapshotVersion.min())&&(et=fromVersion(ee)),new MutationResult(et,$.transformResults||[])}function fromWriteResults($,ee){return $&&$.length>0?(hardAssert(void 0!==ee),$.map($=>fromWriteResult($,ee))):[]}function toFieldTransform($,ee){let et=ee.transform;if(et instanceof ServerTimestampTransform)return{fieldPath:ee.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(et instanceof ArrayUnionTransformOperation)return{fieldPath:ee.field.canonicalString(),appendMissingElements:{values:et.elements}};if(et instanceof ArrayRemoveTransformOperation)return{fieldPath:ee.field.canonicalString(),removeAllFromArray:{values:et.elements}};if(et instanceof NumericIncrementTransformOperation)return{fieldPath:ee.field.canonicalString(),increment:et.operand};throw fail()}function fromFieldTransform($,ee){let et=null;if("setToServerValue"in ee)hardAssert("REQUEST_TIME"===ee.setToServerValue),et=new ServerTimestampTransform;else if("appendMissingElements"in ee){let $=ee.appendMissingElements.values||[];et=new ArrayUnionTransformOperation($)}else if("removeAllFromArray"in ee){let $=ee.removeAllFromArray.values||[];et=new ArrayRemoveTransformOperation($)}else"increment"in ee?et=new NumericIncrementTransformOperation($,ee.increment):fail();let er=FieldPath$1.fromServerFormat(ee.fieldPath);return new FieldTransform(er,et)}function toDocumentsTarget($,ee){return{documents:[toQueryPath($,ee.path)]}}function fromDocumentsTarget($){let ee=$.documents.length;hardAssert(1===ee);let et=$.documents[0];return queryToTarget(newQueryForPath(fromQueryPath(et)))}function toQueryTarget($,ee){let et={structuredQuery:{}},er=ee.path;null!==ee.collectionGroup?(et.parent=toQueryPath($,er),et.structuredQuery.from=[{collectionId:ee.collectionGroup,allDescendants:!0}]):(et.parent=toQueryPath($,er.popLast()),et.structuredQuery.from=[{collectionId:er.lastSegment()}]);let en=toFilters(ee.filters);en&&(et.structuredQuery.where=en);let ei=toOrder(ee.orderBy);ei&&(et.structuredQuery.orderBy=ei);let es=toInt32Proto($,ee.limit);return null!==es&&(et.structuredQuery.limit=es),ee.startAt&&(et.structuredQuery.startAt=toStartAtCursor(ee.startAt)),ee.endAt&&(et.structuredQuery.endAt=toEndAtCursor(ee.endAt)),et}function toRunAggregationQueryRequest($,ee,et){let er=toQueryTarget($,ee),en={},ei=[],es=0;return et.forEach($=>{let ee=`aggregate_${es++}`;en[ee]=$.alias,"count"===$.aggregateType?ei.push({alias:ee,count:{}}):"avg"===$.aggregateType?ei.push({alias:ee,avg:{field:toFieldPathReference($.fieldPath)}}):"sum"===$.aggregateType&&ei.push({alias:ee,sum:{field:toFieldPathReference($.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:ei,structuredQuery:er.structuredQuery},parent:er.parent},aliasMap:en}}function convertQueryTargetToQuery($){let ee=fromQueryPath($.parent),et=$.structuredQuery,er=et.from?et.from.length:0,en=null;if(er>0){hardAssert(1===er);let $=et.from[0];$.allDescendants?en=$.collectionId:ee=ee.child($.collectionId)}let ei=[];et.where&&(ei=fromFilters(et.where));let es=[];et.orderBy&&(es=fromOrder(et.orderBy));let eo=null;et.limit&&(eo=fromInt32Proto(et.limit));let eu=null;et.startAt&&(eu=fromStartAtCursor(et.startAt));let eh=null;return et.endAt&&(eh=fromEndAtCursor(et.endAt)),newQuery(ee,en,es,ei,eo,"F",eu,eh)}function fromQueryTarget($){return queryToTarget(convertQueryTargetToQuery($))}function toListenRequestLabels($,ee){let et=toLabel(ee.purpose);return null==et?null:{"goog-listen-tags":et}}function toLabel($){switch($){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return fail()}}function toTarget($,ee){let et;let er=ee.target;if((et=targetIsDocumentTarget(er)?{documents:toDocumentsTarget($,er)}:{query:toQueryTarget($,er)}).targetId=ee.targetId,ee.resumeToken.approximateByteSize()>0){et.resumeToken=toBytes($,ee.resumeToken);let er=toInt32Proto($,ee.expectedCount);null!==er&&(et.expectedCount=er)}else if(ee.snapshotVersion.compareTo(SnapshotVersion.min())>0){et.readTime=toTimestamp($,ee.snapshotVersion.toTimestamp());let er=toInt32Proto($,ee.expectedCount);null!==er&&(et.expectedCount=er)}return et}function toFilters($){if(0!==$.length)return toFilter(CompositeFilter.create($,"and"))}function fromFilters($){let ee=fromFilter($);return ee instanceof CompositeFilter&&compositeFilterIsFlatConjunction(ee)?ee.getFilters():[ee]}function fromFilter($){return void 0!==$.unaryFilter?fromUnaryFilter($):void 0!==$.fieldFilter?fromFieldFilter($):void 0!==$.compositeFilter?fromCompositeFilter($):fail()}function toOrder($){if(0!==$.length)return $.map($=>toPropertyOrder($))}function fromOrder($){return $.map($=>fromPropertyOrder($))}function toStartAtCursor($){return{before:$.inclusive,values:$.position}}function toEndAtCursor($){return{before:!$.inclusive,values:$.position}}function fromStartAtCursor($){let ee=!!$.before,et=$.values||[];return new Bound(et,ee)}function fromEndAtCursor($){let ee=!$.before,et=$.values||[];return new Bound(et,ee)}function toDirection($){return nf[$]}function fromDirection($){switch($){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function toOperatorName($){return nm[$]}function toCompositeOperatorName($){return ng[$]}function fromOperatorName($){switch($){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return fail()}}function fromCompositeOperatorName($){switch($){case"AND":return"and";case"OR":return"or";default:return fail()}}function toFieldPathReference($){return{fieldPath:$.canonicalString()}}function fromFieldPathReference($){return FieldPath$1.fromServerFormat($.fieldPath)}function toPropertyOrder($){return{field:toFieldPathReference($.field),direction:toDirection($.dir)}}function fromPropertyOrder($){return new OrderBy(fromFieldPathReference($.field),fromDirection($.direction))}function toFilter($){return $ instanceof FieldFilter?toUnaryOrFieldFilter($):$ instanceof CompositeFilter?toCompositeFilter($):fail()}function toCompositeFilter($){let ee=$.getFilters().map($=>toFilter($));return 1===ee.length?ee[0]:{compositeFilter:{op:toCompositeOperatorName($.op),filters:ee}}}function toUnaryOrFieldFilter($){if("=="===$.op){if(isNanValue($.value))return{unaryFilter:{field:toFieldPathReference($.field),op:"IS_NAN"}};if(isNullValue($.value))return{unaryFilter:{field:toFieldPathReference($.field),op:"IS_NULL"}}}else if("!="===$.op){if(isNanValue($.value))return{unaryFilter:{field:toFieldPathReference($.field),op:"IS_NOT_NAN"}};if(isNullValue($.value))return{unaryFilter:{field:toFieldPathReference($.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:toFieldPathReference($.field),op:toOperatorName($.op),value:$.value}}}function fromUnaryFilter($){switch($.unaryFilter.op){case"IS_NAN":let ee=fromFieldPathReference($.unaryFilter.field);return FieldFilter.create(ee,"==",{doubleValue:NaN});case"IS_NULL":let et=fromFieldPathReference($.unaryFilter.field);return FieldFilter.create(et,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let er=fromFieldPathReference($.unaryFilter.field);return FieldFilter.create(er,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let en=fromFieldPathReference($.unaryFilter.field);return FieldFilter.create(en,"!=",{nullValue:"NULL_VALUE"});default:return fail()}}function fromFieldFilter($){return FieldFilter.create(fromFieldPathReference($.fieldFilter.field),fromOperatorName($.fieldFilter.op),$.fieldFilter.value)}function fromCompositeFilter($){return CompositeFilter.create($.compositeFilter.filters.map($=>fromFilter($)),fromCompositeOperatorName($.compositeFilter.op))}function toDocumentMask($){let ee=[];return $.fields.forEach($=>ee.push($.canonicalString())),{fieldPaths:ee}}function fromDocumentMask($){let ee=$.fieldPaths||[];return new FieldMask(ee.map($=>FieldPath$1.fromServerFormat($)))}function isValidResourceName($){return $.length>=4&&"projects"===$.get(0)&&"databases"===$.get(2)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let TargetData=class TargetData{constructor($,ee,et,er,en=SnapshotVersion.min(),ei=SnapshotVersion.min(),es=ByteString.EMPTY_BYTE_STRING,eo=null){this.target=$,this.targetId=ee,this.purpose=et,this.sequenceNumber=er,this.snapshotVersion=en,this.lastLimboFreeSnapshotVersion=ei,this.resumeToken=es,this.expectedCount=eo}withSequenceNumber($){return new TargetData(this.target,this.targetId,this.purpose,$,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken($,ee){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,ee,this.lastLimboFreeSnapshotVersion,$,null)}withExpectedCount($){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,$)}withLastLimboFreeSnapshotVersion($){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,$,this.resumeToken,this.expectedCount)}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let LocalSerializer=class LocalSerializer{constructor($){this.remoteSerializer=$}};function fromDbRemoteDocument($,ee){let et;if(ee.document)et=fromDocument($.remoteSerializer,ee.document,!!ee.hasCommittedMutations);else if(ee.noDocument){let $=DocumentKey.fromSegments(ee.noDocument.path),er=fromDbTimestamp(ee.noDocument.readTime);et=MutableDocument.newNoDocument($,er),ee.hasCommittedMutations&&et.setHasCommittedMutations()}else{if(!ee.unknownDocument)return fail();let $=DocumentKey.fromSegments(ee.unknownDocument.path),er=fromDbTimestamp(ee.unknownDocument.version);et=MutableDocument.newUnknownDocument($,er)}return ee.readTime&&et.setReadTime(fromDbTimestampKey(ee.readTime)),et}function toDbRemoteDocument($,ee){let et=ee.key,er={prefixPath:et.getCollectionPath().popLast().toArray(),collectionGroup:et.collectionGroup,documentId:et.path.lastSegment(),readTime:toDbTimestampKey(ee.readTime),hasCommittedMutations:ee.hasCommittedMutations};if(ee.isFoundDocument())er.document=toDocument($.remoteSerializer,ee);else if(ee.isNoDocument())er.noDocument={path:et.path.toArray(),readTime:toDbTimestamp(ee.version)};else{if(!ee.isUnknownDocument())return fail();er.unknownDocument={path:et.path.toArray(),version:toDbTimestamp(ee.version)}}return er}function toDbTimestampKey($){let ee=$.toTimestamp();return[ee.seconds,ee.nanoseconds]}function fromDbTimestampKey($){let ee=new Timestamp($[0],$[1]);return SnapshotVersion.fromTimestamp(ee)}function toDbTimestamp($){let ee=$.toTimestamp();return{seconds:ee.seconds,nanoseconds:ee.nanoseconds}}function fromDbTimestamp($){let ee=new Timestamp($.seconds,$.nanoseconds);return SnapshotVersion.fromTimestamp(ee)}function toDbMutationBatch($,ee,et){let er=et.baseMutations.map(ee=>toMutation($.remoteSerializer,ee)),en=et.mutations.map(ee=>toMutation($.remoteSerializer,ee));return{userId:ee,batchId:et.batchId,localWriteTimeMs:et.localWriteTime.toMillis(),baseMutations:er,mutations:en}}function fromDbMutationBatch($,ee){let et=(ee.baseMutations||[]).map(ee=>fromMutation($.remoteSerializer,ee));for(let $=0;$<ee.mutations.length-1;++$){let et=ee.mutations[$],er=$+1<ee.mutations.length&&void 0!==ee.mutations[$+1].transform;if(er){let er=ee.mutations[$+1];et.updateTransforms=er.transform.fieldTransforms,ee.mutations.splice($+1,1),++$}}let er=ee.mutations.map(ee=>fromMutation($.remoteSerializer,ee)),en=Timestamp.fromMillis(ee.localWriteTimeMs);return new MutationBatch(ee.batchId,en,et,er)}function fromDbTarget($){let ee;let et=fromDbTimestamp($.readTime),er=void 0!==$.lastLimboFreeSnapshotVersion?fromDbTimestamp($.lastLimboFreeSnapshotVersion):SnapshotVersion.min();return ee=isDocumentQuery($.query)?fromDocumentsTarget($.query):fromQueryTarget($.query),new TargetData(ee,$.targetId,"TargetPurposeListen",$.lastListenSequenceNumber,et,er,ByteString.fromBase64String($.resumeToken))}function toDbTarget($,ee){let et;let er=toDbTimestamp(ee.snapshotVersion),en=toDbTimestamp(ee.lastLimboFreeSnapshotVersion);et=targetIsDocumentTarget(ee.target)?toDocumentsTarget($.remoteSerializer,ee.target):toQueryTarget($.remoteSerializer,ee.target);let ei=ee.resumeToken.toBase64();return{targetId:ee.targetId,canonicalId:canonifyTarget(ee.target),readTime:er,resumeToken:ei,lastListenSequenceNumber:ee.sequenceNumber,lastLimboFreeSnapshotVersion:en,query:et}}function isDocumentQuery($){return void 0!==$.documents}function fromDbBundle($){return{id:$.bundleId,createTime:fromDbTimestamp($.createTime),version:$.version}}function toDbBundle($){return{bundleId:$.id,createTime:toDbTimestamp(fromVersion($.createTime)),version:$.version}}function fromDbNamedQuery($){return{name:$.name,query:fromBundledQuery($.bundledQuery),readTime:fromDbTimestamp($.readTime)}}function toDbNamedQuery($){return{name:$.name,readTime:toDbTimestamp(fromVersion($.readTime)),bundledQuery:$.bundledQuery}}function fromBundledQuery($){let ee=convertQueryTargetToQuery({parent:$.parent,structuredQuery:$.structuredQuery});return"LAST"===$.limitType?queryWithLimit(ee,ee.limit,"L"):ee}function fromProtoNamedQuery($){return{name:$.name,query:fromBundledQuery($.bundledQuery),readTime:fromVersion($.readTime)}}function fromBundleMetadata($){return{id:$.id,version:$.version,createTime:fromVersion($.createTime)}}function fromDbDocumentOverlay($,ee){return new Overlay(ee.largestBatchId,fromMutation($.remoteSerializer,ee.overlayMutation))}function toDbDocumentOverlay($,ee,et){let[er,en,ei]=toDbDocumentOverlayKey(ee,et.mutation.key);return{userId:ee,collectionPath:en,documentId:ei,collectionGroup:et.mutation.key.getCollectionGroup(),largestBatchId:et.largestBatchId,overlayMutation:toMutation($.remoteSerializer,et.mutation)}}function toDbDocumentOverlayKey($,ee){let et=ee.path.lastSegment(),er=encodeResourcePath(ee.path.popLast());return[$,er,et]}function toDbIndexConfiguration($){return{indexId:$.indexId,collectionGroup:$.collectionGroup,fields:$.fields.map($=>[$.fieldPath.canonicalString(),$.kind])}}function fromDbIndexConfiguration($,ee){let et=ee?new IndexState(ee.sequenceNumber,new IndexOffset(fromDbTimestamp(ee.readTime),new DocumentKey(decodeResourcePath(ee.documentKey)),ee.largestBatchId)):IndexState.empty(),er=$.fields.map(([$,ee])=>new IndexSegment(FieldPath$1.fromServerFormat($),ee));return new FieldIndex($.indexId,$.collectionGroup,er,et)}function toDbIndexState($,ee,et,er){return{indexId:$,uid:ee.uid||"",sequenceNumber:et,readTime:toDbTimestamp(er.readTime),documentKey:encodeResourcePath(er.documentKey.path),largestBatchId:er.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let IndexedDbBundleCache=class IndexedDbBundleCache{getBundleMetadata($,ee){return bundlesStore($).get(ee).next($=>{if($)return fromDbBundle($)})}saveBundleMetadata($,ee){return bundlesStore($).put(toDbBundle(ee))}getNamedQuery($,ee){return namedQueriesStore($).get(ee).next($=>{if($)return fromDbNamedQuery($)})}saveNamedQuery($,ee){return namedQueriesStore($).put(toDbNamedQuery(ee))}};function bundlesStore($){return getStore($,rT)}function namedQueriesStore($){return getStore($,rw)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let IndexedDbDocumentOverlayCache=class IndexedDbDocumentOverlayCache{constructor($,ee){this.serializer=$,this.userId=ee}static forUser($,ee){let et=ee.uid||"";return new IndexedDbDocumentOverlayCache($,et)}getOverlay($,ee){return documentOverlayStore($).get(toDbDocumentOverlayKey(this.userId,ee)).next($=>$?fromDbDocumentOverlay(this.serializer,$):null)}getOverlays($,ee){let et=newOverlayMap();return PersistencePromise.forEach(ee,ee=>this.getOverlay($,ee).next($=>{null!==$&&et.set(ee,$)})).next(()=>et)}saveOverlays($,ee,et){let er=[];return et.forEach((et,en)=>{let ei=new Overlay(ee,en);er.push(this.saveOverlay($,ei))}),PersistencePromise.waitFor(er)}removeOverlaysForBatchId($,ee,et){let er=new Set;ee.forEach($=>er.add(encodeResourcePath($.getCollectionPath())));let en=[];return er.forEach(ee=>{let er=IDBKeyRange.bound([this.userId,ee,et],[this.userId,ee,et+1],!1,!0);en.push(documentOverlayStore($).deleteAll(rj,er))}),PersistencePromise.waitFor(en)}getOverlaysForCollection($,ee,et){let er=newOverlayMap(),en=encodeResourcePath(ee),ei=IDBKeyRange.bound([this.userId,en,et],[this.userId,en,Number.POSITIVE_INFINITY],!0);return documentOverlayStore($).loadAll(rj,ei).next($=>{for(let ee of $){let $=fromDbDocumentOverlay(this.serializer,ee);er.set($.getKey(),$)}return er})}getOverlaysForCollectionGroup($,ee,et,er){let en;let ei=newOverlayMap(),es=IDBKeyRange.bound([this.userId,ee,et],[this.userId,ee,Number.POSITIVE_INFINITY],!0);return documentOverlayStore($).iterate({index:rq,range:es},($,ee,et)=>{let es=fromDbDocumentOverlay(this.serializer,ee);ei.size()<er||es.largestBatchId===en?(ei.set(es.getKey(),es),en=es.largestBatchId):et.done()}).next(()=>ei)}saveOverlay($,ee){return documentOverlayStore($).put(toDbDocumentOverlay(this.serializer,this.userId,ee))}};function documentOverlayStore($){return getStore($,rB)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ny=5,nv=10,nS=13,nC=15,nT=20,nE=25,nw=30,nD=37,nI=45,nR=50,n_=55,nP=60,nA=2;let FirestoreIndexValueWriter=class FirestoreIndexValueWriter{constructor(){}writeIndexValue($,ee){this.writeIndexValueAux($,ee),ee.writeInfinity()}writeIndexValueAux($,ee){if("nullValue"in $)this.writeValueTypeLabel(ee,ny);else if("booleanValue"in $)this.writeValueTypeLabel(ee,nv),ee.writeNumber($.booleanValue?1:0);else if("integerValue"in $)this.writeValueTypeLabel(ee,nC),ee.writeNumber(normalizeNumber($.integerValue));else if("doubleValue"in $){let et=normalizeNumber($.doubleValue);isNaN(et)?this.writeValueTypeLabel(ee,nS):(this.writeValueTypeLabel(ee,nC),isNegativeZero(et)?ee.writeNumber(0):ee.writeNumber(et))}else if("timestampValue"in $){let et=$.timestampValue;this.writeValueTypeLabel(ee,nT),"string"==typeof et?ee.writeString(et):(ee.writeString(`${et.seconds||""}`),ee.writeNumber(et.nanos||0))}else if("stringValue"in $)this.writeIndexString($.stringValue,ee),this.writeTruncationMarker(ee);else if("bytesValue"in $)this.writeValueTypeLabel(ee,nw),ee.writeBytes(normalizeByteString($.bytesValue)),this.writeTruncationMarker(ee);else if("referenceValue"in $)this.writeIndexEntityRef($.referenceValue,ee);else if("geoPointValue"in $){let et=$.geoPointValue;this.writeValueTypeLabel(ee,nI),ee.writeNumber(et.latitude||0),ee.writeNumber(et.longitude||0)}else"mapValue"in $?isMaxValue($)?this.writeValueTypeLabel(ee,Number.MAX_SAFE_INTEGER):(this.writeIndexMap($.mapValue,ee),this.writeTruncationMarker(ee)):"arrayValue"in $?(this.writeIndexArray($.arrayValue,ee),this.writeTruncationMarker(ee)):fail()}writeIndexString($,ee){this.writeValueTypeLabel(ee,nE),this.writeUnlabeledIndexString($,ee)}writeUnlabeledIndexString($,ee){ee.writeString($)}writeIndexMap($,ee){let et=$.fields||{};for(let $ of(this.writeValueTypeLabel(ee,n_),Object.keys(et)))this.writeIndexString($,ee),this.writeIndexValueAux(et[$],ee)}writeIndexArray($,ee){let et=$.values||[];for(let $ of(this.writeValueTypeLabel(ee,nR),et))this.writeIndexValueAux($,ee)}writeIndexEntityRef($,ee){this.writeValueTypeLabel(ee,nD);let et=DocumentKey.fromName($).path;et.forEach($=>{this.writeValueTypeLabel(ee,nP),this.writeUnlabeledIndexString($,ee)})}writeValueTypeLabel($,ee){$.writeNumber(ee)}writeTruncationMarker($){$.writeNumber(nA)}};FirestoreIndexValueWriter.INSTANCE=new FirestoreIndexValueWriter;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nx="\uD800",nO="\uDBFF",nk=0,nN=255,nM=1,nF=255,nL=255,nB=0,nV=64,nj=8,nU=1024;function doubleToLongBits($){let ee=new DataView(new ArrayBuffer(8));return ee.setFloat64(0,$,!1),new Uint8Array(ee.buffer)}function numberOfLeadingZerosInByte($){if(0===$)return 8;let ee=0;return $>>4==0&&(ee+=4,$<<=4),$>>6==0&&(ee+=2,$<<=2),$>>7==0&&(ee+=1),ee}function numberOfLeadingZeros($){let ee=0;for(let et=0;et<8;++et){let er=numberOfLeadingZerosInByte(255&$[et]);if(ee+=er,8!==er)break}return ee}function unsignedNumLength($){let ee=nV-numberOfLeadingZeros($);return Math.ceil(ee/nj)}let OrderedCodeWriter=class OrderedCodeWriter{constructor(){this.buffer=new Uint8Array(nU),this.position=0}writeBytesAscending($){let ee=$[Symbol.iterator](),et=ee.next();for(;!et.done;)this.writeByteAscending(et.value),et=ee.next();this.writeSeparatorAscending()}writeBytesDescending($){let ee=$[Symbol.iterator](),et=ee.next();for(;!et.done;)this.writeByteDescending(et.value),et=ee.next();this.writeSeparatorDescending()}writeUtf8Ascending($){for(let ee of $){let $=ee.charCodeAt(0);if($<128)this.writeByteAscending($);else if($<2048)this.writeByteAscending(960|$>>>6),this.writeByteAscending(128|63&$);else if(ee<nx||nO<ee)this.writeByteAscending(480|$>>>12),this.writeByteAscending(128|63&$>>>6),this.writeByteAscending(128|63&$);else{let $=ee.codePointAt(0);this.writeByteAscending(240|$>>>18),this.writeByteAscending(128|63&$>>>12),this.writeByteAscending(128|63&$>>>6),this.writeByteAscending(128|63&$)}}this.writeSeparatorAscending()}writeUtf8Descending($){for(let ee of $){let $=ee.charCodeAt(0);if($<128)this.writeByteDescending($);else if($<2048)this.writeByteDescending(960|$>>>6),this.writeByteDescending(128|63&$);else if(ee<nx||nO<ee)this.writeByteDescending(480|$>>>12),this.writeByteDescending(128|63&$>>>6),this.writeByteDescending(128|63&$);else{let $=ee.codePointAt(0);this.writeByteDescending(240|$>>>18),this.writeByteDescending(128|63&$>>>12),this.writeByteDescending(128|63&$>>>6),this.writeByteDescending(128|63&$)}}this.writeSeparatorDescending()}writeNumberAscending($){let ee=this.toOrderedBits($),et=unsignedNumLength(ee);this.ensureAvailable(1+et),this.buffer[this.position++]=255&et;for(let $=ee.length-et;$<ee.length;++$)this.buffer[this.position++]=255&ee[$]}writeNumberDescending($){let ee=this.toOrderedBits($),et=unsignedNumLength(ee);this.ensureAvailable(1+et),this.buffer[this.position++]=~(255&et);for(let $=ee.length-et;$<ee.length;++$)this.buffer[this.position++]=~(255&ee[$])}writeInfinityAscending(){this.writeEscapedByteAscending(nF),this.writeEscapedByteAscending(nL)}writeInfinityDescending(){this.writeEscapedByteDescending(nF),this.writeEscapedByteDescending(nL)}reset(){this.position=0}seed($){this.ensureAvailable($.length),this.buffer.set($,this.position),this.position+=$.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits($){let ee=doubleToLongBits($),et=(128&ee[0])!=0;ee[0]^=et?255:128;for(let $=1;$<ee.length;++$)ee[$]^=et?255:0;return ee}writeByteAscending($){let ee=255&$;ee===nk?(this.writeEscapedByteAscending(nk),this.writeEscapedByteAscending(nN)):ee===nF?(this.writeEscapedByteAscending(nF),this.writeEscapedByteAscending(nB)):this.writeEscapedByteAscending(ee)}writeByteDescending($){let ee=255&$;ee===nk?(this.writeEscapedByteDescending(nk),this.writeEscapedByteDescending(nN)):ee===nF?(this.writeEscapedByteDescending(nF),this.writeEscapedByteDescending(nB)):this.writeEscapedByteDescending($)}writeSeparatorAscending(){this.writeEscapedByteAscending(nk),this.writeEscapedByteAscending(nM)}writeSeparatorDescending(){this.writeEscapedByteDescending(nk),this.writeEscapedByteDescending(nM)}writeEscapedByteAscending($){this.ensureAvailable(1),this.buffer[this.position++]=$}writeEscapedByteDescending($){this.ensureAvailable(1),this.buffer[this.position++]=~$}ensureAvailable($){let ee=$+this.position;if(ee<=this.buffer.length)return;let et=2*this.buffer.length;et<ee&&(et=ee);let er=new Uint8Array(et);er.set(this.buffer),this.buffer=er}};let AscendingIndexByteEncoder=class AscendingIndexByteEncoder{constructor($){this.orderedCode=$}writeBytes($){this.orderedCode.writeBytesAscending($)}writeString($){this.orderedCode.writeUtf8Ascending($)}writeNumber($){this.orderedCode.writeNumberAscending($)}writeInfinity(){this.orderedCode.writeInfinityAscending()}};let DescendingIndexByteEncoder=class DescendingIndexByteEncoder{constructor($){this.orderedCode=$}writeBytes($){this.orderedCode.writeBytesDescending($)}writeString($){this.orderedCode.writeUtf8Descending($)}writeNumber($){this.orderedCode.writeNumberDescending($)}writeInfinity(){this.orderedCode.writeInfinityDescending()}};let IndexByteEncoder=class IndexByteEncoder{constructor(){this.orderedCode=new OrderedCodeWriter,this.ascending=new AscendingIndexByteEncoder(this.orderedCode),this.descending=new DescendingIndexByteEncoder(this.orderedCode)}seed($){this.orderedCode.seed($)}forKind($){return 0===$?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let IndexEntry=class IndexEntry{constructor($,ee,et,er){this.indexId=$,this.documentKey=ee,this.arrayValue=et,this.directionalValue=er}successor(){let $=this.directionalValue.length,ee=0===$||255===this.directionalValue[$-1]?$+1:$,et=new Uint8Array(ee);return et.set(this.directionalValue,0),ee!==$?et.set([0],this.directionalValue.length):++et[et.length-1],new IndexEntry(this.indexId,this.documentKey,this.arrayValue,et)}};function indexEntryComparator($,ee){let et=$.indexId-ee.indexId;return 0!==et||0!==(et=compareByteArrays($.arrayValue,ee.arrayValue))||0!==(et=compareByteArrays($.directionalValue,ee.directionalValue))?et:DocumentKey.comparator($.documentKey,ee.documentKey)}function compareByteArrays($,ee){for(let et=0;et<$.length&&et<ee.length;++et){let er=$[et]-ee[et];if(0!==er)return er}return $.length-ee.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let TargetIndexMatcher=class TargetIndexMatcher{constructor($){for(let ee of(this.collectionId=null!=$.collectionGroup?$.collectionGroup:$.path.lastSegment(),this.orderBys=$.orderBy,this.equalityFilters=[],$.filters)){let $=ee;$.isInequality()?this.inequalityFilter=$:this.equalityFilters.push($)}}servedByIndex($){hardAssert($.collectionGroup===this.collectionId);let ee=fieldIndexGetArraySegment($);if(void 0!==ee&&!this.hasMatchingEqualityFilter(ee))return!1;let et=fieldIndexGetDirectionalSegments($),er=new Set,en=0,ei=0;for(;en<et.length;++en)if(this.hasMatchingEqualityFilter(et[en]))er=er.add(et[en].fieldPath.canonicalString());else break;if(en===et.length)return!0;if(void 0!==this.inequalityFilter){if(!er.has(this.inequalityFilter.field.canonicalString())){let $=et[en];if(!this.matchesFilter(this.inequalityFilter,$)||!this.matchesOrderBy(this.orderBys[ei++],$))return!1}++en}for(;en<et.length;++en){let $=et[en];if(ei>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[ei++],$))return!1}return!0}buildTargetIndex(){let $=new SortedSet(FieldPath$1.comparator),ee=[];for(let et of this.equalityFilters){if(et.field.isKeyField())continue;let er="array-contains"===et.op||"array-contains-any"===et.op;if(er)ee.push(new IndexSegment(et.field,2));else{if($.has(et.field))continue;$=$.add(et.field),ee.push(new IndexSegment(et.field,0))}}for(let et of this.orderBys)et.field.isKeyField()||$.has(et.field)||($=$.add(et.field),ee.push(new IndexSegment(et.field,"asc"===et.dir?0:1)));return new FieldIndex(FieldIndex.UNKNOWN_ID,this.collectionId,ee,IndexState.empty())}hasMatchingEqualityFilter($){for(let ee of this.equalityFilters)if(this.matchesFilter(ee,$))return!0;return!1}matchesFilter($,ee){if(void 0===$||!$.field.isEqual(ee.fieldPath))return!1;let et="array-contains"===$.op||"array-contains-any"===$.op;return 2===ee.kind===et}matchesOrderBy($,ee){return!!$.field.isEqual(ee.fieldPath)&&(0===ee.kind&&"asc"===$.dir||1===ee.kind&&"desc"===$.dir)}};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function computeInExpansion($){var ee,et;if(hardAssert($ instanceof FieldFilter||$ instanceof CompositeFilter),$ instanceof FieldFilter){if(!($ instanceof InFilter))return $;{let er=(null===(et=null===(ee=$.value.arrayValue)||void 0===ee?void 0:ee.values)||void 0===et?void 0:et.map(ee=>FieldFilter.create($.field,"==",ee)))||[];return CompositeFilter.create(er,"or")}}let er=$.filters.map($=>computeInExpansion($));return CompositeFilter.create(er,$.op)}function getDnfTerms($){if(0===$.getFilters().length)return[];let ee=computeDistributedNormalForm(computeInExpansion($));return(hardAssert(isDisjunctiveNormalForm(ee)),isSingleFieldFilter(ee)||isFlatConjunction(ee))?[ee]:ee.getFilters()}function isSingleFieldFilter($){return $ instanceof FieldFilter}function isFlatConjunction($){return $ instanceof CompositeFilter&&compositeFilterIsFlatConjunction($)}function isDisjunctiveNormalForm($){return isSingleFieldFilter($)||isFlatConjunction($)||isDisjunctionOfFieldFiltersAndFlatConjunctions($)}function isDisjunctionOfFieldFiltersAndFlatConjunctions($){if($ instanceof CompositeFilter&&compositeFilterIsDisjunction($)){for(let ee of $.getFilters())if(!isSingleFieldFilter(ee)&&!isFlatConjunction(ee))return!1;return!0}return!1}function computeDistributedNormalForm($){if(hardAssert($ instanceof FieldFilter||$ instanceof CompositeFilter),$ instanceof FieldFilter)return $;if(1===$.filters.length)return computeDistributedNormalForm($.filters[0]);let ee=$.filters.map($=>computeDistributedNormalForm($)),et=CompositeFilter.create(ee,$.op);return isDisjunctiveNormalForm(et=applyAssociation(et))?et:(hardAssert(et instanceof CompositeFilter),hardAssert(compositeFilterIsConjunction(et)),hardAssert(et.filters.length>1),et.filters.reduce(($,ee)=>applyDistribution($,ee)))}function applyDistribution($,ee){let et;return hardAssert($ instanceof FieldFilter||$ instanceof CompositeFilter),hardAssert(ee instanceof FieldFilter||ee instanceof CompositeFilter),applyAssociation(et=$ instanceof FieldFilter?ee instanceof FieldFilter?applyDistributionFieldFilters($,ee):applyDistributionFieldAndCompositeFilters($,ee):ee instanceof FieldFilter?applyDistributionFieldAndCompositeFilters(ee,$):applyDistributionCompositeFilters($,ee))}function applyDistributionFieldFilters($,ee){return CompositeFilter.create([$,ee],"and")}function applyDistributionCompositeFilters($,ee){if(hardAssert($.filters.length>0&&ee.filters.length>0),compositeFilterIsConjunction($)&&compositeFilterIsConjunction(ee))return compositeFilterWithAddedFilters($,ee.getFilters());let et=compositeFilterIsDisjunction($)?$:ee,er=compositeFilterIsDisjunction($)?ee:$,en=et.filters.map($=>applyDistribution($,er));return CompositeFilter.create(en,"or")}function applyDistributionFieldAndCompositeFilters($,ee){if(compositeFilterIsConjunction(ee))return compositeFilterWithAddedFilters(ee,$.getFilters());{let et=ee.filters.map(ee=>applyDistribution($,ee));return CompositeFilter.create(et,"or")}}function applyAssociation($){if(hardAssert($ instanceof FieldFilter||$ instanceof CompositeFilter),$ instanceof FieldFilter)return $;let ee=$.getFilters();if(1===ee.length)return applyAssociation(ee[0]);if(compositeFilterIsFlat($))return $;let et=ee.map($=>applyAssociation($)),er=[];return(et.forEach(ee=>{ee instanceof FieldFilter?er.push(ee):ee instanceof CompositeFilter&&(ee.op===$.op?er.push(...ee.filters):er.push(ee))}),1===er.length)?er[0]:CompositeFilter.create(er,$.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let MemoryIndexManager=class MemoryIndexManager{constructor(){this.collectionParentIndex=new MemoryCollectionParentIndex}addToCollectionParentIndex($,ee){return this.collectionParentIndex.add(ee),PersistencePromise.resolve()}getCollectionParents($,ee){return PersistencePromise.resolve(this.collectionParentIndex.getEntries(ee))}addFieldIndex($,ee){return PersistencePromise.resolve()}deleteFieldIndex($,ee){return PersistencePromise.resolve()}deleteAllFieldIndexes($){return PersistencePromise.resolve()}createTargetIndexes($,ee){return PersistencePromise.resolve()}getDocumentsMatchingTarget($,ee){return PersistencePromise.resolve(null)}getIndexType($,ee){return PersistencePromise.resolve(0)}getFieldIndexes($,ee){return PersistencePromise.resolve([])}getNextCollectionGroupToUpdate($){return PersistencePromise.resolve(null)}getMinOffset($,ee){return PersistencePromise.resolve(IndexOffset.min())}getMinOffsetFromCollectionGroup($,ee){return PersistencePromise.resolve(IndexOffset.min())}updateCollectionGroup($,ee,et){return PersistencePromise.resolve()}updateIndexEntries($,ee){return PersistencePromise.resolve()}};let MemoryCollectionParentIndex=class MemoryCollectionParentIndex{constructor(){this.index={}}add($){let ee=$.lastSegment(),et=$.popLast(),er=this.index[ee]||new SortedSet(ResourcePath.comparator),en=!er.has(et);return this.index[ee]=er.add(et),en}has($){let ee=$.lastSegment(),et=$.popLast(),er=this.index[ee];return er&&er.has(et)}getEntries($){let ee=this.index[$]||new SortedSet(ResourcePath.comparator);return ee.toArray()}};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nq="IndexedDbIndexManager",nz=new Uint8Array(0);let IndexedDbIndexManager=class IndexedDbIndexManager{constructor($,ee){this.user=$,this.databaseId=ee,this.collectionParentsCache=new MemoryCollectionParentIndex,this.targetToDnfSubTargets=new ObjectMap($=>canonifyTarget($),($,ee)=>targetEquals($,ee)),this.uid=$.uid||""}addToCollectionParentIndex($,ee){if(!this.collectionParentsCache.has(ee)){let et=ee.lastSegment(),er=ee.popLast();$.addOnCommittedListener(()=>{this.collectionParentsCache.add(ee)});let en={collectionId:et,parent:encodeResourcePath(er)};return collectionParentsStore($).put(en)}return PersistencePromise.resolve()}getCollectionParents($,ee){let et=[],er=IDBKeyRange.bound([ee,""],[immediateSuccessor(ee),""],!1,!0);return collectionParentsStore($).loadAll(er).next($=>{for(let er of $){if(er.collectionId!==ee)break;et.push(decodeResourcePath(er.parent))}return et})}addFieldIndex($,ee){let et=indexConfigurationStore($),er=toDbIndexConfiguration(ee);delete er.indexId;let en=et.add(er);if(!ee.indexState)return en.next();{let et=indexStateStore($);return en.next($=>{et.put(toDbIndexState($,this.user,ee.indexState.sequenceNumber,ee.indexState.offset))})}}deleteFieldIndex($,ee){let et=indexConfigurationStore($),er=indexStateStore($),en=indexEntriesStore($);return et.delete(ee.indexId).next(()=>er.delete(IDBKeyRange.bound([ee.indexId],[ee.indexId+1],!1,!0))).next(()=>en.delete(IDBKeyRange.bound([ee.indexId],[ee.indexId+1],!1,!0)))}deleteAllFieldIndexes($){let ee=indexConfigurationStore($),et=indexEntriesStore($),er=indexStateStore($);return ee.deleteAll().next(()=>et.deleteAll()).next(()=>er.deleteAll())}createTargetIndexes($,ee){return PersistencePromise.forEach(this.getSubTargets(ee),ee=>this.getIndexType($,ee).next(et=>{if(0===et||1===et){let et=new TargetIndexMatcher(ee);return this.addFieldIndex($,et.buildTargetIndex())}}))}getDocumentsMatchingTarget($,ee){let et=indexEntriesStore($),er=!0,en=new Map;return PersistencePromise.forEach(this.getSubTargets(ee),ee=>this.getFieldIndex($,ee).next($=>{er&&(er=!!$),en.set(ee,$)})).next(()=>{if(!er)return PersistencePromise.resolve(null);{let $=documentKeySet(),er=[];return PersistencePromise.forEach(en,(en,ei)=>{logDebug(nq,`Using index ${fieldIndexToString(en)} to execute ${canonifyTarget(ee)}`);let es=targetGetArrayValues(ei,en),eo=targetGetNotInValues(ei,en),eu=targetGetLowerBound(ei,en),eh=targetGetUpperBound(ei,en),ep=this.encodeBound(en,ei,eu),ef=this.encodeBound(en,ei,eh),em=this.encodeValues(en,ei,eo),eg=this.generateIndexRanges(en.indexId,es,ep,eu.inclusive,ef,eh.inclusive,em);return PersistencePromise.forEach(eg,en=>et.loadFirst(en,ee.limit).next(ee=>{ee.forEach(ee=>{let et=DocumentKey.fromSegments(ee.documentKey);$.has(et)||($=$.add(et),er.push(et))})}))}).next(()=>er)}})}getSubTargets($){let ee=this.targetToDnfSubTargets.get($);if(ee)return ee;if(0===$.filters.length)ee=[$];else{let et=getDnfTerms(CompositeFilter.create($.filters,"and"));ee=et.map(ee=>newTarget($.path,$.collectionGroup,$.orderBy,ee.getFilters(),$.limit,$.startAt,$.endAt))}return this.targetToDnfSubTargets.set($,ee),ee}generateIndexRanges($,ee,et,er,en,ei,es){let eo=(null!=ee?ee.length:1)*Math.max(et.length,en.length),eu=eo/(null!=ee?ee.length:1),eh=[];for(let ep=0;ep<eo;++ep){let eo=ee?this.encodeSingleElement(ee[ep/eu]):nz,ef=this.generateLowerBound($,eo,et[ep%eu],er),em=this.generateUpperBound($,eo,en[ep%eu],ei),eg=es.map(ee=>this.generateLowerBound($,eo,ee,!0));eh.push(...this.createRange(ef,em,eg))}return eh}generateLowerBound($,ee,et,er){let en=new IndexEntry($,DocumentKey.empty(),ee,et);return er?en:en.successor()}generateUpperBound($,ee,et,er){let en=new IndexEntry($,DocumentKey.empty(),ee,et);return er?en.successor():en}getFieldIndex($,ee){let et=new TargetIndexMatcher(ee),er=null!=ee.collectionGroup?ee.collectionGroup:ee.path.lastSegment();return this.getFieldIndexes($,er).next($=>{let ee=null;for(let er of $){let $=et.servedByIndex(er);$&&(!ee||er.fields.length>ee.fields.length)&&(ee=er)}return ee})}getIndexType($,ee){let et=2,er=this.getSubTargets(ee);return PersistencePromise.forEach(er,ee=>this.getFieldIndex($,ee).next($=>{$?0!==et&&$.fields.length<targetGetSegmentCount(ee)&&(et=1):et=0})).next(()=>targetHasLimit(ee)&&er.length>1&&2===et?1:et)}encodeDirectionalElements($,ee){let et=new IndexByteEncoder;for(let er of fieldIndexGetDirectionalSegments($)){let $=ee.data.field(er.fieldPath);if(null==$)return null;let en=et.forKind(er.kind);FirestoreIndexValueWriter.INSTANCE.writeIndexValue($,en)}return et.encodedBytes()}encodeSingleElement($){let ee=new IndexByteEncoder;return FirestoreIndexValueWriter.INSTANCE.writeIndexValue($,ee.forKind(0)),ee.encodedBytes()}encodeDirectionalKey($,ee){let et=new IndexByteEncoder;return FirestoreIndexValueWriter.INSTANCE.writeIndexValue(refValue(this.databaseId,ee),et.forKind(fieldIndexGetKeyOrder($))),et.encodedBytes()}encodeValues($,ee,et){if(null===et)return[];let er=[];er.push(new IndexByteEncoder);let en=0;for(let ei of fieldIndexGetDirectionalSegments($)){let $=et[en++];for(let et of er)if(this.isInFilter(ee,ei.fieldPath)&&isArray($))er=this.expandIndexValues(er,ei,$);else{let ee=et.forKind(ei.kind);FirestoreIndexValueWriter.INSTANCE.writeIndexValue($,ee)}}return this.getEncodedBytes(er)}encodeBound($,ee,et){return this.encodeValues($,ee,et.position)}getEncodedBytes($){let ee=[];for(let et=0;et<$.length;++et)ee[et]=$[et].encodedBytes();return ee}expandIndexValues($,ee,et){let er=[...$],en=[];for(let $ of et.arrayValue.values||[])for(let et of er){let er=new IndexByteEncoder;er.seed(et.encodedBytes()),FirestoreIndexValueWriter.INSTANCE.writeIndexValue($,er.forKind(ee.kind)),en.push(er)}return en}isInFilter($,ee){return!!$.filters.find($=>$ instanceof FieldFilter&&$.field.isEqual(ee)&&("in"===$.op||"not-in"===$.op))}getFieldIndexes($,ee){let et=indexConfigurationStore($),er=indexStateStore($);return(ee?et.loadAll(r_,IDBKeyRange.bound(ee,ee)):et.loadAll()).next($=>{let ee=[];return PersistencePromise.forEach($,$=>er.get([$.indexId,this.uid]).next(et=>{ee.push(fromDbIndexConfiguration($,et))})).next(()=>ee)})}getNextCollectionGroupToUpdate($){return this.getFieldIndexes($).next($=>0===$.length?null:($.sort(($,ee)=>{let et=$.indexState.sequenceNumber-ee.indexState.sequenceNumber;return 0!==et?et:primitiveComparator($.collectionGroup,ee.collectionGroup)}),$[0].collectionGroup))}updateCollectionGroup($,ee,et){let er=indexConfigurationStore($),en=indexStateStore($);return this.getNextSequenceNumber($).next($=>er.loadAll(r_,IDBKeyRange.bound(ee,ee)).next(ee=>PersistencePromise.forEach(ee,ee=>en.put(toDbIndexState(ee.indexId,this.user,$,et)))))}updateIndexEntries($,ee){let et=new Map;return PersistencePromise.forEach(ee,(ee,er)=>{let en=et.get(ee.collectionGroup),ei=en?PersistencePromise.resolve(en):this.getFieldIndexes($,ee.collectionGroup);return ei.next(en=>(et.set(ee.collectionGroup,en),PersistencePromise.forEach(en,et=>this.getExistingIndexEntries($,ee,et).next(ee=>{let en=this.computeIndexEntries(er,et);return ee.isEqual(en)?PersistencePromise.resolve():this.updateEntries($,er,et,ee,en)}))))})}addIndexEntry($,ee,et,er){let en=indexEntriesStore($);return en.put({indexId:er.indexId,uid:this.uid,arrayValue:er.arrayValue,directionalValue:er.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(et,ee.key),documentKey:ee.key.path.toArray()})}deleteIndexEntry($,ee,et,er){let en=indexEntriesStore($);return en.delete([er.indexId,this.uid,er.arrayValue,er.directionalValue,this.encodeDirectionalKey(et,ee.key),ee.key.path.toArray()])}getExistingIndexEntries($,ee,et){let er=indexEntriesStore($),en=new SortedSet(indexEntryComparator);return er.iterate({index:rF,range:IDBKeyRange.only([et.indexId,this.uid,this.encodeDirectionalKey(et,ee)])},($,er)=>{en=en.add(new IndexEntry(et.indexId,ee,er.arrayValue,er.directionalValue))}).next(()=>en)}computeIndexEntries($,ee){let et=new SortedSet(indexEntryComparator),er=this.encodeDirectionalElements(ee,$);if(null==er)return et;let en=fieldIndexGetArraySegment(ee);if(null!=en){let ei=$.data.field(en.fieldPath);if(isArray(ei))for(let en of ei.arrayValue.values||[])et=et.add(new IndexEntry(ee.indexId,$.key,this.encodeSingleElement(en),er))}else et=et.add(new IndexEntry(ee.indexId,$.key,nz,er));return et}updateEntries($,ee,et,er,en){logDebug(nq,"Updating index entries for document '%s'",ee.key);let ei=[];return diffSortedSets(er,en,indexEntryComparator,er=>{ei.push(this.addIndexEntry($,ee,et,er))},er=>{ei.push(this.deleteIndexEntry($,ee,et,er))}),PersistencePromise.waitFor(ei)}getNextSequenceNumber($){let ee=1,et=indexStateStore($);return et.iterate({index:rO,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},($,et,er)=>{er.done(),ee=et.sequenceNumber+1}).next(()=>ee)}createRange($,ee,et){et=et.sort(($,ee)=>indexEntryComparator($,ee)).filter(($,ee,et)=>!ee||0!==indexEntryComparator($,et[ee-1]));let er=[];for(let en of(er.push($),et)){let et=indexEntryComparator(en,$),ei=indexEntryComparator(en,ee);if(0===et)er[0]=$.successor();else if(et>0&&ei<0)er.push(en),er.push(en.successor());else if(ei>0)break}er.push(ee);let en=[];for(let $=0;$<er.length;$+=2){if(this.isRangeMatchable(er[$],er[$+1]))return[];let ee=[er[$].indexId,this.uid,er[$].arrayValue,er[$].directionalValue,nz,[]],et=[er[$+1].indexId,this.uid,er[$+1].arrayValue,er[$+1].directionalValue,nz,[]];en.push(IDBKeyRange.bound(ee,et))}return en}isRangeMatchable($,ee){return indexEntryComparator($,ee)>0}getMinOffsetFromCollectionGroup($,ee){return this.getFieldIndexes($,ee).next(getMinOffsetFromFieldIndexes)}getMinOffset($,ee){return PersistencePromise.mapArray(this.getSubTargets(ee),ee=>this.getFieldIndex($,ee).next($=>$||fail())).next(getMinOffsetFromFieldIndexes)}};function collectionParentsStore($){return getStore($,ry)}function indexEntriesStore($){return getStore($,rN)}function indexConfigurationStore($){return getStore($,rI)}function indexStateStore($){return getStore($,rA)}function getMinOffsetFromFieldIndexes($){hardAssert(0!==$.length);let ee=$[0].indexState.offset,et=ee.largestBatchId;for(let er=1;er<$.length;er++){let en=$[er].indexState.offset;0>indexOffsetComparator(en,ee)&&(ee=en),et<en.largestBatchId&&(et=en.largestBatchId)}return new IndexOffset(ee.readTime,ee.documentKey,et)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function removeMutationBatch($,ee,et){let er=$.store(tZ),en=$.store(t6),ei=[],es=IDBKeyRange.only(et.batchId),eo=0,eu=er.iterate({range:es},($,ee,et)=>(eo++,et.delete()));ei.push(eu.next(()=>{hardAssert(1===eo)}));let eh=[];for(let $ of et.mutations){let er=newDbDocumentMutationKey(ee,$.key.path,et.batchId);ei.push(en.delete(er)),eh.push($.key)}return PersistencePromise.waitFor(ei).next(()=>eh)}function dbDocumentSize($){let ee;if(!$)return 0;if($.document)ee=$.document;else if($.unknownDocument)ee=$.unknownDocument;else if($.noDocument)ee=$.noDocument;else throw fail();return JSON.stringify(ee).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let IndexedDbMutationQueue=class IndexedDbMutationQueue{constructor($,ee,et,er){this.userId=$,this.serializer=ee,this.indexManager=et,this.referenceDelegate=er,this.documentKeysByBatchId={}}static forUser($,ee,et,er){hardAssert(""!==$.uid);let en=$.isAuthenticated()?$.uid:"";return new IndexedDbMutationQueue(en,ee,et,er)}checkEmpty($){let ee=!0,et=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return mutationsStore($).iterate({index:t1,range:et},($,et,er)=>{ee=!1,er.done()}).next(()=>ee)}addMutationBatch($,ee,et,er){let en=documentMutationsStore($),ei=mutationsStore($);return ei.add({}).next(es=>{hardAssert("number"==typeof es);let eo=new MutationBatch(es,ee,et,er),eu=toDbMutationBatch(this.serializer,this.userId,eo),eh=[],ep=new SortedSet(($,ee)=>primitiveComparator($.canonicalString(),ee.canonicalString()));for(let $ of er){let ee=newDbDocumentMutationKey(this.userId,$.key.path,es);ep=ep.add($.key.path.popLast()),eh.push(ei.put(eu)),eh.push(en.put(ee,t3))}return ep.forEach(ee=>{eh.push(this.indexManager.addToCollectionParentIndex($,ee))}),$.addOnCommittedListener(()=>{this.documentKeysByBatchId[es]=eo.keys()}),PersistencePromise.waitFor(eh).next(()=>eo)})}lookupMutationBatch($,ee){return mutationsStore($).get(ee).next($=>$?(hardAssert($.userId===this.userId),fromDbMutationBatch(this.serializer,$)):null)}lookupMutationKeys($,ee){return this.documentKeysByBatchId[ee]?PersistencePromise.resolve(this.documentKeysByBatchId[ee]):this.lookupMutationBatch($,ee).next($=>{if(!$)return null;{let et=$.keys();return this.documentKeysByBatchId[ee]=et,et}})}getNextMutationBatchAfterBatchId($,ee){let et=ee+1,er=IDBKeyRange.lowerBound([this.userId,et]),en=null;return mutationsStore($).iterate({index:t1,range:er},($,ee,er)=>{ee.userId===this.userId&&(hardAssert(ee.batchId>=et),en=fromDbMutationBatch(this.serializer,ee)),er.done()}).next(()=>en)}getHighestUnacknowledgedBatchId($){let ee=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),et=r9;return mutationsStore($).iterate({index:t1,range:ee,reverse:!0},($,ee,er)=>{et=ee.batchId,er.done()}).next(()=>et)}getAllMutationBatches($){let ee=IDBKeyRange.bound([this.userId,r9],[this.userId,Number.POSITIVE_INFINITY]);return mutationsStore($).loadAll(t1,ee).next($=>$.map($=>fromDbMutationBatch(this.serializer,$)))}getAllMutationBatchesAffectingDocumentKey($,ee){let et=newDbDocumentMutationPrefixForPath(this.userId,ee.path),er=IDBKeyRange.lowerBound(et),en=[];return documentMutationsStore($).iterate({range:er},(et,er,ei)=>{let[es,eo,eu]=et,eh=decodeResourcePath(eo);if(es!==this.userId||!ee.path.isEqual(eh)){ei.done();return}return mutationsStore($).get(eu).next($=>{if(!$)throw fail();hardAssert($.userId===this.userId),en.push(fromDbMutationBatch(this.serializer,$))})}).next(()=>en)}getAllMutationBatchesAffectingDocumentKeys($,ee){let et=new SortedSet(primitiveComparator),er=[];return ee.forEach(ee=>{let en=newDbDocumentMutationPrefixForPath(this.userId,ee.path),ei=IDBKeyRange.lowerBound(en),es=documentMutationsStore($).iterate({range:ei},($,er,en)=>{let[ei,es,eo]=$,eu=decodeResourcePath(es);if(ei!==this.userId||!ee.path.isEqual(eu)){en.done();return}et=et.add(eo)});er.push(es)}),PersistencePromise.waitFor(er).next(()=>this.lookupMutationBatches($,et))}getAllMutationBatchesAffectingQuery($,ee){let et=ee.path,er=et.length+1,en=newDbDocumentMutationPrefixForPath(this.userId,et),ei=IDBKeyRange.lowerBound(en),es=new SortedSet(primitiveComparator);return documentMutationsStore($).iterate({range:ei},($,ee,en)=>{let[ei,eo,eu]=$,eh=decodeResourcePath(eo);if(ei!==this.userId||!et.isPrefixOf(eh)){en.done();return}eh.length===er&&(es=es.add(eu))}).next(()=>this.lookupMutationBatches($,es))}lookupMutationBatches($,ee){let et=[],er=[];return ee.forEach(ee=>{er.push(mutationsStore($).get(ee).next($=>{if(null===$)throw fail();hardAssert($.userId===this.userId),et.push(fromDbMutationBatch(this.serializer,$))}))}),PersistencePromise.waitFor(er).next(()=>et)}removeMutationBatch($,ee){return removeMutationBatch($.simpleDbTransaction,this.userId,ee).next(et=>($.addOnCommittedListener(()=>{this.removeCachedMutationKeys(ee.batchId)}),PersistencePromise.forEach(et,ee=>this.referenceDelegate.markPotentiallyOrphaned($,ee))))}removeCachedMutationKeys($){delete this.documentKeysByBatchId[$]}performConsistencyCheck($){return this.checkEmpty($).next(ee=>{if(!ee)return PersistencePromise.resolve();let et=IDBKeyRange.lowerBound(newDbDocumentMutationPrefixForUser(this.userId)),er=[];return documentMutationsStore($).iterate({range:et},($,ee,et)=>{let en=$[0];if(en!==this.userId){et.done();return}{let ee=decodeResourcePath($[1]);er.push(ee)}}).next(()=>{hardAssert(0===er.length)})})}containsKey($,ee){return mutationQueueContainsKey($,this.userId,ee)}getMutationQueueMetadata($){return mutationQueuesStore($).get(this.userId).next($=>$||{userId:this.userId,lastAcknowledgedBatchId:r9,lastStreamToken:""})}};function mutationQueueContainsKey($,ee,et){let er=newDbDocumentMutationPrefixForPath(ee,et.path),en=er[1],ei=IDBKeyRange.lowerBound(er),es=!1;return documentMutationsStore($).iterate({range:ei,keysOnly:!0},($,et,er)=>{let[ei,eo,eu]=$;ei===ee&&eo===en&&(es=!0),er.done()}).next(()=>es)}function mutationQueuesContainKey($,ee){let et=!1;return mutationQueuesStore($).iterateSerial(er=>mutationQueueContainsKey($,er,ee).next($=>($&&(et=!0),PersistencePromise.resolve(!$)))).next(()=>et)}function mutationsStore($){return getStore($,tZ)}function documentMutationsStore($){return getStore($,t6)}function mutationQueuesStore($){return getStore($,tJ)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nK=2;let TargetIdGenerator=class TargetIdGenerator{constructor($){this.lastId=$}next(){return this.lastId+=nK,this.lastId}static forTargetCache(){return new TargetIdGenerator(2-nK)}static forSyncEngine(){return new TargetIdGenerator(1-nK)}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let IndexedDbTargetCache=class IndexedDbTargetCache{constructor($,ee){this.referenceDelegate=$,this.serializer=ee}allocateTargetId($){return this.retrieveMetadata($).next(ee=>{let et=new TargetIdGenerator(ee.highestTargetId);return ee.highestTargetId=et.next(),this.saveMetadata($,ee).next(()=>ee.highestTargetId)})}getLastRemoteSnapshotVersion($){return this.retrieveMetadata($).next($=>SnapshotVersion.fromTimestamp(new Timestamp($.lastRemoteSnapshotVersion.seconds,$.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber($){return this.retrieveMetadata($).next($=>$.highestListenSequenceNumber)}setTargetsMetadata($,ee,et){return this.retrieveMetadata($).next(er=>(er.highestListenSequenceNumber=ee,et&&(er.lastRemoteSnapshotVersion=et.toTimestamp()),ee>er.highestListenSequenceNumber&&(er.highestListenSequenceNumber=ee),this.saveMetadata($,er)))}addTargetData($,ee){return this.saveTargetData($,ee).next(()=>this.retrieveMetadata($).next(et=>(et.targetCount+=1,this.updateMetadataFromTargetData(ee,et),this.saveMetadata($,et))))}updateTargetData($,ee){return this.saveTargetData($,ee)}removeTargetData($,ee){return this.removeMatchingKeysForTargetId($,ee.targetId).next(()=>targetsStore($).delete(ee.targetId)).next(()=>this.retrieveMetadata($)).next(ee=>(hardAssert(ee.targetCount>0),ee.targetCount-=1,this.saveMetadata($,ee)))}removeTargets($,ee,et){let er=0,en=[];return targetsStore($).iterate((ei,es)=>{let eo=fromDbTarget(es);eo.sequenceNumber<=ee&&null===et.get(eo.targetId)&&(er++,en.push(this.removeTargetData($,eo)))}).next(()=>PersistencePromise.waitFor(en)).next(()=>er)}forEachTarget($,ee){return targetsStore($).iterate(($,et)=>{let er=fromDbTarget(et);ee(er)})}retrieveMetadata($){return globalTargetStore($).get(rm).next($=>(hardAssert(null!==$),$))}saveMetadata($,ee){return globalTargetStore($).put(rm,ee)}saveTargetData($,ee){return targetsStore($).put(toDbTarget(this.serializer,ee))}updateMetadataFromTargetData($,ee){let et=!1;return $.targetId>ee.highestTargetId&&(ee.highestTargetId=$.targetId,et=!0),$.sequenceNumber>ee.highestListenSequenceNumber&&(ee.highestListenSequenceNumber=$.sequenceNumber,et=!0),et}getTargetCount($){return this.retrieveMetadata($).next($=>$.targetCount)}getTargetData($,ee){let et=canonifyTarget(ee),er=IDBKeyRange.bound([et,Number.NEGATIVE_INFINITY],[et,Number.POSITIVE_INFINITY]),en=null;return targetsStore($).iterate({range:er,index:ro},($,et,er)=>{let ei=fromDbTarget(et);targetEquals(ee,ei.target)&&(en=ei,er.done())}).next(()=>en)}addMatchingKeys($,ee,et){let er=[],en=documentTargetStore($);return ee.forEach(ee=>{let ei=encodeResourcePath(ee.path);er.push(en.put({targetId:et,path:ei})),er.push(this.referenceDelegate.addReference($,et,ee))}),PersistencePromise.waitFor(er)}removeMatchingKeys($,ee,et){let er=documentTargetStore($);return PersistencePromise.forEach(ee,ee=>{let en=encodeResourcePath(ee.path);return PersistencePromise.waitFor([er.delete([et,en]),this.referenceDelegate.removeReference($,et,ee)])})}removeMatchingKeysForTargetId($,ee){let et=documentTargetStore($),er=IDBKeyRange.bound([ee],[ee+1],!1,!0);return et.delete(er)}getMatchingKeysForTargetId($,ee){let et=IDBKeyRange.bound([ee],[ee+1],!1,!0),er=documentTargetStore($),en=documentKeySet();return er.iterate({range:et,keysOnly:!0},($,ee,et)=>{let er=decodeResourcePath($[1]),ei=new DocumentKey(er);en=en.add(ei)}).next(()=>en)}containsKey($,ee){let et=encodeResourcePath(ee.path),er=IDBKeyRange.bound([et],[immediateSuccessor(et)],!1,!0),en=0;return documentTargetStore($).iterate({index:rp,keysOnly:!0,range:er},([$,ee],et,er)=>{0!==$&&(en++,er.done())}).next(()=>en>0)}getTargetDataForTarget($,ee){return targetsStore($).get(ee).next($=>$?fromDbTarget($):null)}};function targetsStore($){return getStore($,ri)}function globalTargetStore($){return getStore($,rg)}function documentTargetStore($){return getStore($,ru)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nW={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},nG=-1,n$=41943040;let LruParams=class LruParams{constructor($,ee,et){this.cacheSizeCollectionThreshold=$,this.percentileToCollect=ee,this.maximumSequenceNumbersToCollect=et}static withCacheSize($){return new LruParams($,LruParams.DEFAULT_COLLECTION_PERCENTILE,LruParams.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};LruParams.DEFAULT_COLLECTION_PERCENTILE=10,LruParams.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,LruParams.DEFAULT=new LruParams(n$,LruParams.DEFAULT_COLLECTION_PERCENTILE,LruParams.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),LruParams.DISABLED=new LruParams(nG,0,0);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nH="LruGarbageCollector",nQ=1048576,nY=null,nJ=null;function bufferEntryComparator([$,ee],[et,er]){let en=primitiveComparator($,et);return 0===en?primitiveComparator(ee,er):en}let RollingSequenceNumberBuffer=class RollingSequenceNumberBuffer{constructor($){this.maxElements=$,this.buffer=new SortedSet(bufferEntryComparator),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement($){let ee=[$,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(ee);else{let $=this.buffer.last();0>bufferEntryComparator(ee,$)&&(this.buffer=this.buffer.delete($).add(ee))}}get maxValue(){return this.buffer.last()[0]}};let LruScheduler=class LruScheduler{constructor($,ee,et){this.garbageCollector=$,this.asyncQueue=ee,this.localStore=et,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==nG&&this.scheduleGC(nY)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC($){logDebug(nH,`Garbage collection scheduled in ${$}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",$,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch($){isIndexedDbTransactionError($)?logDebug(nH,"Ignoring IndexedDB error during garbage collection: ",$):await ignoreIfPrimaryLeaseLoss($)}await this.scheduleGC(nJ)})}};let LruGarbageCollectorImpl=class LruGarbageCollectorImpl{constructor($,ee){this.delegate=$,this.params=ee}calculateTargetCount($,ee){return this.delegate.getSequenceNumberCount($).next($=>Math.floor(ee/100*$))}nthSequenceNumber($,ee){if(0===ee)return PersistencePromise.resolve(ListenSequence.INVALID);let et=new RollingSequenceNumberBuffer(ee);return this.delegate.forEachTarget($,$=>et.addElement($.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber($,$=>et.addElement($))).next(()=>et.maxValue)}removeTargets($,ee,et){return this.delegate.removeTargets($,ee,et)}removeOrphanedDocuments($,ee){return this.delegate.removeOrphanedDocuments($,ee)}collect($,ee){return this.params.cacheSizeCollectionThreshold===nG?(logDebug("LruGarbageCollector","Garbage collection skipped; disabled"),PersistencePromise.resolve(nW)):this.getCacheSize($).next(et=>et<this.params.cacheSizeCollectionThreshold?(logDebug("LruGarbageCollector",`Garbage collection skipped; Cache size ${et} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),nW):this.runGarbageCollection($,ee))}getCacheSize($){return this.delegate.getCacheSize($)}runGarbageCollection($,ee){let et,er,en,ei,es,eo,eu;let eh=Date.now();return this.calculateTargetCount($,this.params.percentileToCollect).next(ee=>(ee>this.params.maximumSequenceNumbersToCollect?(logDebug("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${ee}`),er=this.params.maximumSequenceNumbersToCollect):er=ee,ei=Date.now(),this.nthSequenceNumber($,er))).next(er=>(et=er,es=Date.now(),this.removeTargets($,et,ee))).next(ee=>(en=ee,eo=Date.now(),this.removeOrphanedDocuments($,et))).next($=>{if(eu=Date.now(),getLogLevel()<=LogLevel.DEBUG){let ee=`LRU Garbage Collection
	Counted targets in ${ei-eh}ms
	Determined least recently used ${er} in ${es-ei}ms
	Removed ${en} targets in ${eo-es}ms
	Removed ${$} documents in ${eu-eo}ms
Total Duration: ${eu-eh}ms`;logDebug("LruGarbageCollector",ee)}return PersistencePromise.resolve({didRun:!0,sequenceNumbersCollected:er,targetsRemoved:en,documentsRemoved:$})})}};function newLruGarbageCollector($,ee){return new LruGarbageCollectorImpl($,ee)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let IndexedDbLruDelegateImpl=class IndexedDbLruDelegateImpl{constructor($,ee){this.db=$,this.garbageCollector=newLruGarbageCollector(this,ee)}getSequenceNumberCount($){let ee=this.orphanedDocumentCount($),et=this.db.getTargetCache().getTargetCount($);return et.next($=>ee.next(ee=>$+ee))}orphanedDocumentCount($){let ee=0;return this.forEachOrphanedDocumentSequenceNumber($,$=>{ee++}).next(()=>ee)}forEachTarget($,ee){return this.db.getTargetCache().forEachTarget($,ee)}forEachOrphanedDocumentSequenceNumber($,ee){return this.forEachOrphanedDocument($,($,et)=>ee(et))}addReference($,ee,et){return writeSentinelKey($,et)}removeReference($,ee,et){return writeSentinelKey($,et)}removeTargets($,ee,et){return this.db.getTargetCache().removeTargets($,ee,et)}markPotentiallyOrphaned($,ee){return writeSentinelKey($,ee)}isPinned($,ee){return mutationQueuesContainKey($,ee)}removeOrphanedDocuments($,ee){let et=this.db.getRemoteDocumentCache(),er=et.newChangeBuffer(),en=[],ei=0,es=this.forEachOrphanedDocument($,(et,es)=>{if(es<=ee){let ee=this.isPinned($,et).next(ee=>{if(!ee)return ei++,er.getEntry($,et).next(()=>(er.removeEntry(et,SnapshotVersion.min()),documentTargetStore($).delete(sentinelKey$1(et))))});en.push(ee)}});return es.next(()=>PersistencePromise.waitFor(en)).next(()=>er.apply($)).next(()=>ei)}removeTarget($,ee){let et=ee.withSequenceNumber($.currentSequenceNumber);return this.db.getTargetCache().updateTargetData($,et)}updateLimboDocument($,ee){return writeSentinelKey($,ee)}forEachOrphanedDocument($,ee){let et;let er=documentTargetStore($),en=ListenSequence.INVALID;return er.iterate({index:rp},([$,er],{path:ei,sequenceNumber:es})=>{0===$?(en!==ListenSequence.INVALID&&ee(new DocumentKey(decodeResourcePath(et)),en),en=es,et=ei):en=ListenSequence.INVALID}).next(()=>{en!==ListenSequence.INVALID&&ee(new DocumentKey(decodeResourcePath(et)),en)})}getCacheSize($){return this.db.getRemoteDocumentCache().getSize($)}};function sentinelKey$1($){return[0,encodeResourcePath($.path)]}function sentinelRow($,ee){return{targetId:0,path:encodeResourcePath($.path),sequenceNumber:ee}}function writeSentinelKey($,ee){return documentTargetStore($).put(sentinelRow(ee,$.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let RemoteDocumentChangeBuffer=class RemoteDocumentChangeBuffer{constructor(){this.changes=new ObjectMap($=>$.toString(),($,ee)=>$.isEqual(ee)),this.changesApplied=!1}addEntry($){this.assertNotApplied(),this.changes.set($.key,$)}removeEntry($,ee){this.assertNotApplied(),this.changes.set($,MutableDocument.newInvalidDocument($).setReadTime(ee))}getEntry($,ee){this.assertNotApplied();let et=this.changes.get(ee);return void 0!==et?PersistencePromise.resolve(et):this.getFromCache($,ee)}getEntries($,ee){return this.getAllFromCache($,ee)}apply($){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges($)}assertNotApplied(){}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let IndexedDbRemoteDocumentCacheImpl=class IndexedDbRemoteDocumentCacheImpl{constructor($){this.serializer=$}setIndexManager($){this.indexManager=$}addEntry($,ee,et){let er=remoteDocumentsStore($);return er.put(et)}removeEntry($,ee,et){let er=remoteDocumentsStore($);return er.delete(dbReadTimeKey(ee,et))}updateMetadata($,ee){return this.getMetadata($).next(et=>(et.byteSize+=ee,this.setMetadata($,et)))}getEntry($,ee){let et=MutableDocument.newInvalidDocument(ee);return remoteDocumentsStore($).iterate({index:t5,range:IDBKeyRange.only(dbKey(ee))},($,er)=>{et=this.maybeDecodeDocument(ee,er)}).next(()=>et)}getSizedEntry($,ee){let et={size:0,document:MutableDocument.newInvalidDocument(ee)};return remoteDocumentsStore($).iterate({index:t5,range:IDBKeyRange.only(dbKey(ee))},($,er)=>{et={document:this.maybeDecodeDocument(ee,er),size:dbDocumentSize(er)}}).next(()=>et)}getEntries($,ee){let et=mutableDocumentMap();return this.forEachDbEntry($,ee,($,ee)=>{let er=this.maybeDecodeDocument($,ee);et=et.insert($,er)}).next(()=>et)}getSizedEntries($,ee){let et=mutableDocumentMap(),er=new SortedMap(DocumentKey.comparator);return this.forEachDbEntry($,ee,($,ee)=>{let en=this.maybeDecodeDocument($,ee);et=et.insert($,en),er=er.insert($,dbDocumentSize(ee))}).next(()=>({documents:et,sizeMap:er}))}forEachDbEntry($,ee,et){if(ee.isEmpty())return PersistencePromise.resolve();let er=new SortedSet(dbKeyComparator);ee.forEach($=>er=er.add($));let en=IDBKeyRange.bound(dbKey(er.first()),dbKey(er.last())),ei=er.getIterator(),es=ei.getNext();return remoteDocumentsStore($).iterate({index:t5,range:en},($,ee,er)=>{let en=DocumentKey.fromSegments([...ee.prefixPath,ee.collectionGroup,ee.documentId]);for(;es&&0>dbKeyComparator(es,en);)et(es,null),es=ei.getNext();es&&es.isEqual(en)&&(et(es,ee),es=ei.hasNext()?ei.getNext():null),es?er.skip(dbKey(es)):er.done()}).next(()=>{for(;es;)et(es,null),es=ei.hasNext()?ei.getNext():null})}getDocumentsMatchingQuery($,ee,et,er,en){let ei=ee.path,es=[ei.popLast().toArray(),ei.lastSegment(),toDbTimestampKey(et.readTime),et.documentKey.path.isEmpty()?"":et.documentKey.path.lastSegment()],eo=[ei.popLast().toArray(),ei.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return remoteDocumentsStore($).loadAll(IDBKeyRange.bound(es,eo,!0)).next($=>{null==en||en.incrementDocumentReadCount($.length);let et=mutableDocumentMap();for(let en of $){let $=this.maybeDecodeDocument(DocumentKey.fromSegments(en.prefixPath.concat(en.collectionGroup,en.documentId)),en);$.isFoundDocument()&&(queryMatches(ee,$)||er.has($.key))&&(et=et.insert($.key,$))}return et})}getAllFromCollectionGroup($,ee,et,er){let en=mutableDocumentMap(),ei=dbCollectionGroupKey(ee,et),es=dbCollectionGroupKey(ee,IndexOffset.max());return remoteDocumentsStore($).iterate({index:t7,range:IDBKeyRange.bound(ei,es,!0)},($,ee,et)=>{let ei=this.maybeDecodeDocument(DocumentKey.fromSegments(ee.prefixPath.concat(ee.collectionGroup,ee.documentId)),ee);(en=en.insert(ei.key,ei)).size===er&&et.done()}).next(()=>en)}newChangeBuffer($){return new IndexedDbRemoteDocumentChangeBuffer(this,!!$&&$.trackRemovals)}getSize($){return this.getMetadata($).next($=>$.byteSize)}getMetadata($){return documentGlobalStore($).get(rn).next($=>(hardAssert(!!$),$))}setMetadata($,ee){return documentGlobalStore($).put(rn,ee)}maybeDecodeDocument($,ee){if(ee){let $=fromDbRemoteDocument(this.serializer,ee),et=$.isNoDocument()&&$.version.isEqual(SnapshotVersion.min());if(!et)return $}return MutableDocument.newInvalidDocument($)}};function newIndexedDbRemoteDocumentCache($){return new IndexedDbRemoteDocumentCacheImpl($)}let IndexedDbRemoteDocumentChangeBuffer=class IndexedDbRemoteDocumentChangeBuffer extends null{constructor($,ee){super(),this.documentCache=$,this.trackRemovals=ee,this.documentStates=new ObjectMap($=>$.toString(),($,ee)=>$.isEqual(ee))}applyChanges($){let ee=[],et=0,er=new SortedSet(($,ee)=>primitiveComparator($.canonicalString(),ee.canonicalString()));return this.changes.forEach((en,ei)=>{let es=this.documentStates.get(en);if(ee.push(this.documentCache.removeEntry($,en,es.readTime)),ei.isValidDocument()){let eo=toDbRemoteDocument(this.documentCache.serializer,ei);er=er.add(en.path.popLast());let eu=dbDocumentSize(eo);et+=eu-es.size,ee.push(this.documentCache.addEntry($,en,eo))}else if(et-=es.size,this.trackRemovals){let et=toDbRemoteDocument(this.documentCache.serializer,ei.convertToNoDocument(SnapshotVersion.min()));ee.push(this.documentCache.addEntry($,en,et))}}),er.forEach(et=>{ee.push(this.documentCache.indexManager.addToCollectionParentIndex($,et))}),ee.push(this.documentCache.updateMetadata($,et)),PersistencePromise.waitFor(ee)}getFromCache($,ee){return this.documentCache.getSizedEntry($,ee).next($=>(this.documentStates.set(ee,{size:$.size,readTime:$.document.readTime}),$.document))}getAllFromCache($,ee){return this.documentCache.getSizedEntries($,ee).next(({documents:$,sizeMap:ee})=>(ee.forEach((ee,et)=>{this.documentStates.set(ee,{size:et,readTime:$.get(ee).readTime})}),$))}};function documentGlobalStore($){return getStore($,rr)}function remoteDocumentsStore($){return getStore($,t4)}function dbKey($){let ee=$.path.toArray();return[ee.slice(0,ee.length-2),ee[ee.length-2],ee[ee.length-1]]}function dbReadTimeKey($,ee){let et=$.path.toArray();return[et.slice(0,et.length-2),et[et.length-2],toDbTimestampKey(ee),et[et.length-1]]}function dbCollectionGroupKey($,ee){let et=ee.documentKey.path.toArray();return[$,toDbTimestampKey(ee.readTime),et.slice(0,et.length-2),et.length>0?et[et.length-1]:""]}function dbKeyComparator($,ee){let et=$.path.toArray(),er=ee.path.toArray(),en=0;for(let $=0;$<et.length-2&&$<er.length-2;++$)if(en=primitiveComparator(et[$],er[$]))return en;return(en=primitiveComparator(et.length,er.length))||(en=primitiveComparator(et[et.length-2],er[er.length-2]))?en:primitiveComparator(et[et.length-1],er[er.length-1])}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nX=15;/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let OverlayedDocument=class OverlayedDocument{constructor($,ee){this.overlayedDocument=$,this.mutatedFields=ee}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let LocalDocumentsView=class LocalDocumentsView{constructor($,ee,et,er){this.remoteDocumentCache=$,this.mutationQueue=ee,this.documentOverlayCache=et,this.indexManager=er}getDocument($,ee){let et=null;return this.documentOverlayCache.getOverlay($,ee).next(er=>(et=er,this.remoteDocumentCache.getEntry($,ee))).next($=>(null!==et&&mutationApplyToLocalView(et.mutation,$,FieldMask.empty(),Timestamp.now()),$))}getDocuments($,ee){return this.remoteDocumentCache.getEntries($,ee).next(ee=>this.getLocalViewOfDocuments($,ee,documentKeySet()).next(()=>ee))}getLocalViewOfDocuments($,ee,et=documentKeySet()){let er=newOverlayMap();return this.populateOverlays($,er,ee).next(()=>this.computeViews($,ee,er,et).next($=>{let ee=documentMap();return $.forEach(($,et)=>{ee=ee.insert($,et.overlayedDocument)}),ee}))}getOverlayedDocuments($,ee){let et=newOverlayMap();return this.populateOverlays($,et,ee).next(()=>this.computeViews($,ee,et,documentKeySet()))}populateOverlays($,ee,et){let er=[];return et.forEach($=>{ee.has($)||er.push($)}),this.documentOverlayCache.getOverlays($,er).next($=>{$.forEach(($,et)=>{ee.set($,et)})})}computeViews($,ee,et,er){let en=mutableDocumentMap(),ei=newDocumentKeyMap(),es=newOverlayedDocumentMap();return ee.forEach(($,ee)=>{let es=et.get(ee.key);er.has(ee.key)&&(void 0===es||es.mutation instanceof PatchMutation)?en=en.insert(ee.key,ee):void 0!==es?(ei.set(ee.key,es.mutation.getFieldMask()),mutationApplyToLocalView(es.mutation,ee,es.mutation.getFieldMask(),Timestamp.now())):ei.set(ee.key,FieldMask.empty())}),this.recalculateAndSaveOverlays($,en).next($=>($.forEach(($,ee)=>ei.set($,ee)),ee.forEach(($,ee)=>{var et;return es.set($,new OverlayedDocument(ee,null!==(et=ei.get($))&&void 0!==et?et:null))}),es))}recalculateAndSaveOverlays($,ee){let et=newDocumentKeyMap(),er=new SortedMap(($,ee)=>$-ee),en=documentKeySet();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys($,ee).next($=>{for(let en of $)en.keys().forEach($=>{let ei=ee.get($);if(null===ei)return;let es=et.get($)||FieldMask.empty();es=en.applyToLocalView(ei,es),et.set($,es);let eo=(er.get(en.batchId)||documentKeySet()).add($);er=er.insert(en.batchId,eo)})}).next(()=>{let ei=[],es=er.getReverseIterator();for(;es.hasNext();){let er=es.getNext(),eo=er.key,eu=er.value,eh=newMutationMap();eu.forEach($=>{if(!en.has($)){let er=calculateOverlayMutation(ee.get($),et.get($));null!==er&&eh.set($,er),en=en.add($)}}),ei.push(this.documentOverlayCache.saveOverlays($,eo,eh))}return PersistencePromise.waitFor(ei)}).next(()=>et)}recalculateAndSaveOverlaysForDocumentKeys($,ee){return this.remoteDocumentCache.getEntries($,ee).next(ee=>this.recalculateAndSaveOverlays($,ee))}getDocumentsMatchingQuery($,ee,et,er){return isDocumentQuery$1(ee)?this.getDocumentsMatchingDocumentQuery($,ee.path):isCollectionGroupQuery(ee)?this.getDocumentsMatchingCollectionGroupQuery($,ee,et,er):this.getDocumentsMatchingCollectionQuery($,ee,et,er)}getNextDocuments($,ee,et,er){return this.remoteDocumentCache.getAllFromCollectionGroup($,ee,et,er).next(en=>{let ei=er-en.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup($,ee,et.largestBatchId,er-en.size):PersistencePromise.resolve(newOverlayMap()),es=tN,eo=en;return ei.next(ee=>PersistencePromise.forEach(ee,(ee,et)=>(es<et.largestBatchId&&(es=et.largestBatchId),en.get(ee))?PersistencePromise.resolve():this.remoteDocumentCache.getEntry($,ee).next($=>{eo=eo.insert(ee,$)})).next(()=>this.populateOverlays($,ee,en)).next(()=>this.computeViews($,eo,ee,documentKeySet())).next($=>({batchId:es,changes:convertOverlayedDocumentMapToDocumentMap($)})))})}getDocumentsMatchingDocumentQuery($,ee){return this.getDocument($,new DocumentKey(ee)).next($=>{let ee=documentMap();return $.isFoundDocument()&&(ee=ee.insert($.key,$)),ee})}getDocumentsMatchingCollectionGroupQuery($,ee,et,er){let en=ee.collectionGroup,ei=documentMap();return this.indexManager.getCollectionParents($,en).next(es=>PersistencePromise.forEach(es,es=>{let eo=asCollectionQueryAtPath(ee,es.child(en));return this.getDocumentsMatchingCollectionQuery($,eo,et,er).next($=>{$.forEach(($,ee)=>{ei=ei.insert($,ee)})})}).next(()=>ei))}getDocumentsMatchingCollectionQuery($,ee,et,er){let en;return this.documentOverlayCache.getOverlaysForCollection($,ee.path,et.largestBatchId).next(ei=>(en=ei,this.remoteDocumentCache.getDocumentsMatchingQuery($,ee,et,en,er))).next($=>{en.forEach((ee,et)=>{let er=et.getKey();null===$.get(er)&&($=$.insert(er,MutableDocument.newInvalidDocument(er)))});let et=documentMap();return $.forEach(($,er)=>{let ei=en.get($);void 0!==ei&&mutationApplyToLocalView(ei.mutation,er,FieldMask.empty(),Timestamp.now()),queryMatches(ee,er)&&(et=et.insert($,er))}),et})}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let MemoryBundleCache=class MemoryBundleCache{constructor($){this.serializer=$,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata($,ee){return PersistencePromise.resolve(this.bundles.get(ee))}saveBundleMetadata($,ee){return this.bundles.set(ee.id,fromBundleMetadata(ee)),PersistencePromise.resolve()}getNamedQuery($,ee){return PersistencePromise.resolve(this.namedQueries.get(ee))}saveNamedQuery($,ee){return this.namedQueries.set(ee.name,fromProtoNamedQuery(ee)),PersistencePromise.resolve()}};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let MemoryDocumentOverlayCache=class MemoryDocumentOverlayCache{constructor(){this.overlays=new SortedMap(DocumentKey.comparator),this.overlayByBatchId=new Map}getOverlay($,ee){return PersistencePromise.resolve(this.overlays.get(ee))}getOverlays($,ee){let et=newOverlayMap();return PersistencePromise.forEach(ee,ee=>this.getOverlay($,ee).next($=>{null!==$&&et.set(ee,$)})).next(()=>et)}saveOverlays($,ee,et){return et.forEach((et,er)=>{this.saveOverlay($,ee,er)}),PersistencePromise.resolve()}removeOverlaysForBatchId($,ee,et){let er=this.overlayByBatchId.get(et);return void 0!==er&&(er.forEach($=>this.overlays=this.overlays.remove($)),this.overlayByBatchId.delete(et)),PersistencePromise.resolve()}getOverlaysForCollection($,ee,et){let er=newOverlayMap(),en=ee.length+1,ei=new DocumentKey(ee.child("")),es=this.overlays.getIteratorFrom(ei);for(;es.hasNext();){let $=es.getNext(),ei=$.value,eo=ei.getKey();if(!ee.isPrefixOf(eo.path))break;eo.path.length===en&&ei.largestBatchId>et&&er.set(ei.getKey(),ei)}return PersistencePromise.resolve(er)}getOverlaysForCollectionGroup($,ee,et,er){let en=new SortedMap(($,ee)=>$-ee),ei=this.overlays.getIterator();for(;ei.hasNext();){let $=ei.getNext(),er=$.value,es=er.getKey();if(es.getCollectionGroup()===ee&&er.largestBatchId>et){let $=en.get(er.largestBatchId);null===$&&($=newOverlayMap(),en=en.insert(er.largestBatchId,$)),$.set(er.getKey(),er)}}let es=newOverlayMap(),eo=en.getIterator();for(;eo.hasNext();){let $=eo.getNext(),ee=$.value;if(ee.forEach(($,ee)=>es.set($,ee)),es.size()>=er)break}return PersistencePromise.resolve(es)}saveOverlay($,ee,et){let er=this.overlays.get(et.key);if(null!==er){let $=this.overlayByBatchId.get(er.largestBatchId).delete(et.key);this.overlayByBatchId.set(er.largestBatchId,$)}this.overlays=this.overlays.insert(et.key,new Overlay(ee,et));let en=this.overlayByBatchId.get(ee);void 0===en&&(en=documentKeySet(),this.overlayByBatchId.set(ee,en)),this.overlayByBatchId.set(ee,en.add(et.key))}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ReferenceSet=class ReferenceSet{constructor(){this.refsByKey=new SortedSet(DocReference.compareByKey),this.refsByTarget=new SortedSet(DocReference.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference($,ee){let et=new DocReference($,ee);this.refsByKey=this.refsByKey.add(et),this.refsByTarget=this.refsByTarget.add(et)}addReferences($,ee){$.forEach($=>this.addReference($,ee))}removeReference($,ee){this.removeRef(new DocReference($,ee))}removeReferences($,ee){$.forEach($=>this.removeReference($,ee))}removeReferencesForId($){let ee=new DocumentKey(new ResourcePath([])),et=new DocReference(ee,$),er=new DocReference(ee,$+1),en=[];return this.refsByTarget.forEachInRange([et,er],$=>{this.removeRef($),en.push($.key)}),en}removeAllReferences(){this.refsByKey.forEach($=>this.removeRef($))}removeRef($){this.refsByKey=this.refsByKey.delete($),this.refsByTarget=this.refsByTarget.delete($)}referencesForId($){let ee=new DocumentKey(new ResourcePath([])),et=new DocReference(ee,$),er=new DocReference(ee,$+1),en=documentKeySet();return this.refsByTarget.forEachInRange([et,er],$=>{en=en.add($.key)}),en}containsKey($){let ee=new DocReference($,0),et=this.refsByKey.firstAfterOrEqual(ee);return null!==et&&$.isEqual(et.key)}};let DocReference=class DocReference{constructor($,ee){this.key=$,this.targetOrBatchId=ee}static compareByKey($,ee){return DocumentKey.comparator($.key,ee.key)||primitiveComparator($.targetOrBatchId,ee.targetOrBatchId)}static compareByTargetId($,ee){return primitiveComparator($.targetOrBatchId,ee.targetOrBatchId)||DocumentKey.comparator($.key,ee.key)}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let MemoryMutationQueue=class MemoryMutationQueue{constructor($,ee){this.indexManager=$,this.referenceDelegate=ee,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new SortedSet(DocReference.compareByKey)}checkEmpty($){return PersistencePromise.resolve(0===this.mutationQueue.length)}addMutationBatch($,ee,et,er){let en=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let ei=new MutationBatch(en,ee,et,er);for(let ee of(this.mutationQueue.push(ei),er))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new DocReference(ee.key,en)),this.indexManager.addToCollectionParentIndex($,ee.key.path.popLast());return PersistencePromise.resolve(ei)}lookupMutationBatch($,ee){return PersistencePromise.resolve(this.findMutationBatch(ee))}getNextMutationBatchAfterBatchId($,ee){let et=ee+1,er=this.indexOfBatchId(et),en=er<0?0:er;return PersistencePromise.resolve(this.mutationQueue.length>en?this.mutationQueue[en]:null)}getHighestUnacknowledgedBatchId(){return PersistencePromise.resolve(0===this.mutationQueue.length?r9:this.nextBatchId-1)}getAllMutationBatches($){return PersistencePromise.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey($,ee){let et=new DocReference(ee,0),er=new DocReference(ee,Number.POSITIVE_INFINITY),en=[];return this.batchesByDocumentKey.forEachInRange([et,er],$=>{let ee=this.findMutationBatch($.targetOrBatchId);en.push(ee)}),PersistencePromise.resolve(en)}getAllMutationBatchesAffectingDocumentKeys($,ee){let et=new SortedSet(primitiveComparator);return ee.forEach($=>{let ee=new DocReference($,0),er=new DocReference($,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([ee,er],$=>{et=et.add($.targetOrBatchId)})}),PersistencePromise.resolve(this.findMutationBatches(et))}getAllMutationBatchesAffectingQuery($,ee){let et=ee.path,er=et.length+1,en=et;DocumentKey.isDocumentKey(en)||(en=en.child(""));let ei=new DocReference(new DocumentKey(en),0),es=new SortedSet(primitiveComparator);return this.batchesByDocumentKey.forEachWhile($=>{let ee=$.key.path;return!!et.isPrefixOf(ee)&&(ee.length===er&&(es=es.add($.targetOrBatchId)),!0)},ei),PersistencePromise.resolve(this.findMutationBatches(es))}findMutationBatches($){let ee=[];return $.forEach($=>{let et=this.findMutationBatch($);null!==et&&ee.push(et)}),ee}removeMutationBatch($,ee){let et=this.indexOfExistingBatchId(ee.batchId,"removed");hardAssert(0===et),this.mutationQueue.shift();let er=this.batchesByDocumentKey;return PersistencePromise.forEach(ee.mutations,et=>{let en=new DocReference(et.key,ee.batchId);return er=er.delete(en),this.referenceDelegate.markPotentiallyOrphaned($,et.key)}).next(()=>{this.batchesByDocumentKey=er})}removeCachedMutationKeys($){}containsKey($,ee){let et=new DocReference(ee,0),er=this.batchesByDocumentKey.firstAfterOrEqual(et);return PersistencePromise.resolve(ee.isEqual(er&&er.key))}performConsistencyCheck($){return this.mutationQueue.length,PersistencePromise.resolve()}indexOfExistingBatchId($,ee){let et=this.indexOfBatchId($);return et}indexOfBatchId($){if(0===this.mutationQueue.length)return 0;let ee=this.mutationQueue[0].batchId;return $-ee}findMutationBatch($){let ee=this.indexOfBatchId($);if(ee<0||ee>=this.mutationQueue.length)return null;let et=this.mutationQueue[ee];return et}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function documentEntryMap(){return new SortedMap(DocumentKey.comparator)}let MemoryRemoteDocumentCacheImpl=class MemoryRemoteDocumentCacheImpl{constructor($){this.sizer=$,this.docs=documentEntryMap(),this.size=0}setIndexManager($){this.indexManager=$}addEntry($,ee){let et=ee.key,er=this.docs.get(et),en=er?er.size:0,ei=this.sizer(ee);return this.docs=this.docs.insert(et,{document:ee.mutableCopy(),size:ei}),this.size+=ei-en,this.indexManager.addToCollectionParentIndex($,et.path.popLast())}removeEntry($){let ee=this.docs.get($);ee&&(this.docs=this.docs.remove($),this.size-=ee.size)}getEntry($,ee){let et=this.docs.get(ee);return PersistencePromise.resolve(et?et.document.mutableCopy():MutableDocument.newInvalidDocument(ee))}getEntries($,ee){let et=mutableDocumentMap();return ee.forEach($=>{let ee=this.docs.get($);et=et.insert($,ee?ee.document.mutableCopy():MutableDocument.newInvalidDocument($))}),PersistencePromise.resolve(et)}getDocumentsMatchingQuery($,ee,et,er){let en=mutableDocumentMap(),ei=ee.path,es=new DocumentKey(ei.child("")),eo=this.docs.getIteratorFrom(es);for(;eo.hasNext();){let{key:$,value:{document:es}}=eo.getNext();if(!ei.isPrefixOf($.path))break;!($.path.length>ei.length+1||0>=indexOffsetComparator(newIndexOffsetFromDocument(es),et))&&(er.has(es.key)||queryMatches(ee,es))&&(en=en.insert(es.key,es.mutableCopy()))}return PersistencePromise.resolve(en)}getAllFromCollectionGroup($,ee,et,er){fail()}forEachDocumentKey($,ee){return PersistencePromise.forEach(this.docs,$=>ee($))}newChangeBuffer($){return new MemoryRemoteDocumentChangeBuffer(this)}getSize($){return PersistencePromise.resolve(this.size)}};function newMemoryRemoteDocumentCache($){return new MemoryRemoteDocumentCacheImpl($)}let MemoryRemoteDocumentChangeBuffer=class MemoryRemoteDocumentChangeBuffer extends RemoteDocumentChangeBuffer{constructor($){super(),this.documentCache=$}applyChanges($){let ee=[];return this.changes.forEach((et,er)=>{er.isValidDocument()?ee.push(this.documentCache.addEntry($,er)):this.documentCache.removeEntry(et)}),PersistencePromise.waitFor(ee)}getFromCache($,ee){return this.documentCache.getEntry($,ee)}getAllFromCache($,ee){return this.documentCache.getEntries($,ee)}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let MemoryTargetCache=class MemoryTargetCache{constructor($){this.persistence=$,this.targets=new ObjectMap($=>canonifyTarget($),targetEquals),this.lastRemoteSnapshotVersion=SnapshotVersion.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new ReferenceSet,this.targetCount=0,this.targetIdGenerator=TargetIdGenerator.forTargetCache()}forEachTarget($,ee){return this.targets.forEach(($,et)=>ee(et)),PersistencePromise.resolve()}getLastRemoteSnapshotVersion($){return PersistencePromise.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber($){return PersistencePromise.resolve(this.highestSequenceNumber)}allocateTargetId($){return this.highestTargetId=this.targetIdGenerator.next(),PersistencePromise.resolve(this.highestTargetId)}setTargetsMetadata($,ee,et){return et&&(this.lastRemoteSnapshotVersion=et),ee>this.highestSequenceNumber&&(this.highestSequenceNumber=ee),PersistencePromise.resolve()}saveTargetData($){this.targets.set($.target,$);let ee=$.targetId;ee>this.highestTargetId&&(this.targetIdGenerator=new TargetIdGenerator(ee),this.highestTargetId=ee),$.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=$.sequenceNumber)}addTargetData($,ee){return this.saveTargetData(ee),this.targetCount+=1,PersistencePromise.resolve()}updateTargetData($,ee){return this.saveTargetData(ee),PersistencePromise.resolve()}removeTargetData($,ee){return this.targets.delete(ee.target),this.references.removeReferencesForId(ee.targetId),this.targetCount-=1,PersistencePromise.resolve()}removeTargets($,ee,et){let er=0,en=[];return this.targets.forEach((ei,es)=>{es.sequenceNumber<=ee&&null===et.get(es.targetId)&&(this.targets.delete(ei),en.push(this.removeMatchingKeysForTargetId($,es.targetId)),er++)}),PersistencePromise.waitFor(en).next(()=>er)}getTargetCount($){return PersistencePromise.resolve(this.targetCount)}getTargetData($,ee){let et=this.targets.get(ee)||null;return PersistencePromise.resolve(et)}addMatchingKeys($,ee,et){return this.references.addReferences(ee,et),PersistencePromise.resolve()}removeMatchingKeys($,ee,et){this.references.removeReferences(ee,et);let er=this.persistence.referenceDelegate,en=[];return er&&ee.forEach(ee=>{en.push(er.markPotentiallyOrphaned($,ee))}),PersistencePromise.waitFor(en)}removeMatchingKeysForTargetId($,ee){return this.references.removeReferencesForId(ee),PersistencePromise.resolve()}getMatchingKeysForTargetId($,ee){let et=this.references.referencesForId(ee);return PersistencePromise.resolve(et)}containsKey($,ee){return PersistencePromise.resolve(this.references.containsKey(ee))}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nZ="MemoryPersistence";let MemoryPersistence=class MemoryPersistence{constructor($,ee){this.mutationQueues={},this.overlays={},this.listenSequence=new ListenSequence(0),this._started=!1,this._started=!0,this.referenceDelegate=$(this),this.targetCache=new MemoryTargetCache(this);let sizer=$=>this.referenceDelegate.documentSize($);this.indexManager=new MemoryIndexManager,this.remoteDocumentCache=newMemoryRemoteDocumentCache(sizer),this.serializer=new LocalSerializer(ee),this.bundleCache=new MemoryBundleCache(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager($){return this.indexManager}getDocumentOverlayCache($){let ee=this.overlays[$.toKey()];return ee||(ee=new MemoryDocumentOverlayCache,this.overlays[$.toKey()]=ee),ee}getMutationQueue($,ee){let et=this.mutationQueues[$.toKey()];return et||(et=new MemoryMutationQueue(ee,this.referenceDelegate),this.mutationQueues[$.toKey()]=et),et}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction($,ee,et){logDebug(nZ,"Starting transaction:",$);let er=new MemoryTransaction(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),et(er).next($=>this.referenceDelegate.onTransactionCommitted(er).next(()=>$)).toPromise().then($=>(er.raiseOnCommittedEvent(),$))}mutationQueuesContainKey($,ee){return PersistencePromise.or(Object.values(this.mutationQueues).map(et=>()=>et.containsKey($,ee)))}};let MemoryTransaction=class MemoryTransaction extends PersistenceTransaction{constructor($){super(),this.currentSequenceNumber=$}};let MemoryEagerDelegate=class MemoryEagerDelegate{constructor($){this.persistence=$,this.localViewReferences=new ReferenceSet,this._orphanedDocuments=null}static factory($){return new MemoryEagerDelegate($)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw fail()}addReference($,ee,et){return this.localViewReferences.addReference(et,ee),this.orphanedDocuments.delete(et.toString()),PersistencePromise.resolve()}removeReference($,ee,et){return this.localViewReferences.removeReference(et,ee),this.orphanedDocuments.add(et.toString()),PersistencePromise.resolve()}markPotentiallyOrphaned($,ee){return this.orphanedDocuments.add(ee.toString()),PersistencePromise.resolve()}removeTarget($,ee){let et=this.localViewReferences.removeReferencesForId(ee.targetId);et.forEach($=>this.orphanedDocuments.add($.toString()));let er=this.persistence.getTargetCache();return er.getMatchingKeysForTargetId($,ee.targetId).next($=>{$.forEach($=>this.orphanedDocuments.add($.toString()))}).next(()=>er.removeTargetData($,ee))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted($){let ee=this.persistence.getRemoteDocumentCache(),et=ee.newChangeBuffer();return PersistencePromise.forEach(this.orphanedDocuments,ee=>{let er=DocumentKey.fromPath(ee);return this.isReferenced($,er).next($=>{$||et.removeEntry(er,SnapshotVersion.min())})}).next(()=>(this._orphanedDocuments=null,et.apply($)))}updateLimboDocument($,ee){return this.isReferenced($,ee).next($=>{$?this.orphanedDocuments.delete(ee.toString()):this.orphanedDocuments.add(ee.toString())})}documentSize($){return 0}isReferenced($,ee){return PersistencePromise.or([()=>PersistencePromise.resolve(this.localViewReferences.containsKey(ee)),()=>this.persistence.getTargetCache().containsKey($,ee),()=>this.persistence.mutationQueuesContainKey($,ee)])}};let MemoryLruDelegate=class MemoryLruDelegate{constructor($,ee){this.persistence=$,this.orphanedSequenceNumbers=new ObjectMap($=>encodeResourcePath($.path),($,ee)=>$.isEqual(ee)),this.garbageCollector=newLruGarbageCollector(this,ee)}static factory($,ee){return new MemoryLruDelegate($,ee)}onTransactionStarted(){}onTransactionCommitted($){return PersistencePromise.resolve()}forEachTarget($,ee){return this.persistence.getTargetCache().forEachTarget($,ee)}getSequenceNumberCount($){let ee=this.orphanedDocumentCount($),et=this.persistence.getTargetCache().getTargetCount($);return et.next($=>ee.next(ee=>$+ee))}orphanedDocumentCount($){let ee=0;return this.forEachOrphanedDocumentSequenceNumber($,$=>{ee++}).next(()=>ee)}forEachOrphanedDocumentSequenceNumber($,ee){return PersistencePromise.forEach(this.orphanedSequenceNumbers,(et,er)=>this.isPinned($,et,er).next($=>$?PersistencePromise.resolve():ee(er)))}removeTargets($,ee,et){return this.persistence.getTargetCache().removeTargets($,ee,et)}removeOrphanedDocuments($,ee){let et=0,er=this.persistence.getRemoteDocumentCache(),en=er.newChangeBuffer(),ei=er.forEachDocumentKey($,er=>this.isPinned($,er,ee).next($=>{$||(et++,en.removeEntry(er,SnapshotVersion.min()))}));return ei.next(()=>en.apply($)).next(()=>et)}markPotentiallyOrphaned($,ee){return this.orphanedSequenceNumbers.set(ee,$.currentSequenceNumber),PersistencePromise.resolve()}removeTarget($,ee){let et=ee.withSequenceNumber($.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData($,et)}addReference($,ee,et){return this.orphanedSequenceNumbers.set(et,$.currentSequenceNumber),PersistencePromise.resolve()}removeReference($,ee,et){return this.orphanedSequenceNumbers.set(et,$.currentSequenceNumber),PersistencePromise.resolve()}updateLimboDocument($,ee){return this.orphanedSequenceNumbers.set(ee,$.currentSequenceNumber),PersistencePromise.resolve()}documentSize($){let ee=$.key.toString().length;return $.isFoundDocument()&&(ee+=estimateByteSize($.data.value)),ee}isPinned($,ee,et){return PersistencePromise.or([()=>this.persistence.mutationQueuesContainKey($,ee),()=>this.persistence.getTargetCache().containsKey($,ee),()=>{let $=this.orphanedSequenceNumbers.get(ee);return PersistencePromise.resolve(void 0!==$&&$>et)}])}getCacheSize($){return this.persistence.getRemoteDocumentCache().getSize($)}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let SchemaConverter=class SchemaConverter{constructor($){this.serializer=$}createOrUpgrade($,ee,et,er){let en=new SimpleDbTransaction("createOrUpgrade",ee);et<1&&er>=1&&(createPrimaryClientStore($),createMutationQueue($),createQueryCache($),createLegacyRemoteDocumentCache($));let ei=PersistencePromise.resolve();return et<3&&er>=3&&(0!==et&&(dropQueryCache($),createQueryCache($)),ei=ei.next(()=>writeEmptyTargetGlobalEntry(en))),et<4&&er>=4&&(0!==et&&(ei=ei.next(()=>upgradeMutationBatchSchemaAndMigrateData($,en))),ei=ei.next(()=>{createClientMetadataStore($)})),et<5&&er>=5&&(ei=ei.next(()=>this.removeAcknowledgedMutations(en))),et<6&&er>=6&&(ei=ei.next(()=>(createDocumentGlobalStore($),this.addDocumentGlobal(en)))),et<7&&er>=7&&(ei=ei.next(()=>this.ensureSequenceNumbers(en))),et<8&&er>=8&&(ei=ei.next(()=>this.createCollectionParentIndex($,en))),et<9&&er>=9&&(ei=ei.next(()=>{dropRemoteDocumentChangesStore($)})),et<10&&er>=10&&(ei=ei.next(()=>this.rewriteCanonicalIds(en))),et<11&&er>=11&&(ei=ei.next(()=>{createBundlesStore($),createNamedQueriesStore($)})),et<12&&er>=12&&(ei=ei.next(()=>{createDocumentOverlayStore($)})),et<13&&er>=13&&(ei=ei.next(()=>createRemoteDocumentCache($)).next(()=>this.rewriteRemoteDocumentCache($,en)).next(()=>$.deleteObjectStore(tH))),et<14&&er>=14&&(ei=ei.next(()=>this.runOverlayMigration($,en))),et<15&&er>=15&&(ei=ei.next(()=>createFieldIndex($))),ei}addDocumentGlobal($){let ee=0;return $.store(tH).iterate(($,et)=>{ee+=dbDocumentSize(et)}).next(()=>{let et={byteSize:ee};return $.store(rr).put(rn,et)})}removeAcknowledgedMutations($){let ee=$.store(tJ),et=$.store(tZ);return ee.loadAll().next(ee=>PersistencePromise.forEach(ee,ee=>{let er=IDBKeyRange.bound([ee.userId,r9],[ee.userId,ee.lastAcknowledgedBatchId]);return et.loadAll(t1,er).next(et=>PersistencePromise.forEach(et,et=>{hardAssert(et.userId===ee.userId);let er=fromDbMutationBatch(this.serializer,et);return removeMutationBatch($,ee.userId,er).next(()=>{})}))}))}ensureSequenceNumbers($){let ee=$.store(ru),et=$.store(tH),er=$.store(rg);return er.get(rm).next($=>{let writeSentinelKey=et=>ee.put({targetId:0,path:encodeResourcePath(et),sequenceNumber:$.highestListenSequenceNumber}),er=[];return et.iterate(($,et)=>{let en=new ResourcePath($),ei=sentinelKey(en);er.push(ee.get(ei).next($=>$?PersistencePromise.resolve():writeSentinelKey(en)))}).next(()=>PersistencePromise.waitFor(er))})}createCollectionParentIndex($,ee){$.createObjectStore(ry,{keyPath:rv});let et=ee.store(ry),er=new MemoryCollectionParentIndex,addEntry=$=>{if(er.add($)){let ee=$.lastSegment(),er=$.popLast();return et.put({collectionId:ee,parent:encodeResourcePath(er)})}};return ee.store(tH).iterate({keysOnly:!0},($,ee)=>{let et=new ResourcePath($);return addEntry(et.popLast())}).next(()=>ee.store(t6).iterate({keysOnly:!0},([$,ee,et],er)=>{let en=decodeResourcePath(ee);return addEntry(en.popLast())}))}rewriteCanonicalIds($){let ee=$.store(ri);return ee.iterate(($,et)=>{let er=fromDbTarget(et),en=toDbTarget(this.serializer,er);return ee.put(en)})}rewriteRemoteDocumentCache($,ee){let et=ee.store(tH),er=[];return et.iterate(($,et)=>{let en=ee.store(t4),ei=extractKey(et).path.toArray(),es={prefixPath:ei.slice(0,ei.length-2),collectionGroup:ei[ei.length-2],documentId:ei[ei.length-1],readTime:et.readTime||[0,0],unknownDocument:et.unknownDocument,noDocument:et.noDocument,document:et.document,hasCommittedMutations:!!et.hasCommittedMutations};er.push(en.put(es))}).next(()=>PersistencePromise.waitFor(er))}runOverlayMigration($,ee){let et=ee.store(tZ),er=newIndexedDbRemoteDocumentCache(this.serializer),en=new MemoryPersistence(MemoryEagerDelegate.factory,this.serializer.remoteSerializer);return et.loadAll().next($=>{let et=new Map;return $.forEach($=>{var ee;let er=null!==(ee=et.get($.userId))&&void 0!==ee?ee:documentKeySet(),en=fromDbMutationBatch(this.serializer,$);en.keys().forEach($=>er=er.add($)),et.set($.userId,er)}),PersistencePromise.forEach(et,($,et)=>{let ei=new User(et),es=IndexedDbDocumentOverlayCache.forUser(this.serializer,ei),eo=en.getIndexManager(ei),eu=IndexedDbMutationQueue.forUser(ei,this.serializer,eo,en.referenceDelegate),eh=new LocalDocumentsView(er,eu,es,eo);return eh.recalculateAndSaveOverlaysForDocumentKeys(new IndexedDbTransaction(ee,ListenSequence.INVALID),$).next()})})}};function sentinelKey($){return[0,encodeResourcePath($)]}function createPrimaryClientStore($){$.createObjectStore(tQ)}function createMutationQueue($){$.createObjectStore(tJ,{keyPath:tX});let ee=$.createObjectStore(tZ,{keyPath:t0,autoIncrement:!0});ee.createIndex(t1,t2,{unique:!0}),$.createObjectStore(t6)}function upgradeMutationBatchSchemaAndMigrateData($,ee){let et=ee.store(tZ);return et.loadAll().next(et=>{$.deleteObjectStore(tZ);let er=$.createObjectStore(tZ,{keyPath:t0,autoIncrement:!0});er.createIndex(t1,t2,{unique:!0});let en=ee.store(tZ),ei=et.map($=>en.put($));return PersistencePromise.waitFor(ei)})}function createLegacyRemoteDocumentCache($){$.createObjectStore(tH)}function createRemoteDocumentCache($){let ee=$.createObjectStore(t4,{keyPath:t9});ee.createIndex(t5,t8),ee.createIndex(t7,rt)}function createDocumentGlobalStore($){$.createObjectStore(rr)}function createQueryCache($){let ee=$.createObjectStore(ru,{keyPath:rh});ee.createIndex(rp,rf,{unique:!0});let et=$.createObjectStore(ri,{keyPath:rs});et.createIndex(ro,rl,{unique:!0}),$.createObjectStore(rg)}function dropQueryCache($){$.deleteObjectStore(ru),$.deleteObjectStore(ri),$.deleteObjectStore(rg)}function dropRemoteDocumentChangesStore($){$.objectStoreNames.contains("remoteDocumentChanges")&&$.deleteObjectStore("remoteDocumentChanges")}function writeEmptyTargetGlobalEntry($){let ee=$.store(rg),et={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:SnapshotVersion.min().toTimestamp(),targetCount:0};return ee.put(rm,et)}function createClientMetadataStore($){$.createObjectStore(rS,{keyPath:rC})}function createBundlesStore($){$.createObjectStore(rT,{keyPath:rE})}function createNamedQueriesStore($){$.createObjectStore(rw,{keyPath:rD})}function createFieldIndex($){let ee=$.createObjectStore(rI,{keyPath:rR,autoIncrement:!0});ee.createIndex(r_,rP,{unique:!1});let et=$.createObjectStore(rA,{keyPath:rx});et.createIndex(rO,rk,{unique:!1});let er=$.createObjectStore(rN,{keyPath:rM});er.createIndex(rF,rL,{unique:!1})}function createDocumentOverlayStore($){let ee=$.createObjectStore(rB,{keyPath:rV});ee.createIndex(rj,rU,{unique:!1}),ee.createIndex(rq,rz,{unique:!1})}function extractKey($){return $.document?new DocumentKey(ResourcePath.fromString($.document.name).popFirst(5)):$.noDocument?DocumentKey.fromSegments($.noDocument.path):$.unknownDocument?DocumentKey.fromSegments($.unknownDocument.path):fail()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let n0="IndexedDbPersistence",n3=null,n6=5e3,n4=4e3,n9=null,n5=null,n8="firestore_zombie",n7="main";let IndexedDbPersistence=class IndexedDbPersistence{constructor($,ee,et,er,en,ei,es,eo,eu,eh,ep=nX){if(this.allowTabSynchronization=$,this.persistenceKey=ee,this.clientId=et,this.queue=en,this.window=ei,this.document=es,this.sequenceNumberSyncer=eu,this.forceOwningTab=eh,this.schemaVersion=ep,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=$=>Promise.resolve(),!IndexedDbPersistence.isAvailable())throw new FirestoreError(t_.UNIMPLEMENTED,n5);this.referenceDelegate=new IndexedDbLruDelegateImpl(this,er),this.dbName=ee+n7,this.serializer=new LocalSerializer(eo),this.simpleDb=new SimpleDb(this.dbName,this.schemaVersion,new SchemaConverter(this.serializer)),this.targetCache=new IndexedDbTargetCache(this.referenceDelegate,this.serializer),this.remoteDocumentCache=newIndexedDbRemoteDocumentCache(this.serializer),this.bundleCache=new IndexedDbBundleCache,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===eh&&logError(n0,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new FirestoreError(t_.FAILED_PRECONDITION,n9);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",$=>this.targetCache.getHighestSequenceNumber($))}).then($=>{this.listenSequence=new ListenSequence($,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch($=>(this.simpleDb&&this.simpleDb.close(),Promise.reject($)))}setPrimaryStateListener($){return this.primaryStateListener=async ee=>{if(this.started)return $(ee)},$(this.isPrimary)}setDatabaseDeletedListener($){this.simpleDb.setVersionChangeListener(async ee=>{null===ee.newVersion&&await $()})}setNetworkEnabled($){this.networkEnabled!==$&&(this.networkEnabled=$,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",$=>{let ee=clientMetadataStore($);return ee.put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease($).next($=>{$||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary($)).next(ee=>this.isPrimary&&!ee?this.releasePrimaryLeaseIfHeld($).next(()=>!1):!!ee&&this.acquireOrExtendPrimaryLease($).next(()=>!0))}).catch($=>{if(isIndexedDbTransactionError($))return logDebug(n0,"Failed to extend owner lease: ",$),this.isPrimary;if(!this.allowTabSynchronization)throw $;return logDebug(n0,"Releasing owner lease after error during lease refresh",$),!1}).then($=>{this.isPrimary!==$&&this.queue.enqueueRetryable(()=>this.primaryStateListener($)),this.isPrimary=$})}verifyPrimaryLease($){let ee=primaryClientStore($);return ee.get(tY).next($=>PersistencePromise.resolve(this.isLocalClient($)))}removeClientMetadata($){let ee=clientMetadataStore($);return ee.delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,n3)){this.lastGarbageCollectionTime=Date.now();let $=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",$=>{let ee=getStore($,rS);return ee.loadAll().next($=>{let et=this.filterActiveClients($,n3),er=$.filter($=>-1===et.indexOf($));return PersistencePromise.forEach(er,$=>ee.delete($.clientId)).next(()=>er)})}).catch(()=>[]);if(this.webStorage)for(let ee of $)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(ee.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",n4,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient($){return!!$&&$.ownerId===this.clientId}canActAsPrimary($){if(this.forceOwningTab)return PersistencePromise.resolve(!0);let ee=primaryClientStore($);return ee.get(tY).next(ee=>{let et=null!==ee&&this.isWithinAge(ee.leaseTimestampMs,n6)&&!this.isClientZombied(ee.ownerId);if(et){if(this.isLocalClient(ee)&&this.networkEnabled)return!0;if(!this.isLocalClient(ee)){if(!ee.allowTabSynchronization)throw new FirestoreError(t_.FAILED_PRECONDITION,n9);return!1}}return!!this.networkEnabled&&!!this.inForeground||clientMetadataStore($).loadAll().next($=>{let ee=this.filterActiveClients($,n6).find($=>{if(this.clientId!==$.clientId){let ee=!this.networkEnabled&&$.networkEnabled,et=!this.inForeground&&$.inForeground,er=this.networkEnabled===$.networkEnabled;if(ee||et&&er)return!0}return!1});return void 0===ee})}).next($=>(this.isPrimary!==$&&logDebug(n0,`Client ${$?"is":"is not"} eligible for a primary lease.`),$))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[tQ,rS],$=>{let ee=new IndexedDbTransaction($,ListenSequence.INVALID);return this.releasePrimaryLeaseIfHeld(ee).next(()=>this.removeClientMetadata(ee))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients($,ee){return $.filter($=>this.isWithinAge($.updateTimeMs,ee)&&!this.isClientZombied($.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",$=>clientMetadataStore($).loadAll().next($=>this.filterActiveClients($,n3).map($=>$.clientId)))}get started(){return this._started}getMutationQueue($,ee){return IndexedDbMutationQueue.forUser($,this.serializer,ee,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager($){return new IndexedDbIndexManager($,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache($){return IndexedDbDocumentOverlayCache.forUser(this.serializer,$)}getBundleCache(){return this.bundleCache}runTransaction($,ee,et){let er;logDebug(n0,"Starting transaction:",$);let en="readonly"===ee?"readonly":"readwrite",ei=getObjectStores(this.schemaVersion);return this.simpleDb.runTransaction($,en,ei,en=>(er=new IndexedDbTransaction(en,this.listenSequence?this.listenSequence.next():ListenSequence.INVALID),"readwrite-primary"===ee)?this.verifyPrimaryLease(er).next($=>!!$||this.canActAsPrimary(er)).next(ee=>{if(!ee)throw logError(`Failed to obtain primary lease for action '${$}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new FirestoreError(t_.FAILED_PRECONDITION,tF);return et(er)}).next($=>this.acquireOrExtendPrimaryLease(er).next(()=>$)):this.verifyAllowTabSynchronization(er).next(()=>et(er))).then($=>(er.raiseOnCommittedEvent(),$))}verifyAllowTabSynchronization($){let ee=primaryClientStore($);return ee.get(tY).next($=>{let ee=null!==$&&this.isWithinAge($.leaseTimestampMs,n6)&&!this.isClientZombied($.ownerId);if(ee&&!this.isLocalClient($)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!$.allowTabSynchronization))throw new FirestoreError(t_.FAILED_PRECONDITION,n9)})}acquireOrExtendPrimaryLease($){let ee={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return primaryClientStore($).put(tY,ee)}static isAvailable(){return SimpleDb.isAvailable()}releasePrimaryLeaseIfHeld($){let ee=primaryClientStore($);return ee.get(tY).next($=>this.isLocalClient($)?(logDebug(n0,"Releasing primary lease."),ee.delete(tY)):PersistencePromise.resolve())}isWithinAge($,ee){let et=Date.now(),er=et-ee,en=et;return!($<er)&&(!($>en)||(logError(`Detected an update time that is in the future: ${$} > ${en}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var $;"function"==typeof(null===($=this.window)||void 0===$?void 0:$.addEventListener)&&(this.windowUnloadHandler=()=>{this.markClientZombied();let $=/(?:Version|Mobile)\/1[456]/;isSafari()&&(navigator.appVersion.match($)||navigator.userAgent.match($))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied($){var ee;try{let et=(null===(ee=this.webStorage)||void 0===ee?void 0:ee.getItem(this.zombiedClientLocalStorageKey($)))!==null;return logDebug(n0,`Client '${$}' ${et?"is":"is not"} zombied in LocalStorage`),et}catch($){return logError(n0,"Failed to get zombied client id.",$),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch($){logError("Failed to set zombie client id.",$)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch($){}}zombiedClientLocalStorageKey($){return`${n8}_${this.persistenceKey}_${$}`}};function primaryClientStore($){return getStore($,tQ)}function clientMetadataStore($){return getStore($,rS)}function indexedDbStoragePrefix($,ee){let et=$.projectId;return $.isDefaultDatabase||(et+="."+$.database),"firestore/"+ee+"/"+et+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function diffArrays($,ee,et,er,en){ee=[...ee],($=[...$]).sort(et),ee.sort(et);let ei=$.length,es=ee.length,eo=0,eu=0;for(;eo<es&&eu<ei;){let ei=et($[eu],ee[eo]);ei<0?en($[eu++]):ei>0?er(ee[eo++]):(eo++,eu++)}for(;eo<es;)er(ee[eo++]);for(;eu<ei;)en($[eu++])}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ie="LocalStore",ir=3e8;let LocalStoreImpl=class LocalStoreImpl{constructor($,ee,et,er){this.persistence=$,this.queryEngine=ee,this.serializer=er,this.targetDataByTarget=new SortedMap(primitiveComparator),this.targetIdByTarget=new ObjectMap($=>canonifyTarget($),targetEquals),this.collectionGroupReadTime=new Map,this.remoteDocuments=$.getRemoteDocumentCache(),this.targetCache=$.getTargetCache(),this.bundleCache=$.getBundleCache(),this.initializeUserComponents(et)}initializeUserComponents($){this.documentOverlayCache=this.persistence.getDocumentOverlayCache($),this.indexManager=this.persistence.getIndexManager($),this.mutationQueue=this.persistence.getMutationQueue($,this.indexManager),this.localDocuments=new LocalDocumentsView(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage($){return this.persistence.runTransaction("Collect garbage","readwrite-primary",ee=>$.collect(ee,this.targetDataByTarget))}};function newLocalStore($,ee,et,er){return new LocalStoreImpl($,ee,et,er)}async function localStoreHandleUserChange($,ee){let et=debugCast($),er=await et.persistence.runTransaction("Handle user change","readonly",$=>{let er;return et.mutationQueue.getAllMutationBatches($).next(en=>(er=en,et.initializeUserComponents(ee),et.mutationQueue.getAllMutationBatches($))).next(ee=>{let en=[],ei=[],es=documentKeySet();for(let $ of er)for(let ee of(en.push($.batchId),$.mutations))es=es.add(ee.key);for(let $ of ee)for(let ee of(ei.push($.batchId),$.mutations))es=es.add(ee.key);return et.localDocuments.getDocuments($,es).next($=>({affectedDocuments:$,removedBatchIds:en,addedBatchIds:ei}))})});return er}function localStoreWriteLocally($,ee){let et,er;let en=debugCast($),ei=Timestamp.now(),es=ee.reduce(($,ee)=>$.add(ee.key),documentKeySet());return en.persistence.runTransaction("Locally write mutations","readwrite",$=>{let eo=mutableDocumentMap(),eu=documentKeySet();return en.remoteDocuments.getEntries($,es).next($=>{(eo=$).forEach(($,ee)=>{ee.isValidDocument()||(eu=eu.add($))})}).next(()=>en.localDocuments.getOverlayedDocuments($,eo)).next(er=>{et=er;let es=[];for(let $ of ee){let ee=mutationExtractBaseValue($,et.get($.key).overlayedDocument);null!=ee&&es.push(new PatchMutation($.key,ee,extractFieldMask(ee.value.mapValue),Precondition.exists(!0)))}return en.mutationQueue.addMutationBatch($,ei,es,ee)}).next(ee=>{er=ee;let ei=ee.applyToLocalDocumentSet(et,eu);return en.documentOverlayCache.saveOverlays($,ee.batchId,ei)})}).then(()=>({batchId:er.batchId,changes:convertOverlayedDocumentMapToDocumentMap(et)}))}function localStoreAcknowledgeBatch($,ee){let et=debugCast($);return et.persistence.runTransaction("Acknowledge batch","readwrite-primary",$=>{let er=ee.batch.keys(),en=et.remoteDocuments.newChangeBuffer({trackRemovals:!0});return applyWriteToRemoteDocuments(et,$,ee,en).next(()=>en.apply($)).next(()=>et.mutationQueue.performConsistencyCheck($)).next(()=>et.documentOverlayCache.removeOverlaysForBatchId($,er,ee.batch.batchId)).next(()=>et.localDocuments.recalculateAndSaveOverlaysForDocumentKeys($,getKeysWithTransformResults(ee))).next(()=>et.localDocuments.getDocuments($,er))})}function getKeysWithTransformResults($){let ee=documentKeySet();for(let et=0;et<$.mutationResults.length;++et){let er=$.mutationResults[et];er.transformResults.length>0&&(ee=ee.add($.batch.mutations[et].key))}return ee}function localStoreRejectBatch($,ee){let et=debugCast($);return et.persistence.runTransaction("Reject batch","readwrite-primary",$=>{let er;return et.mutationQueue.lookupMutationBatch($,ee).next(ee=>(hardAssert(null!==ee),er=ee.keys(),et.mutationQueue.removeMutationBatch($,ee))).next(()=>et.mutationQueue.performConsistencyCheck($)).next(()=>et.documentOverlayCache.removeOverlaysForBatchId($,er,ee)).next(()=>et.localDocuments.recalculateAndSaveOverlaysForDocumentKeys($,er)).next(()=>et.localDocuments.getDocuments($,er))})}function localStoreGetHighestUnacknowledgedBatchId($){let ee=debugCast($);return ee.persistence.runTransaction("Get highest unacknowledged batch id","readonly",$=>ee.mutationQueue.getHighestUnacknowledgedBatchId($))}function localStoreGetLastRemoteSnapshotVersion($){let ee=debugCast($);return ee.persistence.runTransaction("Get last remote snapshot version","readonly",$=>ee.targetCache.getLastRemoteSnapshotVersion($))}function localStoreApplyRemoteEventToLocalCache($,ee){let et=debugCast($),er=ee.snapshotVersion,en=et.targetDataByTarget;return et.persistence.runTransaction("Apply remote event","readwrite-primary",$=>{let ei=et.remoteDocuments.newChangeBuffer({trackRemovals:!0});en=et.targetDataByTarget;let es=[];ee.targetChanges.forEach((ei,eo)=>{let eu=en.get(eo);if(!eu)return;es.push(et.targetCache.removeMatchingKeys($,ei.removedDocuments,eo).next(()=>et.targetCache.addMatchingKeys($,ei.addedDocuments,eo)));let eh=eu.withSequenceNumber($.currentSequenceNumber);null!==ee.targetMismatches.get(eo)?eh=eh.withResumeToken(ByteString.EMPTY_BYTE_STRING,SnapshotVersion.min()).withLastLimboFreeSnapshotVersion(SnapshotVersion.min()):ei.resumeToken.approximateByteSize()>0&&(eh=eh.withResumeToken(ei.resumeToken,er)),en=en.insert(eo,eh),shouldPersistTargetData(eu,eh,ei)&&es.push(et.targetCache.updateTargetData($,eh))});let eo=mutableDocumentMap(),eu=documentKeySet();if(ee.documentUpdates.forEach(er=>{ee.resolvedLimboDocuments.has(er)&&es.push(et.persistence.referenceDelegate.updateLimboDocument($,er))}),es.push(populateDocumentChangeBuffer($,ei,ee.documentUpdates).next($=>{eo=$.changedDocuments,eu=$.existenceChangedKeys})),!er.isEqual(SnapshotVersion.min())){let ee=et.targetCache.getLastRemoteSnapshotVersion($).next(ee=>et.targetCache.setTargetsMetadata($,$.currentSequenceNumber,er));es.push(ee)}return PersistencePromise.waitFor(es).next(()=>ei.apply($)).next(()=>et.localDocuments.getLocalViewOfDocuments($,eo,eu)).next(()=>eo)}).then($=>(et.targetDataByTarget=en,$))}function populateDocumentChangeBuffer($,ee,et){let er=documentKeySet(),en=documentKeySet();return et.forEach($=>er=er.add($)),ee.getEntries($,er).next($=>{let er=mutableDocumentMap();return et.forEach((et,ei)=>{let es=$.get(et);ei.isFoundDocument()!==es.isFoundDocument()&&(en=en.add(et)),ei.isNoDocument()&&ei.version.isEqual(SnapshotVersion.min())?(ee.removeEntry(et,ei.readTime),er=er.insert(et,ei)):!es.isValidDocument()||ei.version.compareTo(es.version)>0||0===ei.version.compareTo(es.version)&&es.hasPendingWrites?(ee.addEntry(ei),er=er.insert(et,ei)):logDebug(ie,"Ignoring outdated watch update for ",et,". Current version:",es.version," Watch version:",ei.version)}),{changedDocuments:er,existenceChangedKeys:en}})}function shouldPersistTargetData($,ee,et){if(0===$.resumeToken.approximateByteSize())return!0;let er=ee.snapshotVersion.toMicroseconds()-$.snapshotVersion.toMicroseconds();if(er>=ir)return!0;let en=et.addedDocuments.size+et.modifiedDocuments.size+et.removedDocuments.size;return en>0}async function localStoreNotifyLocalViewChanges($,ee){let et=debugCast($);try{await et.persistence.runTransaction("notifyLocalViewChanges","readwrite",$=>PersistencePromise.forEach(ee,ee=>PersistencePromise.forEach(ee.addedKeys,er=>et.persistence.referenceDelegate.addReference($,ee.targetId,er)).next(()=>PersistencePromise.forEach(ee.removedKeys,er=>et.persistence.referenceDelegate.removeReference($,ee.targetId,er)))))}catch($){if(isIndexedDbTransactionError($))logDebug(ie,"Failed to update sequence numbers: "+$);else throw $}for(let $ of ee){let ee=$.targetId;if(!$.fromCache){let $=et.targetDataByTarget.get(ee),er=$.snapshotVersion,en=$.withLastLimboFreeSnapshotVersion(er);et.targetDataByTarget=et.targetDataByTarget.insert(ee,en)}}}function localStoreGetNextMutationBatch($,ee){let et=debugCast($);return et.persistence.runTransaction("Get next mutation batch","readonly",$=>(void 0===ee&&(ee=r9),et.mutationQueue.getNextMutationBatchAfterBatchId($,ee)))}function localStoreReadDocument($,ee){let et=debugCast($);return et.persistence.runTransaction("read document","readonly",$=>et.localDocuments.getDocument($,ee))}function localStoreAllocateTarget($,ee){let et=debugCast($);return et.persistence.runTransaction("Allocate target","readwrite",$=>{let er;return et.targetCache.getTargetData($,ee).next(en=>en?(er=en,PersistencePromise.resolve(er)):et.targetCache.allocateTargetId($).next(en=>(er=new TargetData(ee,en,"TargetPurposeListen",$.currentSequenceNumber),et.targetCache.addTargetData($,er).next(()=>er))))}).then($=>{let er=et.targetDataByTarget.get($.targetId);return(null===er||$.snapshotVersion.compareTo(er.snapshotVersion)>0)&&(et.targetDataByTarget=et.targetDataByTarget.insert($.targetId,$),et.targetIdByTarget.set(ee,$.targetId)),$})}function localStoreGetTargetData($,ee,et){let er=debugCast($),en=er.targetIdByTarget.get(et);return void 0!==en?PersistencePromise.resolve(er.targetDataByTarget.get(en)):er.targetCache.getTargetData(ee,et)}async function localStoreReleaseTarget($,ee,et){let er=debugCast($),en=er.targetDataByTarget.get(ee),ei=et?"readwrite":"readwrite-primary";try{et||await er.persistence.runTransaction("Release target",ei,$=>er.persistence.referenceDelegate.removeTarget($,en))}catch($){if(isIndexedDbTransactionError($))logDebug(ie,`Failed to update sequence numbers for target ${ee}: ${$}`);else throw $}er.targetDataByTarget=er.targetDataByTarget.remove(ee),er.targetIdByTarget.delete(en.target)}function localStoreExecuteQuery($,ee,et){let er=debugCast($),en=SnapshotVersion.min(),ei=documentKeySet();return er.persistence.runTransaction("Execute query","readwrite",$=>localStoreGetTargetData(er,$,queryToTarget(ee)).next(ee=>{if(ee)return en=ee.lastLimboFreeSnapshotVersion,er.targetCache.getMatchingKeysForTargetId($,ee.targetId).next($=>{ei=$})}).next(()=>er.queryEngine.getDocumentsMatchingQuery($,ee,et?en:SnapshotVersion.min(),et?ei:documentKeySet())).next($=>(setMaxReadTime(er,queryCollectionGroup(ee),$),{documents:$,remoteKeys:ei})))}function applyWriteToRemoteDocuments($,ee,et,er){let en=et.batch,ei=en.keys(),es=PersistencePromise.resolve();return ei.forEach($=>{es=es.next(()=>er.getEntry(ee,$)).next(ee=>{let ei=et.docVersions.get($);hardAssert(null!==ei),0>ee.version.compareTo(ei)&&(en.applyToRemoteDocument(ee,et),ee.isValidDocument()&&(ee.setReadTime(et.commitVersion),er.addEntry(ee)))})}),es.next(()=>$.mutationQueue.removeMutationBatch(ee,en))}function localStoreLookupMutationDocuments($,ee){let et=debugCast($),er=debugCast(et.mutationQueue);return et.persistence.runTransaction("Lookup mutation documents","readonly",$=>er.lookupMutationKeys($,ee).next(ee=>ee?et.localDocuments.getDocuments($,ee):PersistencePromise.resolve(null)))}function localStoreRemoveCachedMutationBatchMetadata($,ee){let et=debugCast(debugCast($,LocalStoreImpl).mutationQueue);et.removeCachedMutationKeys(ee)}function localStoreGetActiveClients($){let ee=debugCast(debugCast($,LocalStoreImpl).persistence);return ee.getActiveClients()}function localStoreGetCachedTarget($,ee){let et=debugCast($),er=debugCast(et.targetCache),en=et.targetDataByTarget.get(ee);return en?Promise.resolve(en.target):et.persistence.runTransaction("Get target data","readonly",$=>er.getTargetDataForTarget($,ee).next($=>$?$.target:null))}function localStoreGetNewDocumentChanges($,ee){let et=debugCast($),er=et.collectionGroupReadTime.get(ee)||SnapshotVersion.min();return et.persistence.runTransaction("Get new document changes","readonly",$=>et.remoteDocuments.getAllFromCollectionGroup($,ee,newIndexOffsetSuccessorFromReadTime(er,tN),Number.MAX_SAFE_INTEGER)).then($=>(setMaxReadTime(et,ee,$),$))}function setMaxReadTime($,ee,et){let er=$.collectionGroupReadTime.get(ee)||SnapshotVersion.min();et.forEach(($,ee)=>{ee.readTime.compareTo(er)>0&&(er=ee.readTime)}),$.collectionGroupReadTime.set(ee,er)}function umbrellaTarget($){return queryToTarget(newQueryForPath(ResourcePath.fromString(`__bundle__/docs/${$}`)))}async function localStoreApplyBundledDocuments($,ee,et,er){let en=debugCast($),ei=documentKeySet(),es=mutableDocumentMap();for(let $ of et){let et=ee.toDocumentKey($.metadata.name);$.document&&(ei=ei.add(et));let er=ee.toMutableDocument($);er.setReadTime(ee.toSnapshotVersion($.metadata.readTime)),es=es.insert(et,er)}let eo=en.remoteDocuments.newChangeBuffer({trackRemovals:!0}),eu=await localStoreAllocateTarget(en,umbrellaTarget(er));return en.persistence.runTransaction("Apply bundle documents","readwrite",$=>populateDocumentChangeBuffer($,eo,es).next(ee=>(eo.apply($),ee)).next(ee=>en.targetCache.removeMatchingKeysForTargetId($,eu.targetId).next(()=>en.targetCache.addMatchingKeys($,ei,eu.targetId)).next(()=>en.localDocuments.getLocalViewOfDocuments($,ee.changedDocuments,ee.existenceChangedKeys)).next(()=>ee.changedDocuments)))}function localStoreHasNewerBundle($,ee){let et=debugCast($),er=fromVersion(ee.createTime);return et.persistence.runTransaction("hasNewerBundle","readonly",$=>et.bundleCache.getBundleMetadata($,ee.id)).then($=>!!$&&$.createTime.compareTo(er)>=0)}function localStoreSaveBundle($,ee){let et=debugCast($);return et.persistence.runTransaction("Save bundle","readwrite",$=>et.bundleCache.saveBundleMetadata($,ee))}async function localStoreSaveNamedQuery($,ee,et=documentKeySet()){let er=await localStoreAllocateTarget($,queryToTarget(fromBundledQuery(ee.bundledQuery))),en=debugCast($);return en.persistence.runTransaction("Save named query","readwrite",$=>{let ei=fromVersion(ee.readTime);if(er.snapshotVersion.compareTo(ei)>=0)return en.bundleCache.saveNamedQuery($,ee);let es=er.withResumeToken(ByteString.EMPTY_BYTE_STRING,ei);return en.targetDataByTarget=en.targetDataByTarget.insert(es.targetId,es),en.targetCache.updateTargetData($,es).next(()=>en.targetCache.removeMatchingKeysForTargetId($,er.targetId)).next(()=>en.targetCache.addMatchingKeys($,et,er.targetId)).next(()=>en.bundleCache.saveNamedQuery($,ee))})}function localStoreSetIndexAutoCreationEnabled($,ee){let et=debugCast($);et.queryEngine.indexAutoCreationEnabled=ee}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let QueryContext=class QueryContext{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount($){this._documentReadCount+=$}};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ii=100,is=8;let QueryEngine=class QueryEngine{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=ii,this.relativeIndexReadCostPerDocument=is}initialize($,ee){this.localDocumentsView=$,this.indexManager=ee,this.initialized=!0}getDocumentsMatchingQuery($,ee,et,er){let en={result:null};return this.performQueryUsingIndex($,ee).next($=>{en.result=$}).next(()=>{if(!en.result)return this.performQueryUsingRemoteKeys($,ee,er,et).next($=>{en.result=$})}).next(()=>{if(en.result)return;let et=new QueryContext;return this.executeFullCollectionScan($,ee,et).next(er=>{if(en.result=er,this.indexAutoCreationEnabled)return this.createCacheIndexes($,ee,et,er.size)})}).next(()=>en.result)}createCacheIndexes($,ee,et,er){return et.documentReadCount<this.indexAutoCreationMinCollectionSize?(getLogLevel()<=ep.in.DEBUG&&logDebug("QueryEngine","SDK will not create cache indexes for query:",stringifyQuery(ee),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),PersistencePromise.resolve()):(getLogLevel()<=ep.in.DEBUG&&logDebug("QueryEngine","Query:",stringifyQuery(ee),"scans",et.documentReadCount,"local documents and returns",er,"documents as results."),et.documentReadCount>this.relativeIndexReadCostPerDocument*er)?(getLogLevel()<=ep.in.DEBUG&&logDebug("QueryEngine","The SDK decides to create cache indexes for query:",stringifyQuery(ee),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes($,queryToTarget(ee))):PersistencePromise.resolve()}performQueryUsingIndex($,ee){if(queryMatchesAllDocuments(ee))return PersistencePromise.resolve(null);let et=queryToTarget(ee);return this.indexManager.getIndexType($,et).next(er=>0===er?null:(null!==ee.limit&&1===er&&(et=queryToTarget(ee=queryWithLimit(ee,null,"F"))),this.indexManager.getDocumentsMatchingTarget($,et).next(er=>{let en=documentKeySet(...er);return this.localDocumentsView.getDocuments($,en).next(er=>this.indexManager.getMinOffset($,et).next(et=>{let ei=this.applyQuery(ee,er);return this.needsRefill(ee,ei,en,et.readTime)?this.performQueryUsingIndex($,queryWithLimit(ee,null,"F")):this.appendRemainingResults($,ei,ee,et)}))})))}performQueryUsingRemoteKeys($,ee,et,er){return queryMatchesAllDocuments(ee)||er.isEqual(SnapshotVersion.min())?PersistencePromise.resolve(null):this.localDocumentsView.getDocuments($,et).next(en=>{let ei=this.applyQuery(ee,en);return this.needsRefill(ee,ei,et,er)?PersistencePromise.resolve(null):(getLogLevel()<=ep.in.DEBUG&&logDebug("QueryEngine","Re-using previous result from %s to execute query: %s",er.toString(),stringifyQuery(ee)),this.appendRemainingResults($,ei,ee,newIndexOffsetSuccessorFromReadTime(er,tN)).next($=>$))})}applyQuery($,ee){let et=new SortedSet(newQueryComparator($));return ee.forEach((ee,er)=>{queryMatches($,er)&&(et=et.add(er))}),et}needsRefill($,ee,et,er){if(null===$.limit)return!1;if(et.size!==ee.size)return!0;let en="F"===$.limitType?ee.last():ee.first();return!!en&&(en.hasPendingWrites||en.version.compareTo(er)>0)}executeFullCollectionScan($,ee,et){return getLogLevel()<=ep.in.DEBUG&&logDebug("QueryEngine","Using full collection scan to execute query:",stringifyQuery(ee)),this.localDocumentsView.getDocumentsMatchingQuery($,ee,IndexOffset.min(),et)}appendRemainingResults($,ee,et,er){return this.localDocumentsView.getDocumentsMatchingQuery($,et,er).next($=>(ee.forEach(ee=>{$=$.insert(ee.key,ee)}),$))}};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let io="firestore_clients";function createWebStorageClientStateKey($,ee){return`${io}_${$}_${ee}`}let il="firestore_mutations";function createWebStorageMutationBatchKey($,ee,et){let er=`${il}_${$}_${et}`;return ee.isAuthenticated()&&(er+=`_${ee.uid}`),er}let iu="firestore_targets";function createWebStorageQueryTargetMetadataKey($,ee){return`${iu}_${$}_${ee}`}let ih="firestore_online_state";function createWebStorageOnlineStateKey($){return`${ih}_${$}`}let ip="firestore_bundle_loaded_v2";function createBundleLoadedKey($){return`${ip}_${$}`}let im="firestore_sequence_number";function createWebStorageSequenceNumberKey($){return`${im}_${$}`}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ig="SharedClientState";let MutationMetadata=class MutationMetadata{constructor($,ee,et,er){this.user=$,this.batchId=ee,this.state=et,this.error=er}static fromWebStorageEntry($,ee,et){let er;let en=JSON.parse(et),ei="object"==typeof en&&-1!==["pending","acknowledged","rejected"].indexOf(en.state)&&(void 0===en.error||"object"==typeof en.error);return(ei&&en.error&&(ei="string"==typeof en.error.message&&"string"==typeof en.error.code)&&(er=new FirestoreError(en.error.code,en.error.message)),ei)?new MutationMetadata($,ee,en.state,er):(logError(ig,`Failed to parse mutation state for ID '${ee}': ${et}`),null)}toWebStorageJSON(){let $={state:this.state,updateTimeMs:Date.now()};return this.error&&($.error={code:this.error.code,message:this.error.message}),JSON.stringify($)}};let QueryTargetMetadata=class QueryTargetMetadata{constructor($,ee,et){this.targetId=$,this.state=ee,this.error=et}static fromWebStorageEntry($,ee){let et;let er=JSON.parse(ee),en="object"==typeof er&&-1!==["not-current","current","rejected"].indexOf(er.state)&&(void 0===er.error||"object"==typeof er.error);return(en&&er.error&&(en="string"==typeof er.error.message&&"string"==typeof er.error.code)&&(et=new FirestoreError(er.error.code,er.error.message)),en)?new QueryTargetMetadata($,er.state,et):(logError(ig,`Failed to parse target state for ID '${$}': ${ee}`),null)}toWebStorageJSON(){let $={state:this.state,updateTimeMs:Date.now()};return this.error&&($.error={code:this.error.code,message:this.error.message}),JSON.stringify($)}};let RemoteClientState=class RemoteClientState{constructor($,ee){this.clientId=$,this.activeTargetIds=ee}static fromWebStorageEntry($,ee){let et=JSON.parse(ee),er="object"==typeof et&&et.activeTargetIds instanceof Array,en=targetIdSet();for(let $=0;er&&$<et.activeTargetIds.length;++$)er=isSafeInteger(et.activeTargetIds[$]),en=en.add(et.activeTargetIds[$]);return er?new RemoteClientState($,en):(logError(ig,`Failed to parse client data for instance '${$}': ${ee}`),null)}};let SharedOnlineState=class SharedOnlineState{constructor($,ee){this.clientId=$,this.onlineState=ee}static fromWebStorageEntry($){let ee=JSON.parse($),et="object"==typeof ee&&-1!==["Unknown","Online","Offline"].indexOf(ee.onlineState)&&"string"==typeof ee.clientId;return et?new SharedOnlineState(ee.clientId,ee.onlineState):(logError(ig,`Failed to parse online state: ${$}`),null)}};let LocalClientState=class LocalClientState{constructor(){this.activeTargetIds=targetIdSet()}addQueryTarget($){this.activeTargetIds=this.activeTargetIds.add($)}removeQueryTarget($){this.activeTargetIds=this.activeTargetIds.delete($)}toWebStorageJSON(){let $={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify($)}};let WebStorageSharedClientState=class WebStorageSharedClientState{constructor($,ee,et,er,en){this.window=$,this.queue=ee,this.persistenceKey=et,this.localClientId=er,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new SortedMap(primitiveComparator),this.started=!1,this.earlyEvents=[];let ei=et.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=en,this.localClientStorageKey=createWebStorageClientStateKey(this.persistenceKey,this.localClientId),this.sequenceNumberKey=createWebStorageSequenceNumberKey(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new LocalClientState),this.clientStateKeyRe=RegExp(`^${io}_${ei}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${il}_${ei}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${iu}_${ei}_(\\d+)$`),this.onlineStateKey=createWebStorageOnlineStateKey(this.persistenceKey),this.bundleLoadedKey=createBundleLoadedKey(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable($){return!!($&&$.localStorage)}async start(){let $=await this.syncEngine.getActiveClients();for(let ee of $){if(ee===this.localClientId)continue;let $=this.getItem(createWebStorageClientStateKey(this.persistenceKey,ee));if($){let et=RemoteClientState.fromWebStorageEntry(ee,$);et&&(this.activeClients=this.activeClients.insert(et.clientId,et))}}this.persistClientState();let ee=this.storage.getItem(this.onlineStateKey);if(ee){let $=this.fromWebStorageOnlineState(ee);$&&this.handleOnlineStateEvent($)}for(let $ of this.earlyEvents)this.handleWebStorageEvent($);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber($){this.setItem(this.sequenceNumberKey,JSON.stringify($))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget($){let ee=!1;return this.activeClients.forEach((et,er)=>{er.activeTargetIds.has($)&&(ee=!0)}),ee}addPendingMutation($){this.persistMutationState($,"pending")}updateMutationState($,ee,et){this.persistMutationState($,ee,et),this.removeMutationState($)}addLocalQueryTarget($){let ee="not-current";if(this.isActiveQueryTarget($)){let et=this.storage.getItem(createWebStorageQueryTargetMetadataKey(this.persistenceKey,$));if(et){let er=QueryTargetMetadata.fromWebStorageEntry($,et);er&&(ee=er.state)}}return this.localClientState.addQueryTarget($),this.persistClientState(),ee}removeLocalQueryTarget($){this.localClientState.removeQueryTarget($),this.persistClientState()}isLocalQueryTarget($){return this.localClientState.activeTargetIds.has($)}clearQueryState($){this.removeItem(createWebStorageQueryTargetMetadataKey(this.persistenceKey,$))}updateQueryState($,ee,et){this.persistQueryTargetState($,ee,et)}handleUserChange($,ee,et){ee.forEach($=>{this.removeMutationState($)}),this.currentUser=$,et.forEach($=>{this.addPendingMutation($)})}setOnlineState($){this.persistOnlineState($)}notifyBundleLoaded($){this.persistBundleLoadedState($)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem($){let ee=this.storage.getItem($);return logDebug(ig,"READ",$,ee),ee}setItem($,ee){logDebug(ig,"SET",$,ee),this.storage.setItem($,ee)}removeItem($){logDebug(ig,"REMOVE",$),this.storage.removeItem($)}handleWebStorageEvent($){let ee=$;if(ee.storageArea===this.storage){if(logDebug(ig,"EVENT",ee.key,ee.newValue),ee.key===this.localClientStorageKey){logError("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(async()=>{if(!this.started){this.earlyEvents.push(ee);return}if(null!==ee.key){if(this.clientStateKeyRe.test(ee.key)){if(null!=ee.newValue){let $=this.fromWebStorageClientState(ee.key,ee.newValue);if($)return this.handleClientStateEvent($.clientId,$)}else{let $=this.fromWebStorageClientStateKey(ee.key);return this.handleClientStateEvent($,null)}}else if(this.mutationBatchKeyRe.test(ee.key)){if(null!==ee.newValue){let $=this.fromWebStorageMutationMetadata(ee.key,ee.newValue);if($)return this.handleMutationBatchEvent($)}}else if(this.queryTargetKeyRe.test(ee.key)){if(null!==ee.newValue){let $=this.fromWebStorageQueryTargetMetadata(ee.key,ee.newValue);if($)return this.handleQueryTargetEvent($)}}else if(ee.key===this.onlineStateKey){if(null!==ee.newValue){let $=this.fromWebStorageOnlineState(ee.newValue);if($)return this.handleOnlineStateEvent($)}}else if(ee.key===this.sequenceNumberKey){let $=fromWebStorageSequenceNumber(ee.newValue);$!==ListenSequence.INVALID&&this.sequenceNumberHandler($)}else if(ee.key===this.bundleLoadedKey){let $=this.fromWebStoreBundleLoadedState(ee.newValue);await Promise.all($.map($=>this.syncEngine.synchronizeWithChangedDocuments($)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState($,ee,et){let er=new MutationMetadata(this.currentUser,$,ee,et),en=createWebStorageMutationBatchKey(this.persistenceKey,this.currentUser,$);this.setItem(en,er.toWebStorageJSON())}removeMutationState($){let ee=createWebStorageMutationBatchKey(this.persistenceKey,this.currentUser,$);this.removeItem(ee)}persistOnlineState($){let ee={clientId:this.localClientId,onlineState:$};this.storage.setItem(this.onlineStateKey,JSON.stringify(ee))}persistQueryTargetState($,ee,et){let er=createWebStorageQueryTargetMetadataKey(this.persistenceKey,$),en=new QueryTargetMetadata($,ee,et);this.setItem(er,en.toWebStorageJSON())}persistBundleLoadedState($){let ee=JSON.stringify(Array.from($));this.setItem(this.bundleLoadedKey,ee)}fromWebStorageClientStateKey($){let ee=this.clientStateKeyRe.exec($);return ee?ee[1]:null}fromWebStorageClientState($,ee){let et=this.fromWebStorageClientStateKey($);return RemoteClientState.fromWebStorageEntry(et,ee)}fromWebStorageMutationMetadata($,ee){let et=this.mutationBatchKeyRe.exec($),er=Number(et[1]),en=void 0!==et[2]?et[2]:null;return MutationMetadata.fromWebStorageEntry(new User(en),er,ee)}fromWebStorageQueryTargetMetadata($,ee){let et=this.queryTargetKeyRe.exec($),er=Number(et[1]);return QueryTargetMetadata.fromWebStorageEntry(er,ee)}fromWebStorageOnlineState($){return SharedOnlineState.fromWebStorageEntry($)}fromWebStoreBundleLoadedState($){return JSON.parse($)}async handleMutationBatchEvent($){if($.user.uid!==this.currentUser.uid){logDebug(ig,`Ignoring mutation for non-active user ${$.user.uid}`);return}return this.syncEngine.applyBatchState($.batchId,$.state,$.error)}handleQueryTargetEvent($){return this.syncEngine.applyTargetState($.targetId,$.state,$.error)}handleClientStateEvent($,ee){let et=ee?this.activeClients.insert($,ee):this.activeClients.remove($),er=this.extractActiveQueryTargets(this.activeClients),en=this.extractActiveQueryTargets(et),ei=[],es=[];return en.forEach($=>{er.has($)||ei.push($)}),er.forEach($=>{en.has($)||es.push($)}),this.syncEngine.applyActiveTargetsChange(ei,es).then(()=>{this.activeClients=et})}handleOnlineStateEvent($){this.activeClients.get($.clientId)&&this.onlineStateHandler($.onlineState)}extractActiveQueryTargets($){let ee=targetIdSet();return $.forEach(($,et)=>{ee=ee.unionWith(et.activeTargetIds)}),ee}};function fromWebStorageSequenceNumber($){let ee=ListenSequence.INVALID;if(null!=$)try{let et=JSON.parse($);hardAssert("number"==typeof et),ee=et}catch($){logError(ig,"Failed to read sequence number from WebStorage",$)}return ee}let MemorySharedClientState=class MemorySharedClientState{constructor(){this.localState=new LocalClientState,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation($){}updateMutationState($,ee,et){}addLocalQueryTarget($){return this.localState.addQueryTarget($),this.queryState[$]||"not-current"}updateQueryState($,ee,et){this.queryState[$]=ee}removeLocalQueryTarget($){this.localState.removeQueryTarget($)}isLocalQueryTarget($){return this.localState.activeTargetIds.has($)}clearQueryState($){delete this.queryState[$]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget($){return this.localState.activeTargetIds.has($)}start(){return this.localState=new LocalClientState,Promise.resolve()}handleUserChange($,ee,et){}setOnlineState($){}shutdown(){}writeSequenceNumber($){}notifyBundleLoaded($){}};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let NoopConnectivityMonitor=class NoopConnectivityMonitor{addCallback($){}shutdown(){}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let StreamBridge=class StreamBridge{constructor($){this.sendFn=$.sendFn,this.closeFn=$.closeFn}onOpen($){this.wrappedOnOpen=$}onClose($){this.wrappedOnClose=$}onMessage($){this.wrappedOnMessage=$}close(){this.closeFn()}send($){this.sendFn($)}callOnOpen(){this.wrappedOnOpen()}callOnClose($){this.wrappedOnClose($)}callOnMessage($){this.wrappedOnMessage($)}};/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iy=null;function generateInitialUniqueDebugId(){let $=268435456,ee=2415919104,et=ee-$,er=Math.round(et*Math.random());return $+er}function generateUniqueDebugId(){return null===iy?iy=generateInitialUniqueDebugId():iy++,"0x"+iy.toString(16)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nodePromise($){return new Promise((ee,et)=>{$(($,er)=>{$?et($):ee(er)})})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iv="1.9.1",iS="GrpcConnection",iC=`gl-node/${process.versions.node} fire/${tI} grpc/${iv}`;function createMetadata($,ee,et,er){hardAssert(null===ee||"OAuth"===ee.type);let en=new tC.SF;return ee&&ee.headers.forEach(($,ee)=>en.set(ee,$)),et&&et.headers.forEach(($,ee)=>en.set(ee,$)),er&&en.set("X-Firebase-GMPID",er),en.set("X-Goog-Api-Client",iC),en.set("Google-Cloud-Resource-Prefix",$),en.set("x-goog-request-params",$),en}let GrpcConnection=class GrpcConnection{constructor($,ee){this.databaseInfo=ee,this.cachedStub=null,this.firestore=$.google.firestore.v1,this.databasePath=`projects/${ee.databaseId.projectId}/databases/${ee.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){logDebug(iS,"Creating Firestore stub.");let $=this.databaseInfo.ssl?tC.K9.createSsl():tC.K9.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,$)}return this.cachedStub}invokeRPC($,ee,et,er,en){let ei=generateUniqueDebugId(),es=this.ensureActiveStub(),eo=createMetadata(this.databasePath,er,en,this.databaseInfo.appId),eu=Object.assign({database:this.databasePath},et);return nodePromise(ee=>(logDebug(iS,`RPC '${$}' ${ei} invoked with request:`,et),es[$](eu,eo,(et,er)=>{et?(logDebug(iS,`RPC '${$}' ${ei} failed with error:`,et),ee(new FirestoreError(mapCodeFromRpcCode(et.code),et.message))):(logDebug(iS,`RPC '${$}' ${ei} completed with response:`,er),ee(void 0,er))})))}invokeStreamingRPC($,ee,et,er,en,ei){let es=generateUniqueDebugId(),eo=[],eu=new Deferred;logDebug(iS,`RPC '${$}' ${es} invoked (streaming) with request:`,et);let eh=this.ensureActiveStub(),ep=createMetadata(this.databasePath,er,en,this.databaseInfo.appId),ef=Object.assign(Object.assign({},et),{database:this.databasePath}),em=eh[$](ef,ep),eg=!1;return em.on("data",ee=>{logDebug(iS,`RPC ${$} ${es} received result:`,ee),eo.push(ee),void 0!==ei&&eo.length===ei&&(eg=!0,eu.resolve(eo))}),em.on("end",()=>{logDebug(iS,`RPC '${$}' ${es} completed.`),eg||(eg=!0,eu.resolve(eo))}),em.on("error",ee=>{logDebug(iS,`RPC '${$}' ${es} failed with error:`,ee);let et=mapCodeFromRpcCode(ee.code);eu.reject(new FirestoreError(et,ee.message))}),eu.promise}openStream($,ee,et){let er=generateUniqueDebugId(),en=this.ensureActiveStub(),ei=createMetadata(this.databasePath,ee,et,this.databaseInfo.appId),es=en[$](ei),eo=!1,close=$=>{eo||(eo=!0,eu.callOnClose($),es.end())},eu=new StreamBridge({sendFn:ee=>{if(eo)logDebug(iS,`RPC '${$}' stream ${er} not sending because gRPC stream is closed:`,ee);else{logDebug(iS,`RPC '${$}' stream ${er} sending:`,ee);try{es.write(ee)}catch($){throw logError("Failure sending:",ee),logError("Error:",$),$}}},closeFn:()=>{logDebug(iS,`RPC '${$}' stream ${er} closed locally via close().`),close()}});return es.on("data",ee=>{eo||(logDebug(iS,`RPC '${$}' stream ${er} received:`,ee),eu.callOnMessage(ee))}),es.on("end",()=>{logDebug(iS,`RPC '${$}' stream ${er} ended.`),close()}),es.on("error",ee=>{if(!eo){logWarn(iS,`RPC '${$}' stream ${er} error. Code:`,ee.code,"Message:",ee.message);let et=mapCodeFromRpcCode(ee.code);close(new FirestoreError(et,ee.message))}}),logDebug(iS,`Opening RPC '${$}' stream ${er} to ${this.databaseInfo.host}`),setTimeout(()=>{eu.callOnOpen()},0),eu}};let iT={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var iE={nested:iT},iw=Object.freeze({__proto__:null,nested:iT,default:iE});/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iD={longs:String,enums:String,defaults:!0,oneofs:!1};function loadProtos(){let $=tT.im(iw,iD);return tC.Rz($)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function newConnection($){let ee=loadProtos();return new GrpcConnection(ee,$)}function newConnectivityMonitor(){return new NoopConnectivityMonitor}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getWindow(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function getDocument(){return null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function newSerializer($){return new JsonProtoSerializer($,!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iI="ExponentialBackoff",iR=1e3,i_=1.5,iP=6e4;let ExponentialBackoff=class ExponentialBackoff{constructor($,ee,et=iR,er=i_,en=iP){this.queue=$,this.timerId=ee,this.initialDelayMs=et,this.backoffFactor=er,this.maxDelayMs=en,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun($){this.cancel();let ee=Math.floor(this.currentBaseMs+this.jitterDelayMs()),et=Math.max(0,Date.now()-this.lastAttemptTime),er=Math.max(0,ee-et);er>0&&logDebug(iI,`Backing off for ${er} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${ee} ms, last attempt: ${et} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,er,()=>(this.lastAttemptTime=Date.now(),$())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iA="PersistentStream",ix=6e4,iO=1e4;let PersistentStream=class PersistentStream{constructor($,ee,et,er,en,ei,es,eo){this.queue=$,this.idleTimerId=et,this.healthTimerId=er,this.connection=en,this.authCredentialsProvider=ei,this.appCheckCredentialsProvider=es,this.listener=eo,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.backoff=new ExponentialBackoff($,ee)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){if(4===this.state){this.performBackoff();return}this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,ix,()=>this.handleIdleCloseTimer()))}sendRequest($){this.cancelIdleCheck(),this.stream.send($)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close($,ee){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==$?this.backoff.reset():ee&&ee.code===t_.RESOURCE_EXHAUSTED?(logError(ee.toString()),logError("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):ee&&ee.code===t_.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=$,await this.listener.onClose(ee)}tearDown(){}auth(){this.state=1;let $=this.getCloseGuardedDispatcher(this.closeCount),ee=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([$,et])=>{this.closeCount===ee&&this.startStream($,et)},ee=>{$(()=>{let $=new FirestoreError(t_.UNKNOWN,"Fetching auth token failed: "+ee.message);return this.handleStreamClose($)})})}startStream($,ee){let et=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc($,ee),this.stream.onOpen(()=>{et(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,iO,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose($=>{et(()=>this.handleStreamClose($))}),this.stream.onMessage($=>{et(()=>this.onMessage($))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose($){return logDebug(iA,`close with error: ${$}`),this.stream=null,this.close(4,$)}getCloseGuardedDispatcher($){return ee=>{this.queue.enqueueAndForget(()=>this.closeCount===$?ee():(logDebug(iA,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}};let PersistentListenStream=class PersistentListenStream extends PersistentStream{constructor($,ee,et,er,en,ei){super($,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",ee,et,er,ei),this.serializer=en}startRpc($,ee){return this.connection.openStream("Listen",$,ee)}onMessage($){this.backoff.reset();let ee=fromWatchChange(this.serializer,$),et=versionFromListenResponse($);return this.listener.onWatchChange(ee,et)}watch($){let ee={};ee.database=getEncodedDatabaseId(this.serializer),ee.addTarget=toTarget(this.serializer,$);let et=toListenRequestLabels(this.serializer,$);et&&(ee.labels=et),this.sendRequest(ee)}unwatch($){let ee={};ee.database=getEncodedDatabaseId(this.serializer),ee.removeTarget=$,this.sendRequest(ee)}};let PersistentWriteStream=class PersistentWriteStream extends PersistentStream{constructor($,ee,et,er,en,ei){super($,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",ee,et,er,ei),this.serializer=en,this.handshakeComplete_=!1}get handshakeComplete(){return this.handshakeComplete_}start(){this.handshakeComplete_=!1,this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete_&&this.writeMutations([])}startRpc($,ee){return this.connection.openStream("Write",$,ee)}onMessage($){if(hardAssert(!!$.streamToken),this.lastStreamToken=$.streamToken,!this.handshakeComplete_)return hardAssert(!$.writeResults||0===$.writeResults.length),this.handshakeComplete_=!0,this.listener.onHandshakeComplete();{this.backoff.reset();let ee=fromWriteResults($.writeResults,$.commitTime),et=fromVersion($.commitTime);return this.listener.onMutationResult(et,ee)}}writeHandshake(){let $={};$.database=getEncodedDatabaseId(this.serializer),this.sendRequest($)}writeMutations($){let ee={streamToken:this.lastStreamToken,writes:$.map($=>toMutation(this.serializer,$))};this.sendRequest(ee)}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Datastore=class Datastore{};let DatastoreImpl=class DatastoreImpl extends Datastore{constructor($,ee,et,er){super(),this.authCredentials=$,this.appCheckCredentials=ee,this.connection=et,this.serializer=er,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new FirestoreError(t_.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC($,ee,et){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([er,en])=>this.connection.invokeRPC($,ee,et,er,en)).catch($=>{if("FirebaseError"===$.name)throw $.code===t_.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),$;throw new FirestoreError(t_.UNKNOWN,$.toString())})}invokeStreamingRPC($,ee,et,er){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([en,ei])=>this.connection.invokeStreamingRPC($,ee,et,en,ei,er)).catch($=>{if("FirebaseError"===$.name)throw $.code===t_.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),$;throw new FirestoreError(t_.UNKNOWN,$.toString())})}terminate(){this.terminated=!0}};function newDatastore($,ee,et,er){return new DatastoreImpl($,ee,et,er)}async function invokeCommitRpc($,ee){let et=debugCast($),er=getEncodedDatabaseId(et.serializer)+"/documents",en={writes:ee.map($=>toMutation(et.serializer,$))};await et.invokeRPC("Commit",er,en)}async function invokeBatchGetDocumentsRpc($,ee){let et=debugCast($),er=getEncodedDatabaseId(et.serializer)+"/documents",en={documents:ee.map($=>toName(et.serializer,$))},ei=await et.invokeStreamingRPC("BatchGetDocuments",er,en,ee.length),es=new Map;ei.forEach($=>{let ee=fromBatchGetDocumentsResponse(et.serializer,$);es.set(ee.key.toString(),ee)});let eo=[];return ee.forEach($=>{let ee=es.get($.toString());hardAssert(!!ee),eo.push(ee)}),eo}async function invokeRunAggregationQueryRpc($,ee,et){var er;let en=debugCast($),{request:ei,aliasMap:es}=toRunAggregationQueryRequest(en.serializer,queryToAggregateTarget(ee),et),eo=ei.parent;en.connection.shouldResourcePathBeIncludedInRequest||delete ei.parent;let eu=await en.invokeStreamingRPC("RunAggregationQuery",eo,ei,1),eh=eu.filter($=>!!$.result);hardAssert(1===eh.length);let ep=null===(er=eh[0].result)||void 0===er?void 0:er.aggregateFields,ef=Object.keys(ep).reduce(($,ee)=>($[es[ee]]=ep[ee],$),{});return ef}function newPersistentWriteStream($,ee,et){let er=debugCast($);return er.verifyInitialized(),new PersistentWriteStream(ee,er.connection,er.authCredentials,er.appCheckCredentials,er.serializer,et)}function newPersistentWatchStream($,ee,et){let er=debugCast($);return er.verifyInitialized(),new PersistentListenStream(ee,er.connection,er.authCredentials,er.appCheckCredentials,er.serializer,et)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ik="OnlineStateTracker",iN=1,iM=1e4;let OnlineStateTracker=class OnlineStateTracker{constructor($,ee){this.asyncQueue=$,this.onlineStateHandler=ee,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",iM,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${iM/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure($){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=iN&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${iN} times. Most recent error: ${$.toString()}`),this.setAndBroadcast("Offline")))}set($){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===$&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast($)}setAndBroadcast($){$!==this.state&&(this.state=$,this.onlineStateHandler($))}logClientOfflineWarningIfNecessary($){let ee=`Could not reach Cloud Firestore backend. ${$}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(logError(ee),this.shouldWarnClientIsOffline=!1):logDebug(ik,ee)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iF="RemoteStore",iL=10;let RemoteStoreImpl=class RemoteStoreImpl{constructor($,ee,et,er,en){this.localStore=$,this.datastore=ee,this.asyncQueue=et,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=en,this.connectivityMonitor.addCallback($=>{et.enqueueAndForget(async()=>{canUseNetwork(this)&&(logDebug(iF,"Restarting streams for network reachability change."),await restartNetwork(this))})}),this.onlineStateTracker=new OnlineStateTracker(et,er)}};function newRemoteStore($,ee,et,er,en){return new RemoteStoreImpl($,ee,et,er,en)}async function enableNetworkInternal($){if(canUseNetwork($))for(let ee of $.onNetworkStatusChange)await ee(!0)}async function disableNetworkInternal($){for(let ee of $.onNetworkStatusChange)await ee(!1)}async function remoteStoreShutdown($){let ee=debugCast($);logDebug(iF,"RemoteStore shutting down."),ee.offlineCauses.add(5),await disableNetworkInternal(ee),ee.connectivityMonitor.shutdown(),ee.onlineStateTracker.set("Unknown")}function remoteStoreListen($,ee){let et=debugCast($);!et.listenTargets.has(ee.targetId)&&(et.listenTargets.set(ee.targetId,ee),shouldStartWatchStream(et)?startWatchStream(et):ensureWatchStream(et).isOpen()&&sendWatchRequest(et,ee))}function remoteStoreUnlisten($,ee){let et=debugCast($),er=ensureWatchStream(et);et.listenTargets.delete(ee),er.isOpen()&&sendUnwatchRequest(et,ee),0===et.listenTargets.size&&(er.isOpen()?er.markIdle():canUseNetwork(et)&&et.onlineStateTracker.set("Unknown"))}function sendWatchRequest($,ee){if($.watchChangeAggregator.recordPendingTargetRequest(ee.targetId),ee.resumeToken.approximateByteSize()>0||ee.snapshotVersion.compareTo(SnapshotVersion.min())>0){let et=$.remoteSyncer.getRemoteKeysForTarget(ee.targetId).size;ee=ee.withExpectedCount(et)}ensureWatchStream($).watch(ee)}function sendUnwatchRequest($,ee){$.watchChangeAggregator.recordPendingTargetRequest(ee),ensureWatchStream($).unwatch(ee)}function startWatchStream($){$.watchChangeAggregator=new WatchChangeAggregator({getRemoteKeysForTarget:ee=>$.remoteSyncer.getRemoteKeysForTarget(ee),getTargetDataForTarget:ee=>$.listenTargets.get(ee)||null,getDatabaseId:()=>$.datastore.serializer.databaseId}),ensureWatchStream($).start(),$.onlineStateTracker.handleWatchStreamStart()}function shouldStartWatchStream($){return canUseNetwork($)&&!ensureWatchStream($).isStarted()&&$.listenTargets.size>0}function canUseNetwork($){let ee=debugCast($);return 0===ee.offlineCauses.size}function cleanUpWatchStreamState($){$.watchChangeAggregator=void 0}async function onWatchStreamOpen($){$.listenTargets.forEach((ee,et)=>{sendWatchRequest($,ee)})}async function onWatchStreamClose($,ee){cleanUpWatchStreamState($),shouldStartWatchStream($)?($.onlineStateTracker.handleWatchStreamFailure(ee),startWatchStream($)):$.onlineStateTracker.set("Unknown")}async function onWatchStreamChange($,ee,et){if($.onlineStateTracker.set("Online"),ee instanceof WatchTargetChange&&2===ee.state&&ee.cause){try{await handleTargetError($,ee)}catch(et){logDebug(iF,"Failed to remove targets %s: %s ",ee.targetIds.join(","),et),await disableNetworkUntilRecovery($,et)}return}if(ee instanceof DocumentWatchChange?$.watchChangeAggregator.handleDocumentChange(ee):ee instanceof ExistenceFilterChange?$.watchChangeAggregator.handleExistenceFilter(ee):$.watchChangeAggregator.handleTargetChange(ee),!et.isEqual(SnapshotVersion.min()))try{let ee=await localStoreGetLastRemoteSnapshotVersion($.localStore);et.compareTo(ee)>=0&&await raiseWatchSnapshot($,et)}catch(ee){logDebug(iF,"Failed to raise snapshot:",ee),await disableNetworkUntilRecovery($,ee)}}async function disableNetworkUntilRecovery($,ee,et){if(isIndexedDbTransactionError(ee))$.offlineCauses.add(1),await disableNetworkInternal($),$.onlineStateTracker.set("Offline"),et||(et=()=>localStoreGetLastRemoteSnapshotVersion($.localStore)),$.asyncQueue.enqueueRetryable(async()=>{logDebug(iF,"Retrying IndexedDB access"),await et(),$.offlineCauses.delete(1),await enableNetworkInternal($)});else throw ee}function executeWithRecovery($,ee){return ee().catch(et=>disableNetworkUntilRecovery($,et,ee))}function raiseWatchSnapshot($,ee){let et=$.watchChangeAggregator.createRemoteEvent(ee);return et.targetChanges.forEach((et,er)=>{if(et.resumeToken.approximateByteSize()>0){let en=$.listenTargets.get(er);en&&$.listenTargets.set(er,en.withResumeToken(et.resumeToken,ee))}}),et.targetMismatches.forEach((ee,et)=>{let er=$.listenTargets.get(ee);if(!er)return;$.listenTargets.set(ee,er.withResumeToken(ByteString.EMPTY_BYTE_STRING,er.snapshotVersion)),sendUnwatchRequest($,ee);let en=new TargetData(er.target,ee,et,er.sequenceNumber);sendWatchRequest($,en)}),$.remoteSyncer.applyRemoteEvent(et)}async function handleTargetError($,ee){let et=ee.cause;for(let er of ee.targetIds)$.listenTargets.has(er)&&(await $.remoteSyncer.rejectListen(er,et),$.listenTargets.delete(er),$.watchChangeAggregator.removeTarget(er))}async function fillWritePipeline($){let ee=debugCast($),et=ensureWriteStream(ee),er=ee.writePipeline.length>0?ee.writePipeline[ee.writePipeline.length-1].batchId:r9;for(;canAddToWritePipeline(ee);)try{let $=await localStoreGetNextMutationBatch(ee.localStore,er);if(null===$){0===ee.writePipeline.length&&et.markIdle();break}er=$.batchId,addToWritePipeline(ee,$)}catch($){await disableNetworkUntilRecovery(ee,$)}shouldStartWriteStream(ee)&&startWriteStream(ee)}function canAddToWritePipeline($){return canUseNetwork($)&&$.writePipeline.length<iL}function addToWritePipeline($,ee){$.writePipeline.push(ee);let et=ensureWriteStream($);et.isOpen()&&et.handshakeComplete&&et.writeMutations(ee.mutations)}function shouldStartWriteStream($){return canUseNetwork($)&&!ensureWriteStream($).isStarted()&&$.writePipeline.length>0}function startWriteStream($){ensureWriteStream($).start()}async function onWriteStreamOpen($){ensureWriteStream($).writeHandshake()}async function onWriteHandshakeComplete($){let ee=ensureWriteStream($);for(let et of $.writePipeline)ee.writeMutations(et.mutations)}async function onMutationResult($,ee,et){let er=$.writePipeline.shift(),en=MutationBatchResult.from(er,ee,et);await executeWithRecovery($,()=>$.remoteSyncer.applySuccessfulWrite(en)),await fillWritePipeline($)}async function onWriteStreamClose($,ee){ee&&ensureWriteStream($).handshakeComplete&&await handleWriteError($,ee),shouldStartWriteStream($)&&startWriteStream($)}async function handleWriteError($,ee){if(isPermanentWriteError(ee.code)){let et=$.writePipeline.shift();ensureWriteStream($).inhibitBackoff(),await executeWithRecovery($,()=>$.remoteSyncer.rejectFailedWrite(et.batchId,ee)),await fillWritePipeline($)}}async function restartNetwork($){let ee=debugCast($);ee.offlineCauses.add(4),await disableNetworkInternal(ee),ee.onlineStateTracker.set("Unknown"),ee.offlineCauses.delete(4),await enableNetworkInternal(ee)}async function remoteStoreHandleCredentialChange($,ee){let et=debugCast($);et.asyncQueue.verifyOperationInProgress(),logDebug(iF,"RemoteStore received new credentials");let er=canUseNetwork(et);et.offlineCauses.add(3),await disableNetworkInternal(et),er&&et.onlineStateTracker.set("Unknown"),await et.remoteSyncer.handleCredentialChange(ee),et.offlineCauses.delete(3),await enableNetworkInternal(et)}async function remoteStoreApplyPrimaryState($,ee){let et=debugCast($);ee?(et.offlineCauses.delete(2),await enableNetworkInternal(et)):ee||(et.offlineCauses.add(2),await disableNetworkInternal(et),et.onlineStateTracker.set("Unknown"))}function ensureWatchStream($){return $.watchStream||($.watchStream=newPersistentWatchStream($.datastore,$.asyncQueue,{onOpen:onWatchStreamOpen.bind(null,$),onClose:onWatchStreamClose.bind(null,$),onWatchChange:onWatchStreamChange.bind(null,$)}),$.onNetworkStatusChange.push(async ee=>{ee?($.watchStream.inhibitBackoff(),shouldStartWatchStream($)?startWatchStream($):$.onlineStateTracker.set("Unknown")):(await $.watchStream.stop(),cleanUpWatchStreamState($))})),$.watchStream}function ensureWriteStream($){return $.writeStream||($.writeStream=newPersistentWriteStream($.datastore,$.asyncQueue,{onOpen:onWriteStreamOpen.bind(null,$),onClose:onWriteStreamClose.bind(null,$),onHandshakeComplete:onWriteHandshakeComplete.bind(null,$),onMutationResult:onMutationResult.bind(null,$)}),$.onNetworkStatusChange.push(async ee=>{ee?($.writeStream.inhibitBackoff(),await fillWritePipeline($)):(await $.writeStream.stop(),$.writePipeline.length>0&&(logDebug(iF,`Stopping write stream with ${$.writePipeline.length} pending writes`),$.writePipeline=[]))})),$.writeStream}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iB="AsyncQueue";let DelayedOperation=class DelayedOperation{constructor($,ee,et,er,en){this.asyncQueue=$,this.timerId=ee,this.targetTimeMs=et,this.op=er,this.removalCallback=en,this.deferred=new Deferred,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch($=>{})}get promise(){return this.deferred.promise}static createAndSchedule($,ee,et,er,en){let ei=Date.now()+et,es=new DelayedOperation($,ee,ei,er,en);return es.start(et),es}start($){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),$)}skipDelay(){return this.handleDelayElapsed()}cancel($){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new FirestoreError(t_.CANCELLED,"Operation cancelled"+($?": "+$:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then($=>this.deferred.resolve($))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function wrapInUserErrorIfRecoverable($,ee){if(logError(iB,`${ee}: ${$}`),isIndexedDbTransactionError($))return new FirestoreError(t_.UNAVAILABLE,`${ee}: ${$}`);throw $}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let DocumentSet=class DocumentSet{constructor($){$?this.comparator=(ee,et)=>$(ee,et)||DocumentKey.comparator(ee.key,et.key):this.comparator=($,ee)=>DocumentKey.comparator($.key,ee.key),this.keyedMap=documentMap(),this.sortedSet=new SortedMap(this.comparator)}static emptySet($){return new DocumentSet($.comparator)}has($){return null!=this.keyedMap.get($)}get($){return this.keyedMap.get($)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf($){let ee=this.keyedMap.get($);return ee?this.sortedSet.indexOf(ee):-1}get size(){return this.sortedSet.size}forEach($){this.sortedSet.inorderTraversal((ee,et)=>($(ee),!1))}add($){let ee=this.delete($.key);return ee.copy(ee.keyedMap.insert($.key,$),ee.sortedSet.insert($,null))}delete($){let ee=this.get($);return ee?this.copy(this.keyedMap.remove($),this.sortedSet.remove(ee)):this}isEqual($){if(!($ instanceof DocumentSet)||this.size!==$.size)return!1;let ee=this.sortedSet.getIterator(),et=$.sortedSet.getIterator();for(;ee.hasNext();){let $=ee.getNext().key,er=et.getNext().key;if(!$.isEqual(er))return!1}return!0}toString(){let $=[];return(this.forEach(ee=>{$.push(ee.toString())}),0===$.length)?"DocumentSet ()":"DocumentSet (\n  "+$.join("  \n")+"\n)"}copy($,ee){let et=new DocumentSet;return et.comparator=this.comparator,et.keyedMap=$,et.sortedSet=ee,et}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let DocumentChangeSet=class DocumentChangeSet{constructor(){this.changeMap=new SortedMap(DocumentKey.comparator)}track($){let ee=$.doc.key,et=this.changeMap.get(ee);if(!et){this.changeMap=this.changeMap.insert(ee,$);return}0!==$.type&&3===et.type?this.changeMap=this.changeMap.insert(ee,$):3===$.type&&1!==et.type?this.changeMap=this.changeMap.insert(ee,{type:et.type,doc:$.doc}):2===$.type&&2===et.type?this.changeMap=this.changeMap.insert(ee,{type:2,doc:$.doc}):2===$.type&&0===et.type?this.changeMap=this.changeMap.insert(ee,{type:0,doc:$.doc}):1===$.type&&0===et.type?this.changeMap=this.changeMap.remove(ee):1===$.type&&2===et.type?this.changeMap=this.changeMap.insert(ee,{type:1,doc:et.doc}):0===$.type&&1===et.type?this.changeMap=this.changeMap.insert(ee,{type:2,doc:$.doc}):fail()}getChanges(){let $=[];return this.changeMap.inorderTraversal((ee,et)=>{$.push(et)}),$}};let ViewSnapshot=class ViewSnapshot{constructor($,ee,et,er,en,ei,es,eo,eu){this.query=$,this.docs=ee,this.oldDocs=et,this.docChanges=er,this.mutatedKeys=en,this.fromCache=ei,this.syncStateChanged=es,this.excludesMetadataChanges=eo,this.hasCachedResults=eu}static fromInitialDocuments($,ee,et,er,en){let ei=[];return ee.forEach($=>{ei.push({type:0,doc:$})}),new ViewSnapshot($,ee,DocumentSet.emptySet(ee),ei,et,er,!0,!1,en)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual($){if(this.fromCache!==$.fromCache||this.hasCachedResults!==$.hasCachedResults||this.syncStateChanged!==$.syncStateChanged||!this.mutatedKeys.isEqual($.mutatedKeys)||!queryEquals(this.query,$.query)||!this.docs.isEqual($.docs)||!this.oldDocs.isEqual($.oldDocs))return!1;let ee=this.docChanges,et=$.docChanges;if(ee.length!==et.length)return!1;for(let $=0;$<ee.length;$++)if(ee[$].type!==et[$].type||!ee[$].doc.isEqual(et[$].doc))return!1;return!0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let QueryListenersInfo=class QueryListenersInfo{constructor(){this.viewSnap=void 0,this.listeners=[]}};function newEventManager(){return new EventManagerImpl}let EventManagerImpl=class EventManagerImpl{constructor(){this.queries=new ObjectMap($=>canonifyQuery($),queryEquals),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}};async function eventManagerListen($,ee){let et=debugCast($),er=ee.query,en=!1,ei=et.queries.get(er);if(ei||(en=!0,ei=new QueryListenersInfo),en)try{ei.viewSnap=await et.onListen(er)}catch(et){let $=wrapInUserErrorIfRecoverable(et,`Initialization of query '${stringifyQuery(ee.query)}' failed`);ee.onError($);return}if(et.queries.set(er,ei),ei.listeners.push(ee),ee.applyOnlineStateChange(et.onlineState),ei.viewSnap){let $=ee.onViewSnapshot(ei.viewSnap);$&&raiseSnapshotsInSyncEvent(et)}}async function eventManagerUnlisten($,ee){let et=debugCast($),er=ee.query,en=!1,ei=et.queries.get(er);if(ei){let $=ei.listeners.indexOf(ee);$>=0&&(ei.listeners.splice($,1),en=0===ei.listeners.length)}if(en)return et.queries.delete(er),et.onUnlisten(er)}function eventManagerOnWatchChange($,ee){let et=debugCast($),er=!1;for(let $ of ee){let ee=$.query,en=et.queries.get(ee);if(en){for(let ee of en.listeners)ee.onViewSnapshot($)&&(er=!0);en.viewSnap=$}}er&&raiseSnapshotsInSyncEvent(et)}function eventManagerOnWatchError($,ee,et){let er=debugCast($),en=er.queries.get(ee);if(en)for(let $ of en.listeners)$.onError(et);er.queries.delete(ee)}function eventManagerOnOnlineStateChange($,ee){let et=debugCast($);et.onlineState=ee;let er=!1;et.queries.forEach(($,et)=>{for(let $ of et.listeners)$.applyOnlineStateChange(ee)&&(er=!0)}),er&&raiseSnapshotsInSyncEvent(et)}function raiseSnapshotsInSyncEvent($){$.snapshotsInSyncListeners.forEach($=>{$.next()})}let QueryListener=class QueryListener{constructor($,ee,et){this.query=$,this.queryObserver=ee,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=et||{}}onViewSnapshot($){if(!this.options.includeMetadataChanges){let ee=[];for(let et of $.docChanges)3!==et.type&&ee.push(et);$=new ViewSnapshot($.query,$.docs,$.oldDocs,ee,$.mutatedKeys,$.fromCache,$.syncStateChanged,!0,$.hasCachedResults)}let ee=!1;return this.raisedInitialEvent?this.shouldRaiseEvent($)&&(this.queryObserver.next($),ee=!0):this.shouldRaiseInitialEvent($,this.onlineState)&&(this.raiseInitialEvent($),ee=!0),this.snap=$,ee}onError($){this.queryObserver.error($)}applyOnlineStateChange($){this.onlineState=$;let ee=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,$)&&(this.raiseInitialEvent(this.snap),ee=!0),ee}shouldRaiseInitialEvent($,ee){if(!$.fromCache)return!0;let et="Offline"!==ee;return(!this.options.waitForSyncWhenOnline||!et)&&(!$.docs.isEmpty()||$.hasCachedResults||"Offline"===ee)}shouldRaiseEvent($){if($.docChanges.length>0)return!0;let ee=this.snap&&this.snap.hasPendingWrites!==$.hasPendingWrites;return(!!$.syncStateChanged||!!ee)&&!0===this.options.includeMetadataChanges}raiseInitialEvent($){$=ViewSnapshot.fromInitialDocuments($.query,$.docs,$.mutatedKeys,$.fromCache,$.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next($)}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let LocalViewChanges=class LocalViewChanges{constructor($,ee,et,er){this.targetId=$,this.fromCache=ee,this.addedKeys=et,this.removedKeys=er}static fromSnapshot($,ee){let et=documentKeySet(),er=documentKeySet();for(let $ of ee.docChanges)switch($.type){case 0:et=et.add($.doc.key);break;case 1:er=er.add($.doc.key)}return new LocalViewChanges($,ee.fromCache,et,er)}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let BundleConverterImpl=class BundleConverterImpl{constructor($){this.serializer=$}toDocumentKey($){return fromName(this.serializer,$)}toMutableDocument($){return $.metadata.exists?fromDocument(this.serializer,$.document,!1):MutableDocument.newNoDocument(this.toDocumentKey($.metadata.name),this.toSnapshotVersion($.metadata.readTime))}toSnapshotVersion($){return fromVersion($)}};let BundleLoader=class BundleLoader{constructor($,ee,et){this.bundleMetadata=$,this.localStore=ee,this.serializer=et,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=bundleInitialProgress($)}addSizedElement($){this.progress.bytesLoaded+=$.byteLength;let ee=this.progress.documentsLoaded;if($.payload.namedQuery)this.queries.push($.payload.namedQuery);else if($.payload.documentMetadata){this.documents.push({metadata:$.payload.documentMetadata}),!$.payload.documentMetadata.exists&&++ee;let et=ResourcePath.fromString($.payload.documentMetadata.name);this.collectionGroups.add(et.get(et.length-2))}else $.payload.document&&(this.documents[this.documents.length-1].document=$.payload.document,++ee);return ee!==this.progress.documentsLoaded?(this.progress.documentsLoaded=ee,Object.assign({},this.progress)):null}getQueryDocumentMapping($){let ee=new Map,et=new BundleConverterImpl(this.serializer);for(let er of $)if(er.metadata.queries){let $=et.toDocumentKey(er.metadata.name);for(let et of er.metadata.queries){let er=(ee.get(et)||documentKeySet()).add($);ee.set(et,er)}}return ee}async complete(){let $=await localStoreApplyBundledDocuments(this.localStore,new BundleConverterImpl(this.serializer),this.documents,this.bundleMetadata.id),ee=this.getQueryDocumentMapping(this.documents);for(let $ of this.queries)await localStoreSaveNamedQuery(this.localStore,$,ee.get($.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:$}}};function bundleInitialProgress($){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:$.totalDocuments,totalBytes:$.totalBytes}}function bundleSuccessProgress($){return{taskState:"Success",documentsLoaded:$.totalDocuments,bytesLoaded:$.totalBytes,totalDocuments:$.totalDocuments,totalBytes:$.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let AddedLimboDocument=class AddedLimboDocument{constructor($){this.key=$}};let RemovedLimboDocument=class RemovedLimboDocument{constructor($){this.key=$}};let View=class View{constructor($,ee){this.query=$,this._syncedDocuments=ee,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=documentKeySet(),this.mutatedKeys=documentKeySet(),this.docComparator=newQueryComparator($),this.documentSet=new DocumentSet(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges($,ee){let et=ee?ee.changeSet:new DocumentChangeSet,er=ee?ee.documentSet:this.documentSet,en=ee?ee.mutatedKeys:this.mutatedKeys,ei=er,es=!1,eo="F"===this.query.limitType&&er.size===this.query.limit?er.last():null,eu="L"===this.query.limitType&&er.size===this.query.limit?er.first():null;if($.inorderTraversal(($,ee)=>{let eh=er.get($),ep=queryMatches(this.query,ee)?ee:null,ef=!!eh&&this.mutatedKeys.has(eh.key),em=!!ep&&(ep.hasLocalMutations||this.mutatedKeys.has(ep.key)&&ep.hasCommittedMutations),eg=!1;if(eh&&ep){let $=eh.data.isEqual(ep.data);$?ef!==em&&(et.track({type:3,doc:ep}),eg=!0):!this.shouldWaitForSyncedDocument(eh,ep)&&(et.track({type:2,doc:ep}),eg=!0,(eo&&this.docComparator(ep,eo)>0||eu&&0>this.docComparator(ep,eu))&&(es=!0))}else!eh&&ep?(et.track({type:0,doc:ep}),eg=!0):eh&&!ep&&(et.track({type:1,doc:eh}),eg=!0,(eo||eu)&&(es=!0));eg&&(ep?(ei=ei.add(ep),en=em?en.add($):en.delete($)):(ei=ei.delete($),en=en.delete($)))}),null!==this.query.limit)for(;ei.size>this.query.limit;){let $="F"===this.query.limitType?ei.last():ei.first();ei=ei.delete($.key),en=en.delete($.key),et.track({type:1,doc:$})}return{documentSet:ei,changeSet:et,needsRefill:es,mutatedKeys:en}}shouldWaitForSyncedDocument($,ee){return $.hasLocalMutations&&ee.hasCommittedMutations&&!ee.hasLocalMutations}applyChanges($,ee,et){let er=this.documentSet;this.documentSet=$.documentSet,this.mutatedKeys=$.mutatedKeys;let en=$.changeSet.getChanges();en.sort(($,ee)=>compareChangeType($.type,ee.type)||this.docComparator($.doc,ee.doc)),this.applyTargetChange(et);let ei=ee?this.updateLimboDocuments():[],es=0===this.limboDocuments.size&&this.current,eo=es?1:0,eu=eo!==this.syncState;if(this.syncState=eo,0===en.length&&!eu)return{limboChanges:ei};{let ee=new ViewSnapshot(this.query,$.documentSet,er,en,$.mutatedKeys,0===eo,eu,!1,!!et&&et.resumeToken.approximateByteSize()>0);return{snapshot:ee,limboChanges:ei}}}applyOnlineStateChange($){return this.current&&"Offline"===$?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new DocumentChangeSet,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo($){return!this._syncedDocuments.has($)&&!!this.documentSet.has($)&&!this.documentSet.get($).hasLocalMutations}applyTargetChange($){$&&($.addedDocuments.forEach($=>this._syncedDocuments=this._syncedDocuments.add($)),$.modifiedDocuments.forEach($=>{}),$.removedDocuments.forEach($=>this._syncedDocuments=this._syncedDocuments.delete($)),this.current=$.current)}updateLimboDocuments(){if(!this.current)return[];let $=this.limboDocuments;this.limboDocuments=documentKeySet(),this.documentSet.forEach($=>{this.shouldBeInLimbo($.key)&&(this.limboDocuments=this.limboDocuments.add($.key))});let ee=[];return $.forEach($=>{this.limboDocuments.has($)||ee.push(new RemovedLimboDocument($))}),this.limboDocuments.forEach(et=>{$.has(et)||ee.push(new AddedLimboDocument(et))}),ee}synchronizeWithPersistedState($){this._syncedDocuments=$.remoteKeys,this.limboDocuments=documentKeySet();let ee=this.computeDocChanges($.documents);return this.applyChanges(ee,!0)}computeInitialSnapshot(){return ViewSnapshot.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}};function compareChangeType($,ee){let order=$=>{switch($){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return fail()}};return order($)-order(ee)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iV="SyncEngine";let QueryView=class QueryView{constructor($,ee,et){this.query=$,this.targetId=ee,this.view=et}};let LimboResolution=class LimboResolution{constructor($){this.key=$,this.receivedDocument=!1}};let SyncEngineImpl=class SyncEngineImpl{constructor($,ee,et,er,en,ei){this.localStore=$,this.remoteStore=ee,this.eventManager=et,this.sharedClientState=er,this.currentUser=en,this.maxConcurrentLimboResolutions=ei,this.syncEngineListener={},this.queryViewsByQuery=new ObjectMap($=>canonifyQuery($),queryEquals),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new SortedMap(DocumentKey.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new ReferenceSet,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=TargetIdGenerator.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}};function newSyncEngine($,ee,et,er,en,ei,es){let eo=new SyncEngineImpl($,ee,et,er,en,ei);return es&&(eo._isPrimaryClient=!0),eo}async function syncEngineListen($,ee){let et,er;let en=ensureWatchCallbacks($),ei=en.queryViewsByQuery.get(ee);if(ei)et=ei.targetId,en.sharedClientState.addLocalQueryTarget(et),er=ei.view.computeInitialSnapshot();else{let $=await localStoreAllocateTarget(en.localStore,queryToTarget(ee)),ei=en.sharedClientState.addLocalQueryTarget($.targetId);et=$.targetId,er=await initializeViewAndComputeSnapshot(en,ee,et,"current"===ei,$.resumeToken),en.isPrimaryClient&&remoteStoreListen(en.remoteStore,$)}return er}async function initializeViewAndComputeSnapshot($,ee,et,er,en){$.applyDocChanges=(ee,et,er)=>applyDocChanges($,ee,et,er);let ei=await localStoreExecuteQuery($.localStore,ee,!0),es=new View(ee,ei.remoteKeys),eo=es.computeDocChanges(ei.documents),eu=TargetChange.createSynthesizedTargetChangeForCurrentChange(et,er&&"Offline"!==$.onlineState,en),eh=es.applyChanges(eo,$.isPrimaryClient,eu);updateTrackedLimbos($,et,eh.limboChanges);let ep=new QueryView(ee,et,es);return $.queryViewsByQuery.set(ee,ep),$.queriesByTarget.has(et)?$.queriesByTarget.get(et).push(ee):$.queriesByTarget.set(et,[ee]),eh.snapshot}async function syncEngineUnlisten($,ee){let et=debugCast($),er=et.queryViewsByQuery.get(ee),en=et.queriesByTarget.get(er.targetId);if(en.length>1){et.queriesByTarget.set(er.targetId,en.filter($=>!queryEquals($,ee))),et.queryViewsByQuery.delete(ee);return}if(et.isPrimaryClient){et.sharedClientState.removeLocalQueryTarget(er.targetId);let $=et.sharedClientState.isActiveQueryTarget(er.targetId);$||await localStoreReleaseTarget(et.localStore,er.targetId,!1).then(()=>{et.sharedClientState.clearQueryState(er.targetId),remoteStoreUnlisten(et.remoteStore,er.targetId),removeAndCleanupTarget(et,er.targetId)}).catch(ignoreIfPrimaryLeaseLoss)}else removeAndCleanupTarget(et,er.targetId),await localStoreReleaseTarget(et.localStore,er.targetId,!0)}async function syncEngineWrite($,ee,et){let er=syncEngineEnsureWriteCallbacks($);try{let $=await localStoreWriteLocally(er.localStore,ee);er.sharedClientState.addPendingMutation($.batchId),addMutationCallback(er,$.batchId,et),await syncEngineEmitNewSnapsAndNotifyLocalStore(er,$.changes),await fillWritePipeline(er.remoteStore)}catch(ee){let $=wrapInUserErrorIfRecoverable(ee,"Failed to persist write");et.reject($)}}async function syncEngineApplyRemoteEvent($,ee){let et=debugCast($);try{let $=await localStoreApplyRemoteEventToLocalCache(et.localStore,ee);ee.targetChanges.forEach(($,ee)=>{let er=et.activeLimboResolutionsByTarget.get(ee);er&&(hardAssert($.addedDocuments.size+$.modifiedDocuments.size+$.removedDocuments.size<=1),$.addedDocuments.size>0?er.receivedDocument=!0:$.modifiedDocuments.size>0?hardAssert(er.receivedDocument):$.removedDocuments.size>0&&(hardAssert(er.receivedDocument),er.receivedDocument=!1))}),await syncEngineEmitNewSnapsAndNotifyLocalStore(et,$,ee)}catch($){await ignoreIfPrimaryLeaseLoss($)}}function syncEngineApplyOnlineStateChange($,ee,et){let er=debugCast($);if(er.isPrimaryClient&&0===et||!er.isPrimaryClient&&1===et){let $=[];er.queryViewsByQuery.forEach((et,er)=>{let en=er.view.applyOnlineStateChange(ee);en.snapshot&&$.push(en.snapshot)}),eventManagerOnOnlineStateChange(er.eventManager,ee),$.length&&er.syncEngineListener.onWatchChange($),er.onlineState=ee,er.isPrimaryClient&&er.sharedClientState.setOnlineState(ee)}}async function syncEngineRejectListen($,ee,et){let er=debugCast($);er.sharedClientState.updateQueryState(ee,"rejected",et);let en=er.activeLimboResolutionsByTarget.get(ee),ei=en&&en.key;if(ei){let $=new SortedMap(DocumentKey.comparator);$=$.insert(ei,MutableDocument.newNoDocument(ei,SnapshotVersion.min()));let et=documentKeySet().add(ei),en=new RemoteEvent(SnapshotVersion.min(),new Map,new SortedMap(primitiveComparator),$,et);await syncEngineApplyRemoteEvent(er,en),er.activeLimboTargetsByKey=er.activeLimboTargetsByKey.remove(ei),er.activeLimboResolutionsByTarget.delete(ee),pumpEnqueuedLimboResolutions(er)}else await localStoreReleaseTarget(er.localStore,ee,!1).then(()=>removeAndCleanupTarget(er,ee,et)).catch(ignoreIfPrimaryLeaseLoss)}async function syncEngineApplySuccessfulWrite($,ee){let et=debugCast($),er=ee.batch.batchId;try{let $=await localStoreAcknowledgeBatch(et.localStore,ee);processUserCallback(et,er,null),triggerPendingWritesCallbacks(et,er),et.sharedClientState.updateMutationState(er,"acknowledged"),await syncEngineEmitNewSnapsAndNotifyLocalStore(et,$)}catch($){await ignoreIfPrimaryLeaseLoss($)}}async function syncEngineRejectFailedWrite($,ee,et){let er=debugCast($);try{let $=await localStoreRejectBatch(er.localStore,ee);processUserCallback(er,ee,et),triggerPendingWritesCallbacks(er,ee),er.sharedClientState.updateMutationState(ee,"rejected",et),await syncEngineEmitNewSnapsAndNotifyLocalStore(er,$)}catch($){await ignoreIfPrimaryLeaseLoss($)}}function triggerPendingWritesCallbacks($,ee){($.pendingWritesCallbacks.get(ee)||[]).forEach($=>{$.resolve()}),$.pendingWritesCallbacks.delete(ee)}function rejectOutstandingPendingWritesCallbacks($,ee){$.pendingWritesCallbacks.forEach($=>{$.forEach($=>{$.reject(new FirestoreError(t_.CANCELLED,ee))})}),$.pendingWritesCallbacks.clear()}function addMutationCallback($,ee,et){let er=$.mutationUserCallbacks[$.currentUser.toKey()];er||(er=new SortedMap(primitiveComparator)),er=er.insert(ee,et),$.mutationUserCallbacks[$.currentUser.toKey()]=er}function processUserCallback($,ee,et){let er=debugCast($),en=er.mutationUserCallbacks[er.currentUser.toKey()];if(en){let $=en.get(ee);$&&(et?$.reject(et):$.resolve(),en=en.remove(ee)),er.mutationUserCallbacks[er.currentUser.toKey()]=en}}function removeAndCleanupTarget($,ee,et=null){for(let er of($.sharedClientState.removeLocalQueryTarget(ee),$.queriesByTarget.get(ee)))$.queryViewsByQuery.delete(er),et&&$.syncEngineListener.onWatchError(er,et);if($.queriesByTarget.delete(ee),$.isPrimaryClient){let et=$.limboDocumentRefs.removeReferencesForId(ee);et.forEach(ee=>{let et=$.limboDocumentRefs.containsKey(ee);et||removeLimboTarget($,ee)})}}function removeLimboTarget($,ee){$.enqueuedLimboResolutions.delete(ee.path.canonicalString());let et=$.activeLimboTargetsByKey.get(ee);null!==et&&(remoteStoreUnlisten($.remoteStore,et),$.activeLimboTargetsByKey=$.activeLimboTargetsByKey.remove(ee),$.activeLimboResolutionsByTarget.delete(et),pumpEnqueuedLimboResolutions($))}function updateTrackedLimbos($,ee,et){for(let er of et)if(er instanceof AddedLimboDocument)$.limboDocumentRefs.addReference(er.key,ee),trackLimboChange($,er);else if(er instanceof RemovedLimboDocument){logDebug(iV,"Document no longer in limbo: "+er.key),$.limboDocumentRefs.removeReference(er.key,ee);let et=$.limboDocumentRefs.containsKey(er.key);et||removeLimboTarget($,er.key)}else fail()}function trackLimboChange($,ee){let et=ee.key,er=et.path.canonicalString();$.activeLimboTargetsByKey.get(et)||$.enqueuedLimboResolutions.has(er)||(logDebug(iV,"New document in limbo: "+et),$.enqueuedLimboResolutions.add(er),pumpEnqueuedLimboResolutions($))}function pumpEnqueuedLimboResolutions($){for(;$.enqueuedLimboResolutions.size>0&&$.activeLimboTargetsByKey.size<$.maxConcurrentLimboResolutions;){let ee=$.enqueuedLimboResolutions.values().next().value;$.enqueuedLimboResolutions.delete(ee);let et=new DocumentKey(ResourcePath.fromString(ee)),er=$.limboTargetIdGenerator.next();$.activeLimboResolutionsByTarget.set(er,new LimboResolution(et)),$.activeLimboTargetsByKey=$.activeLimboTargetsByKey.insert(et,er),remoteStoreListen($.remoteStore,new TargetData(queryToTarget(newQueryForPath(et.path)),er,"TargetPurposeLimboResolution",ListenSequence.INVALID))}}async function syncEngineEmitNewSnapsAndNotifyLocalStore($,ee,et){let er=debugCast($),en=[],ei=[],es=[];er.queryViewsByQuery.isEmpty()||(er.queryViewsByQuery.forEach(($,eo)=>{es.push(er.applyDocChanges(eo,ee,et).then($=>{if(($||et)&&er.isPrimaryClient&&er.sharedClientState.updateQueryState(eo.targetId,(null==$?void 0:$.fromCache)?"not-current":"current"),$){en.push($);let ee=LocalViewChanges.fromSnapshot(eo.targetId,$);ei.push(ee)}}))}),await Promise.all(es),er.syncEngineListener.onWatchChange(en),await localStoreNotifyLocalViewChanges(er.localStore,ei))}async function applyDocChanges($,ee,et,er){let en=ee.view.computeDocChanges(et);en.needsRefill&&(en=await localStoreExecuteQuery($.localStore,ee.query,!1).then(({documents:$})=>ee.view.computeDocChanges($,en)));let ei=er&&er.targetChanges.get(ee.targetId),es=ee.view.applyChanges(en,$.isPrimaryClient,ei);return updateTrackedLimbos($,ee.targetId,es.limboChanges),es.snapshot}async function syncEngineHandleCredentialChange($,ee){let et=debugCast($),er=!et.currentUser.isEqual(ee);if(er){logDebug(iV,"User change. New user:",ee.toKey());let $=await localStoreHandleUserChange(et.localStore,ee);et.currentUser=ee,rejectOutstandingPendingWritesCallbacks(et,"'waitForPendingWrites' promise is rejected due to a user change."),et.sharedClientState.handleUserChange(ee,$.removedBatchIds,$.addedBatchIds),await syncEngineEmitNewSnapsAndNotifyLocalStore(et,$.affectedDocuments)}}function syncEngineGetRemoteKeysForTarget($,ee){let et=debugCast($),er=et.activeLimboResolutionsByTarget.get(ee);if(er&&er.receivedDocument)return documentKeySet().add(er.key);{let $=documentKeySet(),er=et.queriesByTarget.get(ee);if(!er)return $;for(let ee of er){let er=et.queryViewsByQuery.get(ee);$=$.unionWith(er.view.syncedDocuments)}return $}}async function synchronizeViewAndComputeSnapshot($,ee){let et=debugCast($),er=await localStoreExecuteQuery(et.localStore,ee.query,!0),en=ee.view.synchronizeWithPersistedState(er);return et.isPrimaryClient&&updateTrackedLimbos(et,ee.targetId,en.limboChanges),en}async function syncEngineSynchronizeWithChangedDocuments($,ee){let et=debugCast($);return localStoreGetNewDocumentChanges(et.localStore,ee).then($=>syncEngineEmitNewSnapsAndNotifyLocalStore(et,$))}async function syncEngineApplyBatchState($,ee,et,er){let en=debugCast($),ei=await localStoreLookupMutationDocuments(en.localStore,ee);if(null===ei){logDebug(iV,"Cannot apply mutation batch with id: "+ee);return}"pending"===et?await fillWritePipeline(en.remoteStore):"acknowledged"===et||"rejected"===et?(processUserCallback(en,ee,er||null),triggerPendingWritesCallbacks(en,ee),localStoreRemoveCachedMutationBatchMetadata(en.localStore,ee)):fail(),await syncEngineEmitNewSnapsAndNotifyLocalStore(en,ei)}async function syncEngineApplyPrimaryState($,ee){let et=debugCast($);if(ensureWatchCallbacks(et),syncEngineEnsureWriteCallbacks(et),!0===ee&&!0!==et._isPrimaryClient){let $=et.sharedClientState.getAllActiveQueryTargets(),ee=await synchronizeQueryViewsAndRaiseSnapshots(et,$.toArray());for(let $ of(et._isPrimaryClient=!0,await remoteStoreApplyPrimaryState(et.remoteStore,!0),ee))remoteStoreListen(et.remoteStore,$)}else if(!1===ee&&!1!==et._isPrimaryClient){let $=[],ee=Promise.resolve();et.queriesByTarget.forEach((er,en)=>{et.sharedClientState.isLocalQueryTarget(en)?$.push(en):ee=ee.then(()=>(removeAndCleanupTarget(et,en),localStoreReleaseTarget(et.localStore,en,!0))),remoteStoreUnlisten(et.remoteStore,en)}),await ee,await synchronizeQueryViewsAndRaiseSnapshots(et,$),resetLimboDocuments(et),et._isPrimaryClient=!1,await remoteStoreApplyPrimaryState(et.remoteStore,!1)}}function resetLimboDocuments($){let ee=debugCast($);ee.activeLimboResolutionsByTarget.forEach(($,et)=>{remoteStoreUnlisten(ee.remoteStore,et)}),ee.limboDocumentRefs.removeAllReferences(),ee.activeLimboResolutionsByTarget=new Map,ee.activeLimboTargetsByKey=new SortedMap(DocumentKey.comparator)}async function synchronizeQueryViewsAndRaiseSnapshots($,ee,et){let er=debugCast($),en=[],ei=[];for(let $ of ee){let ee;let et=er.queriesByTarget.get($);if(et&&0!==et.length)for(let $ of(ee=await localStoreAllocateTarget(er.localStore,queryToTarget(et[0])),et)){let ee=er.queryViewsByQuery.get($),et=await synchronizeViewAndComputeSnapshot(er,ee);et.snapshot&&ei.push(et.snapshot)}else{let et=await localStoreGetCachedTarget(er.localStore,$);ee=await localStoreAllocateTarget(er.localStore,et),await initializeViewAndComputeSnapshot(er,synthesizeTargetToQuery(et),$,!1,ee.resumeToken)}en.push(ee)}return er.syncEngineListener.onWatchChange(ei),en}function synthesizeTargetToQuery($){return newQuery($.path,$.collectionGroup,$.orderBy,$.filters,$.limit,"F",$.startAt,$.endAt)}function syncEngineGetActiveClients($){let ee=debugCast($);return localStoreGetActiveClients(ee.localStore)}async function syncEngineApplyTargetState($,ee,et,er){let en=debugCast($);if(en._isPrimaryClient){logDebug(iV,"Ignoring unexpected query state notification.");return}let ei=en.queriesByTarget.get(ee);if(ei&&ei.length>0)switch(et){case"current":case"not-current":{let $=await localStoreGetNewDocumentChanges(en.localStore,queryCollectionGroup(ei[0])),er=RemoteEvent.createSynthesizedRemoteEventForCurrentChange(ee,"current"===et,ByteString.EMPTY_BYTE_STRING);await syncEngineEmitNewSnapsAndNotifyLocalStore(en,$,er);break}case"rejected":await localStoreReleaseTarget(en.localStore,ee,!0),removeAndCleanupTarget(en,ee,er);break;default:fail()}}async function syncEngineApplyActiveTargetsChange($,ee,et){let er=ensureWatchCallbacks($);if(er._isPrimaryClient){for(let $ of ee){if(er.queriesByTarget.has($)){logDebug(iV,"Adding an already active target "+$);continue}let ee=await localStoreGetCachedTarget(er.localStore,$),et=await localStoreAllocateTarget(er.localStore,ee);await initializeViewAndComputeSnapshot(er,synthesizeTargetToQuery(ee),et.targetId,!1,et.resumeToken),remoteStoreListen(er.remoteStore,et)}for(let $ of et)er.queriesByTarget.has($)&&await localStoreReleaseTarget(er.localStore,$,!1).then(()=>{remoteStoreUnlisten(er.remoteStore,$),removeAndCleanupTarget(er,$)}).catch(ignoreIfPrimaryLeaseLoss)}}function ensureWatchCallbacks($){let ee=debugCast($);return ee.remoteStore.remoteSyncer.applyRemoteEvent=syncEngineApplyRemoteEvent.bind(null,ee),ee.remoteStore.remoteSyncer.getRemoteKeysForTarget=syncEngineGetRemoteKeysForTarget.bind(null,ee),ee.remoteStore.remoteSyncer.rejectListen=syncEngineRejectListen.bind(null,ee),ee.syncEngineListener.onWatchChange=eventManagerOnWatchChange.bind(null,ee.eventManager),ee.syncEngineListener.onWatchError=eventManagerOnWatchError.bind(null,ee.eventManager),ee}function syncEngineEnsureWriteCallbacks($){let ee=debugCast($);return ee.remoteStore.remoteSyncer.applySuccessfulWrite=syncEngineApplySuccessfulWrite.bind(null,ee),ee.remoteStore.remoteSyncer.rejectFailedWrite=syncEngineRejectFailedWrite.bind(null,ee),ee}async function loadBundleImpl($,ee,et){try{let er=await ee.getMetadata(),en=await localStoreHasNewerBundle($.localStore,er);if(en)return await ee.close(),et._completeWith(bundleSuccessProgress(er)),Promise.resolve(new Set);et._updateProgress(bundleInitialProgress(er));let ei=new BundleLoader(er,$.localStore,ee.serializer),es=await ee.nextElement();for(;es;){let $=await ei.addSizedElement(es);$&&et._updateProgress($),es=await ee.nextElement()}let eo=await ei.complete();return await syncEngineEmitNewSnapsAndNotifyLocalStore($,eo.changedDocs,void 0),await localStoreSaveBundle($.localStore,er),et._completeWith(eo.progress),Promise.resolve(eo.changedCollectionGroups)}catch($){return logWarn(iV,`Loading bundle failed with ${$}`),et._failWith($),Promise.resolve(new Set)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let MemoryOfflineComponentProvider=class MemoryOfflineComponentProvider{constructor(){this.synchronizeTabs=!1}async initialize($){this.serializer=newSerializer($.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState($),this.persistence=this.createPersistence($),await this.persistence.start(),this.localStore=this.createLocalStore($),this.gcScheduler=this.createGarbageCollectionScheduler($,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler($,this.localStore)}createGarbageCollectionScheduler($,ee){return null}createIndexBackfillerScheduler($,ee){return null}createLocalStore($){return newLocalStore(this.persistence,new QueryEngine,$.initialUser,this.serializer)}createPersistence($){return new MemoryPersistence(MemoryEagerDelegate.factory,this.serializer)}createSharedClientState($){return new MemorySharedClientState}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}};let IndexedDbOfflineComponentProvider=class IndexedDbOfflineComponentProvider extends null{constructor($,ee,et){super(),this.onlineComponentProvider=$,this.cacheSizeBytes=ee,this.forceOwnership=et,this.synchronizeTabs=!1}async initialize($){await super.initialize($),await this.onlineComponentProvider.initialize(this,$),await syncEngineEnsureWriteCallbacks(this.onlineComponentProvider.syncEngine),await fillWritePipeline(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore($){return newLocalStore(this.persistence,new QueryEngine,$.initialUser,this.serializer)}createGarbageCollectionScheduler($,ee){let et=this.persistence.referenceDelegate.garbageCollector;return new LruScheduler(et,$.asyncQueue,ee)}createIndexBackfillerScheduler($,ee){let et=new IndexBackfiller(ee,this.persistence);return new IndexBackfillerScheduler($.asyncQueue,et)}createPersistence($){let ee=indexedDbStoragePrefix($.databaseInfo.databaseId,$.databaseInfo.persistenceKey),et=void 0!==this.cacheSizeBytes?LruParams.withCacheSize(this.cacheSizeBytes):LruParams.DEFAULT;return new IndexedDbPersistence(this.synchronizeTabs,ee,$.clientId,et,$.asyncQueue,getWindow(),getDocument(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState($){return new MemorySharedClientState}};let OnlineComponentProvider=class OnlineComponentProvider{async initialize($,ee){this.localStore||(this.localStore=$.localStore,this.sharedClientState=$.sharedClientState,this.datastore=this.createDatastore(ee),this.remoteStore=this.createRemoteStore(ee),this.eventManager=this.createEventManager(ee),this.syncEngine=this.createSyncEngine(ee,!$.synchronizeTabs),this.sharedClientState.onlineStateHandler=$=>syncEngineApplyOnlineStateChange(this.syncEngine,$,1),this.remoteStore.remoteSyncer.handleCredentialChange=syncEngineHandleCredentialChange.bind(null,this.syncEngine),await remoteStoreApplyPrimaryState(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager($){return newEventManager()}createDatastore($){let ee=newSerializer($.databaseInfo.databaseId),et=newConnection($.databaseInfo);return newDatastore($.authCredentials,$.appCheckCredentials,et,ee)}createRemoteStore($){return newRemoteStore(this.localStore,this.datastore,$.asyncQueue,$=>syncEngineApplyOnlineStateChange(this.syncEngine,$,0),newConnectivityMonitor())}createSyncEngine($,ee){return newSyncEngine(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,$.initialUser,$.maxConcurrentLimboResolutions,ee)}terminate(){return remoteStoreShutdown(this.remoteStore)}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ij=10240;function toByteStreamReaderHelper($,ee=ij){let et=0,er={async read(){if(et<$.byteLength){let er={value:$.slice(et,et+ee),done:!1};return et+=ee,er}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()};return er}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function validateNonEmptyArgument($,ee,et){if(!et)throw new FirestoreError(t_.INVALID_ARGUMENT,`Function ${$}() cannot be called with an empty ${ee}.`)}function validateIsNotUsedTogether($,ee,et,er){if(!0===ee&&!0===er)throw new FirestoreError(t_.INVALID_ARGUMENT,`${$} and ${et} cannot be used together.`)}function validateDocumentPath($){if(!DocumentKey.isDocumentKey($))throw new FirestoreError(t_.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${$} has ${$.length}.`)}function validateCollectionPath($){if(DocumentKey.isDocumentKey($))throw new FirestoreError(t_.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${$} has ${$.length}.`)}function isPlainObject($){return"object"==typeof $&&null!==$&&(Object.getPrototypeOf($)===Object.prototype||null===Object.getPrototypeOf($))}function valueDescription($){if(void 0===$)return"undefined";if(null===$)return"null";if("string"==typeof $)return $.length>20&&($=`${$.substring(0,20)}...`),JSON.stringify($);if("number"==typeof $||"boolean"==typeof $)return""+$;if("object"==typeof $){if($ instanceof Array)return"an array";{let ee=tryGetCustomObjectType($);return ee?`a custom ${ee} object`:"an object"}}if("function"==typeof $)return"a function";return fail()}function tryGetCustomObjectType($){return $.constructor?$.constructor.name:null}function cast($,ee){if("_delegate"in $&&($=$._delegate),!($ instanceof ee)){if(ee.name===$.constructor.name)throw new FirestoreError(t_.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let et=valueDescription($);throw new FirestoreError(t_.INVALID_ARGUMENT,`Expected type '${ee.name}', but it was: ${et}`)}}return $}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function toByteStreamReader($,ee){if(!($ instanceof Uint8Array))throw new FirestoreError(t_.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${valueDescription($)}`);return toByteStreamReaderHelper($,ee)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let AsyncObserver=class AsyncObserver{constructor($){this.observer=$,this.muted=!1}next($){this.observer.next&&this.scheduleEvent(this.observer.next,$)}error($){this.observer.error?this.scheduleEvent(this.observer.error,$):logError("Uncaught Error in snapshot listener:",$.toString())}mute(){this.muted=!0}scheduleEvent($,ee){this.muted||setTimeout(()=>{this.muted||$(ee)},0)}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let SizedBundleElement=class SizedBundleElement{constructor($,ee){this.payload=$,this.byteLength=ee}isBundleMetadata(){return"metadata"in this.payload}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let BundleReaderImpl=class BundleReaderImpl{constructor($,ee){this.reader=$,this.serializer=ee,this.metadata=new Deferred,this.buffer=new Uint8Array,this.textDecoder=newTextDecoder(),this.nextElementImpl().then($=>{$&&$.isBundleMetadata()?this.metadata.resolve($.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(null==$?void 0:$.payload)}`))},$=>this.metadata.reject($))}close(){return this.reader.cancel()}async getMetadata(){return this.metadata.promise}async nextElement(){return await this.getMetadata(),this.nextElementImpl()}async nextElementImpl(){let $=await this.readLength();if(null===$)return null;let ee=this.textDecoder.decode($),et=Number(ee);isNaN(et)&&this.raiseError(`length string (${ee}) is not valid number`);let er=await this.readJsonString(et);return new SizedBundleElement(JSON.parse(er),$.length+et)}indexOfOpenBracket(){return this.buffer.findIndex($=>123===$)}async readLength(){for(;0>this.indexOfOpenBracket();){let $=await this.pullMoreDataToBuffer();if($)break}if(0===this.buffer.length)return null;let $=this.indexOfOpenBracket();$<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let ee=this.buffer.slice(0,$);return this.buffer=this.buffer.slice($),ee}async readJsonString($){for(;this.buffer.length<$;){let $=await this.pullMoreDataToBuffer();$&&this.raiseError("Reached the end of bundle when more is expected.")}let ee=this.textDecoder.decode(this.buffer.slice(0,$));return this.buffer=this.buffer.slice($),ee}raiseError($){throw this.reader.cancel(),Error(`Invalid bundle format: ${$}`)}async pullMoreDataToBuffer(){let $=await this.reader.read();if(!$.done){let ee=new Uint8Array(this.buffer.length+$.value.length);ee.set(this.buffer),ee.set($.value,this.buffer.length),this.buffer=ee}return $.done}};function newBundleReader($,ee){return new BundleReaderImpl($,ee)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Transaction$2=class Transaction$2{constructor($){this.datastore=$,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup($){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new FirestoreError(t_.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");let ee=await invokeBatchGetDocumentsRpc(this.datastore,$);return ee.forEach($=>this.recordVersion($)),ee}set($,ee){this.write(ee.toMutation($,this.precondition($))),this.writtenDocs.add($.toString())}update($,ee){try{this.write(ee.toMutation($,this.preconditionForUpdate($)))}catch($){this.lastWriteError=$}this.writtenDocs.add($.toString())}delete($){this.write(new DeleteMutation($,this.precondition($))),this.writtenDocs.add($.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;let $=this.readVersions;this.mutations.forEach(ee=>{$.delete(ee.key.toString())}),$.forEach(($,ee)=>{let et=DocumentKey.fromPath(ee);this.mutations.push(new VerifyMutation(et,this.precondition(et)))}),await invokeCommitRpc(this.datastore,this.mutations),this.committed=!0}recordVersion($){let ee;if($.isFoundDocument())ee=$.version;else if($.isNoDocument())ee=SnapshotVersion.min();else throw fail();let et=this.readVersions.get($.key.toString());if(et){if(!ee.isEqual(et))throw new FirestoreError(t_.ABORTED,"Document version changed between two reads.")}else this.readVersions.set($.key.toString(),ee)}precondition($){let ee=this.readVersions.get($.toString());return this.writtenDocs.has($.toString())||!ee?Precondition.none():ee.isEqual(SnapshotVersion.min())?Precondition.exists(!1):Precondition.updateTime(ee)}preconditionForUpdate($){let ee=this.readVersions.get($.toString());if(this.writtenDocs.has($.toString())||!ee)return Precondition.exists(!0);if(ee.isEqual(SnapshotVersion.min()))throw new FirestoreError(t_.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Precondition.updateTime(ee)}write($){this.ensureCommitNotCalled(),this.mutations.push($)}ensureCommitNotCalled(){}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iU="FirestoreClient",iq=100,iz=11,iK=20,iW=22;let FirestoreClient=class FirestoreClient{constructor($,ee,et,er){this.authCredentials=$,this.appCheckCredentials=ee,this.asyncQueue=et,this.databaseInfo=er,this.user=User.UNAUTHENTICATED,this.clientId=AutoId.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(et,async $=>{logDebug(iU,"Received user=",$.uid),await this.authCredentialListener($),this.user=$}),this.appCheckCredentials.start(et,$=>(logDebug(iU,"Received new app check token=",$),this.appCheckCredentialListener($,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:iq}}setCredentialChangeListener($){this.authCredentialListener=$}setAppCheckTokenChangeListener($){this.appCheckCredentialListener=$}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new FirestoreError(t_.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let $=new Deferred;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),$.resolve()}catch(et){let ee=wrapInUserErrorIfRecoverable(et,"Failed to shutdown persistence");$.reject(ee)}}),$.promise}};async function setOfflineComponentProvider($,ee){$.asyncQueue.verifyOperationInProgress(),logDebug(iU,"Initializing OfflineComponentProvider");let et=await $.getConfiguration();await ee.initialize(et);let er=et.initialUser;$.setCredentialChangeListener(async $=>{er.isEqual($)||(await localStoreHandleUserChange(ee.localStore,$),er=$)}),ee.persistence.setDatabaseDeletedListener(()=>$.terminate()),$._offlineComponents=ee}async function setOnlineComponentProvider($,ee){$.asyncQueue.verifyOperationInProgress();let et=await ensureOfflineComponents($);logDebug(iU,"Initializing OnlineComponentProvider");let er=await $.getConfiguration();await ee.initialize(et,er),$.setCredentialChangeListener($=>remoteStoreHandleCredentialChange(ee.remoteStore,$)),$.setAppCheckTokenChangeListener(($,et)=>remoteStoreHandleCredentialChange(ee.remoteStore,et)),$._onlineComponents=ee}function canFallbackFromIndexedDbError($){return"FirebaseError"===$.name?$.code===t_.FAILED_PRECONDITION||$.code===t_.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&$ instanceof DOMException)||$.code===iW||$.code===iK||$.code===iz}async function ensureOfflineComponents($){if(!$._offlineComponents){if($._uninitializedComponentsProvider){logDebug(iU,"Using user provided OfflineComponentProvider");try{await setOfflineComponentProvider($,$._uninitializedComponentsProvider._offline)}catch(et){let ee=et;if(!canFallbackFromIndexedDbError(ee))throw ee;logWarn("Error using user provided cache. Falling back to memory cache: "+ee),await setOfflineComponentProvider($,new MemoryOfflineComponentProvider)}}else logDebug(iU,"Using default OfflineComponentProvider"),await setOfflineComponentProvider($,new MemoryOfflineComponentProvider)}return $._offlineComponents}async function ensureOnlineComponents($){return $._onlineComponents||($._uninitializedComponentsProvider?(logDebug(iU,"Using user provided OnlineComponentProvider"),await setOnlineComponentProvider($,$._uninitializedComponentsProvider._online)):(logDebug(iU,"Using default OnlineComponentProvider"),await setOnlineComponentProvider($,new OnlineComponentProvider))),$._onlineComponents}function getLocalStore($){return ensureOfflineComponents($).then($=>$.localStore)}function getSyncEngine($){return ensureOnlineComponents($).then($=>$.syncEngine)}function getDatastore($){return ensureOnlineComponents($).then($=>$.datastore)}async function getEventManager($){let ee=await ensureOnlineComponents($),et=ee.eventManager;return et.onListen=syncEngineListen.bind(null,ee.syncEngine),et.onUnlisten=syncEngineUnlisten.bind(null,ee.syncEngine),et}function firestoreClientGetDocumentViaSnapshotListener($,ee,et={}){let er=new Deferred;return $.asyncQueue.enqueueAndForget(async()=>{let en=await getEventManager($);return readDocumentViaSnapshotListener(en,$.asyncQueue,ee,et,er)}),er.promise}function firestoreClientGetDocumentsViaSnapshotListener($,ee,et={}){let er=new Deferred;return $.asyncQueue.enqueueAndForget(async()=>{let en=await getEventManager($);return executeQueryViaSnapshotListener(en,$.asyncQueue,ee,et,er)}),er.promise}function firestoreClientWrite($,ee){let et=new Deferred;return $.asyncQueue.enqueueAndForget(async()=>{let er=await getSyncEngine($);return syncEngineWrite(er,ee,et)}),et.promise}function readDocumentViaSnapshotListener($,ee,et,er,en){let ei=new AsyncObserver({next:ei=>{ee.enqueueAndForget(()=>eventManagerUnlisten($,es));let eo=ei.docs.has(et);!eo&&ei.fromCache?en.reject(new FirestoreError(t_.UNAVAILABLE,"Failed to get document because the client is offline.")):eo&&ei.fromCache&&er&&"server"===er.source?en.reject(new FirestoreError(t_.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):en.resolve(ei)},error:$=>en.reject($)}),es=new QueryListener(newQueryForPath(et.path),ei,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return eventManagerListen($,es)}function executeQueryViaSnapshotListener($,ee,et,er,en){let ei=new AsyncObserver({next:et=>{ee.enqueueAndForget(()=>eventManagerUnlisten($,es)),et.fromCache&&"server"===er.source?en.reject(new FirestoreError(t_.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):en.resolve(et)},error:$=>en.reject($)}),es=new QueryListener(et,ei,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return eventManagerListen($,es)}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function longPollingOptionsEqual($,ee){return $.timeoutSeconds===ee.timeoutSeconds}function cloneLongPollingOptions($){let ee={};return void 0!==$.timeoutSeconds&&(ee.timeoutSeconds=$.timeoutSeconds),ee}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iG="ComponentProvider",i$=new Map;function removeComponents($){let ee=i$.get($);ee&&(logDebug(iG,"Removing Datastore"),i$.delete($),ee.terminate())}function makeDatabaseInfo($,ee,et,er){return new DatabaseInfo($,ee,et,er.host,er.ssl,er.experimentalForceLongPolling,er.experimentalAutoDetectLongPolling,cloneLongPollingOptions(er.experimentalLongPollingOptions),er.useFetchStreams)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iH="firestore.googleapis.com",iQ=!0,iY=5,iJ=30,iX=!0;let FirestoreSettingsImpl=class FirestoreSettingsImpl{constructor($){var ee,et;if(void 0===$.host){if(void 0!==$.ssl)throw new FirestoreError(t_.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=iH,this.ssl=iQ}else this.host=$.host,this.ssl=null!==(ee=$.ssl)&&void 0!==ee?ee:iQ;if(this.credentials=$.credentials,this.ignoreUndefinedProperties=!!$.ignoreUndefinedProperties,this.localCache=$.localCache,void 0===$.cacheSizeBytes)this.cacheSizeBytes=n$;else{if($.cacheSizeBytes!==nG&&$.cacheSizeBytes<nQ)throw new FirestoreError(t_.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${nQ}`);this.cacheSizeBytes=$.cacheSizeBytes}validateIsNotUsedTogether("experimentalForceLongPolling",$.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",$.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!$.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===$.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=iX:this.experimentalAutoDetectLongPolling=!!$.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=cloneLongPollingOptions(null!==(et=$.experimentalLongPollingOptions)&&void 0!==et?et:{}),validateLongPollingOptions(this.experimentalLongPollingOptions),this.useFetchStreams=!!$.useFetchStreams}isEqual($){return this.host===$.host&&this.ssl===$.ssl&&this.credentials===$.credentials&&this.cacheSizeBytes===$.cacheSizeBytes&&this.experimentalForceLongPolling===$.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===$.experimentalAutoDetectLongPolling&&longPollingOptionsEqual(this.experimentalLongPollingOptions,$.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===$.ignoreUndefinedProperties&&this.useFetchStreams===$.useFetchStreams}};function validateLongPollingOptions($){if(void 0!==$.timeoutSeconds){if(isNaN($.timeoutSeconds))throw new FirestoreError(t_.INVALID_ARGUMENT,`invalid long polling timeout: ${$.timeoutSeconds} (must not be NaN)`);if($.timeoutSeconds<iY)throw new FirestoreError(t_.INVALID_ARGUMENT,`invalid long polling timeout: ${$.timeoutSeconds} (minimum allowed value is ${iY})`);if($.timeoutSeconds>iJ)throw new FirestoreError(t_.INVALID_ARGUMENT,`invalid long polling timeout: ${$.timeoutSeconds} (maximum allowed value is ${iJ})`)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Firestore$1=class Firestore$1{constructor($,ee,et,er){this._authCredentials=$,this._appCheckCredentials=ee,this._databaseId=et,this._app=er,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new FirestoreSettingsImpl({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new FirestoreError(t_.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings($){if(this._settingsFrozen)throw new FirestoreError(t_.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new FirestoreSettingsImpl($),void 0!==$.credentials&&(this._authCredentials=makeAuthCredentialsProvider($.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return removeComponents(this),Promise.resolve()}};function connectFirestoreEmulator($,ee,et,er={}){var en;$=cast($,Firestore$1);let ei=$._getSettings(),es=`${ee}:${et}`;if(ei.host!==iH&&ei.host!==es&&logWarn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),$._setSettings(Object.assign(Object.assign({},ei),{host:es,ssl:!1})),er.mockUserToken){let ee,et;if("string"==typeof er.mockUserToken)ee=er.mockUserToken,et=User.MOCK_USER;else{ee=(0,em.Sg)(er.mockUserToken,null===(en=$._app)||void 0===en?void 0:en.options.projectId);let ei=er.mockUserToken.sub||er.mockUserToken.user_id;if(!ei)throw new FirestoreError(t_.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");et=new User(ei)}$._authCredentials=new EmulatorAuthCredentialsProvider(new OAuthToken(ee,et))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Query=class Query{constructor($,ee,et){this.converter=ee,this._query=et,this.type="query",this.firestore=$}withConverter($){return new Query(this.firestore,$,this._query)}};let DocumentReference=class DocumentReference{constructor($,ee,et){this.converter=ee,this._key=et,this.type="document",this.firestore=$}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new CollectionReference(this.firestore,this.converter,this._key.path.popLast())}withConverter($){return new DocumentReference(this.firestore,$,this._key)}};let CollectionReference=class CollectionReference extends Query{constructor($,ee,et){super($,ee,newQueryForPath(et)),this._path=et,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let $=this._path.popLast();return $.isEmpty()?null:new DocumentReference(this.firestore,null,new DocumentKey($))}withConverter($){return new CollectionReference(this.firestore,$,this._path)}};function collection($,ee,...et){if($=(0,em.m9)($),validateNonEmptyArgument("collection","path",ee),$ instanceof Firestore$1){let er=ResourcePath.fromString(ee,...et);return validateCollectionPath(er),new CollectionReference($,null,er)}{if(!($ instanceof DocumentReference)&&!($ instanceof CollectionReference))throw new FirestoreError(t_.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let er=$._path.child(ResourcePath.fromString(ee,...et));return validateCollectionPath(er),new CollectionReference($.firestore,null,er)}}function doc($,ee,...et){if($=(0,em.m9)($),1==arguments.length&&(ee=AutoId.newId()),validateNonEmptyArgument("doc","path",ee),$ instanceof Firestore$1){let er=ResourcePath.fromString(ee,...et);return validateDocumentPath(er),new DocumentReference($,null,new DocumentKey(er))}{if(!($ instanceof DocumentReference)&&!($ instanceof CollectionReference))throw new FirestoreError(t_.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let er=$._path.child(ResourcePath.fromString(ee,...et));return validateDocumentPath(er),new DocumentReference($.firestore,$ instanceof CollectionReference?$.converter:null,new DocumentKey(er))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let iZ="AsyncQueue";let AsyncQueueImpl=class AsyncQueueImpl{constructor(){this.tail=Promise.resolve(),this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new ExponentialBackoff(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()}}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget($){this.enqueue($)}enqueueAndForgetEvenWhileRestricted($){this.verifyNotFailed(),this.enqueueInternal($)}enterRestrictedMode($){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=$||!1)}enqueue($){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let ee=new Deferred;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():($().then(ee.resolve,ee.reject),ee.promise)).then(()=>ee.promise)}enqueueRetryable($){this.enqueueAndForget(()=>(this.retryableOps.push($),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch($){if(isIndexedDbTransactionError($))logDebug(iZ,"Operation failed with retryable error: "+$);else throw $}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal($){let ee=this.tail.then(()=>(this.operationInProgress=!0,$().catch($=>{this.failure=$,this.operationInProgress=!1;let ee=getMessageOrStack($);throw logError("INTERNAL UNHANDLED ERROR: ",ee),$}).then($=>(this.operationInProgress=!1,$))));return this.tail=ee,ee}enqueueAfterDelay($,ee,et){this.verifyNotFailed(),this.timerIdsToSkip.indexOf($)>-1&&(ee=0);let er=DelayedOperation.createAndSchedule(this,$,ee,et,$=>this.removeDelayedOperation($));return this.delayedOperations.push(er),er}verifyNotFailed(){this.failure&&fail()}verifyOperationInProgress(){}async drain(){let $;do $=this.tail,await $;while($!==this.tail)}containsDelayedOperation($){for(let ee of this.delayedOperations)if(ee.timerId===$)return!0;return!1}runAllDelayedOperationsUntil($){return this.drain().then(()=>{for(let ee of(this.delayedOperations.sort(($,ee)=>$.targetTimeMs-ee.targetTimeMs),this.delayedOperations))if(ee.skipDelay(),"all"!==$&&ee.timerId===$)break;return this.drain()})}skipDelaysForTimerId($){this.timerIdsToSkip.push($)}removeDelayedOperation($){let ee=this.delayedOperations.indexOf($);this.delayedOperations.splice(ee,1)}};function newAsyncQueue(){return new AsyncQueueImpl}function getMessageOrStack($){let ee=$.message||"";return $.stack&&(ee=$.stack.includes($.message)?$.stack:$.message+"\n"+$.stack),ee}let Firestore=class Firestore extends Firestore$1{constructor($,ee,et,er){super($,ee,et,er),this.type="firestore",this._queue=newAsyncQueue(),this._persistenceKey=(null==er?void 0:er.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||configureFirestore(this),this._firestoreClient.terminate()}};function getFirestore($,ee){let et="object"==typeof $?$:(0,eu.Mq)(),er="string"==typeof $?$:ee||r4,en=(0,eu.qX)(et,"firestore").getImmediate({identifier:er});if(!en._initialized){let $=(0,em.P0)("firestore");$&&connectFirestoreEmulator(en,...$)}return en}function ensureFirestoreConfigured($){return $._firestoreClient||configureFirestore($),$._firestoreClient.verifyNotTerminated(),$._firestoreClient}function configureFirestore($){var ee,et,er;let en=$._freezeSettings(),ei=makeDatabaseInfo($._databaseId,(null===(ee=$._app)||void 0===ee?void 0:ee.options.appId)||"",$._persistenceKey,en);$._firestoreClient=new FirestoreClient($._authCredentials,$._appCheckCredentials,$._queue,ei),(null===(et=en.localCache)||void 0===et?void 0:et._offlineComponentProvider)&&(null===(er=en.localCache)||void 0===er?void 0:er._onlineComponentProvider)&&($._firestoreClient._uninitializedComponentsProvider={_offlineKind:en.localCache.kind,_offline:en.localCache._offlineComponentProvider,_online:en.localCache._onlineComponentProvider})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function registerFirestore($,ee=!0){setSDKVersion(eu.Jn),(0,eu.Xd)(new eh.wA("firestore",($,{instanceIdentifier:et,options:er})=>{let en=$.getProvider("app").getImmediate(),ei=new Firestore(new FirebaseAuthCredentialsProvider($.getProvider("auth-internal")),new FirebaseAppCheckTokenProvider($.getProvider("app-check-internal")),databaseIdFromApp(en,et),en);return er=Object.assign({useFetchStreams:ee},er),ei._setSettings(er),ei},"PUBLIC").setMultipleInstances(!0)),(0,eu.KN)(tE,tw,$),(0,eu.KN)(tE,tw,"esm2017")}let AggregateQuerySnapshot=class AggregateQuerySnapshot{constructor($,ee,et){this._userDataWriter=ee,this._data=et,this.type="AggregateQuerySnapshot",this.query=$}data(){return this._userDataWriter.convertObjectMap(this._data)}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bytes=class Bytes{constructor($){this._byteString=$}static fromBase64String($){try{return new Bytes(ByteString.fromBase64String($))}catch($){throw new FirestoreError(t_.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+$)}}static fromUint8Array($){return new Bytes(ByteString.fromUint8Array($))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual($){return this._byteString.isEqual($._byteString)}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let FieldPath=class FieldPath{constructor(...$){for(let ee=0;ee<$.length;++ee)if(0===$[ee].length)throw new FirestoreError(t_.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new FieldPath$1($)}isEqual($){return this._internalPath.isEqual($._internalPath)}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let FieldValue=class FieldValue{constructor($){this._methodName=$}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let GeoPoint=class GeoPoint{constructor($,ee){if(!isFinite($)||$<-90||$>90)throw new FirestoreError(t_.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+$);if(!isFinite(ee)||ee<-180||ee>180)throw new FirestoreError(t_.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+ee);this._lat=$,this._long=ee}get latitude(){return this._lat}get longitude(){return this._long}isEqual($){return this._lat===$._lat&&this._long===$._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo($){return primitiveComparator(this._lat,$._lat)||primitiveComparator(this._long,$._long)}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let i0=/^__.*__$/;let ParsedSetData=class ParsedSetData{constructor($,ee,et){this.data=$,this.fieldMask=ee,this.fieldTransforms=et}toMutation($,ee){return null!==this.fieldMask?new PatchMutation($,this.data,this.fieldMask,ee,this.fieldTransforms):new SetMutation($,this.data,ee,this.fieldTransforms)}};let ParsedUpdateData=class ParsedUpdateData{constructor($,ee,et){this.data=$,this.fieldMask=ee,this.fieldTransforms=et}toMutation($,ee){return new PatchMutation($,this.data,this.fieldMask,ee,this.fieldTransforms)}};function isWrite($){switch($){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw fail()}}let ParseContextImpl=class ParseContextImpl{constructor($,ee,et,er,en,ei){this.settings=$,this.databaseId=ee,this.serializer=et,this.ignoreUndefinedProperties=er,void 0===en&&this.validatePath(),this.fieldTransforms=en||[],this.fieldMask=ei||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith($){return new ParseContextImpl(Object.assign(Object.assign({},this.settings),$),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField($){var ee;let et=null===(ee=this.path)||void 0===ee?void 0:ee.child($),er=this.contextWith({path:et,arrayElement:!1});return er.validatePathSegment($),er}childContextForFieldPath($){var ee;let et=null===(ee=this.path)||void 0===ee?void 0:ee.child($),er=this.contextWith({path:et,arrayElement:!1});return er.validatePath(),er}childContextForArray($){return this.contextWith({path:void 0,arrayElement:!0})}createError($){return createError($,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains($){return void 0!==this.fieldMask.find(ee=>$.isPrefixOf(ee))||void 0!==this.fieldTransforms.find(ee=>$.isPrefixOf(ee.field))}validatePath(){if(this.path)for(let $=0;$<this.path.length;$++)this.validatePathSegment(this.path.get($))}validatePathSegment($){if(0===$.length)throw this.createError("Document fields must not be empty");if(isWrite(this.dataSource)&&i0.test($))throw this.createError('Document fields cannot begin and end with "__"')}};let UserDataReader=class UserDataReader{constructor($,ee,et){this.databaseId=$,this.ignoreUndefinedProperties=ee,this.serializer=et||newSerializer($)}createContext($,ee,et,er=!1){return new ParseContextImpl({dataSource:$,methodName:ee,targetDoc:et,path:FieldPath$1.emptyPath(),arrayElement:!1,hasConverter:er},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function newUserDataReader($){let ee=$._freezeSettings(),et=newSerializer($._databaseId);return new UserDataReader($._databaseId,!!ee.ignoreUndefinedProperties,et)}function parseSetData($,ee,et,er,en,ei={}){let es,eo;let eu=$.createContext(ei.merge||ei.mergeFields?2:0,ee,et,en);validatePlainObject("Data must be an object, but it was:",eu,er);let eh=parseObject(er,eu);if(ei.merge)es=new FieldMask(eu.fieldMask),eo=eu.fieldTransforms;else if(ei.mergeFields){let $=[];for(let er of ei.mergeFields){let en=fieldPathFromArgument$1(ee,er,et);if(!eu.contains(en))throw new FirestoreError(t_.INVALID_ARGUMENT,`Field '${en}' is specified in your field mask but missing from your input data.`);fieldMaskContains($,en)||$.push(en)}es=new FieldMask($),eo=eu.fieldTransforms.filter($=>es.covers($.field))}else es=null,eo=eu.fieldTransforms;return new ParsedSetData(new ObjectValue(eh),es,eo)}let DeleteFieldValueImpl=class DeleteFieldValueImpl extends FieldValue{_toFieldTransform($){if(2===$.dataSource)$.fieldMask.push($.path);else if(1===$.dataSource)throw $.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw $.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual($){return $ instanceof DeleteFieldValueImpl}};let ServerTimestampFieldValueImpl=class ServerTimestampFieldValueImpl extends null{_toFieldTransform($){return new FieldTransform($.path,new ServerTimestampTransform)}isEqual($){return $ instanceof ServerTimestampFieldValueImpl}};function parseUpdateData($,ee,et,er){let en=$.createContext(1,ee,et);validatePlainObject("Data must be an object, but it was:",en,er);let ei=[],es=ObjectValue.empty();forEach(er,($,er)=>{let eo=fieldPathFromDotSeparatedString(ee,$,et);er=(0,em.m9)(er);let eu=en.childContextForFieldPath(eo);if(er instanceof DeleteFieldValueImpl)ei.push(eo);else{let $=parseData(er,eu);null!=$&&(ei.push(eo),es.set(eo,$))}});let eo=new FieldMask(ei);return new ParsedUpdateData(es,eo,en.fieldTransforms)}function parseUpdateVarargs($,ee,et,er,en,ei){let es=$.createContext(1,ee,et),eo=[fieldPathFromArgument$1(ee,er,et)],eu=[en];if(ei.length%2!=0)throw new FirestoreError(t_.INVALID_ARGUMENT,`Function ${ee}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let $=0;$<ei.length;$+=2)eo.push(fieldPathFromArgument$1(ee,ei[$])),eu.push(ei[$+1]);let eh=[],ep=ObjectValue.empty();for(let $=eo.length-1;$>=0;--$)if(!fieldMaskContains(eh,eo[$])){let ee=eo[$],et=eu[$];et=(0,em.m9)(et);let er=es.childContextForFieldPath(ee);if(et instanceof DeleteFieldValueImpl)eh.push(ee);else{let $=parseData(et,er);null!=$&&(eh.push(ee),ep.set(ee,$))}}let ef=new FieldMask(eh);return new ParsedUpdateData(ep,ef,es.fieldTransforms)}function parseQueryValue($,ee,et,er=!1){let en=$.createContext(er?4:3,ee),ei=parseData(et,en);return ei}function parseData($,ee){if(looksLikeJsonObject($=(0,em.m9)($)))return validatePlainObject("Unsupported field value:",ee,$),parseObject($,ee);if($ instanceof FieldValue)return parseSentinelFieldValue($,ee),null;if(void 0===$&&ee.ignoreUndefinedProperties)return null;if(ee.path&&ee.fieldMask.push(ee.path),!($ instanceof Array))return parseScalarValue($,ee);if(ee.settings.arrayElement&&4!==ee.dataSource)throw ee.createError("Nested arrays are not supported");return parseArray($,ee)}function parseObject($,ee){let et={};return isEmpty($)?ee.path&&ee.path.length>0&&ee.fieldMask.push(ee.path):forEach($,($,er)=>{let en=parseData(er,ee.childContextForField($));null!=en&&(et[$]=en)}),{mapValue:{fields:et}}}function parseArray($,ee){let et=[],er=0;for(let en of $){let $=parseData(en,ee.childContextForArray(er));null==$&&($={nullValue:"NULL_VALUE"}),et.push($),er++}return{arrayValue:{values:et}}}function parseSentinelFieldValue($,ee){if(!isWrite(ee.dataSource))throw ee.createError(`${$._methodName}() can only be used with update() and set()`);if(!ee.path)throw ee.createError(`${$._methodName}() is not currently supported inside arrays`);let et=$._toFieldTransform(ee);et&&ee.fieldTransforms.push(et)}function parseScalarValue($,ee){if(null===($=(0,em.m9)($)))return{nullValue:"NULL_VALUE"};if("number"==typeof $)return toNumber(ee.serializer,$);if("boolean"==typeof $)return{booleanValue:$};if("string"==typeof $)return{stringValue:$};if($ instanceof Date){let et=Timestamp.fromDate($);return{timestampValue:toTimestamp(ee.serializer,et)}}if($ instanceof Timestamp){let et=new Timestamp($.seconds,1e3*Math.floor($.nanoseconds/1e3));return{timestampValue:toTimestamp(ee.serializer,et)}}if($ instanceof GeoPoint)return{geoPointValue:{latitude:$.latitude,longitude:$.longitude}};else if($ instanceof Bytes)return{bytesValue:toBytes(ee.serializer,$._byteString)};else if($ instanceof DocumentReference){let et=ee.databaseId,er=$.firestore._databaseId;if(!er.isEqual(et))throw ee.createError(`Document reference is for database ${er.projectId}/${er.database} but should be for database ${et.projectId}/${et.database}`);return{referenceValue:toResourceName($.firestore._databaseId||ee.databaseId,$._key.path)}}else throw ee.createError(`Unsupported field value: ${valueDescription($)}`)}function looksLikeJsonObject($){return"object"==typeof $&&null!==$&&!($ instanceof Array)&&!($ instanceof Date)&&!($ instanceof Timestamp)&&!($ instanceof GeoPoint)&&!($ instanceof Bytes)&&!($ instanceof DocumentReference)&&!($ instanceof FieldValue)}function validatePlainObject($,ee,et){if(!looksLikeJsonObject(et)||!isPlainObject(et)){let er=valueDescription(et);if("an object"===er)throw ee.createError($+" a custom object");throw ee.createError($+" "+er)}}function fieldPathFromArgument$1($,ee,et){if((ee=(0,em.m9)(ee))instanceof FieldPath)return ee._internalPath;if("string"==typeof ee)return fieldPathFromDotSeparatedString($,ee);{let ee="Field path arguments must be of type string or ";throw createError(ee,$,!1,void 0,et)}}let i1=RegExp("[~\\*/\\[\\]]");function fieldPathFromDotSeparatedString($,ee,et){let er=ee.search(i1);if(er>=0)throw createError(`Invalid field path (${ee}). Paths must not contain '~', '*', '/', '[', or ']'`,$,!1,void 0,et);try{return new FieldPath(...ee.split("."))._internalPath}catch(er){throw createError(`Invalid field path (${ee}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,$,!1,void 0,et)}}function createError($,ee,et,er,en){let ei=er&&!er.isEmpty(),es=void 0!==en,eo=`Function ${ee}() called with invalid data`;et&&(eo+=" (via `toFirestore()`)"),eo+=". ";let eu="";return(ei||es)&&(eu+=" (found",ei&&(eu+=` in field ${er}`),es&&(eu+=` in document ${en}`),eu+=")"),new FirestoreError(t_.INVALID_ARGUMENT,eo+$+eu)}function fieldMaskContains($,ee){return $.some($=>$.isEqual(ee))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let DocumentSnapshot$1=class DocumentSnapshot$1{constructor($,ee,et,er,en){this._firestore=$,this._userDataWriter=ee,this._key=et,this._document=er,this._converter=en}get id(){return this._key.path.lastSegment()}get ref(){return new DocumentReference(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let $=new QueryDocumentSnapshot$1(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore($)}}}get($){if(this._document){let ee=this._document.data.field(fieldPathFromArgument("DocumentSnapshot.get",$));if(null!==ee)return this._userDataWriter.convertValue(ee)}}};let QueryDocumentSnapshot$1=class QueryDocumentSnapshot$1 extends DocumentSnapshot$1{data(){return super.data()}};function fieldPathFromArgument($,ee){return"string"==typeof ee?fieldPathFromDotSeparatedString($,ee):ee instanceof FieldPath?ee._internalPath:ee._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function validateHasExplicitOrderByForLimitToLast($){if("L"===$.limitType&&0===$.explicitOrderBy.length)throw new FirestoreError(t_.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}let AppliableConstraint=class AppliableConstraint{};let QueryConstraint=class QueryConstraint extends AppliableConstraint{};function query($,ee,...et){let er=[];for(let en of(ee instanceof AppliableConstraint&&er.push(ee),validateQueryConstraintArray(er=er.concat(et)),er))$=en._apply($);return $}let QueryFieldFilterConstraint=class QueryFieldFilterConstraint extends QueryConstraint{constructor($,ee,et){super(),this._field=$,this._op=ee,this._value=et,this.type="where"}static _create($,ee,et){return new QueryFieldFilterConstraint($,ee,et)}_apply($){let ee=this._parse($);return validateNewFieldFilter($._query,ee),new Query($.firestore,$.converter,queryWithAddedFilter($._query,ee))}_parse($){let ee=newUserDataReader($.firestore),et=newQueryFilter($._query,"where",ee,$.firestore._databaseId,this._field,this._op,this._value);return et}};let QueryCompositeFilterConstraint=class QueryCompositeFilterConstraint extends AppliableConstraint{constructor($,ee){super(),this.type=$,this._queryConstraints=ee}static _create($,ee){return new QueryCompositeFilterConstraint($,ee)}_parse($){let ee=this._queryConstraints.map(ee=>ee._parse($)).filter($=>$.getFilters().length>0);return 1===ee.length?ee[0]:CompositeFilter.create(ee,this._getOperator())}_apply($){let ee=this._parse($);return 0===ee.getFilters().length?$:(validateNewFilter($._query,ee),new Query($.firestore,$.converter,queryWithAddedFilter($._query,ee)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}};let QueryOrderByConstraint=class QueryOrderByConstraint extends QueryConstraint{constructor($,ee){super(),this._field=$,this._direction=ee,this.type="orderBy"}static _create($,ee){return new QueryOrderByConstraint($,ee)}_apply($){let ee=newQueryOrderBy($._query,this._field,this._direction);return new Query($.firestore,$.converter,queryWithAddedOrderBy($._query,ee))}};function orderBy($,ee="asc"){let et=ee,er=fieldPathFromArgument("orderBy",$);return QueryOrderByConstraint._create(er,et)}let QueryLimitConstraint=class QueryLimitConstraint extends null{constructor($,ee,et){super(),this.type=$,this._limit=ee,this._limitType=et}static _create($,ee,et){return new QueryLimitConstraint($,ee,et)}_apply($){return new Query($.firestore,$.converter,queryWithLimit($._query,this._limit,this._limitType))}};let QueryStartAtConstraint=class QueryStartAtConstraint extends null{constructor($,ee,et){super(),this.type=$,this._docOrFields=ee,this._inclusive=et}static _create($,ee,et){return new QueryStartAtConstraint($,ee,et)}_apply($){let ee=newQueryBoundFromDocOrFields($,this.type,this._docOrFields,this._inclusive);return new Query($.firestore,$.converter,queryWithStartAt($._query,ee))}};let QueryEndAtConstraint=class QueryEndAtConstraint extends null{constructor($,ee,et){super(),this.type=$,this._docOrFields=ee,this._inclusive=et}static _create($,ee,et){return new QueryEndAtConstraint($,ee,et)}_apply($){let ee=newQueryBoundFromDocOrFields($,this.type,this._docOrFields,this._inclusive);return new Query($.firestore,$.converter,queryWithEndAt($._query,ee))}};function newQueryBoundFromDocOrFields($,ee,et,er){if(et[0]=getModularInstance(et[0]),et[0]instanceof DocumentSnapshot$1)return newQueryBoundFromDocument($._query,$.firestore._databaseId,ee,et[0]._document,er);{let en=newUserDataReader($.firestore);return newQueryBoundFromFields($._query,$.firestore._databaseId,en,ee,et,er)}}function newQueryFilter($,ee,et,er,en,ei,es){let eo;if(en.isKeyField()){if("array-contains"===ei||"array-contains-any"===ei)throw new FirestoreError(t_.INVALID_ARGUMENT,`Invalid Query. You can't perform '${ei}' queries on documentId().`);if("in"===ei||"not-in"===ei){validateDisjunctiveFilterElements(es,ei);let ee=[];for(let et of es)ee.push(parseDocumentIdValue(er,$,et));eo={arrayValue:{values:ee}}}else eo=parseDocumentIdValue(er,$,es)}else("in"===ei||"not-in"===ei||"array-contains-any"===ei)&&validateDisjunctiveFilterElements(es,ei),eo=parseQueryValue(et,ee,es,"in"===ei||"not-in"===ei);let eu=FieldFilter.create(en,ei,eo);return eu}function newQueryOrderBy($,ee,et){if(null!==$.startAt)throw new FirestoreError(t_.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==$.endAt)throw new FirestoreError(t_.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");let er=new OrderBy(ee,et);return validateNewOrderBy($,er),er}function newQueryBoundFromDocument($,ee,et,er,en){if(!er)throw new FirestoreError(t_.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${et}().`);let ei=[];for(let et of queryNormalizedOrderBy($))if(et.field.isKeyField())ei.push(refValue(ee,er.key));else{let $=er.data.field(et.field);if(isServerTimestamp($))throw new FirestoreError(t_.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+et.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null!==$)ei.push($);else{let $=et.field.canonicalString();throw new FirestoreError(t_.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${$}' (used as the orderBy) does not exist.`)}}return new Bound(ei,en)}function newQueryBoundFromFields($,ee,et,er,en,ei){let es=$.explicitOrderBy;if(en.length>es.length)throw new FirestoreError(t_.INVALID_ARGUMENT,`Too many arguments provided to ${er}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let eo=[];for(let ei=0;ei<en.length;ei++){let eu=en[ei],eh=es[ei];if(eh.field.isKeyField()){if("string"!=typeof eu)throw new FirestoreError(t_.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${er}(), but got a ${typeof eu}`);if(!isCollectionGroupQuery($)&&-1!==eu.indexOf("/"))throw new FirestoreError(t_.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${er}() must be a plain document ID, but '${eu}' contains a slash.`);let et=$.path.child(ResourcePath.fromString(eu));if(!DocumentKey.isDocumentKey(et))throw new FirestoreError(t_.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${er}() must result in a valid document path, but '${et}' is not because it contains an odd number of segments.`);let en=new DocumentKey(et);eo.push(refValue(ee,en))}else{let $=parseQueryValue(et,er,eu);eo.push($)}}return new Bound(eo,ei)}function parseDocumentIdValue($,ee,et){if("string"==typeof(et=(0,em.m9)(et))){if(""===et)throw new FirestoreError(t_.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!isCollectionGroupQuery(ee)&&-1!==et.indexOf("/"))throw new FirestoreError(t_.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${et}' contains a '/' character.`);let er=ee.path.child(ResourcePath.fromString(et));if(!DocumentKey.isDocumentKey(er))throw new FirestoreError(t_.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${er}' is not because it has an odd number of segments (${er.length}).`);return refValue($,new DocumentKey(er))}if(et instanceof DocumentReference)return refValue($,et._key);throw new FirestoreError(t_.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${valueDescription(et)}.`)}function validateDisjunctiveFilterElements($,ee){if(!Array.isArray($)||0===$.length)throw new FirestoreError(t_.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${ee.toString()}' filters.`)}function conflictingOps($){switch($){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function validateNewFieldFilter($,ee){if(ee.isInequality()){let et=getInequalityFilterField($),er=ee.field;if(null!==et&&!et.isEqual(er))throw new FirestoreError(t_.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${et.toString()}' and '${er.toString()}'`);let en=getFirstOrderByField($);null!==en&&validateOrderByAndInequalityMatch($,er,en)}let et=findOpInsideFilters($.filters,conflictingOps(ee.op));if(null!==et){if(et===ee.op)throw new FirestoreError(t_.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${ee.op.toString()}' filter.`);throw new FirestoreError(t_.INVALID_ARGUMENT,`Invalid query. You cannot use '${ee.op.toString()}' filters with '${et.toString()}' filters.`)}}function validateNewFilter($,ee){let et=$,er=ee.getFlattenedFilters();for(let $ of er)validateNewFieldFilter(et,$),et=queryWithAddedFilter(et,$)}function findOpInsideFilters($,ee){for(let et of $)for(let $ of et.getFlattenedFilters())if(ee.indexOf($.op)>=0)return $.op;return null}function validateNewOrderBy($,ee){if(null===getFirstOrderByField($)){let et=getInequalityFilterField($);null!==et&&validateOrderByAndInequalityMatch($,et,ee.field)}}function validateOrderByAndInequalityMatch($,ee,et){if(!et.isEqual(ee))throw new FirestoreError(t_.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${ee.toString()}' and so you must also use '${ee.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${et.toString()}' instead.`)}function validateQueryConstraintArray($){let ee=$.filter($=>$ instanceof QueryCompositeFilterConstraint).length,et=$.filter($=>$ instanceof QueryFieldFilterConstraint).length;if(ee>1||ee>0&&et>0)throw new FirestoreError(t_.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let AbstractUserDataWriter=class AbstractUserDataWriter{convertValue($,ee="none"){switch(typeOrder($)){case 0:return null;case 1:return $.booleanValue;case 2:return normalizeNumber($.integerValue||$.doubleValue);case 3:return this.convertTimestamp($.timestampValue);case 4:return this.convertServerTimestamp($,ee);case 5:return $.stringValue;case 6:return this.convertBytes(normalizeByteString($.bytesValue));case 7:return this.convertReference($.referenceValue);case 8:return this.convertGeoPoint($.geoPointValue);case 9:return this.convertArray($.arrayValue,ee);case 10:return this.convertObject($.mapValue,ee);default:throw fail()}}convertObject($,ee){return this.convertObjectMap($.fields,ee)}convertObjectMap($,ee="none"){let et={};return forEach($,($,er)=>{et[$]=this.convertValue(er,ee)}),et}convertGeoPoint($){return new GeoPoint(normalizeNumber($.latitude),normalizeNumber($.longitude))}convertArray($,ee){return($.values||[]).map($=>this.convertValue($,ee))}convertServerTimestamp($,ee){switch(ee){case"previous":let et=getPreviousValue($);if(null==et)return null;return this.convertValue(et,ee);case"estimate":return this.convertTimestamp(getLocalWriteTime($));default:return null}}convertTimestamp($){let ee=normalizeTimestamp($);return new Timestamp(ee.seconds,ee.nanos)}convertDocumentKey($,ee){let et=ResourcePath.fromString($);hardAssert(isValidResourceName(et));let er=new DatabaseId(et.get(1),et.get(3)),en=new DocumentKey(et.popFirst(5));return er.isEqual(ee)||logError(`Document ${en} contains a document reference within a different database (${er.projectId}/${er.database}) which is not supported. It will be treated as a reference in the current database (${ee.projectId}/${ee.database}) instead.`),en}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function applyFirestoreDataConverter($,ee,et){return $?et&&(et.merge||et.mergeFields)?$.toFirestore(ee,et):$.toFirestore(ee):ee}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let SnapshotMetadata=class SnapshotMetadata{constructor($,ee){this.hasPendingWrites=$,this.fromCache=ee}isEqual($){return this.hasPendingWrites===$.hasPendingWrites&&this.fromCache===$.fromCache}};let DocumentSnapshot=class DocumentSnapshot extends DocumentSnapshot$1{constructor($,ee,et,er,en,ei){super($,ee,et,er,ei),this._firestore=$,this._firestoreImpl=$,this.metadata=en}exists(){return super.exists()}data($={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,$.serverTimestamps);{let ee=new QueryDocumentSnapshot(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(ee,$)}}}get($,ee={}){if(this._document){let et=this._document.data.field(fieldPathFromArgument("DocumentSnapshot.get",$));if(null!==et)return this._userDataWriter.convertValue(et,ee.serverTimestamps)}}};let QueryDocumentSnapshot=class QueryDocumentSnapshot extends DocumentSnapshot{data($={}){return super.data($)}};let QuerySnapshot=class QuerySnapshot{constructor($,ee,et,er){this._firestore=$,this._userDataWriter=ee,this._snapshot=er,this.metadata=new SnapshotMetadata(er.hasPendingWrites,er.fromCache),this.query=et}get docs(){let $=[];return this.forEach(ee=>$.push(ee)),$}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach($,ee){this._snapshot.docs.forEach(et=>{$.call(ee,new QueryDocumentSnapshot(this._firestore,this._userDataWriter,et.key,et,new SnapshotMetadata(this._snapshot.mutatedKeys.has(et.key),this._snapshot.fromCache),this.query.converter))})}docChanges($={}){let ee=!!$.includeMetadataChanges;if(ee&&this._snapshot.excludesMetadataChanges)throw new FirestoreError(t_.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===ee||(this._cachedChanges=changesFromSnapshot(this,ee),this._cachedChangesIncludeMetadataChanges=ee),this._cachedChanges}};function changesFromSnapshot($,ee){if($._snapshot.oldDocs.isEmpty()){let ee=0;return $._snapshot.docChanges.map(et=>{let er=new QueryDocumentSnapshot($._firestore,$._userDataWriter,et.doc.key,et.doc,new SnapshotMetadata($._snapshot.mutatedKeys.has(et.doc.key),$._snapshot.fromCache),$.query.converter);return et.doc,{type:"added",doc:er,oldIndex:-1,newIndex:ee++}})}{let et=$._snapshot.oldDocs;return $._snapshot.docChanges.filter($=>ee||3!==$.type).map(ee=>{let er=new QueryDocumentSnapshot($._firestore,$._userDataWriter,ee.doc.key,ee.doc,new SnapshotMetadata($._snapshot.mutatedKeys.has(ee.doc.key),$._snapshot.fromCache),$.query.converter),en=-1,ei=-1;return 0!==ee.type&&(en=et.indexOf(ee.doc.key),et=et.delete(ee.doc.key)),1!==ee.type&&(ei=(et=et.add(ee.doc)).indexOf(ee.doc.key)),{type:resultChangeType(ee.type),doc:er,oldIndex:en,newIndex:ei}})}}function resultChangeType($){switch($){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return fail()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getDoc($){$=cast($,DocumentReference);let ee=cast($.firestore,Firestore),et=ensureFirestoreConfigured(ee);return firestoreClientGetDocumentViaSnapshotListener(et,$._key).then(et=>convertToDocSnapshot(ee,$,et))}let ExpUserDataWriter=class ExpUserDataWriter extends AbstractUserDataWriter{constructor($){super(),this.firestore=$}convertBytes($){return new Bytes($)}convertReference($){let ee=this.convertDocumentKey($,this.firestore._databaseId);return new DocumentReference(this.firestore,null,ee)}};function getDocs($){$=cast($,Query);let ee=cast($.firestore,Firestore),et=ensureFirestoreConfigured(ee),er=new ExpUserDataWriter(ee);return validateHasExplicitOrderByForLimitToLast($._query),firestoreClientGetDocumentsViaSnapshotListener(et,$._query).then(et=>new QuerySnapshot(ee,er,$,et))}function setDoc($,ee,et){$=cast($,DocumentReference);let er=cast($.firestore,Firestore),en=applyFirestoreDataConverter($.converter,ee,et),ei=newUserDataReader(er),es=parseSetData(ei,"setDoc",$._key,en,null!==$.converter,et),eo=es.toMutation($._key,Precondition.none());return executeWrite(er,[eo])}function updateDoc($,ee,et,...er){let en;$=cast($,DocumentReference);let ei=cast($.firestore,Firestore),es=newUserDataReader(ei);en="string"==typeof(ee=(0,em.m9)(ee))||ee instanceof FieldPath?parseUpdateVarargs(es,"updateDoc",$._key,ee,et,er):parseUpdateData(es,"updateDoc",$._key,ee);let eo=en.toMutation($._key,Precondition.exists(!0));return executeWrite(ei,[eo])}function deleteDoc($){let ee=cast($.firestore,Firestore),et=[new DeleteMutation($._key,Precondition.none())];return executeWrite(ee,et)}function addDoc($,ee){let et=cast($.firestore,Firestore),er=doc($),en=applyFirestoreDataConverter($.converter,ee),ei=newUserDataReader($.firestore),es=parseSetData(ei,"addDoc",er._key,en,null!==$.converter,{}),eo=es.toMutation(er._key,Precondition.exists(!1));return executeWrite(et,[eo]).then(()=>er)}function executeWrite($,ee){let et=ensureFirestoreConfigured($);return firestoreClientWrite(et,ee)}function convertToDocSnapshot($,ee,et){let er=et.docs.get(ee._key),en=new ExpUserDataWriter($);return new DocumentSnapshot($,en,ee._key,er,new SnapshotMetadata(et.hasPendingWrites,et.fromCache),ee.converter)}let SingleTabManagerImpl=class SingleTabManagerImpl{constructor($){this.forceOwnership=$,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize($){this._onlineComponentProvider=new OnlineComponentProvider,this._offlineComponentProvider=new IndexedDbOfflineComponentProvider(this._onlineComponentProvider,null==$?void 0:$.cacheSizeBytes,this.forceOwnership)}};new WeakMap,/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */registerFirestore("node")},81513:$=>{"use strict";$.exports={i8:"1.9.5"}},56541:$=>{"use strict";$.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Api":{"fields":{"name":{"type":"string","id":1},"methods":{"rule":"repeated","type":"Method","id":2},"options":{"rule":"repeated","type":"Option","id":3},"version":{"type":"string","id":4},"sourceContext":{"type":"SourceContext","id":5},"mixins":{"rule":"repeated","type":"Mixin","id":6},"syntax":{"type":"Syntax","id":7}}},"Method":{"fields":{"name":{"type":"string","id":1},"requestTypeUrl":{"type":"string","id":2},"requestStreaming":{"type":"bool","id":3},"responseTypeUrl":{"type":"string","id":4},"responseStreaming":{"type":"bool","id":5},"options":{"rule":"repeated","type":"Option","id":6},"syntax":{"type":"Syntax","id":7}}},"Mixin":{"fields":{"name":{"type":"string","id":1},"root":{"type":"string","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}}}}}}}}')},89987:$=>{"use strict";$.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"FileDescriptorSet":{"fields":{"file":{"rule":"repeated","type":"FileDescriptorProto","id":1}}},"FileDescriptorProto":{"fields":{"name":{"type":"string","id":1},"package":{"type":"string","id":2},"dependency":{"rule":"repeated","type":"string","id":3},"publicDependency":{"rule":"repeated","type":"int32","id":10,"options":{"packed":false}},"weakDependency":{"rule":"repeated","type":"int32","id":11,"options":{"packed":false}},"messageType":{"rule":"repeated","type":"DescriptorProto","id":4},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":5},"service":{"rule":"repeated","type":"ServiceDescriptorProto","id":6},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":7},"options":{"type":"FileOptions","id":8},"sourceCodeInfo":{"type":"SourceCodeInfo","id":9},"syntax":{"type":"string","id":12}}},"DescriptorProto":{"fields":{"name":{"type":"string","id":1},"field":{"rule":"repeated","type":"FieldDescriptorProto","id":2},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":6},"nestedType":{"rule":"repeated","type":"DescriptorProto","id":3},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":4},"extensionRange":{"rule":"repeated","type":"ExtensionRange","id":5},"oneofDecl":{"rule":"repeated","type":"OneofDescriptorProto","id":8},"options":{"type":"MessageOptions","id":7},"reservedRange":{"rule":"repeated","type":"ReservedRange","id":9},"reservedName":{"rule":"repeated","type":"string","id":10}},"nested":{"ExtensionRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}},"ReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"FieldDescriptorProto":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":3},"label":{"type":"Label","id":4},"type":{"type":"Type","id":5},"typeName":{"type":"string","id":6},"extendee":{"type":"string","id":2},"defaultValue":{"type":"string","id":7},"oneofIndex":{"type":"int32","id":9},"jsonName":{"type":"string","id":10},"options":{"type":"FieldOptions","id":8}},"nested":{"Type":{"values":{"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Label":{"values":{"LABEL_OPTIONAL":1,"LABEL_REQUIRED":2,"LABEL_REPEATED":3}}}},"OneofDescriptorProto":{"fields":{"name":{"type":"string","id":1},"options":{"type":"OneofOptions","id":2}}},"EnumDescriptorProto":{"fields":{"name":{"type":"string","id":1},"value":{"rule":"repeated","type":"EnumValueDescriptorProto","id":2},"options":{"type":"EnumOptions","id":3}}},"EnumValueDescriptorProto":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"type":"EnumValueOptions","id":3}}},"ServiceDescriptorProto":{"fields":{"name":{"type":"string","id":1},"method":{"rule":"repeated","type":"MethodDescriptorProto","id":2},"options":{"type":"ServiceOptions","id":3}}},"MethodDescriptorProto":{"fields":{"name":{"type":"string","id":1},"inputType":{"type":"string","id":2},"outputType":{"type":"string","id":3},"options":{"type":"MethodOptions","id":4},"clientStreaming":{"type":"bool","id":5},"serverStreaming":{"type":"bool","id":6}}},"FileOptions":{"fields":{"javaPackage":{"type":"string","id":1},"javaOuterClassname":{"type":"string","id":8},"javaMultipleFiles":{"type":"bool","id":10},"javaGenerateEqualsAndHash":{"type":"bool","id":20,"options":{"deprecated":true}},"javaStringCheckUtf8":{"type":"bool","id":27},"optimizeFor":{"type":"OptimizeMode","id":9,"options":{"default":"SPEED"}},"goPackage":{"type":"string","id":11},"ccGenericServices":{"type":"bool","id":16},"javaGenericServices":{"type":"bool","id":17},"pyGenericServices":{"type":"bool","id":18},"deprecated":{"type":"bool","id":23},"ccEnableArenas":{"type":"bool","id":31},"objcClassPrefix":{"type":"string","id":36},"csharpNamespace":{"type":"string","id":37},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[38,38]],"nested":{"OptimizeMode":{"values":{"SPEED":1,"CODE_SIZE":2,"LITE_RUNTIME":3}}}},"MessageOptions":{"fields":{"messageSetWireFormat":{"type":"bool","id":1},"noStandardDescriptorAccessor":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"mapEntry":{"type":"bool","id":7},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[8,8]]},"FieldOptions":{"fields":{"ctype":{"type":"CType","id":1,"options":{"default":"STRING"}},"packed":{"type":"bool","id":2},"jstype":{"type":"JSType","id":6,"options":{"default":"JS_NORMAL"}},"lazy":{"type":"bool","id":5},"deprecated":{"type":"bool","id":3},"weak":{"type":"bool","id":10},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4]],"nested":{"CType":{"values":{"STRING":0,"CORD":1,"STRING_PIECE":2}},"JSType":{"values":{"JS_NORMAL":0,"JS_STRING":1,"JS_NUMBER":2}}}},"OneofOptions":{"fields":{"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumOptions":{"fields":{"allowAlias":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumValueOptions":{"fields":{"deprecated":{"type":"bool","id":1},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"ServiceOptions":{"fields":{"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"MethodOptions":{"fields":{"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"UninterpretedOption":{"fields":{"name":{"rule":"repeated","type":"NamePart","id":2},"identifierValue":{"type":"string","id":3},"positiveIntValue":{"type":"uint64","id":4},"negativeIntValue":{"type":"int64","id":5},"doubleValue":{"type":"double","id":6},"stringValue":{"type":"bytes","id":7},"aggregateValue":{"type":"string","id":8}},"nested":{"NamePart":{"fields":{"namePart":{"rule":"required","type":"string","id":1},"isExtension":{"rule":"required","type":"bool","id":2}}}}},"SourceCodeInfo":{"fields":{"location":{"rule":"repeated","type":"Location","id":1}},"nested":{"Location":{"fields":{"path":{"rule":"repeated","type":"int32","id":1},"span":{"rule":"repeated","type":"int32","id":2},"leadingComments":{"type":"string","id":3},"trailingComments":{"type":"string","id":4},"leadingDetachedComments":{"rule":"repeated","type":"string","id":6}}}}},"GeneratedCodeInfo":{"fields":{"annotation":{"rule":"repeated","type":"Annotation","id":1}},"nested":{"Annotation":{"fields":{"path":{"rule":"repeated","type":"int32","id":1},"sourceFile":{"type":"string","id":2},"begin":{"type":"int32","id":3},"end":{"type":"int32","id":4}}}}}}}}}}}')},57674:$=>{"use strict";$.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')},73795:$=>{"use strict";$.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Type":{"fields":{"name":{"type":"string","id":1},"fields":{"rule":"repeated","type":"Field","id":2},"oneofs":{"rule":"repeated","type":"string","id":3},"options":{"rule":"repeated","type":"Option","id":4},"sourceContext":{"type":"SourceContext","id":5},"syntax":{"type":"Syntax","id":6}}},"Field":{"fields":{"kind":{"type":"Kind","id":1},"cardinality":{"type":"Cardinality","id":2},"number":{"type":"int32","id":3},"name":{"type":"string","id":4},"typeUrl":{"type":"string","id":6},"oneofIndex":{"type":"int32","id":7},"packed":{"type":"bool","id":8},"options":{"rule":"repeated","type":"Option","id":9},"jsonName":{"type":"string","id":10},"defaultValue":{"type":"string","id":11}},"nested":{"Kind":{"values":{"TYPE_UNKNOWN":0,"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Cardinality":{"values":{"CARDINALITY_UNKNOWN":0,"CARDINALITY_OPTIONAL":1,"CARDINALITY_REQUIRED":2,"CARDINALITY_REPEATED":3}}}},"Enum":{"fields":{"name":{"type":"string","id":1},"enumvalue":{"rule":"repeated","type":"EnumValue","id":2},"options":{"rule":"repeated","type":"Option","id":3},"sourceContext":{"type":"SourceContext","id":4},"syntax":{"type":"Syntax","id":5}}},"EnumValue":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"rule":"repeated","type":"Option","id":3}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}},"Any":{"fields":{"type_url":{"type":"string","id":1},"value":{"type":"bytes","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')}};